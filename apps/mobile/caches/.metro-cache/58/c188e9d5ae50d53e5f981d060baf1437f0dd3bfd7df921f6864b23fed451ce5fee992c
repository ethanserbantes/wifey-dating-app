{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"apollo-link-token-refresh","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":61,"index":61}}],"key":"k0kHaK6RPdAI7PB6DeVqFVw4EpM=","exportNames":["*"],"imports":1}},{"name":"jwt-decode","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":62},"end":{"line":2,"column":39,"index":101}}],"key":"Ctk48ebkS2nqaQvz9JtD6w/U1Fs=","exportNames":["*"],"imports":1}},{"name":"../../constants","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":102},"end":{"line":3,"column":42,"index":144}}],"key":"YsZOVsdLlPVn6jRFd6doj+rn3ws=","exportNames":["*"],"imports":1}},{"name":"../../stores/authStore","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":145},"end":{"line":4,"column":54,"index":199}}],"key":"qgo985sE+Pdg3kJBBNYMI1GH+6Q=","exportNames":["*"],"imports":1}},{"name":"expo-router","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":200},"end":{"line":5,"column":37,"index":237}}],"key":"/+ErnBisjrT6aDU+GRp5Qz/lYoY=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"tokenRefreshLink\", {\n    enumerable: true,\n    get: function () {\n      return tokenRefreshLink;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0]);\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _apolloLinkTokenRefresh = require(_dependencyMap[1]);\n  var _jwtDecode = require(_dependencyMap[2]);\n  var _constants = require(_dependencyMap[3]);\n  var _storesAuthStore = require(_dependencyMap[4]);\n  var _expoRouter = require(_dependencyMap[5]);\n  function getMutationName(doc) {\n    var mutation = doc.definitions.find(def => def.kind === 'OperationDefinition' && def.operation === 'mutation');\n    var selection = mutation?.selectionSet.selections[0];\n    if (selection?.kind === 'Field') {\n      return selection.name.value;\n    }\n    return undefined;\n  }\n  var WHITELISTED_MUTATIONS = ['requestMagicLink', 'signUpWithMagicLinkOrRequestMagicLink', 'signInWithMagicLinkCode'];\n  var tokenRefreshLink = new _apolloLinkTokenRefresh.TokenRefreshLink({\n    accessTokenField: 'payload',\n    isTokenValidOrUndefined: function () {\n      var _ref = (0, _asyncToGenerator.default)(function* (operation) {\n        var operationName = getMutationName(operation.query);\n        // these do not need valid tokens\n        if (operationName && WHITELISTED_MUTATIONS.includes(operationName)) {\n          return true;\n        }\n        var token = _storesAuthStore.useAuthStore.getState().auth?.accessToken;\n        if (!token) {\n          return true;\n        }\n        var claims = (0, _jwtDecode.jwtDecode)(token);\n        if (!claims.exp) return true;\n        var expirationTimeInSeconds = claims.exp * 1000;\n        var now = new Date();\n        var isValid = expirationTimeInSeconds >= now.getTime();\n        return isValid;\n      });\n      return function isTokenValidOrUndefined(_x) {\n        return _ref.apply(this, arguments);\n      };\n    }(),\n    fetchAccessToken: function () {\n      var _ref2 = (0, _asyncToGenerator.default)(function* () {\n        var headers = new Headers();\n        headers.append('Content-Type', 'application/json');\n        var refreshToken = _storesAuthStore.useAuthStore.getState().auth?.refreshToken;\n        if (refreshToken) {\n          headers.append('x-anything-refresh-token', refreshToken);\n        }\n        var response = yield fetch(`${_constants.API_URL}/refresh_token`, {\n          method: 'POST',\n          headers\n        });\n        if (!response.ok) {\n          throw new Error('Failed to refresh token');\n        }\n        return response.json();\n      });\n      return function fetchAccessToken() {\n        return _ref2.apply(this, arguments);\n      };\n    }(),\n    handleError: () => {\n      _storesAuthStore.useAuthStore.getState().setAuth(null);\n      _expoRouter.router.replace('/');\n    },\n    handleFetch: auth => {\n      _storesAuthStore.useAuthStore.getState().setAuth(auth);\n    },\n    handleResponse: (_operation, _accessTokenField) => response => {\n      if (response.ok) {\n        return {\n          payload: {\n            accessToken: response.accessToken,\n            refreshToken: response.refreshToken\n          }\n        };\n      }\n      return {\n        payload: null\n      };\n    }\n  });\n});","lineCount":100,"map":[[12,2,19,0,"Object"],[12,8,19,0],[12,9,19,0,"defineProperty"],[12,23,19,0],[12,24,19,0,"exports"],[12,31,19,0],[13,4,19,0,"enumerable"],[13,14,19,0],[14,4,19,0,"get"],[14,7,19,0],[14,18,19,0,"get"],[14,19,19,0],[15,6,19,0],[15,13,19,0,"tokenRefreshLink"],[15,29,19,0],[16,4,19,0],[17,2,19,0],[18,2,73,3],[18,6,73,3,"_babelRuntimeHelpersAsyncToGenerator"],[18,42,73,3],[18,45,73,3,"require"],[18,52,73,3],[18,53,73,3,"_dependencyMap"],[18,67,73,3],[19,2,73,3],[19,6,73,3,"_asyncToGenerator"],[19,23,73,3],[19,26,73,3,"_interopDefault"],[19,41,73,3],[19,42,73,3,"_babelRuntimeHelpersAsyncToGenerator"],[19,78,73,3],[20,2,1,0],[20,6,1,0,"_apolloLinkTokenRefresh"],[20,29,1,0],[20,32,1,0,"require"],[20,39,1,0],[20,40,1,0,"_dependencyMap"],[20,54,1,0],[21,2,2,0],[21,6,2,0,"_jwtDecode"],[21,16,2,0],[21,19,2,0,"require"],[21,26,2,0],[21,27,2,0,"_dependencyMap"],[21,41,2,0],[22,2,3,0],[22,6,3,0,"_constants"],[22,16,3,0],[22,19,3,0,"require"],[22,26,3,0],[22,27,3,0,"_dependencyMap"],[22,41,3,0],[23,2,4,0],[23,6,4,0,"_storesAuthStore"],[23,22,4,0],[23,25,4,0,"require"],[23,32,4,0],[23,33,4,0,"_dependencyMap"],[23,47,4,0],[24,2,5,0],[24,6,5,0,"_expoRouter"],[24,17,5,0],[24,20,5,0,"require"],[24,27,5,0],[24,28,5,0,"_dependencyMap"],[24,42,5,0],[25,2,6,0],[25,11,6,9,"getMutationName"],[25,26,6,24,"getMutationName"],[25,27,6,25,"doc"],[25,30,6,28],[25,32,6,30],[26,4,7,4],[26,8,7,10,"mutation"],[26,16,7,18],[26,19,7,21,"doc"],[26,22,7,24],[26,23,7,25,"definitions"],[26,34,7,36],[26,35,7,37,"find"],[26,39,7,41],[26,40,7,43,"def"],[26,43,7,46],[26,47,7,51,"def"],[26,50,7,54],[26,51,7,55,"kind"],[26,55,7,59],[26,60,7,64],[26,81,7,85],[26,85,7,89,"def"],[26,88,7,92],[26,89,7,93,"operation"],[26,98,7,102],[26,103,7,107],[26,113,7,117],[26,114,7,118],[27,4,8,4],[27,8,8,10,"selection"],[27,17,8,19],[27,20,8,22,"mutation"],[27,28,8,30],[27,30,8,32,"selectionSet"],[27,42,8,44],[27,43,8,45,"selections"],[27,53,8,55],[27,54,8,56],[27,55,8,57],[27,56,8,58],[28,4,9,4],[28,8,9,8,"selection"],[28,17,9,17],[28,19,9,19,"kind"],[28,23,9,23],[28,28,9,28],[28,35,9,35],[28,37,9,37],[29,6,10,8],[29,13,10,15,"selection"],[29,22,10,24],[29,23,10,25,"name"],[29,27,10,29],[29,28,10,30,"value"],[29,33,10,35],[30,4,11,4],[31,4,12,4],[31,11,12,11,"undefined"],[31,20,12,20],[32,2,13,0],[33,2,14,0],[33,6,14,6,"WHITELISTED_MUTATIONS"],[33,27,14,27],[33,30,14,30],[33,31,15,4],[33,49,15,22],[33,51,16,4],[33,90,16,43],[33,92,17,4],[33,117,17,29],[33,118,18,1],[34,2,19,7],[34,6,19,13,"tokenRefreshLink"],[34,22,19,29],[34,25,19,32],[34,29,19,36,"TokenRefreshLink"],[34,52,19,52],[34,53,19,52,"TokenRefreshLink"],[34,69,19,52],[34,70,19,53],[35,4,20,4,"accessTokenField"],[35,20,20,20],[35,22,20,22],[35,31,20,31],[36,4,21,4,"isTokenValidOrUndefined"],[36,27,21,27],[37,6,21,27],[37,10,21,27,"_ref"],[37,14,21,27],[37,21,21,27,"_asyncToGenerator"],[37,38,21,27],[37,39,21,27,"default"],[37,46,21,27],[37,48,21,29],[37,59,21,36,"operation"],[37,68,21,45],[37,70,21,50],[38,8,22,8],[38,12,22,14,"operationName"],[38,25,22,27],[38,28,22,30,"getMutationName"],[38,43,22,45],[38,44,22,46,"operation"],[38,53,22,55],[38,54,22,56,"query"],[38,59,22,61],[38,60,22,62],[39,8,23,8],[40,8,24,8],[40,12,24,12,"operationName"],[40,25,24,25],[40,29,24,29,"WHITELISTED_MUTATIONS"],[40,50,24,50],[40,51,24,51,"includes"],[40,59,24,59],[40,60,24,60,"operationName"],[40,73,24,73],[40,74,24,74],[40,76,24,76],[41,10,25,12],[41,17,25,19],[41,21,25,23],[42,8,26,8],[43,8,27,8],[43,12,27,14,"token"],[43,17,27,19],[43,20,27,22,"useAuthStore"],[43,36,27,34],[43,37,27,34,"useAuthStore"],[43,49,27,34],[43,50,27,35,"getState"],[43,58,27,43],[43,59,27,44],[43,60,27,45],[43,61,27,46,"auth"],[43,65,27,50],[43,67,27,52,"accessToken"],[43,78,27,63],[44,8,28,8],[44,12,28,12],[44,13,28,13,"token"],[44,18,28,18],[44,20,28,20],[45,10,29,12],[45,17,29,19],[45,21,29,23],[46,8,30,8],[47,8,31,8],[47,12,31,14,"claims"],[47,18,31,20],[47,21,31,23],[47,25,31,23,"jwtDecode"],[47,35,31,32],[47,36,31,32,"jwtDecode"],[47,45,31,32],[47,47,31,33,"token"],[47,52,31,38],[47,53,31,39],[48,8,32,8],[48,12,32,12],[48,13,32,13,"claims"],[48,19,32,19],[48,20,32,20,"exp"],[48,23,32,23],[48,25,33,12],[48,32,33,19],[48,36,33,23],[49,8,34,8],[49,12,34,14,"expirationTimeInSeconds"],[49,35,34,37],[49,38,34,40,"claims"],[49,44,34,46],[49,45,34,47,"exp"],[49,48,34,50],[49,51,34,53],[49,55,34,57],[50,8,35,8],[50,12,35,14,"now"],[50,15,35,17],[50,18,35,20],[50,22,35,24,"Date"],[50,26,35,28],[50,27,35,29],[50,28,35,30],[51,8,36,8],[51,12,36,14,"isValid"],[51,19,36,21],[51,22,36,24,"expirationTimeInSeconds"],[51,45,36,47],[51,49,36,51,"now"],[51,52,36,54],[51,53,36,55,"getTime"],[51,60,36,62],[51,61,36,63],[51,62,36,64],[52,8,37,8],[52,15,37,15,"isValid"],[52,22,37,22],[53,6,38,4],[53,7,38,5],[54,6,38,5],[54,22,21,4,"isTokenValidOrUndefined"],[54,45,21,27,"isTokenValidOrUndefined"],[54,46,21,27,"_x"],[54,48,21,27],[55,8,21,27],[55,15,21,27,"_ref"],[55,19,21,27],[55,20,21,27,"apply"],[55,25,21,27],[55,32,21,27,"arguments"],[55,41,21,27],[56,6,21,27],[57,4,21,27],[57,7,38,5],[58,4,39,4,"fetchAccessToken"],[58,20,39,20],[59,6,39,20],[59,10,39,20,"_ref2"],[59,15,39,20],[59,22,39,20,"_asyncToGenerator"],[59,39,39,20],[59,40,39,20,"default"],[59,47,39,20],[59,49,39,22],[59,62,39,34],[60,8,40,8],[60,12,40,14,"headers"],[60,19,40,21],[60,22,40,24],[60,26,40,28,"Headers"],[60,33,40,35],[60,34,40,36],[60,35,40,37],[61,8,41,8,"headers"],[61,15,41,15],[61,16,41,16,"append"],[61,22,41,22],[61,23,41,23],[61,37,41,37],[61,39,41,39],[61,57,41,57],[61,58,41,58],[62,8,42,8],[62,12,42,14,"refreshToken"],[62,24,42,26],[62,27,42,29,"useAuthStore"],[62,43,42,41],[62,44,42,41,"useAuthStore"],[62,56,42,41],[62,57,42,42,"getState"],[62,65,42,50],[62,66,42,51],[62,67,42,52],[62,68,42,53,"auth"],[62,72,42,57],[62,74,42,59,"refreshToken"],[62,86,42,71],[63,8,43,8],[63,12,43,12,"refreshToken"],[63,24,43,24],[63,26,43,26],[64,10,44,12,"headers"],[64,17,44,19],[64,18,44,20,"append"],[64,24,44,26],[64,25,44,27],[64,51,44,53],[64,53,44,55,"refreshToken"],[64,65,44,67],[64,66,44,68],[65,8,45,8],[66,8,46,8],[66,12,46,14,"response"],[66,20,46,22],[66,29,46,31,"fetch"],[66,34,46,36],[66,35,46,37],[66,38,46,40,"API_URL"],[66,48,46,47],[66,49,46,47,"API_URL"],[66,56,46,47],[66,72,46,63],[66,74,46,65],[67,10,47,12,"method"],[67,16,47,18],[67,18,47,20],[67,24,47,26],[68,10,48,12,"headers"],[69,8,49,8],[69,9,49,9],[69,10,49,10],[70,8,50,8],[70,12,50,12],[70,13,50,13,"response"],[70,21,50,21],[70,22,50,22,"ok"],[70,24,50,24],[70,26,50,26],[71,10,51,12],[71,16,51,18],[71,20,51,22,"Error"],[71,25,51,27],[71,26,51,28],[71,51,51,53],[71,52,51,54],[72,8,52,8],[73,8,53,8],[73,15,53,15,"response"],[73,23,53,23],[73,24,53,24,"json"],[73,28,53,28],[73,29,53,29],[73,30,53,30],[74,6,54,4],[74,7,54,5],[75,6,54,5],[75,22,39,4,"fetchAccessToken"],[75,38,39,20,"fetchAccessToken"],[75,39,39,20],[76,8,39,20],[76,15,39,20,"_ref2"],[76,20,39,20],[76,21,39,20,"apply"],[76,26,39,20],[76,33,39,20,"arguments"],[76,42,39,20],[77,6,39,20],[78,4,39,20],[78,7,54,5],[79,4,55,4,"handleError"],[79,15,55,15],[79,17,55,17,"handleError"],[79,18,55,17],[79,23,55,23],[80,6,56,8,"useAuthStore"],[80,22,56,20],[80,23,56,20,"useAuthStore"],[80,35,56,20],[80,36,56,21,"getState"],[80,44,56,29],[80,45,56,30],[80,46,56,31],[80,47,56,32,"setAuth"],[80,54,56,39],[80,55,56,40],[80,59,56,44],[80,60,56,45],[81,6,57,8,"router"],[81,17,57,14],[81,18,57,14,"router"],[81,24,57,14],[81,25,57,15,"replace"],[81,32,57,22],[81,33,57,23],[81,36,57,26],[81,37,57,27],[82,4,58,4],[82,5,58,5],[83,4,59,4,"handleFetch"],[83,15,59,15],[83,17,59,18,"auth"],[83,21,59,22],[83,25,59,27],[84,6,60,8,"useAuthStore"],[84,22,60,20],[84,23,60,20,"useAuthStore"],[84,35,60,20],[84,36,60,21,"getState"],[84,44,60,29],[84,45,60,30],[84,46,60,31],[84,47,60,32,"setAuth"],[84,54,60,39],[84,55,60,40,"auth"],[84,59,60,44],[84,60,60,45],[85,4,61,4],[85,5,61,5],[86,4,62,4,"handleResponse"],[86,18,62,18],[86,20,62,20,"handleResponse"],[86,21,62,21,"_operation"],[86,31,62,31],[86,33,62,33,"_accessTokenField"],[86,50,62,50],[86,55,62,56,"response"],[86,63,62,64],[86,67,62,69],[87,6,63,8],[87,10,63,12,"response"],[87,18,63,20],[87,19,63,21,"ok"],[87,21,63,23],[87,23,63,25],[88,8,64,12],[88,15,64,19],[89,10,65,16,"payload"],[89,17,65,23],[89,19,65,25],[90,12,66,20,"accessToken"],[90,23,66,31],[90,25,66,33,"response"],[90,33,66,41],[90,34,66,42,"accessToken"],[90,45,66,53],[91,12,67,20,"refreshToken"],[91,24,67,32],[91,26,67,34,"response"],[91,34,67,42],[91,35,67,43,"refreshToken"],[92,10,68,16],[93,8,69,12],[93,9,69,13],[94,6,70,8],[95,6,71,8],[95,13,71,15],[96,8,71,17,"payload"],[96,15,71,24],[96,17,71,26],[97,6,71,31],[97,7,71,32],[98,4,72,4],[99,2,73,0],[99,3,73,1],[99,4,73,2],[100,0,73,3],[100,3]],"functionMap":{"names":["<global>","getMutationName","doc.definitions.find$argument_0","TokenRefreshLink$argument_0.isTokenValidOrUndefined","TokenRefreshLink$argument_0.fetchAccessToken","TokenRefreshLink$argument_0.handleError","TokenRefreshLink$argument_0.handleFetch","TokenRefreshLink$argument_0.handleResponse","<anonymous>"],"mappings":"AAA;ACK;0CCC,2ED;CDM;6BGQ;KHiB;sBIC;KJe;iBKC;KLG;iBMC;KNE;oBOC,mCC;KRU"},"hasCjsExports":false},"type":"js/module"}]}