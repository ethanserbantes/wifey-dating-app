{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":42,"index":42}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.usePreChatDecisionTimers = usePreChatDecisionTimers;\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0]);\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _react = require(_dependencyMap[1]);\n  function usePreChatDecisionTimers(_ref) {\n    var user = _ref.user,\n      preChatRows = _ref.preChatRows,\n      loading = _ref.loading,\n      otherChatsHidden = _ref.otherChatsHidden,\n      loadMatches = _ref.loadMatches;\n    var startedDecisionTimersRef = (0, _react.useRef)(new Set());\n    (0, _react.useEffect)(() => {\n      if (otherChatsHidden) return;\n      var userIdNum = Number(user?.id);\n      if (!Number.isFinite(userIdNum)) return;\n      if (loading) return;\n      var candidates = (Array.isArray(preChatRows) ? preChatRows : []).filter(m => String(m?.prechat_role) === \"receiver\").filter(m => !m?.decision_expires_at).filter(m => !m?.terminal_state).slice(0, 6);\n      var toStart = candidates.filter(m => {\n        var idStr = m?.match_id != null ? String(m.match_id) : \"\";\n        if (!idStr) return false;\n        if (startedDecisionTimersRef.current.has(idStr)) return false;\n        return true;\n      });\n      if (toStart.length === 0) return;\n      toStart.forEach(m => {\n        var idStr = String(m.match_id);\n        startedDecisionTimersRef.current.add(idStr);\n      });\n      var cancelled = false;\n      var run = /*#__PURE__*/function () {\n        var _ref2 = (0, _asyncToGenerator.default)(function* () {\n          try {\n            var results = yield Promise.all(toStart.map(/*#__PURE__*/function () {\n              var _ref3 = (0, _asyncToGenerator.default)(function* (m) {\n                var matchIdStr = String(m.match_id);\n                var resp = yield fetch(`/api/conversations/prechat-seen/${encodeURIComponent(matchIdStr)}`, {\n                  method: \"POST\",\n                  headers: {\n                    \"Content-Type\": \"application/json\"\n                  },\n                  body: JSON.stringify({\n                    userId: userIdNum\n                  })\n                });\n                if (!resp.ok) {\n                  var text = yield resp.text().catch(() => \"\");\n                  throw new Error(`When posting /api/conversations/prechat-seen/${matchIdStr}, the response was [${resp.status}] ${resp.statusText}. ${text}`);\n                }\n                var data = yield resp.json().catch(() => ({}));\n                return Boolean(data?.started);\n              });\n              return function (_x) {\n                return _ref3.apply(this, arguments);\n              };\n            }()));\n            var startedAny = results.some(Boolean);\n            if (!cancelled && startedAny) {\n              yield loadMatches(userIdNum);\n            }\n          } catch (e) {\n            console.error(e);\n          }\n        });\n        return function run() {\n          return _ref2.apply(this, arguments);\n        };\n      }();\n      run();\n      return () => {\n        cancelled = true;\n      };\n    }, [loading, loadMatches, otherChatsHidden, preChatRows, user?.id]);\n  }\n});","lineCount":85,"map":[[12,2,3,0,"exports"],[12,9,3,0],[12,10,3,0,"usePreChatDecisionTimers"],[12,34,3,0],[12,37,3,0,"usePreChatDecisionTimers"],[12,61,3,0],[13,2,82,1],[13,6,82,1,"_babelRuntimeHelpersAsyncToGenerator"],[13,42,82,1],[13,45,82,1,"require"],[13,52,82,1],[13,53,82,1,"_dependencyMap"],[13,67,82,1],[14,2,82,1],[14,6,82,1,"_asyncToGenerator"],[14,23,82,1],[14,26,82,1,"_interopDefault"],[14,41,82,1],[14,42,82,1,"_babelRuntimeHelpersAsyncToGenerator"],[14,78,82,1],[15,2,1,0],[15,6,1,0,"_react"],[15,12,1,0],[15,15,1,0,"require"],[15,22,1,0],[15,23,1,0,"_dependencyMap"],[15,37,1,0],[16,2,3,7],[16,11,3,16,"usePreChatDecisionTimers"],[16,35,3,40,"usePreChatDecisionTimers"],[16,36,3,40,"_ref"],[16,40,3,40],[16,42,9,3],[17,4,9,3],[17,8,4,2,"user"],[17,12,4,6],[17,15,4,6,"_ref"],[17,19,4,6],[17,20,4,2,"user"],[17,24,4,6],[18,6,5,2,"preChatRows"],[18,17,5,13],[18,20,5,13,"_ref"],[18,24,5,13],[18,25,5,2,"preChatRows"],[18,36,5,13],[19,6,6,2,"loading"],[19,13,6,9],[19,16,6,9,"_ref"],[19,20,6,9],[19,21,6,2,"loading"],[19,28,6,9],[20,6,7,2,"otherChatsHidden"],[20,22,7,18],[20,25,7,18,"_ref"],[20,29,7,18],[20,30,7,2,"otherChatsHidden"],[20,46,7,18],[21,6,8,2,"loadMatches"],[21,17,8,13],[21,20,8,13,"_ref"],[21,24,8,13],[21,25,8,2,"loadMatches"],[21,36,8,13],[22,4,10,2],[22,8,10,8,"startedDecisionTimersRef"],[22,32,10,32],[22,35,10,35],[22,39,10,35,"useRef"],[22,45,10,41],[22,46,10,41,"useRef"],[22,52,10,41],[22,54,10,42],[22,58,10,46,"Set"],[22,61,10,49],[22,62,10,50],[22,63,10,51],[22,64,10,52],[23,4,12,2],[23,8,12,2,"useEffect"],[23,14,12,11],[23,15,12,11,"useEffect"],[23,24,12,11],[23,26,12,12],[23,32,12,18],[24,6,13,4],[24,10,13,8,"otherChatsHidden"],[24,26,13,24],[24,28,13,26],[25,6,15,4],[25,10,15,10,"userIdNum"],[25,19,15,19],[25,22,15,22,"Number"],[25,28,15,28],[25,29,15,29,"user"],[25,33,15,33],[25,35,15,35,"id"],[25,37,15,37],[25,38,15,38],[26,6,16,4],[26,10,16,8],[26,11,16,9,"Number"],[26,17,16,15],[26,18,16,16,"isFinite"],[26,26,16,24],[26,27,16,25,"userIdNum"],[26,36,16,34],[26,37,16,35],[26,39,16,37],[27,6,17,4],[27,10,17,8,"loading"],[27,17,17,15],[27,19,17,17],[28,6,19,4],[28,10,19,10,"candidates"],[28,20,19,20],[28,23,19,23],[28,24,19,24,"Array"],[28,29,19,29],[28,30,19,30,"isArray"],[28,37,19,37],[28,38,19,38,"preChatRows"],[28,49,19,49],[28,50,19,50],[28,53,19,53,"preChatRows"],[28,64,19,64],[28,67,19,67],[28,69,19,69],[28,71,20,7,"filter"],[28,77,20,13],[28,78,20,15,"m"],[28,79,20,16],[28,83,20,21,"String"],[28,89,20,27],[28,90,20,28,"m"],[28,91,20,29],[28,93,20,31,"prechat_role"],[28,105,20,43],[28,106,20,44],[28,111,20,49],[28,121,20,59],[28,122,20,60],[28,123,21,7,"filter"],[28,129,21,13],[28,130,21,15,"m"],[28,131,21,16],[28,135,21,21],[28,136,21,22,"m"],[28,137,21,23],[28,139,21,25,"decision_expires_at"],[28,158,21,44],[28,159,21,45],[28,160,22,7,"filter"],[28,166,22,13],[28,167,22,15,"m"],[28,168,22,16],[28,172,22,21],[28,173,22,22,"m"],[28,174,22,23],[28,176,22,25,"terminal_state"],[28,190,22,39],[28,191,22,40],[28,192,23,7,"slice"],[28,197,23,12],[28,198,23,13],[28,199,23,14],[28,201,23,16],[28,202,23,17],[28,203,23,18],[29,6,25,4],[29,10,25,10,"toStart"],[29,17,25,17],[29,20,25,20,"candidates"],[29,30,25,30],[29,31,25,31,"filter"],[29,37,25,37],[29,38,25,39,"m"],[29,39,25,40],[29,43,25,45],[30,8,26,6],[30,12,26,12,"idStr"],[30,17,26,17],[30,20,26,20,"m"],[30,21,26,21],[30,23,26,23,"match_id"],[30,31,26,31],[30,35,26,35],[30,39,26,39],[30,42,26,42,"String"],[30,48,26,48],[30,49,26,49,"m"],[30,50,26,50],[30,51,26,51,"match_id"],[30,59,26,59],[30,60,26,60],[30,63,26,63],[30,65,26,65],[31,8,27,6],[31,12,27,10],[31,13,27,11,"idStr"],[31,18,27,16],[31,20,27,18],[31,27,27,25],[31,32,27,30],[32,8,28,6],[32,12,28,10,"startedDecisionTimersRef"],[32,36,28,34],[32,37,28,35,"current"],[32,44,28,42],[32,45,28,43,"has"],[32,48,28,46],[32,49,28,47,"idStr"],[32,54,28,52],[32,55,28,53],[32,57,28,55],[32,64,28,62],[32,69,28,67],[33,8,29,6],[33,15,29,13],[33,19,29,17],[34,6,30,4],[34,7,30,5],[34,8,30,6],[35,6,32,4],[35,10,32,8,"toStart"],[35,17,32,15],[35,18,32,16,"length"],[35,24,32,22],[35,29,32,27],[35,30,32,28],[35,32,32,30],[36,6,34,4,"toStart"],[36,13,34,11],[36,14,34,12,"forEach"],[36,21,34,19],[36,22,34,21,"m"],[36,23,34,22],[36,27,34,27],[37,8,35,6],[37,12,35,12,"idStr"],[37,17,35,17],[37,20,35,20,"String"],[37,26,35,26],[37,27,35,27,"m"],[37,28,35,28],[37,29,35,29,"match_id"],[37,37,35,37],[37,38,35,38],[38,8,36,6,"startedDecisionTimersRef"],[38,32,36,30],[38,33,36,31,"current"],[38,40,36,38],[38,41,36,39,"add"],[38,44,36,42],[38,45,36,43,"idStr"],[38,50,36,48],[38,51,36,49],[39,6,37,4],[39,7,37,5],[39,8,37,6],[40,6,39,4],[40,10,39,8,"cancelled"],[40,19,39,17],[40,22,39,20],[40,27,39,25],[41,6,41,4],[41,10,41,10,"run"],[41,13,41,13],[42,8,41,13],[42,12,41,13,"_ref2"],[42,17,41,13],[42,24,41,13,"_asyncToGenerator"],[42,41,41,13],[42,42,41,13,"default"],[42,49,41,13],[42,51,41,16],[42,64,41,28],[43,10,42,6],[43,14,42,10],[44,12,43,8],[44,16,43,14,"results"],[44,23,43,21],[44,32,43,30,"Promise"],[44,39,43,37],[44,40,43,38,"all"],[44,43,43,41],[44,44,44,10,"toStart"],[44,51,44,17],[44,52,44,18,"map"],[44,55,44,21],[45,14,44,21],[45,18,44,21,"_ref3"],[45,23,44,21],[45,30,44,21,"_asyncToGenerator"],[45,47,44,21],[45,48,44,21,"default"],[45,55,44,21],[45,57,44,22],[45,68,44,29,"m"],[45,69,44,30],[45,71,44,35],[46,16,45,12],[46,20,45,18,"matchIdStr"],[46,30,45,28],[46,33,45,31,"String"],[46,39,45,37],[46,40,45,38,"m"],[46,41,45,39],[46,42,45,40,"match_id"],[46,50,45,48],[46,51,45,49],[47,16,46,12],[47,20,46,18,"resp"],[47,24,46,22],[47,33,46,31,"fetch"],[47,38,46,36],[47,39,47,14],[47,74,47,49,"encodeURIComponent"],[47,92,47,67],[47,93,47,68,"matchIdStr"],[47,103,47,78],[47,104,47,79],[47,106,47,81],[47,108,48,14],[48,18,49,16,"method"],[48,24,49,22],[48,26,49,24],[48,32,49,30],[49,18,50,16,"headers"],[49,25,50,23],[49,27,50,25],[50,20,50,27],[50,34,50,41],[50,36,50,43],[51,18,50,62],[51,19,50,63],[52,18,51,16,"body"],[52,22,51,20],[52,24,51,22,"JSON"],[52,28,51,26],[52,29,51,27,"stringify"],[52,38,51,36],[52,39,51,37],[53,20,51,39,"userId"],[53,26,51,45],[53,28,51,47,"userIdNum"],[54,18,51,57],[54,19,51,58],[55,16,52,14],[55,17,53,12],[55,18,53,13],[56,16,55,12],[56,20,55,16],[56,21,55,17,"resp"],[56,25,55,21],[56,26,55,22,"ok"],[56,28,55,24],[56,30,55,26],[57,18,56,14],[57,22,56,20,"text"],[57,26,56,24],[57,35,56,33,"resp"],[57,39,56,37],[57,40,56,38,"text"],[57,44,56,42],[57,45,56,43],[57,46,56,44],[57,47,56,45,"catch"],[57,52,56,50],[57,53,56,51],[57,59,56,57],[57,61,56,59],[57,62,56,60],[58,18,57,14],[58,24,57,20],[58,28,57,24,"Error"],[58,33,57,29],[58,34,58,16],[58,82,58,64,"matchIdStr"],[58,92,58,74],[58,115,58,97,"resp"],[58,119,58,101],[58,120,58,102,"status"],[58,126,58,108],[58,131,58,113,"resp"],[58,135,58,117],[58,136,58,118,"statusText"],[58,146,58,128],[58,151,58,133,"text"],[58,155,58,137],[58,157,59,14],[58,158,59,15],[59,16,60,12],[60,16,62,12],[60,20,62,18,"data"],[60,24,62,22],[60,33,62,31,"resp"],[60,37,62,35],[60,38,62,36,"json"],[60,42,62,40],[60,43,62,41],[60,44,62,42],[60,45,62,43,"catch"],[60,50,62,48],[60,51,62,49],[60,58,62,56],[60,59,62,57],[60,60,62,58],[60,61,62,59],[60,62,62,60],[61,16,63,12],[61,23,63,19,"Boolean"],[61,30,63,26],[61,31,63,27,"data"],[61,35,63,31],[61,37,63,33,"started"],[61,44,63,40],[61,45,63,41],[62,14,64,10],[62,15,64,11],[63,14,64,11],[63,31,64,11,"_x"],[63,33,64,11],[64,16,64,11],[64,23,64,11,"_ref3"],[64,28,64,11],[64,29,64,11,"apply"],[64,34,64,11],[64,41,64,11,"arguments"],[64,50,64,11],[65,14,64,11],[66,12,64,11],[66,16,65,8],[66,17,65,9],[67,12,67,8],[67,16,67,14,"startedAny"],[67,26,67,24],[67,29,67,27,"results"],[67,36,67,34],[67,37,67,35,"some"],[67,41,67,39],[67,42,67,40,"Boolean"],[67,49,67,47],[67,50,67,48],[68,12,68,8],[68,16,68,12],[68,17,68,13,"cancelled"],[68,26,68,22],[68,30,68,26,"startedAny"],[68,40,68,36],[68,42,68,38],[69,14,69,10],[69,20,69,16,"loadMatches"],[69,31,69,27],[69,32,69,28,"userIdNum"],[69,41,69,37],[69,42,69,38],[70,12,70,8],[71,10,71,6],[71,11,71,7],[71,12,71,8],[71,19,71,15,"e"],[71,20,71,16],[71,22,71,18],[72,12,72,8,"console"],[72,19,72,15],[72,20,72,16,"error"],[72,25,72,21],[72,26,72,22,"e"],[72,27,72,23],[72,28,72,24],[73,10,73,6],[74,8,74,4],[74,9,74,5],[75,8,74,5],[75,24,41,10,"run"],[75,27,41,13,"run"],[75,28,41,13],[76,10,41,13],[76,17,41,13,"_ref2"],[76,22,41,13],[76,23,41,13,"apply"],[76,28,41,13],[76,35,41,13,"arguments"],[76,44,41,13],[77,8,41,13],[78,6,41,13],[78,9,74,5],[79,6,76,4,"run"],[79,9,76,7],[79,10,76,8],[79,11,76,9],[80,6,78,4],[80,13,78,11],[80,19,78,17],[81,8,79,6,"cancelled"],[81,17,79,15],[81,20,79,18],[81,24,79,22],[82,6,80,4],[82,7,80,5],[83,4,81,2],[83,5,81,3],[83,7,81,5],[83,8,81,6,"loading"],[83,15,81,13],[83,17,81,15,"loadMatches"],[83,28,81,26],[83,30,81,28,"otherChatsHidden"],[83,46,81,44],[83,48,81,46,"preChatRows"],[83,59,81,57],[83,61,81,59,"user"],[83,65,81,63],[83,67,81,65,"id"],[83,69,81,67],[83,70,81,68],[83,71,81,69],[84,2,82,0],[85,0,82,1],[85,3]],"functionMap":{"names":["<global>","usePreChatDecisionTimers","useEffect$argument_0","filter$argument_0","filter.filter$argument_0","filter.filter.filter$argument_0","candidates.filter$argument_0","toStart.forEach$argument_0","run","toStart.map$argument_0","resp.text._catch$argument_0","resp.json._catch$argument_0","<anonymous>"],"mappings":"AAA;OCE;YCS;cCQ,6CD;cEC,8BF;cGC,yBH;sCIG;KJK;oBKI;KLG;gBMI;sBCG;mDCY,QD;iDEM,UF;WDE;KNU;WUI;KVE;GDC;CDC"},"hasCjsExports":false},"type":"js/module"}]}