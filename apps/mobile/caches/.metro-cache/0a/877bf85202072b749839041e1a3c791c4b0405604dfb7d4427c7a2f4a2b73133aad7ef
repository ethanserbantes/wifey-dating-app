{"dependencies":[{"name":"../utils/object.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":62,"index":62}}],"key":"C8yMer+b+EwEB0LLb8KqXgEktYc=","exportNames":["*"],"imports":1}},{"name":"../utils/worldwide.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":63},"end":{"line":2,"column":51,"index":114}}],"key":"P+UFfr1ne09dGLmc90iZCFaYonQ=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"getCapturedScopesOnSpan\", {\n    enumerable: true,\n    get: function () {\n      return getCapturedScopesOnSpan;\n    }\n  });\n  Object.defineProperty(exports, \"setCapturedScopesOnSpan\", {\n    enumerable: true,\n    get: function () {\n      return setCapturedScopesOnSpan;\n    }\n  });\n  var _utilsObjectJs = require(_dependencyMap[0], \"../utils/object.js\");\n  var _utilsWorldwideJs = require(_dependencyMap[1], \"../utils/worldwide.js\");\n  var SCOPE_ON_START_SPAN_FIELD = '_sentryScope';\n  var ISOLATION_SCOPE_ON_START_SPAN_FIELD = '_sentryIsolationScope';\n\n  /** Wrap a scope with a WeakRef if available, falling back to a direct scope. */\n  function wrapScopeWithWeakRef(scope) {\n    try {\n      // @ts-expect-error - WeakRef is not available in all environments\n      var WeakRefClass = _utilsWorldwideJs.GLOBAL_OBJ.WeakRef;\n      if (typeof WeakRefClass === 'function') {\n        return new WeakRefClass(scope);\n      }\n    } catch {\n      // WeakRef not available or failed to create\n      // We'll fall back to a direct scope\n    }\n    return scope;\n  }\n\n  /** Try to unwrap a scope from a potential WeakRef wrapper. */\n  function unwrapScopeFromWeakRef(scopeRef) {\n    if (!scopeRef) {\n      return undefined;\n    }\n    if (typeof scopeRef === 'object' && 'deref' in scopeRef && typeof scopeRef.deref === 'function') {\n      try {\n        return scopeRef.deref();\n      } catch {\n        return undefined;\n      }\n    }\n\n    // Fallback to a direct scope\n    return scopeRef;\n  }\n\n  /** Store the scope & isolation scope for a span, which can the be used when it is finished. */\n  function setCapturedScopesOnSpan(span, scope, isolationScope) {\n    if (span) {\n      (0, _utilsObjectJs.addNonEnumerableProperty)(span, ISOLATION_SCOPE_ON_START_SPAN_FIELD, wrapScopeWithWeakRef(isolationScope));\n      // We don't wrap the scope with a WeakRef here because webkit aggressively garbage collects\n      // and scopes are not held in memory for long periods of time.\n      (0, _utilsObjectJs.addNonEnumerableProperty)(span, SCOPE_ON_START_SPAN_FIELD, scope);\n    }\n  }\n\n  /**\n   * Grabs the scope and isolation scope off a span that were active when the span was started.\n   * If WeakRef was used and scopes have been garbage collected, returns undefined for those scopes.\n   */\n  function getCapturedScopesOnSpan(span) {\n    var spanWithScopes = span;\n    return {\n      scope: spanWithScopes[SCOPE_ON_START_SPAN_FIELD],\n      isolationScope: unwrapScopeFromWeakRef(spanWithScopes[ISOLATION_SCOPE_ON_START_SPAN_FIELD])\n    };\n  }\n});","lineCount":77,"map":[[7,2,64,0,"Object"],[7,8,64,0],[7,9,64,0,"defineProperty"],[7,23,64,0],[7,24,64,0,"exports"],[7,31,64,0],[8,4,64,0,"enumerable"],[8,14,64,0],[9,4,64,0,"get"],[9,7,64,0],[9,18,64,0,"get"],[9,19,64,0],[10,6,64,0],[10,13,64,9,"getCapturedScopesOnSpan"],[10,36,64,32],[11,4,64,32],[12,2,64,32],[13,2,64,0,"Object"],[13,8,64,0],[13,9,64,0,"defineProperty"],[13,23,64,0],[13,24,64,0,"exports"],[13,31,64,0],[14,4,64,0,"enumerable"],[14,14,64,0],[15,4,64,0,"get"],[15,7,64,0],[15,18,64,0,"get"],[15,19,64,0],[16,6,64,0],[16,13,64,34,"setCapturedScopesOnSpan"],[16,36,64,57],[17,4,64,57],[18,2,64,57],[19,2,1,0],[19,6,1,0,"_utilsObjectJs"],[19,20,1,0],[19,23,1,0,"require"],[19,30,1,0],[19,31,1,0,"_dependencyMap"],[19,45,1,0],[20,2,2,0],[20,6,2,0,"_utilsWorldwideJs"],[20,23,2,0],[20,26,2,0,"require"],[20,33,2,0],[20,34,2,0,"_dependencyMap"],[20,48,2,0],[21,2,4,0],[21,6,4,6,"SCOPE_ON_START_SPAN_FIELD"],[21,31,4,31],[21,34,4,34],[21,48,4,48],[22,2,5,0],[22,6,5,6,"ISOLATION_SCOPE_ON_START_SPAN_FIELD"],[22,41,5,41],[22,44,5,44],[22,67,5,67],[24,2,7,0],[25,2,8,0],[25,11,8,9,"wrapScopeWithWeakRef"],[25,31,8,29,"wrapScopeWithWeakRef"],[25,32,8,30,"scope"],[25,37,8,35],[25,39,8,37],[26,4,9,2],[26,8,9,6],[27,6,10,4],[28,6,11,4],[28,10,11,10,"WeakRefClass"],[28,22,11,22],[28,25,11,25,"GLOBAL_OBJ"],[28,42,11,35],[28,43,11,35,"GLOBAL_OBJ"],[28,53,11,35],[28,54,11,36,"WeakRef"],[28,61,11,43],[29,6,12,4],[29,10,12,8],[29,17,12,15,"WeakRefClass"],[29,29,12,27],[29,34,12,32],[29,44,12,42],[29,46,12,44],[30,8,13,6],[30,15,13,13],[30,19,13,17,"WeakRefClass"],[30,31,13,29],[30,32,13,30,"scope"],[30,37,13,35],[30,38,13,36],[31,6,14,4],[32,4,15,2],[32,5,15,3],[32,6,15,4],[32,12,15,10],[33,6,16,4],[34,6,17,4],[35,4,17,4],[36,4,20,2],[36,11,20,9,"scope"],[36,16,20,14],[37,2,21,0],[39,2,23,0],[40,2,24,0],[40,11,24,9,"unwrapScopeFromWeakRef"],[40,33,24,31,"unwrapScopeFromWeakRef"],[40,34,24,32,"scopeRef"],[40,42,24,40],[40,44,24,42],[41,4,25,2],[41,8,25,6],[41,9,25,7,"scopeRef"],[41,17,25,15],[41,19,25,17],[42,6,26,4],[42,13,26,11,"undefined"],[42,22,26,20],[43,4,27,2],[44,4,29,2],[44,8,29,6],[44,15,29,13,"scopeRef"],[44,23,29,21],[44,28,29,26],[44,36,29,34],[44,40,29,38],[44,47,29,45],[44,51,29,49,"scopeRef"],[44,59,29,57],[44,63,29,61],[44,70,29,68,"scopeRef"],[44,78,29,76],[44,79,29,77,"deref"],[44,84,29,82],[44,89,29,87],[44,99,29,97],[44,101,29,99],[45,6,30,4],[45,10,30,8],[46,8,31,6],[46,15,31,13,"scopeRef"],[46,23,31,21],[46,24,31,22,"deref"],[46,29,31,27],[46,30,31,28],[46,31,31,29],[47,6,32,4],[47,7,32,5],[47,8,32,6],[47,14,32,12],[48,8,33,6],[48,15,33,13,"undefined"],[48,24,33,22],[49,6,34,4],[50,4,35,2],[52,4,37,2],[53,4,38,2],[53,11,38,9,"scopeRef"],[53,19,38,17],[54,2,39,0],[56,2,41,0],[57,2,42,0],[57,11,42,9,"setCapturedScopesOnSpan"],[57,34,42,32,"setCapturedScopesOnSpan"],[57,35,42,33,"span"],[57,39,42,37],[57,41,42,39,"scope"],[57,46,42,44],[57,48,42,46,"isolationScope"],[57,62,42,60],[57,64,42,62],[58,4,43,2],[58,8,43,6,"span"],[58,12,43,10],[58,14,43,12],[59,6,44,4],[59,10,44,4,"addNonEnumerableProperty"],[59,24,44,28],[59,25,44,28,"addNonEnumerableProperty"],[59,49,44,28],[59,51,44,29,"span"],[59,55,44,33],[59,57,44,35,"ISOLATION_SCOPE_ON_START_SPAN_FIELD"],[59,92,44,70],[59,94,44,72,"wrapScopeWithWeakRef"],[59,114,44,92],[59,115,44,93,"isolationScope"],[59,129,44,107],[59,130,44,108],[59,131,44,109],[60,6,45,4],[61,6,46,4],[62,6,47,4],[62,10,47,4,"addNonEnumerableProperty"],[62,24,47,28],[62,25,47,28,"addNonEnumerableProperty"],[62,49,47,28],[62,51,47,29,"span"],[62,55,47,33],[62,57,47,35,"SCOPE_ON_START_SPAN_FIELD"],[62,82,47,60],[62,84,47,62,"scope"],[62,89,47,67],[62,90,47,68],[63,4,48,2],[64,2,49,0],[66,2,51,0],[67,0,52,0],[68,0,53,0],[69,0,54,0],[70,2,55,0],[70,11,55,9,"getCapturedScopesOnSpan"],[70,34,55,32,"getCapturedScopesOnSpan"],[70,35,55,33,"span"],[70,39,55,37],[70,41,55,39],[71,4,56,2],[71,8,56,8,"spanWithScopes"],[71,22,56,22],[71,25,56,25,"span"],[71,29,56,29],[72,4,58,2],[72,11,58,9],[73,6,59,4,"scope"],[73,11,59,9],[73,13,59,11,"spanWithScopes"],[73,27,59,25],[73,28,59,26,"SCOPE_ON_START_SPAN_FIELD"],[73,53,59,51],[73,54,59,52],[74,6,60,4,"isolationScope"],[74,20,60,18],[74,22,60,20,"unwrapScopeFromWeakRef"],[74,44,60,42],[74,45,60,43,"spanWithScopes"],[74,59,60,57],[74,60,60,58,"ISOLATION_SCOPE_ON_START_SPAN_FIELD"],[74,95,60,93],[74,96,60,94],[75,4,61,2],[75,5,61,3],[76,2,62,0],[77,0,62,1],[77,3]],"functionMap":{"names":["<global>","wrapScopeWithWeakRef","unwrapScopeFromWeakRef","setCapturedScopesOnSpan","getCapturedScopesOnSpan"],"mappings":"AAA;ACO;CDa;AEG;CFe;AGG;CHO;AIM;CJO"},"hasCjsExports":false},"type":"js/module"}]}