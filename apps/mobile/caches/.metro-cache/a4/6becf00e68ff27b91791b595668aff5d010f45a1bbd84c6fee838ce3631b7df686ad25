{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":45,"index":45}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":46},"end":{"line":2,"column":78,"index":124}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.useDrinkPerk = useDrinkPerk;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _tanstackReactQuery = require(_dependencyMap[1], \"@tanstack/react-query\");\n  async function fetchJson(url, options) {\n    const resp = await fetch(url, options);\n    if (!resp.ok) {\n      const text = await resp.text().catch(() => \"\");\n      throw new Error(`When fetching ${url}, the response was [${resp.status}] ${resp.statusText}. ${text}`);\n    }\n    return resp.json();\n  }\n  function useDrinkPerk(matchId, userId) {\n    _s();\n    const queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    const canQuery = Boolean(matchId) && Number.isFinite(Number(userId));\n    const perkQuery = (0, _tanstackReactQuery.useQuery)({\n      queryKey: [\"drinkPerk\", String(matchId), Number(userId)],\n      enabled: canQuery,\n      queryFn: async () => {\n        return fetchJson(`/api/drink-perk/${matchId}?userId=${Number(userId)}`);\n      },\n      staleTime: 0,\n      refetchInterval: 10_000\n    });\n    const pingLocationMutation = (0, _tanstackReactQuery.useMutation)({\n      mutationFn: async ({\n        lat,\n        lng,\n        accuracyM\n      }) => {\n        return fetchJson(`/api/drink-perk/${matchId}/ping`, {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify({\n            userId: Number(userId),\n            lat,\n            lng,\n            accuracyM\n          })\n        });\n      },\n      onSuccess: async () => {\n        await queryClient.invalidateQueries({\n          queryKey: [\"drinkPerk\", String(matchId), Number(userId)]\n        });\n      }\n    });\n    const startHandshakeMutation = (0, _tanstackReactQuery.useMutation)({\n      mutationFn: async () => {\n        return fetchJson(`/api/drink-perk/${matchId}/handshake/start`, {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify({\n            userId: Number(userId)\n          })\n        });\n      }\n    });\n    const confirmHandshakeMutation = (0, _tanstackReactQuery.useMutation)({\n      mutationFn: async ({\n        code\n      }) => {\n        return fetchJson(`/api/drink-perk/${matchId}/handshake/confirm`, {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify({\n            userId: Number(userId),\n            code\n          })\n        });\n      },\n      onSuccess: async () => {\n        await queryClient.invalidateQueries({\n          queryKey: [\"drinkPerk\", String(matchId), Number(userId)]\n        });\n      }\n    });\n    const statusQuery = (0, _tanstackReactQuery.useQuery)({\n      queryKey: [\"drinkHandshake\", String(matchId), Number(userId)],\n      enabled: false,\n      queryFn: async () => {\n        return fetchJson(`/api/drink-perk/${matchId}/handshake/status?userId=${Number(userId)}`);\n      },\n      staleTime: 0\n    });\n    const perkState = (0, _react.useMemo)(() => {\n      const state = String(perkQuery.data?.perk?.state || \"LOCKED\");\n      return state;\n    }, [perkQuery.data?.perk?.state]);\n    const hasDatePlan = Boolean(perkQuery.data?.date?.hasDatePlan);\n    const refetchAll = (0, _react.useCallback)(async () => {\n      await perkQuery.refetch();\n    }, [perkQuery]);\n    return {\n      canQuery,\n      perkQuery,\n      perkState,\n      hasDatePlan,\n      pingLocationMutation,\n      startHandshakeMutation,\n      confirmHandshakeMutation,\n      statusQuery,\n      refetchAll\n    };\n  }\n  _s(useDrinkPerk, \"GIdfTTn9OQT5y+IfLScv0yw7l1g=\", false, function () {\n    return [_tanstackReactQuery.useQueryClient, _tanstackReactQuery.useQuery, _tanstackReactQuery.useMutation, _tanstackReactQuery.useMutation, _tanstackReactQuery.useMutation, _tanstackReactQuery.useQuery];\n  });\n});","lineCount":122,"map":[[8,2,15,0,"exports"],[8,9,15,0],[8,10,15,0,"useDrinkPerk"],[8,22,15,0],[8,25,15,0,"useDrinkPerk"],[8,37,15,0],[9,2,1,0],[9,6,1,0,"_react"],[9,12,1,0],[9,15,1,0,"require"],[9,22,1,0],[9,23,1,0,"_dependencyMap"],[9,37,1,0],[10,2,2,0],[10,6,2,0,"_tanstackReactQuery"],[10,25,2,0],[10,28,2,0,"require"],[10,35,2,0],[10,36,2,0,"_dependencyMap"],[10,50,2,0],[11,2,4,0],[11,17,4,15,"fetchJson"],[11,26,4,24,"fetchJson"],[11,27,4,25,"url"],[11,30,4,28],[11,32,4,30,"options"],[11,39,4,37],[11,41,4,39],[12,4,5,2],[12,10,5,8,"resp"],[12,14,5,12],[12,17,5,15],[12,23,5,21,"fetch"],[12,28,5,26],[12,29,5,27,"url"],[12,32,5,30],[12,34,5,32,"options"],[12,41,5,39],[12,42,5,40],[13,4,6,2],[13,8,6,6],[13,9,6,7,"resp"],[13,13,6,11],[13,14,6,12,"ok"],[13,16,6,14],[13,18,6,16],[14,6,7,4],[14,12,7,10,"text"],[14,16,7,14],[14,19,7,17],[14,25,7,23,"resp"],[14,29,7,27],[14,30,7,28,"text"],[14,34,7,32],[14,35,7,33],[14,36,7,34],[14,37,7,35,"catch"],[14,42,7,40],[14,43,7,41],[14,49,7,47],[14,51,7,49],[14,52,7,50],[15,6,8,4],[15,12,8,10],[15,16,8,14,"Error"],[15,21,8,19],[15,22,9,6],[15,39,9,23,"url"],[15,42,9,26],[15,65,9,49,"resp"],[15,69,9,53],[15,70,9,54,"status"],[15,76,9,60],[15,81,9,65,"resp"],[15,85,9,69],[15,86,9,70,"statusText"],[15,96,9,80],[15,101,9,85,"text"],[15,105,9,89],[15,107,10,4],[15,108,10,5],[16,4,11,2],[17,4,12,2],[17,11,12,9,"resp"],[17,15,12,13],[17,16,12,14,"json"],[17,20,12,18],[17,21,12,19],[17,22,12,20],[18,2,13,0],[19,2,15,7],[19,11,15,16,"useDrinkPerk"],[19,23,15,28,"useDrinkPerk"],[19,24,15,29,"matchId"],[19,31,15,36],[19,33,15,38,"userId"],[19,39,15,44],[19,41,15,46],[20,4,15,46,"_s"],[20,6,15,46],[21,4,16,2],[21,10,16,8,"queryClient"],[21,21,16,19],[21,24,16,22],[21,28,16,22,"useQueryClient"],[21,47,16,36],[21,48,16,36,"useQueryClient"],[21,62,16,36],[21,64,16,37],[21,65,16,38],[22,4,18,2],[22,10,18,8,"canQuery"],[22,18,18,16],[22,21,18,19,"Boolean"],[22,28,18,26],[22,29,18,27,"matchId"],[22,36,18,34],[22,37,18,35],[22,41,18,39,"Number"],[22,47,18,45],[22,48,18,46,"isFinite"],[22,56,18,54],[22,57,18,55,"Number"],[22,63,18,61],[22,64,18,62,"userId"],[22,70,18,68],[22,71,18,69],[22,72,18,70],[23,4,20,2],[23,10,20,8,"perkQuery"],[23,19,20,17],[23,22,20,20],[23,26,20,20,"useQuery"],[23,45,20,28],[23,46,20,28,"useQuery"],[23,54,20,28],[23,56,20,29],[24,6,21,4,"queryKey"],[24,14,21,12],[24,16,21,14],[24,17,21,15],[24,28,21,26],[24,30,21,28,"String"],[24,36,21,34],[24,37,21,35,"matchId"],[24,44,21,42],[24,45,21,43],[24,47,21,45,"Number"],[24,53,21,51],[24,54,21,52,"userId"],[24,60,21,58],[24,61,21,59],[24,62,21,60],[25,6,22,4,"enabled"],[25,13,22,11],[25,15,22,13,"canQuery"],[25,23,22,21],[26,6,23,4,"queryFn"],[26,13,23,11],[26,15,23,13],[26,21,23,13,"queryFn"],[26,22,23,13],[26,27,23,25],[27,8,24,6],[27,15,24,13,"fetchJson"],[27,24,24,22],[27,25,24,23],[27,44,24,42,"matchId"],[27,51,24,49],[27,62,24,60,"Number"],[27,68,24,66],[27,69,24,67,"userId"],[27,75,24,73],[27,76,24,74],[27,78,24,76],[27,79,24,77],[28,6,25,4],[28,7,25,5],[29,6,26,4,"staleTime"],[29,15,26,13],[29,17,26,15],[29,18,26,16],[30,6,27,4,"refetchInterval"],[30,21,27,19],[30,23,27,21],[31,4,28,2],[31,5,28,3],[31,6,28,4],[32,4,30,2],[32,10,30,8,"pingLocationMutation"],[32,30,30,28],[32,33,30,31],[32,37,30,31,"useMutation"],[32,56,30,42],[32,57,30,42,"useMutation"],[32,68,30,42],[32,70,30,43],[33,6,31,4,"mutationFn"],[33,16,31,14],[33,18,31,16],[33,24,31,16,"mutationFn"],[33,25,31,23],[34,8,31,25,"lat"],[34,11,31,28],[35,8,31,30,"lng"],[35,11,31,33],[36,8,31,35,"accuracyM"],[37,6,31,45],[37,7,31,46],[37,12,31,51],[38,8,32,6],[38,15,32,13,"fetchJson"],[38,24,32,22],[38,25,32,23],[38,44,32,42,"matchId"],[38,51,32,49],[38,58,32,56],[38,60,32,58],[39,10,33,8,"method"],[39,16,33,14],[39,18,33,16],[39,24,33,22],[40,10,34,8,"headers"],[40,17,34,15],[40,19,34,17],[41,12,34,19],[41,26,34,33],[41,28,34,35],[42,10,34,54],[42,11,34,55],[43,10,35,8,"body"],[43,14,35,12],[43,16,35,14,"JSON"],[43,20,35,18],[43,21,35,19,"stringify"],[43,30,35,28],[43,31,35,29],[44,12,36,10,"userId"],[44,18,36,16],[44,20,36,18,"Number"],[44,26,36,24],[44,27,36,25,"userId"],[44,33,36,31],[44,34,36,32],[45,12,37,10,"lat"],[45,15,37,13],[46,12,38,10,"lng"],[46,15,38,13],[47,12,39,10,"accuracyM"],[48,10,40,8],[48,11,40,9],[49,8,41,6],[49,9,41,7],[49,10,41,8],[50,6,42,4],[50,7,42,5],[51,6,43,4,"onSuccess"],[51,15,43,13],[51,17,43,15],[51,23,43,15,"onSuccess"],[51,24,43,15],[51,29,43,27],[52,8,44,6],[52,14,44,12,"queryClient"],[52,25,44,23],[52,26,44,24,"invalidateQueries"],[52,43,44,41],[52,44,44,42],[53,10,45,8,"queryKey"],[53,18,45,16],[53,20,45,18],[53,21,45,19],[53,32,45,30],[53,34,45,32,"String"],[53,40,45,38],[53,41,45,39,"matchId"],[53,48,45,46],[53,49,45,47],[53,51,45,49,"Number"],[53,57,45,55],[53,58,45,56,"userId"],[53,64,45,62],[53,65,45,63],[54,8,46,6],[54,9,46,7],[54,10,46,8],[55,6,47,4],[56,4,48,2],[56,5,48,3],[56,6,48,4],[57,4,50,2],[57,10,50,8,"startHandshakeMutation"],[57,32,50,30],[57,35,50,33],[57,39,50,33,"useMutation"],[57,58,50,44],[57,59,50,44,"useMutation"],[57,70,50,44],[57,72,50,45],[58,6,51,4,"mutationFn"],[58,16,51,14],[58,18,51,16],[58,24,51,16,"mutationFn"],[58,25,51,16],[58,30,51,28],[59,8,52,6],[59,15,52,13,"fetchJson"],[59,24,52,22],[59,25,52,23],[59,44,52,42,"matchId"],[59,51,52,49],[59,69,52,67],[59,71,52,69],[60,10,53,8,"method"],[60,16,53,14],[60,18,53,16],[60,24,53,22],[61,10,54,8,"headers"],[61,17,54,15],[61,19,54,17],[62,12,54,19],[62,26,54,33],[62,28,54,35],[63,10,54,54],[63,11,54,55],[64,10,55,8,"body"],[64,14,55,12],[64,16,55,14,"JSON"],[64,20,55,18],[64,21,55,19,"stringify"],[64,30,55,28],[64,31,55,29],[65,12,55,31,"userId"],[65,18,55,37],[65,20,55,39,"Number"],[65,26,55,45],[65,27,55,46,"userId"],[65,33,55,52],[66,10,55,54],[66,11,55,55],[67,8,56,6],[67,9,56,7],[67,10,56,8],[68,6,57,4],[69,4,58,2],[69,5,58,3],[69,6,58,4],[70,4,60,2],[70,10,60,8,"confirmHandshakeMutation"],[70,34,60,32],[70,37,60,35],[70,41,60,35,"useMutation"],[70,60,60,46],[70,61,60,46,"useMutation"],[70,72,60,46],[70,74,60,47],[71,6,61,4,"mutationFn"],[71,16,61,14],[71,18,61,16],[71,24,61,16,"mutationFn"],[71,25,61,23],[72,8,61,25,"code"],[73,6,61,30],[73,7,61,31],[73,12,61,36],[74,8,62,6],[74,15,62,13,"fetchJson"],[74,24,62,22],[74,25,62,23],[74,44,62,42,"matchId"],[74,51,62,49],[74,71,62,69],[74,73,62,71],[75,10,63,8,"method"],[75,16,63,14],[75,18,63,16],[75,24,63,22],[76,10,64,8,"headers"],[76,17,64,15],[76,19,64,17],[77,12,64,19],[77,26,64,33],[77,28,64,35],[78,10,64,54],[78,11,64,55],[79,10,65,8,"body"],[79,14,65,12],[79,16,65,14,"JSON"],[79,20,65,18],[79,21,65,19,"stringify"],[79,30,65,28],[79,31,65,29],[80,12,65,31,"userId"],[80,18,65,37],[80,20,65,39,"Number"],[80,26,65,45],[80,27,65,46,"userId"],[80,33,65,52],[80,34,65,53],[81,12,65,55,"code"],[82,10,65,60],[82,11,65,61],[83,8,66,6],[83,9,66,7],[83,10,66,8],[84,6,67,4],[84,7,67,5],[85,6,68,4,"onSuccess"],[85,15,68,13],[85,17,68,15],[85,23,68,15,"onSuccess"],[85,24,68,15],[85,29,68,27],[86,8,69,6],[86,14,69,12,"queryClient"],[86,25,69,23],[86,26,69,24,"invalidateQueries"],[86,43,69,41],[86,44,69,42],[87,10,70,8,"queryKey"],[87,18,70,16],[87,20,70,18],[87,21,70,19],[87,32,70,30],[87,34,70,32,"String"],[87,40,70,38],[87,41,70,39,"matchId"],[87,48,70,46],[87,49,70,47],[87,51,70,49,"Number"],[87,57,70,55],[87,58,70,56,"userId"],[87,64,70,62],[87,65,70,63],[88,8,71,6],[88,9,71,7],[88,10,71,8],[89,6,72,4],[90,4,73,2],[90,5,73,3],[90,6,73,4],[91,4,75,2],[91,10,75,8,"statusQuery"],[91,21,75,19],[91,24,75,22],[91,28,75,22,"useQuery"],[91,47,75,30],[91,48,75,30,"useQuery"],[91,56,75,30],[91,58,75,31],[92,6,76,4,"queryKey"],[92,14,76,12],[92,16,76,14],[92,17,76,15],[92,33,76,31],[92,35,76,33,"String"],[92,41,76,39],[92,42,76,40,"matchId"],[92,49,76,47],[92,50,76,48],[92,52,76,50,"Number"],[92,58,76,56],[92,59,76,57,"userId"],[92,65,76,63],[92,66,76,64],[92,67,76,65],[93,6,77,4,"enabled"],[93,13,77,11],[93,15,77,13],[93,20,77,18],[94,6,78,4,"queryFn"],[94,13,78,11],[94,15,78,13],[94,21,78,13,"queryFn"],[94,22,78,13],[94,27,78,25],[95,8,79,6],[95,15,79,13,"fetchJson"],[95,24,79,22],[95,25,80,8],[95,44,80,27,"matchId"],[95,51,80,34],[95,79,80,62,"Number"],[95,85,80,68],[95,86,80,69,"userId"],[95,92,80,75],[95,93,80,76],[95,95,81,6],[95,96,81,7],[96,6,82,4],[96,7,82,5],[97,6,83,4,"staleTime"],[97,15,83,13],[97,17,83,15],[98,4,84,2],[98,5,84,3],[98,6,84,4],[99,4,86,2],[99,10,86,8,"perkState"],[99,19,86,17],[99,22,86,20],[99,26,86,20,"useMemo"],[99,32,86,27],[99,33,86,27,"useMemo"],[99,40,86,27],[99,42,86,28],[99,48,86,34],[100,6,87,4],[100,12,87,10,"state"],[100,17,87,15],[100,20,87,18,"String"],[100,26,87,24],[100,27,87,25,"perkQuery"],[100,36,87,34],[100,37,87,35,"data"],[100,41,87,39],[100,43,87,41,"perk"],[100,47,87,45],[100,49,87,47,"state"],[100,54,87,52],[100,58,87,56],[100,66,87,64],[100,67,87,65],[101,6,88,4],[101,13,88,11,"state"],[101,18,88,16],[102,4,89,2],[102,5,89,3],[102,7,89,5],[102,8,89,6,"perkQuery"],[102,17,89,15],[102,18,89,16,"data"],[102,22,89,20],[102,24,89,22,"perk"],[102,28,89,26],[102,30,89,28,"state"],[102,35,89,33],[102,36,89,34],[102,37,89,35],[103,4,91,2],[103,10,91,8,"hasDatePlan"],[103,21,91,19],[103,24,91,22,"Boolean"],[103,31,91,29],[103,32,91,30,"perkQuery"],[103,41,91,39],[103,42,91,40,"data"],[103,46,91,44],[103,48,91,46,"date"],[103,52,91,50],[103,54,91,52,"hasDatePlan"],[103,65,91,63],[103,66,91,64],[104,4,93,2],[104,10,93,8,"refetchAll"],[104,20,93,18],[104,23,93,21],[104,27,93,21,"useCallback"],[104,33,93,32],[104,34,93,32,"useCallback"],[104,45,93,32],[104,47,93,33],[104,59,93,45],[105,6,94,4],[105,12,94,10,"perkQuery"],[105,21,94,19],[105,22,94,20,"refetch"],[105,29,94,27],[105,30,94,28],[105,31,94,29],[106,4,95,2],[106,5,95,3],[106,7,95,5],[106,8,95,6,"perkQuery"],[106,17,95,15],[106,18,95,16],[106,19,95,17],[107,4,97,2],[107,11,97,9],[108,6,98,4,"canQuery"],[108,14,98,12],[109,6,99,4,"perkQuery"],[109,15,99,13],[110,6,100,4,"perkState"],[110,15,100,13],[111,6,101,4,"hasDatePlan"],[111,17,101,15],[112,6,102,4,"pingLocationMutation"],[112,26,102,24],[113,6,103,4,"startHandshakeMutation"],[113,28,103,26],[114,6,104,4,"confirmHandshakeMutation"],[114,30,104,28],[115,6,105,4,"statusQuery"],[115,17,105,15],[116,6,106,4,"refetchAll"],[117,4,107,2],[117,5,107,3],[118,2,108,0],[119,2,108,1,"_s"],[119,4,108,1],[119,5,15,16,"useDrinkPerk"],[119,17,15,28],[120,4,15,28],[120,12,16,22,"useQueryClient"],[120,31,16,36],[120,32,16,36,"useQueryClient"],[120,46,16,36],[120,48,20,20,"useQuery"],[120,67,20,28],[120,68,20,28,"useQuery"],[120,76,20,28],[120,78,30,31,"useMutation"],[120,97,30,42],[120,98,30,42,"useMutation"],[120,109,30,42],[120,111,50,33,"useMutation"],[120,130,50,44],[120,131,50,44,"useMutation"],[120,142,50,44],[120,144,60,35,"useMutation"],[120,163,60,46],[120,164,60,46,"useMutation"],[120,175,60,46],[120,177,75,22,"useQuery"],[120,196,75,30],[120,197,75,30,"useQuery"],[120,205,75,30],[121,2,75,30],[122,0,75,30],[122,3]],"functionMap":{"names":["<global>","fetchJson","resp.text._catch$argument_0","useDrinkPerk","useQuery$argument_0.queryFn","useMutation$argument_0.mutationFn","useMutation$argument_0.onSuccess","useMemo$argument_0","refetchAll"],"mappings":"AAA;ACG;yCCG,QD;CDM;OGE;aCQ;KDE;gBEM;KFW;eGC;KHI;gBEI;KFM;gBEI;KFM;eGC;KHI;aCM;KDI;4BII;GJG;iCKI;GLE;CHa"},"hasCjsExports":false},"type":"js/module"}]}