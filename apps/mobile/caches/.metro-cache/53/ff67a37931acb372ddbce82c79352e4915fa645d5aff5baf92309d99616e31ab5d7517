{"dependencies":[{"name":"../../jsutils/inspect.mjs","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":52,"index":52}}],"key":"HkUMP5eMiKp2JNHcQbAA+S+H8jk=","exportNames":["*"],"imports":1}},{"name":"../../error/GraphQLError.mjs","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":53},"end":{"line":2,"column":60,"index":113}}],"key":"bmIpo7jOJABVILoymQcjQyoT3Bc=","exportNames":["*"],"imports":1}},{"name":"../../language/kinds.mjs","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":114},"end":{"line":3,"column":48,"index":162}}],"key":"Pst0V1b6vjNwQXmeu75q8aBhbiU=","exportNames":["*"],"imports":1}},{"name":"../../type/definition.mjs","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":163},"end":{"line":8,"column":35,"index":263}}],"key":"OJG9n3Eg7iYSTCZRKQx0dU0wthg=","exportNames":["*"],"imports":1}},{"name":"../../utilities/typeComparators.mjs","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":9,"column":0,"index":264},"end":{"line":9,"column":70,"index":334}}],"key":"aeY9uavlNyWIh5UIhTfxqFr2TVE=","exportNames":["*"],"imports":1}},{"name":"../../utilities/typeFromAST.mjs","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":10,"column":0,"index":335},"end":{"line":10,"column":62,"index":397}}],"key":"P51FP4x0ZRWtfhGrarBWkkKMM2k=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.VariablesInAllowedPositionRule = VariablesInAllowedPositionRule;\n  var _jsutilsInspectMjs = require(_dependencyMap[0]);\n  var _errorGraphQLErrorMjs = require(_dependencyMap[1]);\n  var _languageKindsMjs = require(_dependencyMap[2]);\n  var _typeDefinitionMjs = require(_dependencyMap[3]);\n  var _utilitiesTypeComparatorsMjs = require(_dependencyMap[4]);\n  var _utilitiesTypeFromASTMjs = require(_dependencyMap[5]);\n  /**\n   * Variables in allowed position\n   *\n   * Variable usages must be compatible with the arguments they are passed to.\n   *\n   * See https://spec.graphql.org/draft/#sec-All-Variable-Usages-are-Allowed\n   */\n  function VariablesInAllowedPositionRule(context) {\n    var varDefMap = Object.create(null);\n    return {\n      OperationDefinition: {\n        enter() {\n          varDefMap = Object.create(null);\n        },\n        leave(operation) {\n          var usages = context.getRecursiveVariableUsages(operation);\n          for (var _ref of usages) {\n            var node = _ref.node;\n            var type = _ref.type;\n            var defaultValue = _ref.defaultValue;\n            var parentType = _ref.parentType;\n            var varName = node.name.value;\n            var varDef = varDefMap[varName];\n            if (varDef && type) {\n              // A var type is allowed if it is the same or more strict (e.g. is\n              // a subtype of) than the expected type. It can be more strict if\n              // the variable type is non-null when the expected type is nullable.\n              // If both are list types, the variable item type can be more strict\n              // than the expected item type (contravariant).\n              var schema = context.getSchema();\n              var varType = (0, _utilitiesTypeFromASTMjs.typeFromAST)(schema, varDef.type);\n              if (varType && !allowedVariableUsage(schema, varType, varDef.defaultValue, type, defaultValue)) {\n                var varTypeStr = (0, _jsutilsInspectMjs.inspect)(varType);\n                var typeStr = (0, _jsutilsInspectMjs.inspect)(type);\n                context.reportError(new _errorGraphQLErrorMjs.GraphQLError(`Variable \"$${varName}\" of type \"${varTypeStr}\" used in position expecting type \"${typeStr}\".`, {\n                  nodes: [varDef, node]\n                }));\n              }\n              if ((0, _typeDefinitionMjs.isInputObjectType)(parentType) && parentType.isOneOf && (0, _typeDefinitionMjs.isNullableType)(varType)) {\n                context.reportError(new _errorGraphQLErrorMjs.GraphQLError(`Variable \"$${varName}\" is of type \"${varType}\" but must be non-nullable to be used for OneOf Input Object \"${parentType}\".`, {\n                  nodes: [varDef, node]\n                }));\n              }\n            }\n          }\n        }\n      },\n      VariableDefinition(node) {\n        varDefMap[node.variable.name.value] = node;\n      }\n    };\n  }\n  /**\n   * Returns true if the variable is allowed in the location it was found,\n   * which includes considering if default values exist for either the variable\n   * or the location at which it is located.\n   */\n\n  function allowedVariableUsage(schema, varType, varDefaultValue, locationType, locationDefaultValue) {\n    if ((0, _typeDefinitionMjs.isNonNullType)(locationType) && !(0, _typeDefinitionMjs.isNonNullType)(varType)) {\n      var hasNonNullVariableDefaultValue = varDefaultValue != null && varDefaultValue.kind !== _languageKindsMjs.Kind.NULL;\n      var hasLocationDefaultValue = locationDefaultValue !== undefined;\n      if (!hasNonNullVariableDefaultValue && !hasLocationDefaultValue) {\n        return false;\n      }\n      var nullableLocationType = locationType.ofType;\n      return (0, _utilitiesTypeComparatorsMjs.isTypeSubTypeOf)(schema, varType, nullableLocationType);\n    }\n    return (0, _utilitiesTypeComparatorsMjs.isTypeSubTypeOf)(schema, varType, locationType);\n  }\n});","lineCount":84,"map":[[7,2,19,0,"exports"],[7,9,19,0],[7,10,19,0,"VariablesInAllowedPositionRule"],[7,40,19,0],[7,43,19,0,"VariablesInAllowedPositionRule"],[7,73,19,0],[8,2,1,0],[8,6,1,0,"_jsutilsInspectMjs"],[8,24,1,0],[8,27,1,0,"require"],[8,34,1,0],[8,35,1,0,"_dependencyMap"],[8,49,1,0],[9,2,2,0],[9,6,2,0,"_errorGraphQLErrorMjs"],[9,27,2,0],[9,30,2,0,"require"],[9,37,2,0],[9,38,2,0,"_dependencyMap"],[9,52,2,0],[10,2,3,0],[10,6,3,0,"_languageKindsMjs"],[10,23,3,0],[10,26,3,0,"require"],[10,33,3,0],[10,34,3,0,"_dependencyMap"],[10,48,3,0],[11,2,4,0],[11,6,4,0,"_typeDefinitionMjs"],[11,24,4,0],[11,27,4,0,"require"],[11,34,4,0],[11,35,4,0,"_dependencyMap"],[11,49,4,0],[12,2,9,0],[12,6,9,0,"_utilitiesTypeComparatorsMjs"],[12,34,9,0],[12,37,9,0,"require"],[12,44,9,0],[12,45,9,0,"_dependencyMap"],[12,59,9,0],[13,2,10,0],[13,6,10,0,"_utilitiesTypeFromASTMjs"],[13,30,10,0],[13,33,10,0,"require"],[13,40,10,0],[13,41,10,0,"_dependencyMap"],[13,55,10,0],[14,2,12,0],[15,0,13,0],[16,0,14,0],[17,0,15,0],[18,0,16,0],[19,0,17,0],[20,0,18,0],[21,2,19,7],[21,11,19,16,"VariablesInAllowedPositionRule"],[21,41,19,46,"VariablesInAllowedPositionRule"],[21,42,19,47,"context"],[21,49,19,54],[21,51,19,56],[22,4,20,2],[22,8,20,6,"varDefMap"],[22,17,20,15],[22,20,20,18,"Object"],[22,26,20,24],[22,27,20,25,"create"],[22,33,20,31],[22,34,20,32],[22,38,20,36],[22,39,20,37],[23,4,21,2],[23,11,21,9],[24,6,22,4,"OperationDefinition"],[24,25,22,23],[24,27,22,25],[25,8,23,6,"enter"],[25,13,23,11,"enter"],[25,14,23,11],[25,16,23,14],[26,10,24,8,"varDefMap"],[26,19,24,17],[26,22,24,20,"Object"],[26,28,24,26],[26,29,24,27,"create"],[26,35,24,33],[26,36,24,34],[26,40,24,38],[26,41,24,39],[27,8,25,6],[27,9,25,7],[28,8,27,6,"leave"],[28,13,27,11,"leave"],[28,14,27,12,"operation"],[28,23,27,21],[28,25,27,23],[29,10,28,8],[29,14,28,14,"usages"],[29,20,28,20],[29,23,28,23,"context"],[29,30,28,30],[29,31,28,31,"getRecursiveVariableUsages"],[29,57,28,57],[29,58,28,58,"operation"],[29,67,28,67],[29,68,28,68],[30,10,30,8],[30,19,30,8,"_ref"],[30,23,30,8],[30,27,30,63,"usages"],[30,33,30,69],[30,35,30,71],[31,12,30,71],[31,16,30,21,"node"],[31,20,30,25],[31,23,30,25,"_ref"],[31,27,30,25],[31,28,30,21,"node"],[31,32,30,25],[32,12,30,25],[32,16,30,27,"type"],[32,20,30,31],[32,23,30,31,"_ref"],[32,27,30,31],[32,28,30,27,"type"],[32,32,30,31],[33,12,30,31],[33,16,30,33,"defaultValue"],[33,28,30,45],[33,31,30,45,"_ref"],[33,35,30,45],[33,36,30,33,"defaultValue"],[33,48,30,45],[34,12,30,45],[34,16,30,47,"parentType"],[34,26,30,57],[34,29,30,57,"_ref"],[34,33,30,57],[34,34,30,47,"parentType"],[34,44,30,57],[35,12,31,10],[35,16,31,16,"varName"],[35,23,31,23],[35,26,31,26,"node"],[35,30,31,30],[35,31,31,31,"name"],[35,35,31,35],[35,36,31,36,"value"],[35,41,31,41],[36,12,32,10],[36,16,32,16,"varDef"],[36,22,32,22],[36,25,32,25,"varDefMap"],[36,34,32,34],[36,35,32,35,"varName"],[36,42,32,42],[36,43,32,43],[37,12,34,10],[37,16,34,14,"varDef"],[37,22,34,20],[37,26,34,24,"type"],[37,30,34,28],[37,32,34,30],[38,14,35,12],[39,14,36,12],[40,14,37,12],[41,14,38,12],[42,14,39,12],[43,14,40,12],[43,18,40,18,"schema"],[43,24,40,24],[43,27,40,27,"context"],[43,34,40,34],[43,35,40,35,"getSchema"],[43,44,40,44],[43,45,40,45],[43,46,40,46],[44,14,41,12],[44,18,41,18,"varType"],[44,25,41,25],[44,28,41,28],[44,32,41,28,"typeFromAST"],[44,56,41,39],[44,57,41,39,"typeFromAST"],[44,68,41,39],[44,70,41,40,"schema"],[44,76,41,46],[44,78,41,48,"varDef"],[44,84,41,54],[44,85,41,55,"type"],[44,89,41,59],[44,90,41,60],[45,14,43,12],[45,18,44,14,"varType"],[45,25,44,21],[45,29,45,14],[45,30,45,15,"allowedVariableUsage"],[45,50,45,35],[45,51,46,16,"schema"],[45,57,46,22],[45,59,47,16,"varType"],[45,66,47,23],[45,68,48,16,"varDef"],[45,74,48,22],[45,75,48,23,"defaultValue"],[45,87,48,35],[45,89,49,16,"type"],[45,93,49,20],[45,95,50,16,"defaultValue"],[45,107,51,14],[45,108,51,15],[45,110,52,14],[46,16,53,14],[46,20,53,20,"varTypeStr"],[46,30,53,30],[46,33,53,33],[46,37,53,33,"inspect"],[46,55,53,40],[46,56,53,40,"inspect"],[46,63,53,40],[46,65,53,41,"varType"],[46,72,53,48],[46,73,53,49],[47,16,54,14],[47,20,54,20,"typeStr"],[47,27,54,27],[47,30,54,30],[47,34,54,30,"inspect"],[47,52,54,37],[47,53,54,37,"inspect"],[47,60,54,37],[47,62,54,38,"type"],[47,66,54,42],[47,67,54,43],[48,16,55,14,"context"],[48,23,55,21],[48,24,55,22,"reportError"],[48,35,55,33],[48,36,56,16],[48,40,56,20,"GraphQLError"],[48,61,56,32],[48,62,56,32,"GraphQLError"],[48,74,56,32],[48,75,57,18],[48,89,57,32,"varName"],[48,96,57,39],[48,110,57,53,"varTypeStr"],[48,120,57,63],[48,158,57,101,"typeStr"],[48,165,57,108],[48,169,57,112],[48,171,58,18],[49,18,59,20,"nodes"],[49,23,59,25],[49,25,59,27],[49,26,59,28,"varDef"],[49,32,59,34],[49,34,59,36,"node"],[49,38,59,40],[50,16,60,18],[50,17,61,16],[50,18,62,14],[50,19,62,15],[51,14,63,12],[52,14,65,12],[52,18,66,14],[52,22,66,14,"isInputObjectType"],[52,40,66,31],[52,41,66,31,"isInputObjectType"],[52,58,66,31],[52,60,66,32,"parentType"],[52,70,66,42],[52,71,66,43],[52,75,67,14,"parentType"],[52,85,67,24],[52,86,67,25,"isOneOf"],[52,93,67,32],[52,97,68,14],[52,101,68,14,"isNullableType"],[52,119,68,28],[52,120,68,28,"isNullableType"],[52,134,68,28],[52,136,68,29,"varType"],[52,143,68,36],[52,144,68,37],[52,146,69,14],[53,16,70,14,"context"],[53,23,70,21],[53,24,70,22,"reportError"],[53,35,70,33],[53,36,71,16],[53,40,71,20,"GraphQLError"],[53,61,71,32],[53,62,71,32,"GraphQLError"],[53,74,71,32],[53,75,72,18],[53,89,72,32,"varName"],[53,96,72,39],[53,113,72,56,"varType"],[53,120,72,63],[53,185,72,128,"parentType"],[53,195,72,138],[53,199,72,142],[53,201,73,18],[54,18,74,20,"nodes"],[54,23,74,25],[54,25,74,27],[54,26,74,28,"varDef"],[54,32,74,34],[54,34,74,36,"node"],[54,38,74,40],[55,16,75,18],[55,17,76,16],[55,18,77,14],[55,19,77,15],[56,14,78,12],[57,12,79,10],[58,10,80,8],[59,8,81,6],[60,6,82,4],[60,7,82,5],[61,6,84,4,"VariableDefinition"],[61,24,84,22,"VariableDefinition"],[61,25,84,23,"node"],[61,29,84,27],[61,31,84,29],[62,8,85,6,"varDefMap"],[62,17,85,15],[62,18,85,16,"node"],[62,22,85,20],[62,23,85,21,"variable"],[62,31,85,29],[62,32,85,30,"name"],[62,36,85,34],[62,37,85,35,"value"],[62,42,85,40],[62,43,85,41],[62,46,85,44,"node"],[62,50,85,48],[63,6,86,4],[64,4,87,2],[64,5,87,3],[65,2,88,0],[66,2,89,0],[67,0,90,0],[68,0,91,0],[69,0,92,0],[70,0,93,0],[72,2,95,0],[72,11,95,9,"allowedVariableUsage"],[72,31,95,29,"allowedVariableUsage"],[72,32,96,2,"schema"],[72,38,96,8],[72,40,97,2,"varType"],[72,47,97,9],[72,49,98,2,"varDefaultValue"],[72,64,98,17],[72,66,99,2,"locationType"],[72,78,99,14],[72,80,100,2,"locationDefaultValue"],[72,100,100,22],[72,102,101,2],[73,4,102,2],[73,8,102,6],[73,12,102,6,"isNonNullType"],[73,30,102,19],[73,31,102,19,"isNonNullType"],[73,44,102,19],[73,46,102,20,"locationType"],[73,58,102,32],[73,59,102,33],[73,63,102,37],[73,64,102,38],[73,68,102,38,"isNonNullType"],[73,86,102,51],[73,87,102,51,"isNonNullType"],[73,100,102,51],[73,102,102,52,"varType"],[73,109,102,59],[73,110,102,60],[73,112,102,62],[74,6,103,4],[74,10,103,10,"hasNonNullVariableDefaultValue"],[74,40,103,40],[74,43,104,6,"varDefaultValue"],[74,58,104,21],[74,62,104,25],[74,66,104,29],[74,70,104,33,"varDefaultValue"],[74,85,104,48],[74,86,104,49,"kind"],[74,90,104,53],[74,95,104,58,"Kind"],[74,112,104,62],[74,113,104,62,"Kind"],[74,117,104,62],[74,118,104,63,"NULL"],[74,122,104,67],[75,6,105,4],[75,10,105,10,"hasLocationDefaultValue"],[75,33,105,33],[75,36,105,36,"locationDefaultValue"],[75,56,105,56],[75,61,105,61,"undefined"],[75,70,105,70],[76,6,107,4],[76,10,107,8],[76,11,107,9,"hasNonNullVariableDefaultValue"],[76,41,107,39],[76,45,107,43],[76,46,107,44,"hasLocationDefaultValue"],[76,69,107,67],[76,71,107,69],[77,8,108,6],[77,15,108,13],[77,20,108,18],[78,6,109,4],[79,6,111,4],[79,10,111,10,"nullableLocationType"],[79,30,111,30],[79,33,111,33,"locationType"],[79,45,111,45],[79,46,111,46,"ofType"],[79,52,111,52],[80,6,112,4],[80,13,112,11],[80,17,112,11,"isTypeSubTypeOf"],[80,45,112,26],[80,46,112,26,"isTypeSubTypeOf"],[80,61,112,26],[80,63,112,27,"schema"],[80,69,112,33],[80,71,112,35,"varType"],[80,78,112,42],[80,80,112,44,"nullableLocationType"],[80,100,112,64],[80,101,112,65],[81,4,113,2],[82,4,115,2],[82,11,115,9],[82,15,115,9,"isTypeSubTypeOf"],[82,43,115,24],[82,44,115,24,"isTypeSubTypeOf"],[82,59,115,24],[82,61,115,25,"schema"],[82,67,115,31],[82,69,115,33,"varType"],[82,76,115,40],[82,78,115,42,"locationType"],[82,90,115,54],[82,91,115,55],[83,2,116,0],[84,0,116,1],[84,3]],"functionMap":{"names":["<global>","VariablesInAllowedPositionRule","OperationDefinition.enter","OperationDefinition.leave","VariableDefinition","allowedVariableUsage"],"mappings":"AAA;OCkB;MCI;ODE;MEE;OFsD;IGG;KHE;CDE;AKO;CLqB"},"hasCjsExports":false},"type":"js/module"}]}