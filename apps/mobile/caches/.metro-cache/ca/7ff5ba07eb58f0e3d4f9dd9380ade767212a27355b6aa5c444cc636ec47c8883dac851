{"dependencies":[{"name":"../../../types.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":43,"index":43}}],"key":"How8xsoS0dUDpKnVy0jHSdmxOM4=","exportNames":["*"],"imports":1}},{"name":"./getActivationStart.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":44},"end":{"line":2,"column":61,"index":105}}],"key":"HZgTfwsiKuqLBQr5NRx20nhaN6c=","exportNames":["*"],"imports":1}},{"name":"./globalListeners.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":106},"end":{"line":3,"column":75,"index":181}}],"key":"vUYyxH7QtXe33DCzXpyRH3XH51k=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"getVisibilityWatcher\", {\n    enumerable: true,\n    get: function () {\n      return getVisibilityWatcher;\n    }\n  });\n  var _typesJs = require(_dependencyMap[0]);\n  var _getActivationStartJs = require(_dependencyMap[1]);\n  var _globalListenersJs = require(_dependencyMap[2]);\n  /*\n   * Copyright 2020 Google LLC\n   *\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   *     https://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   */\n\n  var firstHiddenTime = -1;\n  var onHiddenFunctions = new Set();\n  var initHiddenTime = () => {\n    // If the document is hidden when this code runs, assume it was always\n    // hidden and the page was loaded in the background, with the one exception\n    // that visibility state is always 'hidden' during prerendering, so we have\n    // to ignore that case until prerendering finishes (see: `prerenderingchange`\n    // event logic below).\n    return _typesJs.WINDOW.document?.visibilityState === 'hidden' && !_typesJs.WINDOW.document?.prerendering ? 0 : Infinity;\n  };\n  var onVisibilityUpdate = event => {\n    // Handle changes to hidden state\n    if (isPageHidden(event) && firstHiddenTime > -1) {\n      // Sentry-specific change: Also call onHidden callbacks for pagehide events\n      // to support older browsers (Safari <14.4) that don't properly fire visibilitychange\n      if (event.type === 'visibilitychange' || event.type === 'pagehide') {\n        for (var onHiddenFunction of onHiddenFunctions) {\n          onHiddenFunction();\n        }\n      }\n\n      // If the document is 'hidden' and no previous hidden timestamp has been\n      // set (so is infinity), update it based on the current event data.\n      if (!isFinite(firstHiddenTime)) {\n        // If the event is a 'visibilitychange' event, it means the page was\n        // visible prior to this change, so the event timestamp is the first\n        // hidden time.\n        // However, if the event is not a 'visibilitychange' event, then it must\n        // be a 'prerenderingchange' or 'pagehide' event, and the fact that the document is\n        // still 'hidden' from the above check means the tab was activated\n        // in a background state and so has always been hidden.\n        firstHiddenTime = event.type === 'visibilitychange' ? event.timeStamp : 0;\n\n        // We no longer need the `prerenderingchange` event listener now we've\n        // set an initial init time so remove that\n        // (we'll keep the visibilitychange and pagehide ones for onHiddenFunction above)\n        (0, _globalListenersJs.removePageListener)('prerenderingchange', onVisibilityUpdate, true);\n      }\n    }\n  };\n  var getVisibilityWatcher = () => {\n    if (_typesJs.WINDOW.document && firstHiddenTime < 0) {\n      // Check if we have a previous hidden `visibility-state` performance entry.\n      var activationStart = (0, _getActivationStartJs.getActivationStart)();\n      var firstVisibilityStateHiddenTime = !_typesJs.WINDOW.document.prerendering ? globalThis.performance.getEntriesByType('visibility-state').filter(e => e.name === 'hidden' && e.startTime > activationStart)[0]?.startTime : undefined;\n\n      // Prefer that, but if it's not available and the document is hidden when\n      // this code runs, assume it was hidden since navigation start. This isn't\n      // a perfect heuristic, but it's the best we can do until the\n      // `visibility-state` performance entry becomes available in all browsers.\n      firstHiddenTime = firstVisibilityStateHiddenTime ?? initHiddenTime();\n      // Listen for visibility changes so we can handle things like bfcache\n      // restores and/or prerender without having to examine individual\n      // timestamps in detail and also for onHidden function calls.\n      (0, _globalListenersJs.addPageListener)('visibilitychange', onVisibilityUpdate, true);\n\n      // Sentry-specific change: Some browsers have buggy implementations of visibilitychange,\n      // so we use pagehide in addition, just to be safe. This is also required for older\n      // Safari versions (<14.4) that we still support.\n      (0, _globalListenersJs.addPageListener)('pagehide', onVisibilityUpdate, true);\n\n      // IMPORTANT: when a page is prerendering, its `visibilityState` is\n      // 'hidden', so in order to account for cases where this module checks for\n      // visibility during prerendering, an additional check after prerendering\n      // completes is also required.\n      (0, _globalListenersJs.addPageListener)('prerenderingchange', onVisibilityUpdate, true);\n    }\n    return {\n      get firstHiddenTime() {\n        return firstHiddenTime;\n      },\n      onHidden(cb) {\n        onHiddenFunctions.add(cb);\n      }\n    };\n  };\n\n  /**\n   * Check if the page is hidden, uses the `pagehide` event for older browsers support that we used to have in `onHidden` function.\n   * Some browsers we still support (Safari <14.4) don't fully support `visibilitychange`\n   * or have known bugs w.r.t the `visibilitychange` event.\n   * // TODO (v11): If we decide to drop support for Safari 14.4, we can use the logic from web-vitals 4.2.4\n   */\n  function isPageHidden(event) {\n    return event.type === 'pagehide' || _typesJs.WINDOW.document?.visibilityState === 'hidden';\n  }\n});","lineCount":118,"map":[[7,2,117,0,"Object"],[7,8,117,0],[7,9,117,0,"defineProperty"],[7,23,117,0],[7,24,117,0,"exports"],[7,31,117,0],[8,4,117,0,"enumerable"],[8,14,117,0],[9,4,117,0,"get"],[9,7,117,0],[9,18,117,0,"get"],[9,19,117,0],[10,6,117,0],[10,13,117,9,"getVisibilityWatcher"],[10,33,117,29],[11,4,117,29],[12,2,117,29],[13,2,1,0],[13,6,1,0,"_typesJs"],[13,14,1,0],[13,17,1,0,"require"],[13,24,1,0],[13,25,1,0,"_dependencyMap"],[13,39,1,0],[14,2,2,0],[14,6,2,0,"_getActivationStartJs"],[14,27,2,0],[14,30,2,0,"require"],[14,37,2,0],[14,38,2,0,"_dependencyMap"],[14,52,2,0],[15,2,3,0],[15,6,3,0,"_globalListenersJs"],[15,24,3,0],[15,27,3,0,"require"],[15,34,3,0],[15,35,3,0,"_dependencyMap"],[15,49,3,0],[16,2,5,0],[17,0,6,0],[18,0,7,0],[19,0,8,0],[20,0,9,0],[21,0,10,0],[22,0,11,0],[23,0,12,0],[24,0,13,0],[25,0,14,0],[26,0,15,0],[27,0,16,0],[28,0,17,0],[29,0,18,0],[30,0,19,0],[32,2,22,0],[32,6,22,4,"firstHiddenTime"],[32,21,22,19],[32,26,22,24],[33,2,23,0],[33,6,23,6,"onHiddenFunctions"],[33,23,23,23],[33,26,23,26],[33,30,23,30,"Set"],[33,33,23,33],[33,34,23,34],[33,35,23,35],[34,2,25,0],[34,6,25,6,"initHiddenTime"],[34,20,25,20],[34,23,25,23,"initHiddenTime"],[34,24,25,23],[34,29,25,29],[35,4,26,2],[36,4,27,2],[37,4,28,2],[38,4,29,2],[39,4,30,2],[40,4,31,2],[40,11,31,9,"WINDOW"],[40,19,31,15],[40,20,31,15,"WINDOW"],[40,26,31,15],[40,27,31,16,"document"],[40,35,31,24],[40,37,31,26,"visibilityState"],[40,52,31,41],[40,57,31,46],[40,65,31,54],[40,69,31,58],[40,70,31,59,"WINDOW"],[40,78,31,65],[40,79,31,65,"WINDOW"],[40,85,31,65],[40,86,31,66,"document"],[40,94,31,74],[40,96,31,76,"prerendering"],[40,108,31,88],[40,111,31,91],[40,112,31,92],[40,115,31,95,"Infinity"],[40,123,31,103],[41,2,32,0],[41,3,32,1],[42,2,34,0],[42,6,34,6,"onVisibilityUpdate"],[42,24,34,24],[42,27,34,28,"event"],[42,32,34,33],[42,36,34,38],[43,4,35,2],[44,4,36,2],[44,8,36,6,"isPageHidden"],[44,20,36,18],[44,21,36,19,"event"],[44,26,36,24],[44,27,36,25],[44,31,36,29,"firstHiddenTime"],[44,46,36,44],[44,51,36,49],[44,53,36,51],[45,6,37,4],[46,6,38,4],[47,6,39,4],[47,10,39,8,"event"],[47,15,39,13],[47,16,39,14,"type"],[47,20,39,18],[47,25,39,23],[47,43,39,41],[47,47,39,45,"event"],[47,52,39,50],[47,53,39,51,"type"],[47,57,39,55],[47,62,39,60],[47,72,39,70],[47,74,39,72],[48,8,40,6],[48,13,40,11],[48,17,40,17,"onHiddenFunction"],[48,33,40,33],[48,37,40,37,"onHiddenFunctions"],[48,54,40,54],[48,56,40,56],[49,10,41,8,"onHiddenFunction"],[49,26,41,24],[49,27,41,25],[49,28,41,26],[50,8,42,6],[51,6,43,4],[53,6,45,4],[54,6,46,4],[55,6,47,4],[55,10,47,8],[55,11,47,9,"isFinite"],[55,19,47,17],[55,20,47,18,"firstHiddenTime"],[55,35,47,33],[55,36,47,34],[55,38,47,36],[56,8,48,6],[57,8,49,6],[58,8,50,6],[59,8,51,6],[60,8,52,6],[61,8,53,6],[62,8,54,6],[63,8,55,6,"firstHiddenTime"],[63,23,55,21],[63,26,55,24,"event"],[63,31,55,29],[63,32,55,30,"type"],[63,36,55,34],[63,41,55,39],[63,59,55,57],[63,62,55,60,"event"],[63,67,55,65],[63,68,55,66,"timeStamp"],[63,77,55,75],[63,80,55,78],[63,81,55,79],[65,8,57,6],[66,8,58,6],[67,8,59,6],[68,8,60,6],[68,12,60,6,"removePageListener"],[68,30,60,24],[68,31,60,24,"removePageListener"],[68,49,60,24],[68,51,60,25],[68,71,60,45],[68,73,60,47,"onVisibilityUpdate"],[68,91,60,65],[68,93,60,67],[68,97,60,71],[68,98,60,72],[69,6,61,4],[70,4,62,2],[71,2,63,0],[71,3,63,1],[72,2,65,0],[72,6,65,6,"getVisibilityWatcher"],[72,26,65,26],[72,29,65,29,"getVisibilityWatcher"],[72,30,65,29],[72,35,65,35],[73,4,66,2],[73,8,66,6,"WINDOW"],[73,16,66,12],[73,17,66,12,"WINDOW"],[73,23,66,12],[73,24,66,13,"document"],[73,32,66,21],[73,36,66,25,"firstHiddenTime"],[73,51,66,40],[73,54,66,43],[73,55,66,44],[73,57,66,46],[74,6,67,4],[75,6,68,4],[75,10,68,10,"activationStart"],[75,25,68,25],[75,28,68,28],[75,32,68,28,"getActivationStart"],[75,53,68,46],[75,54,68,46,"getActivationStart"],[75,72,68,46],[75,74,68,47],[75,75,68,48],[76,6,69,4],[76,10,69,10,"firstVisibilityStateHiddenTime"],[76,40,69,40],[76,43,69,43],[76,44,69,44,"WINDOW"],[76,52,69,50],[76,53,69,50,"WINDOW"],[76,59,69,50],[76,60,69,51,"document"],[76,68,69,59],[76,69,69,60,"prerendering"],[76,81,69,72],[76,84,70,8,"globalThis"],[76,94,70,18],[76,95,70,19,"performance"],[76,106,70,30],[76,107,71,11,"getEntriesByType"],[76,123,71,27],[76,124,71,28],[76,142,71,46],[76,143,71,47],[76,144,72,11,"filter"],[76,150,72,17],[76,151,72,18,"e"],[76,152,72,19],[76,156,72,23,"e"],[76,157,72,24],[76,158,72,25,"name"],[76,162,72,29],[76,167,72,34],[76,175,72,42],[76,179,72,46,"e"],[76,180,72,47],[76,181,72,48,"startTime"],[76,190,72,57],[76,193,72,60,"activationStart"],[76,208,72,75],[76,209,72,76],[76,210,72,77],[76,211,72,78],[76,212,72,79],[76,214,72,81,"startTime"],[76,223,72,90],[76,226,73,8,"undefined"],[76,235,73,17],[78,6,75,4],[79,6,76,4],[80,6,77,4],[81,6,78,4],[82,6,79,4,"firstHiddenTime"],[82,21,79,19],[82,24,79,22,"firstVisibilityStateHiddenTime"],[82,54,79,52],[82,58,79,56,"initHiddenTime"],[82,72,79,70],[82,73,79,71],[82,74,79,72],[83,6,80,4],[84,6,81,4],[85,6,82,4],[86,6,83,4],[86,10,83,4,"addPageListener"],[86,28,83,19],[86,29,83,19,"addPageListener"],[86,44,83,19],[86,46,83,20],[86,64,83,38],[86,66,83,40,"onVisibilityUpdate"],[86,84,83,58],[86,86,83,60],[86,90,83,64],[86,91,83,65],[88,6,85,4],[89,6,86,4],[90,6,87,4],[91,6,88,4],[91,10,88,4,"addPageListener"],[91,28,88,19],[91,29,88,19,"addPageListener"],[91,44,88,19],[91,46,88,20],[91,56,88,30],[91,58,88,32,"onVisibilityUpdate"],[91,76,88,50],[91,78,88,52],[91,82,88,56],[91,83,88,57],[93,6,90,4],[94,6,91,4],[95,6,92,4],[96,6,93,4],[97,6,94,4],[97,10,94,4,"addPageListener"],[97,28,94,19],[97,29,94,19,"addPageListener"],[97,44,94,19],[97,46,94,20],[97,66,94,40],[97,68,94,42,"onVisibilityUpdate"],[97,86,94,60],[97,88,94,62],[97,92,94,66],[97,93,94,67],[98,4,95,2],[99,4,97,2],[99,11,97,9],[100,6,98,4],[100,10,98,8,"firstHiddenTime"],[100,25,98,23,"firstHiddenTime"],[100,26,98,23],[100,28,98,26],[101,8,99,6],[101,15,99,13,"firstHiddenTime"],[101,30,99,28],[102,6,100,4],[102,7,100,5],[103,6,101,4,"onHidden"],[103,14,101,12,"onHidden"],[103,15,101,13,"cb"],[103,17,101,15],[103,19,101,17],[104,8,102,6,"onHiddenFunctions"],[104,25,102,23],[104,26,102,24,"add"],[104,29,102,27],[104,30,102,28,"cb"],[104,32,102,30],[104,33,102,31],[105,6,103,4],[106,4,104,2],[106,5,104,3],[107,2,105,0],[107,3,105,1],[109,2,107,0],[110,0,108,0],[111,0,109,0],[112,0,110,0],[113,0,111,0],[114,0,112,0],[115,2,113,0],[115,11,113,9,"isPageHidden"],[115,23,113,21,"isPageHidden"],[115,24,113,22,"event"],[115,29,113,27],[115,31,113,29],[116,4,114,2],[116,11,114,9,"event"],[116,16,114,14],[116,17,114,15,"type"],[116,21,114,19],[116,26,114,24],[116,36,114,34],[116,40,114,38,"WINDOW"],[116,48,114,44],[116,49,114,44,"WINDOW"],[116,55,114,44],[116,56,114,45,"document"],[116,64,114,53],[116,66,114,55,"visibilityState"],[116,81,114,70],[116,86,114,75],[116,94,114,83],[117,2,115,0],[118,0,115,1],[118,3]],"functionMap":{"names":["<global>","initHiddenTime","onVisibilityUpdate","getVisibilityWatcher","globalThis.performance.getEntriesByType.filter$argument_0","get__firstHiddenTime","onHidden","isPageHidden"],"mappings":"AAA;uBCwB;CDO;2BEE;CF6B;6BGE;kBCO,yDD;IE0B;KFE;IGC;KHE;CHE;AOQ;CPE"},"hasCjsExports":false},"type":"js/module"}]}