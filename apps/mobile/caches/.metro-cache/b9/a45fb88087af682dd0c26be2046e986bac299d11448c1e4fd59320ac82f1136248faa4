{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":66,"index":66}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@react-navigation/native","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":67},"end":{"line":2,"column":58,"index":125}}],"key":"yKhyWCfwa1gXEwEbMKnWHykYbZ4=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":126},"end":{"line":3,"column":55,"index":181}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/hooks/usePendingDateFeedback","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":182},"end":{"line":4,"column":72,"index":254}}],"key":"62Z9chell6H1kn1gDwIkzD2hBE4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.useMessagesFeedback = useMessagesFeedback;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _reactNavigationNative = require(_dependencyMap[1], \"@react-navigation/native\");\n  var _tanstackReactQuery = require(_dependencyMap[2], \"@tanstack/react-query\");\n  var _hooksUsePendingDateFeedback = require(_dependencyMap[3], \"@/hooks/usePendingDateFeedback\");\n  function useMessagesFeedback(user) {\n    const [feedbackOpen, setFeedbackOpen] = (0, _react.useState)(false);\n    const [activeFeedback, setActiveFeedback] = (0, _react.useState)(null);\n    const queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    const pendingKey = (0, _react.useMemo)(() => {\n      const uid = Number(user?.id);\n      return [\"pendingDateFeedback\", uid];\n    }, [user?.id]);\n    const pendingFeedbackQuery = (0, _hooksUsePendingDateFeedback.usePendingDateFeedback)(user?.id);\n    const maybeOpenFeedbackPrompt = (0, _react.useCallback)(pending => {\n      if (feedbackOpen) return;\n      const list = Array.isArray(pending) ? pending : [];\n      if (list.length === 0) return;\n      const first = list[0];\n      setActiveFeedback(first);\n      setFeedbackOpen(true);\n    }, [feedbackOpen]);\n    (0, _react.useEffect)(() => {\n      if (!user?.id) return;\n      if (!pendingFeedbackQuery.isSuccess) return;\n      const pending = pendingFeedbackQuery.data?.pending || [];\n      maybeOpenFeedbackPrompt(pending);\n    }, [maybeOpenFeedbackPrompt, pendingFeedbackQuery.data?.pending, pendingFeedbackQuery.isSuccess, user?.id]);\n    (0, _reactNavigationNative.useFocusEffect)((0, _react.useCallback)(() => {\n      if (!user?.id) {\n        return;\n      }\n      pendingFeedbackQuery.refetch().then(result => {\n        const pending = result?.data?.pending || [];\n        maybeOpenFeedbackPrompt(pending);\n      }).catch(e => {\n        console.error(e);\n      });\n    }, [maybeOpenFeedbackPrompt, pendingFeedbackQuery, user?.id]));\n    const handleFeedbackSubmitted = (0, _react.useCallback)(async ({\n      matchId\n    } = {}) => {\n      setFeedbackOpen(false);\n      setActiveFeedback(null);\n      try {\n        if (Number.isFinite(Number(matchId))) {\n          queryClient.setQueryData(pendingKey, old => {\n            const oldPending = Array.isArray(old?.pending) ? old.pending : [];\n            return {\n              pending: oldPending.filter(p => Number(p?.matchId) !== Number(matchId))\n            };\n          });\n        }\n      } catch (e) {\n        console.error(e);\n      }\n      try {\n        const result = await pendingFeedbackQuery.refetch();\n        const pending = result?.data?.pending || [];\n        if (pending.length > 0) {\n          setActiveFeedback(pending[0]);\n          setFeedbackOpen(true);\n        }\n      } catch (e) {\n        console.error(e);\n      }\n    }, [pendingFeedbackQuery, pendingKey, queryClient]);\n    return {\n      feedbackOpen,\n      activeFeedback,\n      handleFeedbackSubmitted\n    };\n  }\n});","lineCount":80,"map":[[7,2,6,0,"exports"],[7,9,6,0],[7,10,6,0,"useMessagesFeedback"],[7,29,6,0],[7,32,6,0,"useMessagesFeedback"],[7,51,6,0],[8,2,1,0],[8,6,1,0,"_react"],[8,12,1,0],[8,15,1,0,"require"],[8,22,1,0],[8,23,1,0,"_dependencyMap"],[8,37,1,0],[9,2,2,0],[9,6,2,0,"_reactNavigationNative"],[9,28,2,0],[9,31,2,0,"require"],[9,38,2,0],[9,39,2,0,"_dependencyMap"],[9,53,2,0],[10,2,3,0],[10,6,3,0,"_tanstackReactQuery"],[10,25,3,0],[10,28,3,0,"require"],[10,35,3,0],[10,36,3,0,"_dependencyMap"],[10,50,3,0],[11,2,4,0],[11,6,4,0,"_hooksUsePendingDateFeedback"],[11,34,4,0],[11,37,4,0,"require"],[11,44,4,0],[11,45,4,0,"_dependencyMap"],[11,59,4,0],[12,2,6,7],[12,11,6,16,"useMessagesFeedback"],[12,30,6,35,"useMessagesFeedback"],[12,31,6,36,"user"],[12,35,6,40],[12,37,6,42],[13,4,7,2],[13,10,7,8],[13,11,7,9,"feedbackOpen"],[13,23,7,21],[13,25,7,23,"setFeedbackOpen"],[13,40,7,38],[13,41,7,39],[13,44,7,42],[13,48,7,42,"useState"],[13,54,7,50],[13,55,7,50,"useState"],[13,63,7,50],[13,65,7,51],[13,70,7,56],[13,71,7,57],[14,4,8,2],[14,10,8,8],[14,11,8,9,"activeFeedback"],[14,25,8,23],[14,27,8,25,"setActiveFeedback"],[14,44,8,42],[14,45,8,43],[14,48,8,46],[14,52,8,46,"useState"],[14,58,8,54],[14,59,8,54,"useState"],[14,67,8,54],[14,69,8,55],[14,73,8,59],[14,74,8,60],[15,4,9,2],[15,10,9,8,"queryClient"],[15,21,9,19],[15,24,9,22],[15,28,9,22,"useQueryClient"],[15,47,9,36],[15,48,9,36,"useQueryClient"],[15,62,9,36],[15,64,9,37],[15,65,9,38],[16,4,11,2],[16,10,11,8,"pendingKey"],[16,20,11,18],[16,23,11,21],[16,27,11,21,"useMemo"],[16,33,11,28],[16,34,11,28,"useMemo"],[16,41,11,28],[16,43,11,29],[16,49,11,35],[17,6,12,4],[17,12,12,10,"uid"],[17,15,12,13],[17,18,12,16,"Number"],[17,24,12,22],[17,25,12,23,"user"],[17,29,12,27],[17,31,12,29,"id"],[17,33,12,31],[17,34,12,32],[18,6,13,4],[18,13,13,11],[18,14,13,12],[18,35,13,33],[18,37,13,35,"uid"],[18,40,13,38],[18,41,13,39],[19,4,14,2],[19,5,14,3],[19,7,14,5],[19,8,14,6,"user"],[19,12,14,10],[19,14,14,12,"id"],[19,16,14,14],[19,17,14,15],[19,18,14,16],[20,4,16,2],[20,10,16,8,"pendingFeedbackQuery"],[20,30,16,28],[20,33,16,31],[20,37,16,31,"usePendingDateFeedback"],[20,65,16,53],[20,66,16,53,"usePendingDateFeedback"],[20,88,16,53],[20,90,16,54,"user"],[20,94,16,58],[20,96,16,60,"id"],[20,98,16,62],[20,99,16,63],[21,4,18,2],[21,10,18,8,"maybeOpenFeedbackPrompt"],[21,33,18,31],[21,36,18,34],[21,40,18,34,"useCallback"],[21,46,18,45],[21,47,18,45,"useCallback"],[21,58,18,45],[21,60,19,5,"pending"],[21,67,19,12],[21,71,19,17],[22,6,20,6],[22,10,20,10,"feedbackOpen"],[22,22,20,22],[22,24,20,24],[23,6,21,6],[23,12,21,12,"list"],[23,16,21,16],[23,19,21,19,"Array"],[23,24,21,24],[23,25,21,25,"isArray"],[23,32,21,32],[23,33,21,33,"pending"],[23,40,21,40],[23,41,21,41],[23,44,21,44,"pending"],[23,51,21,51],[23,54,21,54],[23,56,21,56],[24,6,22,6],[24,10,22,10,"list"],[24,14,22,14],[24,15,22,15,"length"],[24,21,22,21],[24,26,22,26],[24,27,22,27],[24,29,22,29],[25,6,23,6],[25,12,23,12,"first"],[25,17,23,17],[25,20,23,20,"list"],[25,24,23,24],[25,25,23,25],[25,26,23,26],[25,27,23,27],[26,6,24,6,"setActiveFeedback"],[26,23,24,23],[26,24,24,24,"first"],[26,29,24,29],[26,30,24,30],[27,6,25,6,"setFeedbackOpen"],[27,21,25,21],[27,22,25,22],[27,26,25,26],[27,27,25,27],[28,4,26,4],[28,5,26,5],[28,7,27,4],[28,8,27,5,"feedbackOpen"],[28,20,27,17],[28,21,28,2],[28,22,28,3],[29,4,30,2],[29,8,30,2,"useEffect"],[29,14,30,11],[29,15,30,11,"useEffect"],[29,24,30,11],[29,26,30,12],[29,32,30,18],[30,6,31,4],[30,10,31,8],[30,11,31,9,"user"],[30,15,31,13],[30,17,31,15,"id"],[30,19,31,17],[30,21,31,19],[31,6,32,4],[31,10,32,8],[31,11,32,9,"pendingFeedbackQuery"],[31,31,32,29],[31,32,32,30,"isSuccess"],[31,41,32,39],[31,43,32,41],[32,6,33,4],[32,12,33,10,"pending"],[32,19,33,17],[32,22,33,20,"pendingFeedbackQuery"],[32,42,33,40],[32,43,33,41,"data"],[32,47,33,45],[32,49,33,47,"pending"],[32,56,33,54],[32,60,33,58],[32,62,33,60],[33,6,34,4,"maybeOpenFeedbackPrompt"],[33,29,34,27],[33,30,34,28,"pending"],[33,37,34,35],[33,38,34,36],[34,4,35,2],[34,5,35,3],[34,7,35,5],[34,8,36,4,"maybeOpenFeedbackPrompt"],[34,31,36,27],[34,33,37,4,"pendingFeedbackQuery"],[34,53,37,24],[34,54,37,25,"data"],[34,58,37,29],[34,60,37,31,"pending"],[34,67,37,38],[34,69,38,4,"pendingFeedbackQuery"],[34,89,38,24],[34,90,38,25,"isSuccess"],[34,99,38,34],[34,101,39,4,"user"],[34,105,39,8],[34,107,39,10,"id"],[34,109,39,12],[34,110,40,3],[34,111,40,4],[35,4,42,2],[35,8,42,2,"useFocusEffect"],[35,30,42,16],[35,31,42,16,"useFocusEffect"],[35,45,42,16],[35,47,43,4],[35,51,43,4,"useCallback"],[35,57,43,15],[35,58,43,15,"useCallback"],[35,69,43,15],[35,71,43,16],[35,77,43,22],[36,6,44,6],[36,10,44,10],[36,11,44,11,"user"],[36,15,44,15],[36,17,44,17,"id"],[36,19,44,19],[36,21,44,21],[37,8,45,8],[38,6,46,6],[39,6,48,6,"pendingFeedbackQuery"],[39,26,48,26],[39,27,49,9,"refetch"],[39,34,49,16],[39,35,49,17],[39,36,49,18],[39,37,50,9,"then"],[39,41,50,13],[39,42,50,15,"result"],[39,48,50,21],[39,52,50,26],[40,8,51,10],[40,14,51,16,"pending"],[40,21,51,23],[40,24,51,26,"result"],[40,30,51,32],[40,32,51,34,"data"],[40,36,51,38],[40,38,51,40,"pending"],[40,45,51,47],[40,49,51,51],[40,51,51,53],[41,8,52,10,"maybeOpenFeedbackPrompt"],[41,31,52,33],[41,32,52,34,"pending"],[41,39,52,41],[41,40,52,42],[42,6,53,8],[42,7,53,9],[42,8,53,10],[42,9,54,9,"catch"],[42,14,54,14],[42,15,54,16,"e"],[42,16,54,17],[42,20,54,22],[43,8,55,10,"console"],[43,15,55,17],[43,16,55,18,"error"],[43,21,55,23],[43,22,55,24,"e"],[43,23,55,25],[43,24,55,26],[44,6,56,8],[44,7,56,9],[44,8,56,10],[45,4,57,4],[45,5,57,5],[45,7,57,7],[45,8,57,8,"maybeOpenFeedbackPrompt"],[45,31,57,31],[45,33,57,33,"pendingFeedbackQuery"],[45,53,57,53],[45,55,57,55,"user"],[45,59,57,59],[45,61,57,61,"id"],[45,63,57,63],[45,64,57,64],[45,65,58,2],[45,66,58,3],[46,4,60,2],[46,10,60,8,"handleFeedbackSubmitted"],[46,33,60,31],[46,36,60,34],[46,40,60,34,"useCallback"],[46,46,60,45],[46,47,60,45,"useCallback"],[46,58,60,45],[46,60,61,4],[46,67,61,11],[47,6,61,13,"matchId"],[48,4,61,21],[48,5,61,22],[48,8,61,25],[48,9,61,26],[48,10,61,27],[48,15,61,32],[49,6,62,6,"setFeedbackOpen"],[49,21,62,21],[49,22,62,22],[49,27,62,27],[49,28,62,28],[50,6,63,6,"setActiveFeedback"],[50,23,63,23],[50,24,63,24],[50,28,63,28],[50,29,63,29],[51,6,65,6],[51,10,65,10],[52,8,66,8],[52,12,66,12,"Number"],[52,18,66,18],[52,19,66,19,"isFinite"],[52,27,66,27],[52,28,66,28,"Number"],[52,34,66,34],[52,35,66,35,"matchId"],[52,42,66,42],[52,43,66,43],[52,44,66,44],[52,46,66,46],[53,10,67,10,"queryClient"],[53,21,67,21],[53,22,67,22,"setQueryData"],[53,34,67,34],[53,35,67,35,"pendingKey"],[53,45,67,45],[53,47,67,48,"old"],[53,50,67,51],[53,54,67,56],[54,12,68,12],[54,18,68,18,"oldPending"],[54,28,68,28],[54,31,68,31,"Array"],[54,36,68,36],[54,37,68,37,"isArray"],[54,44,68,44],[54,45,68,45,"old"],[54,48,68,48],[54,50,68,50,"pending"],[54,57,68,57],[54,58,68,58],[54,61,68,61,"old"],[54,64,68,64],[54,65,68,65,"pending"],[54,72,68,72],[54,75,68,75],[54,77,68,77],[55,12,69,12],[55,19,69,19],[56,14,70,14,"pending"],[56,21,70,21],[56,23,70,23,"oldPending"],[56,33,70,33],[56,34,70,34,"filter"],[56,40,70,40],[56,41,71,17,"p"],[56,42,71,18],[56,46,71,23,"Number"],[56,52,71,29],[56,53,71,30,"p"],[56,54,71,31],[56,56,71,33,"matchId"],[56,63,71,40],[56,64,71,41],[56,69,71,46,"Number"],[56,75,71,52],[56,76,71,53,"matchId"],[56,83,71,60],[56,84,72,14],[57,12,73,12],[57,13,73,13],[58,10,74,10],[58,11,74,11],[58,12,74,12],[59,8,75,8],[60,6,76,6],[60,7,76,7],[60,8,76,8],[60,15,76,15,"e"],[60,16,76,16],[60,18,76,18],[61,8,77,8,"console"],[61,15,77,15],[61,16,77,16,"error"],[61,21,77,21],[61,22,77,22,"e"],[61,23,77,23],[61,24,77,24],[62,6,78,6],[63,6,80,6],[63,10,80,10],[64,8,81,8],[64,14,81,14,"result"],[64,20,81,20],[64,23,81,23],[64,29,81,29,"pendingFeedbackQuery"],[64,49,81,49],[64,50,81,50,"refetch"],[64,57,81,57],[64,58,81,58],[64,59,81,59],[65,8,82,8],[65,14,82,14,"pending"],[65,21,82,21],[65,24,82,24,"result"],[65,30,82,30],[65,32,82,32,"data"],[65,36,82,36],[65,38,82,38,"pending"],[65,45,82,45],[65,49,82,49],[65,51,82,51],[66,8,83,8],[66,12,83,12,"pending"],[66,19,83,19],[66,20,83,20,"length"],[66,26,83,26],[66,29,83,29],[66,30,83,30],[66,32,83,32],[67,10,84,10,"setActiveFeedback"],[67,27,84,27],[67,28,84,28,"pending"],[67,35,84,35],[67,36,84,36],[67,37,84,37],[67,38,84,38],[67,39,84,39],[68,10,85,10,"setFeedbackOpen"],[68,25,85,25],[68,26,85,26],[68,30,85,30],[68,31,85,31],[69,8,86,8],[70,6,87,6],[70,7,87,7],[70,8,87,8],[70,15,87,15,"e"],[70,16,87,16],[70,18,87,18],[71,8,88,8,"console"],[71,15,88,15],[71,16,88,16,"error"],[71,21,88,21],[71,22,88,22,"e"],[71,23,88,23],[71,24,88,24],[72,6,89,6],[73,4,90,4],[73,5,90,5],[73,7,91,4],[73,8,91,5,"pendingFeedbackQuery"],[73,28,91,25],[73,30,91,27,"pendingKey"],[73,40,91,37],[73,42,91,39,"queryClient"],[73,53,91,50],[73,54,92,2],[73,55,92,3],[74,4,94,2],[74,11,94,9],[75,6,95,4,"feedbackOpen"],[75,18,95,16],[76,6,96,4,"activeFeedback"],[76,20,96,18],[77,6,97,4,"handleFeedbackSubmitted"],[78,4,98,2],[78,5,98,3],[79,2,99,0],[80,0,99,1],[80,3]],"functionMap":{"names":["<global>","useMessagesFeedback","useMemo$argument_0","maybeOpenFeedbackPrompt","useEffect$argument_0","useFocusEffect$argument_0","pendingFeedbackQuery.refetch.then$argument_0","pendingFeedbackQuery.refetch.then._catch$argument_0","handleFeedbackSubmitted","queryClient.setQueryData$argument_1","oldPending.filter$argument_0"],"mappings":"AAA;OCK;6BCK;GDG;IEK;KFO;YGI;GHK;gBIQ;cCO;SDG;eEC;SFE;KJC;IOI;+CCM;gBCI,6CD;WDG;KPgB;CDS"},"hasCjsExports":false},"type":"js/module"}]}