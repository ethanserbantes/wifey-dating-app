{"dependencies":[{"name":"../../error/GraphQLError.mjs","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":60,"index":60}}],"key":"bmIpo7jOJABVILoymQcjQyoT3Bc=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.NoFragmentCyclesRule = NoFragmentCyclesRule;\n  var _errorGraphQLErrorMjs = require(_dependencyMap[0], \"../../error/GraphQLError.mjs\");\n  /**\n   * No fragment cycles\n   *\n   * The graph of fragment spreads must not form any cycles including spreading itself.\n   * Otherwise an operation could infinitely spread or infinitely execute on cycles in the underlying data.\n   *\n   * See https://spec.graphql.org/draft/#sec-Fragment-spreads-must-not-form-cycles\n   */\n  function NoFragmentCyclesRule(context) {\n    // Tracks already visited fragments to maintain O(N) and to ensure that cycles\n    // are not redundantly reported.\n    var visitedFrags = Object.create(null); // Array of AST nodes used to produce meaningful errors\n\n    var spreadPath = []; // Position in the spread path\n\n    var spreadPathIndexByName = Object.create(null);\n    return {\n      OperationDefinition: () => false,\n      FragmentDefinition(node) {\n        detectCycleRecursive(node);\n        return false;\n      }\n    }; // This does a straight-forward DFS to find cycles.\n    // It does not terminate when a cycle was found but continues to explore\n    // the graph to find all possible cycles.\n\n    function detectCycleRecursive(fragment) {\n      if (visitedFrags[fragment.name.value]) {\n        return;\n      }\n      var fragmentName = fragment.name.value;\n      visitedFrags[fragmentName] = true;\n      var spreadNodes = context.getFragmentSpreads(fragment.selectionSet);\n      if (spreadNodes.length === 0) {\n        return;\n      }\n      spreadPathIndexByName[fragmentName] = spreadPath.length;\n      for (var spreadNode of spreadNodes) {\n        var spreadName = spreadNode.name.value;\n        var cycleIndex = spreadPathIndexByName[spreadName];\n        spreadPath.push(spreadNode);\n        if (cycleIndex === undefined) {\n          var spreadFragment = context.getFragment(spreadName);\n          if (spreadFragment) {\n            detectCycleRecursive(spreadFragment);\n          }\n        } else {\n          var cyclePath = spreadPath.slice(cycleIndex);\n          var viaPath = cyclePath.slice(0, -1).map(s => '\"' + s.name.value + '\"').join(', ');\n          context.reportError(new _errorGraphQLErrorMjs.GraphQLError(`Cannot spread fragment \"${spreadName}\" within itself` + (viaPath !== '' ? ` via ${viaPath}.` : '.'), {\n            nodes: cyclePath\n          }));\n        }\n        spreadPath.pop();\n      }\n      spreadPathIndexByName[fragmentName] = undefined;\n    }\n  }\n});","lineCount":67,"map":[[7,2,11,0,"exports"],[7,9,11,0],[7,10,11,0,"NoFragmentCyclesRule"],[7,30,11,0],[7,33,11,0,"NoFragmentCyclesRule"],[7,53,11,0],[8,2,1,0],[8,6,1,0,"_errorGraphQLErrorMjs"],[8,27,1,0],[8,30,1,0,"require"],[8,37,1,0],[8,38,1,0,"_dependencyMap"],[8,52,1,0],[9,2,3,0],[10,0,4,0],[11,0,5,0],[12,0,6,0],[13,0,7,0],[14,0,8,0],[15,0,9,0],[16,0,10,0],[17,2,11,7],[17,11,11,16,"NoFragmentCyclesRule"],[17,31,11,36,"NoFragmentCyclesRule"],[17,32,11,37,"context"],[17,39,11,44],[17,41,11,46],[18,4,12,2],[19,4,13,2],[20,4,14,2],[20,8,14,8,"visitedFrags"],[20,20,14,20],[20,23,14,23,"Object"],[20,29,14,29],[20,30,14,30,"create"],[20,36,14,36],[20,37,14,37],[20,41,14,41],[20,42,14,42],[20,43,14,43],[20,44,14,44],[22,4,16,2],[22,8,16,8,"spreadPath"],[22,18,16,18],[22,21,16,21],[22,23,16,23],[22,24,16,24],[22,25,16,25],[24,4,18,2],[24,8,18,8,"spreadPathIndexByName"],[24,29,18,29],[24,32,18,32,"Object"],[24,38,18,38],[24,39,18,39,"create"],[24,45,18,45],[24,46,18,46],[24,50,18,50],[24,51,18,51],[25,4,19,2],[25,11,19,9],[26,6,20,4,"OperationDefinition"],[26,25,20,23],[26,27,20,25,"OperationDefinition"],[26,28,20,25],[26,33,20,31],[26,38,20,36],[27,6,22,4,"FragmentDefinition"],[27,24,22,22,"FragmentDefinition"],[27,25,22,23,"node"],[27,29,22,27],[27,31,22,29],[28,8,23,6,"detectCycleRecursive"],[28,28,23,26],[28,29,23,27,"node"],[28,33,23,31],[28,34,23,32],[29,8,24,6],[29,15,24,13],[29,20,24,18],[30,6,25,4],[31,4,26,2],[31,5,26,3],[31,6,26,4],[31,7,26,5],[32,4,27,2],[33,4,28,2],[35,4,30,2],[35,13,30,11,"detectCycleRecursive"],[35,33,30,31,"detectCycleRecursive"],[35,34,30,32,"fragment"],[35,42,30,40],[35,44,30,42],[36,6,31,4],[36,10,31,8,"visitedFrags"],[36,22,31,20],[36,23,31,21,"fragment"],[36,31,31,29],[36,32,31,30,"name"],[36,36,31,34],[36,37,31,35,"value"],[36,42,31,40],[36,43,31,41],[36,45,31,43],[37,8,32,6],[38,6,33,4],[39,6,35,4],[39,10,35,10,"fragmentName"],[39,22,35,22],[39,25,35,25,"fragment"],[39,33,35,33],[39,34,35,34,"name"],[39,38,35,38],[39,39,35,39,"value"],[39,44,35,44],[40,6,36,4,"visitedFrags"],[40,18,36,16],[40,19,36,17,"fragmentName"],[40,31,36,29],[40,32,36,30],[40,35,36,33],[40,39,36,37],[41,6,37,4],[41,10,37,10,"spreadNodes"],[41,21,37,21],[41,24,37,24,"context"],[41,31,37,31],[41,32,37,32,"getFragmentSpreads"],[41,50,37,50],[41,51,37,51,"fragment"],[41,59,37,59],[41,60,37,60,"selectionSet"],[41,72,37,72],[41,73,37,73],[42,6,39,4],[42,10,39,8,"spreadNodes"],[42,21,39,19],[42,22,39,20,"length"],[42,28,39,26],[42,33,39,31],[42,34,39,32],[42,36,39,34],[43,8,40,6],[44,6,41,4],[45,6,43,4,"spreadPathIndexByName"],[45,27,43,25],[45,28,43,26,"fragmentName"],[45,40,43,38],[45,41,43,39],[45,44,43,42,"spreadPath"],[45,54,43,52],[45,55,43,53,"length"],[45,61,43,59],[46,6,45,4],[46,11,45,9],[46,15,45,15,"spreadNode"],[46,25,45,25],[46,29,45,29,"spreadNodes"],[46,40,45,40],[46,42,45,42],[47,8,46,6],[47,12,46,12,"spreadName"],[47,22,46,22],[47,25,46,25,"spreadNode"],[47,35,46,35],[47,36,46,36,"name"],[47,40,46,40],[47,41,46,41,"value"],[47,46,46,46],[48,8,47,6],[48,12,47,12,"cycleIndex"],[48,22,47,22],[48,25,47,25,"spreadPathIndexByName"],[48,46,47,46],[48,47,47,47,"spreadName"],[48,57,47,57],[48,58,47,58],[49,8,48,6,"spreadPath"],[49,18,48,16],[49,19,48,17,"push"],[49,23,48,21],[49,24,48,22,"spreadNode"],[49,34,48,32],[49,35,48,33],[50,8,50,6],[50,12,50,10,"cycleIndex"],[50,22,50,20],[50,27,50,25,"undefined"],[50,36,50,34],[50,38,50,36],[51,10,51,8],[51,14,51,14,"spreadFragment"],[51,28,51,28],[51,31,51,31,"context"],[51,38,51,38],[51,39,51,39,"getFragment"],[51,50,51,50],[51,51,51,51,"spreadName"],[51,61,51,61],[51,62,51,62],[52,10,53,8],[52,14,53,12,"spreadFragment"],[52,28,53,26],[52,30,53,28],[53,12,54,10,"detectCycleRecursive"],[53,32,54,30],[53,33,54,31,"spreadFragment"],[53,47,54,45],[53,48,54,46],[54,10,55,8],[55,8,56,6],[55,9,56,7],[55,15,56,13],[56,10,57,8],[56,14,57,14,"cyclePath"],[56,23,57,23],[56,26,57,26,"spreadPath"],[56,36,57,36],[56,37,57,37,"slice"],[56,42,57,42],[56,43,57,43,"cycleIndex"],[56,53,57,53],[56,54,57,54],[57,10,58,8],[57,14,58,14,"viaPath"],[57,21,58,21],[57,24,58,24,"cyclePath"],[57,33,58,33],[57,34,59,11,"slice"],[57,39,59,16],[57,40,59,17],[57,41,59,18],[57,43,59,20],[57,44,59,21],[57,45,59,22],[57,46,59,23],[57,47,60,11,"map"],[57,50,60,14],[57,51,60,16,"s"],[57,52,60,17],[57,56,60,22],[57,59,60,25],[57,62,60,28,"s"],[57,63,60,29],[57,64,60,30,"name"],[57,68,60,34],[57,69,60,35,"value"],[57,74,60,40],[57,77,60,43],[57,80,60,46],[57,81,60,47],[57,82,61,11,"join"],[57,86,61,15],[57,87,61,16],[57,91,61,20],[57,92,61,21],[58,10,62,8,"context"],[58,17,62,15],[58,18,62,16,"reportError"],[58,29,62,27],[58,30,63,10],[58,34,63,14,"GraphQLError"],[58,55,63,26],[58,56,63,26,"GraphQLError"],[58,68,63,26],[58,69,64,12],[58,96,64,39,"spreadName"],[58,106,64,49],[58,123,64,66],[58,127,65,15,"viaPath"],[58,134,65,22],[58,139,65,27],[58,141,65,29],[58,144,65,32],[58,152,65,40,"viaPath"],[58,159,65,47],[58,162,65,50],[58,165,65,53],[58,168,65,56],[58,169,65,57],[58,171,66,12],[59,12,67,14,"nodes"],[59,17,67,19],[59,19,67,21,"cyclePath"],[60,10,68,12],[60,11,69,10],[60,12,70,8],[60,13,70,9],[61,8,71,6],[62,8,73,6,"spreadPath"],[62,18,73,16],[62,19,73,17,"pop"],[62,22,73,20],[62,23,73,21],[62,24,73,22],[63,6,74,4],[64,6,76,4,"spreadPathIndexByName"],[64,27,76,25],[64,28,76,26,"fragmentName"],[64,40,76,38],[64,41,76,39],[64,44,76,42,"undefined"],[64,53,76,51],[65,4,77,2],[66,2,78,0],[67,0,78,1],[67,3]],"functionMap":{"names":["<global>","NoFragmentCyclesRule","OperationDefinition","FragmentDefinition","detectCycleRecursive","cyclePath.slice.map$argument_0"],"mappings":"AAA;OCU;yBCS,WD;IEE;KFG;EGK;eC8B,+BD;GHiB;CDC"},"hasCjsExports":false},"type":"js/module"}]}