{"dependencies":[{"name":"@babel/runtime/helpers/classCallCheck","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"yg7e6laZwmpbIvId5jovq9ugXp8=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/createClass","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"Z6pzkVZ2fvxBLkFTgVVOy4UDj30=","exportNames":["*"],"imports":1}},{"name":"./polyfills/interactionCountPolyfill.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":78,"index":78}}],"key":"0MuBAjXYJzqIS93aKiU6tlqsUTU=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"InteractionManager\", {\n    enumerable: true,\n    get: function () {\n      return InteractionManager;\n    }\n  });\n  var _babelRuntimeHelpersClassCallCheck = require(_dependencyMap[0]);\n  var _classCallCheck = _interopDefault(_babelRuntimeHelpersClassCallCheck);\n  var _babelRuntimeHelpersCreateClass = require(_dependencyMap[1]);\n  var _createClass = _interopDefault(_babelRuntimeHelpersCreateClass);\n  var _polyfillsInteractionCountPolyfillJs = require(_dependencyMap[2]);\n  /*\n   * Copyright 2024 Google LLC\n   *\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   *     https://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   */\n\n  // To prevent unnecessary memory usage on pages with lots of interactions,\n  // store at most 10 of the longest interactions to consider as INP candidates.\n  var MAX_INTERACTIONS_TO_CONSIDER = 10;\n\n  // Used to store the interaction count after a bfcache restore, since p98\n  // interaction latencies should only consider the current navigation.\n  var prevInteractionCount = 0;\n\n  /**\n   * Returns the interaction count since the last bfcache restore (or for the\n   * full page lifecycle if there were no bfcache restores).\n   */\n  var getInteractionCountForNavigation = () => {\n    return (0, _polyfillsInteractionCountPolyfillJs.getInteractionCount)() - prevInteractionCount;\n  };\n\n  /**\n   *\n   */\n  var InteractionManager = /*#__PURE__*/function () {\n    function InteractionManager() {\n      (0, _classCallCheck.default)(this, InteractionManager);\n      InteractionManager.prototype.__init.call(this);\n      InteractionManager.prototype.__init2.call(this);\n    }\n    /**\n     * A list of longest interactions on the page (by latency) sorted so the\n     * longest one is first. The list is at most MAX_INTERACTIONS_TO_CONSIDER\n     * long.\n     */\n    // eslint-disable-next-line @sentry-internal/sdk/no-class-field-initializers, @typescript-eslint/explicit-member-accessibility\n    return (0, _createClass.default)(InteractionManager, [{\n      key: \"__init\",\n      value: function __init() {\n        this._longestInteractionList = [];\n      }\n\n      /**\n       * A mapping of longest interactions by their interaction ID.\n       * This is used for faster lookup.\n       */\n      // eslint-disable-next-line @sentry-internal/sdk/no-class-field-initializers, @typescript-eslint/explicit-member-accessibility\n    }, {\n      key: \"__init2\",\n      value: function __init2() {\n        this._longestInteractionMap = new Map();\n      }\n\n      // eslint-disable-next-line @typescript-eslint/explicit-member-accessibility\n\n      // eslint-disable-next-line @typescript-eslint/explicit-member-accessibility\n\n      // eslint-disable-next-line @typescript-eslint/explicit-member-accessibility, jsdoc/require-jsdoc\n    }, {\n      key: \"_resetInteractions\",\n      value: function _resetInteractions() {\n        prevInteractionCount = (0, _polyfillsInteractionCountPolyfillJs.getInteractionCount)();\n        this._longestInteractionList.length = 0;\n        this._longestInteractionMap.clear();\n      }\n\n      /**\n       * Returns the estimated p98 longest interaction based on the stored\n       * interaction candidates and the interaction count for the current page.\n       */\n      // eslint-disable-next-line @typescript-eslint/explicit-member-accessibility\n    }, {\n      key: \"_estimateP98LongestInteraction\",\n      value: function _estimateP98LongestInteraction() {\n        var candidateInteractionIndex = Math.min(this._longestInteractionList.length - 1, Math.floor(getInteractionCountForNavigation() / 50));\n        return this._longestInteractionList[candidateInteractionIndex];\n      }\n\n      /**\n       * Takes a performance entry and adds it to the list of worst interactions\n       * if its duration is long enough to make it among the worst. If the\n       * entry is part of an existing interaction, it is merged and the latency\n       * and entries list is updated as needed.\n       */\n      // eslint-disable-next-line @typescript-eslint/explicit-member-accessibility\n    }, {\n      key: \"_processEntry\",\n      value: function _processEntry(entry) {\n        this._onBeforeProcessingEntry?.(entry);\n\n        // Skip further processing for entries that cannot be INP candidates.\n        if (!(entry.interactionId || entry.entryType === 'first-input')) return;\n\n        // The least-long of the 10 longest interactions.\n        var minLongestInteraction = this._longestInteractionList.at(-1);\n        var interaction = this._longestInteractionMap.get(entry.interactionId);\n\n        // Only process the entry if it's possibly one of the ten longest,\n        // or if it's part of an existing interaction.\n        if (interaction || this._longestInteractionList.length < MAX_INTERACTIONS_TO_CONSIDER ||\n        // If the above conditions are false, `minLongestInteraction` will be set.\n        entry.duration > minLongestInteraction._latency) {\n          // If the interaction already exists, update it. Otherwise create one.\n          if (interaction) {\n            // If the new entry has a longer duration, replace the old entries,\n            // otherwise add to the array.\n            if (entry.duration > interaction._latency) {\n              interaction.entries = [entry];\n              interaction._latency = entry.duration;\n            } else if (entry.duration === interaction._latency && entry.startTime === interaction.entries[0].startTime) {\n              interaction.entries.push(entry);\n            }\n          } else {\n            interaction = {\n              id: entry.interactionId,\n              entries: [entry],\n              _latency: entry.duration\n            };\n            this._longestInteractionMap.set(interaction.id, interaction);\n            this._longestInteractionList.push(interaction);\n          }\n\n          // Sort the entries by latency (descending) and keep only the top ten.\n          this._longestInteractionList.sort((a, b) => b._latency - a._latency);\n          if (this._longestInteractionList.length > MAX_INTERACTIONS_TO_CONSIDER) {\n            var removedInteractions = this._longestInteractionList.splice(MAX_INTERACTIONS_TO_CONSIDER);\n            for (var _interaction of removedInteractions) {\n              this._longestInteractionMap.delete(_interaction.id);\n            }\n          }\n\n          // Call any post-processing on the interaction\n          this._onAfterProcessingINPCandidate?.(interaction);\n        }\n      }\n    }]);\n  }();\n});","lineCount":171,"map":[[12,2,142,0,"Object"],[12,8,142,0],[12,9,142,0,"defineProperty"],[12,23,142,0],[12,24,142,0,"exports"],[12,31,142,0],[13,4,142,0,"enumerable"],[13,14,142,0],[14,4,142,0,"get"],[14,7,142,0],[14,18,142,0,"get"],[14,19,142,0],[15,6,142,0],[15,13,142,9,"InteractionManager"],[15,31,142,27],[16,4,142,27],[17,2,142,27],[18,2,142,30],[18,6,142,30,"_babelRuntimeHelpersClassCallCheck"],[18,40,142,30],[18,43,142,30,"require"],[18,50,142,30],[18,51,142,30,"_dependencyMap"],[18,65,142,30],[19,2,142,30],[19,6,142,30,"_classCallCheck"],[19,21,142,30],[19,24,142,30,"_interopDefault"],[19,39,142,30],[19,40,142,30,"_babelRuntimeHelpersClassCallCheck"],[19,74,142,30],[20,2,142,30],[20,6,142,30,"_babelRuntimeHelpersCreateClass"],[20,37,142,30],[20,40,142,30,"require"],[20,47,142,30],[20,48,142,30,"_dependencyMap"],[20,62,142,30],[21,2,142,30],[21,6,142,30,"_createClass"],[21,18,142,30],[21,21,142,30,"_interopDefault"],[21,36,142,30],[21,37,142,30,"_babelRuntimeHelpersCreateClass"],[21,68,142,30],[22,2,1,0],[22,6,1,0,"_polyfillsInteractionCountPolyfillJs"],[22,42,1,0],[22,45,1,0,"require"],[22,52,1,0],[22,53,1,0,"_dependencyMap"],[22,67,1,0],[23,2,3,0],[24,0,4,0],[25,0,5,0],[26,0,6,0],[27,0,7,0],[28,0,8,0],[29,0,9,0],[30,0,10,0],[31,0,11,0],[32,0,12,0],[33,0,13,0],[34,0,14,0],[35,0,15,0],[36,0,16,0],[37,0,17,0],[39,2,20,0],[40,2,21,0],[41,2,22,0],[41,6,22,6,"MAX_INTERACTIONS_TO_CONSIDER"],[41,34,22,34],[41,37,22,37],[41,39,22,39],[43,2,24,0],[44,2,25,0],[45,2,26,0],[45,6,26,4,"prevInteractionCount"],[45,26,26,24],[45,29,26,27],[45,30,26,28],[47,2,28,0],[48,0,29,0],[49,0,30,0],[50,0,31,0],[51,2,32,0],[51,6,32,6,"getInteractionCountForNavigation"],[51,38,32,38],[51,41,32,41,"getInteractionCountForNavigation"],[51,42,32,41],[51,47,32,47],[52,4,33,2],[52,11,33,9],[52,15,33,9,"getInteractionCount"],[52,51,33,28],[52,52,33,28,"getInteractionCount"],[52,71,33,28],[52,73,33,29],[52,74,33,30],[52,77,33,33,"prevInteractionCount"],[52,97,33,53],[53,2,34,0],[53,3,34,1],[55,2,36,0],[56,0,37,0],[57,0,38,0],[58,2,36,0],[58,6,39,6,"InteractionManager"],[58,24,39,24],[59,4,39,26],[59,13,39,26,"InteractionManager"],[59,32,39,26],[59,34,39,40],[60,6,39,40],[60,10,39,40,"_classCallCheck"],[60,25,39,40],[60,26,39,40,"default"],[60,33,39,40],[60,41,39,40,"InteractionManager"],[60,59,39,40],[61,6,39,42,"InteractionManager"],[61,24,39,60],[61,25,39,61,"prototype"],[61,34,39,70],[61,35,39,71,"__init"],[61,41,39,77],[61,42,39,78,"call"],[61,46,39,82],[61,47,39,83],[61,51,39,87],[61,52,39,88],[62,6,39,89,"InteractionManager"],[62,24,39,107],[62,25,39,108,"prototype"],[62,34,39,117],[62,35,39,118,"__init2"],[62,42,39,125],[62,43,39,126,"call"],[62,47,39,130],[62,48,39,131],[62,52,39,135],[62,53,39,136],[63,4,39,138],[64,4,40,2],[65,0,41,0],[66,0,42,0],[67,0,43,0],[68,0,44,0],[69,4,45,2],[70,4,45,2],[70,15,45,2,"_createClass"],[70,27,45,2],[70,28,45,2,"default"],[70,35,45,2],[70,37,45,2,"InteractionManager"],[70,55,45,2],[71,6,45,2,"key"],[71,9,45,2],[72,6,45,2,"value"],[72,11,45,2],[72,13,46,2],[72,22,46,2,"__init"],[72,28,46,8,"__init"],[72,29,46,8],[72,31,46,11],[73,8,46,12],[73,12,46,16],[73,13,46,17,"_longestInteractionList"],[73,36,46,40],[73,39,46,43],[73,41,46,45],[74,6,46,46],[76,6,48,2],[77,0,49,0],[78,0,50,0],[79,0,51,0],[80,6,52,2],[81,4,52,2],[82,6,52,2,"key"],[82,9,52,2],[83,6,52,2,"value"],[83,11,52,2],[83,13,53,2],[83,22,53,2,"__init2"],[83,29,53,9,"__init2"],[83,30,53,9],[83,32,53,12],[84,8,53,13],[84,12,53,17],[84,13,53,18,"_longestInteractionMap"],[84,35,53,40],[84,38,53,43],[84,42,53,47,"Map"],[84,45,53,50],[84,46,53,51],[84,47,53,52],[85,6,53,53],[87,6,55,2],[89,6,57,2],[91,6,59,2],[92,4,59,2],[93,6,59,2,"key"],[93,9,59,2],[94,6,59,2,"value"],[94,11,59,2],[94,13,60,2],[94,22,60,2,"_resetInteractions"],[94,40,60,20,"_resetInteractions"],[94,41,60,20],[94,43,60,23],[95,8,61,4,"prevInteractionCount"],[95,28,61,24],[95,31,61,27],[95,35,61,27,"getInteractionCount"],[95,71,61,46],[95,72,61,46,"getInteractionCount"],[95,91,61,46],[95,93,61,47],[95,94,61,48],[96,8,62,4],[96,12,62,8],[96,13,62,9,"_longestInteractionList"],[96,36,62,32],[96,37,62,33,"length"],[96,43,62,39],[96,46,62,42],[96,47,62,43],[97,8,63,4],[97,12,63,8],[97,13,63,9,"_longestInteractionMap"],[97,35,63,31],[97,36,63,32,"clear"],[97,41,63,37],[97,42,63,38],[97,43,63,39],[98,6,64,2],[100,6,66,2],[101,0,67,0],[102,0,68,0],[103,0,69,0],[104,6,70,2],[105,4,70,2],[106,6,70,2,"key"],[106,9,70,2],[107,6,70,2,"value"],[107,11,70,2],[107,13,71,2],[107,22,71,2,"_estimateP98LongestInteraction"],[107,52,71,32,"_estimateP98LongestInteraction"],[107,53,71,32],[107,55,71,35],[108,8,72,4],[108,12,72,10,"candidateInteractionIndex"],[108,37,72,35],[108,40,72,38,"Math"],[108,44,72,42],[108,45,72,43,"min"],[108,48,72,46],[108,49,73,6],[108,53,73,10],[108,54,73,11,"_longestInteractionList"],[108,77,73,34],[108,78,73,35,"length"],[108,84,73,41],[108,87,73,44],[108,88,73,45],[108,90,74,6,"Math"],[108,94,74,10],[108,95,74,11,"floor"],[108,100,74,16],[108,101,74,17,"getInteractionCountForNavigation"],[108,133,74,49],[108,134,74,50],[108,135,74,51],[108,138,74,54],[108,140,74,56],[108,141,75,4],[108,142,75,5],[109,8,77,4],[109,15,77,11],[109,19,77,15],[109,20,77,16,"_longestInteractionList"],[109,43,77,39],[109,44,77,40,"candidateInteractionIndex"],[109,69,77,65],[109,70,77,66],[110,6,78,2],[112,6,80,2],[113,0,81,0],[114,0,82,0],[115,0,83,0],[116,0,84,0],[117,0,85,0],[118,6,86,2],[119,4,86,2],[120,6,86,2,"key"],[120,9,86,2],[121,6,86,2,"value"],[121,11,86,2],[121,13,87,2],[121,22,87,2,"_processEntry"],[121,35,87,15,"_processEntry"],[121,36,87,16,"entry"],[121,41,87,21],[121,43,87,23],[122,8,88,4],[122,12,88,8],[122,13,88,9,"_onBeforeProcessingEntry"],[122,37,88,33],[122,40,88,36,"entry"],[122,45,88,41],[122,46,88,42],[124,8,90,4],[125,8,91,4],[125,12,91,8],[125,14,91,10,"entry"],[125,19,91,15],[125,20,91,16,"interactionId"],[125,33,91,29],[125,37,91,33,"entry"],[125,42,91,38],[125,43,91,39,"entryType"],[125,52,91,48],[125,57,91,53],[125,70,91,66],[125,71,91,67],[125,73,91,69],[127,8,93,4],[128,8,94,4],[128,12,94,10,"minLongestInteraction"],[128,33,94,31],[128,36,94,34],[128,40,94,38],[128,41,94,39,"_longestInteractionList"],[128,64,94,62],[128,65,94,63,"at"],[128,67,94,65],[128,70,94,68],[128,71,94,69],[129,8,96,4],[129,12,96,8,"interaction"],[129,23,96,19],[129,26,96,22],[129,30,96,26],[129,31,96,27,"_longestInteractionMap"],[129,53,96,49],[129,54,96,50,"get"],[129,57,96,53],[129,58,96,54,"entry"],[129,63,96,59],[129,64,96,60,"interactionId"],[129,77,96,73],[129,78,96,74],[131,8,98,4],[132,8,99,4],[133,8,100,4],[133,12,101,6,"interaction"],[133,23,101,17],[133,27,102,6],[133,31,102,10],[133,32,102,11,"_longestInteractionList"],[133,55,102,34],[133,56,102,35,"length"],[133,62,102,41],[133,65,102,44,"MAX_INTERACTIONS_TO_CONSIDER"],[133,93,102,72],[134,8,103,6],[135,8,104,6,"entry"],[135,13,104,11],[135,14,104,12,"duration"],[135,22,104,20],[135,25,104,23,"minLongestInteraction"],[135,46,104,44],[135,47,104,45,"_latency"],[135,55,104,53],[135,57,105,6],[136,10,106,6],[137,10,107,6],[137,14,107,10,"interaction"],[137,25,107,21],[137,27,107,23],[138,12,108,8],[139,12,109,8],[140,12,110,8],[140,16,110,12,"entry"],[140,21,110,17],[140,22,110,18,"duration"],[140,30,110,26],[140,33,110,29,"interaction"],[140,44,110,40],[140,45,110,41,"_latency"],[140,53,110,49],[140,55,110,51],[141,14,111,10,"interaction"],[141,25,111,21],[141,26,111,22,"entries"],[141,33,111,29],[141,36,111,32],[141,37,111,33,"entry"],[141,42,111,38],[141,43,111,39],[142,14,112,10,"interaction"],[142,25,112,21],[142,26,112,22,"_latency"],[142,34,112,30],[142,37,112,33,"entry"],[142,42,112,38],[142,43,112,39,"duration"],[142,51,112,47],[143,12,113,8],[143,13,113,9],[143,19,113,15],[143,23,113,19,"entry"],[143,28,113,24],[143,29,113,25,"duration"],[143,37,113,33],[143,42,113,38,"interaction"],[143,53,113,49],[143,54,113,50,"_latency"],[143,62,113,58],[143,66,113,62,"entry"],[143,71,113,67],[143,72,113,68,"startTime"],[143,81,113,77],[143,86,113,82,"interaction"],[143,97,113,93],[143,98,113,94,"entries"],[143,105,113,101],[143,106,113,102],[143,107,113,103],[143,108,113,104],[143,109,113,105,"startTime"],[143,118,113,114],[143,120,113,116],[144,14,114,10,"interaction"],[144,25,114,21],[144,26,114,22,"entries"],[144,33,114,29],[144,34,114,30,"push"],[144,38,114,34],[144,39,114,35,"entry"],[144,44,114,40],[144,45,114,41],[145,12,115,8],[146,10,116,6],[146,11,116,7],[146,17,116,13],[147,12,117,8,"interaction"],[147,23,117,19],[147,26,117,22],[148,14,118,10,"id"],[148,16,118,12],[148,18,118,14,"entry"],[148,23,118,19],[148,24,118,20,"interactionId"],[148,37,118,33],[149,14,119,10,"entries"],[149,21,119,17],[149,23,119,19],[149,24,119,20,"entry"],[149,29,119,25],[149,30,119,26],[150,14,120,10,"_latency"],[150,22,120,18],[150,24,120,20,"entry"],[150,29,120,25],[150,30,120,26,"duration"],[151,12,121,8],[151,13,121,9],[152,12,122,8],[152,16,122,12],[152,17,122,13,"_longestInteractionMap"],[152,39,122,35],[152,40,122,36,"set"],[152,43,122,39],[152,44,122,40,"interaction"],[152,55,122,51],[152,56,122,52,"id"],[152,58,122,54],[152,60,122,56,"interaction"],[152,71,122,67],[152,72,122,68],[153,12,123,8],[153,16,123,12],[153,17,123,13,"_longestInteractionList"],[153,40,123,36],[153,41,123,37,"push"],[153,45,123,41],[153,46,123,42,"interaction"],[153,57,123,53],[153,58,123,54],[154,10,124,6],[156,10,126,6],[157,10,127,6],[157,14,127,10],[157,15,127,11,"_longestInteractionList"],[157,38,127,34],[157,39,127,35,"sort"],[157,43,127,39],[157,44,127,40],[157,45,127,41,"a"],[157,46,127,42],[157,48,127,44,"b"],[157,49,127,45],[157,54,127,50,"b"],[157,55,127,51],[157,56,127,52,"_latency"],[157,64,127,60],[157,67,127,63,"a"],[157,68,127,64],[157,69,127,65,"_latency"],[157,77,127,73],[157,78,127,74],[158,10,128,6],[158,14,128,10],[158,18,128,14],[158,19,128,15,"_longestInteractionList"],[158,42,128,38],[158,43,128,39,"length"],[158,49,128,45],[158,52,128,48,"MAX_INTERACTIONS_TO_CONSIDER"],[158,80,128,76],[158,82,128,78],[159,12,129,8],[159,16,129,14,"removedInteractions"],[159,35,129,33],[159,38,129,36],[159,42,129,40],[159,43,129,41,"_longestInteractionList"],[159,66,129,64],[159,67,129,65,"splice"],[159,73,129,71],[159,74,129,72,"MAX_INTERACTIONS_TO_CONSIDER"],[159,102,129,100],[159,103,129,101],[160,12,131,8],[160,17,131,13],[160,21,131,19,"interaction"],[160,33,131,30],[160,37,131,34,"removedInteractions"],[160,56,131,53],[160,58,131,55],[161,14,132,10],[161,18,132,14],[161,19,132,15,"_longestInteractionMap"],[161,41,132,37],[161,42,132,38,"delete"],[161,48,132,44],[161,49,132,45,"interaction"],[161,61,132,56],[161,62,132,57,"id"],[161,64,132,59],[161,65,132,60],[162,12,133,8],[163,10,134,6],[165,10,136,6],[166,10,137,6],[166,14,137,10],[166,15,137,11,"_onAfterProcessingINPCandidate"],[166,45,137,41],[166,48,137,44,"interaction"],[166,59,137,55],[166,60,137,56],[167,8,138,4],[168,6,139,2],[169,4,139,3],[170,2,139,3],[171,0,139,3],[171,3]],"functionMap":{"names":["<global>","getInteractionCountForNavigation","InteractionManager","constructor","__init","__init2","_resetInteractions","_estimateP98LongestInteraction","_processEntry","_longestInteractionList.sort$argument_0"],"mappings":"AAA;yCC+B;CDE;AEK,0BC,iHD;EEO,6CF;EGO,oDH;EIO;GJI;EKO;GLO;EMS;wCCwC,iCD;GNY;CFC"},"hasCjsExports":false},"type":"js/module"}]}