{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"./currentScopes.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":67,"index":67}}],"key":"K7iI+PRtR1yDAq2Cd5P/ht8ORfQ=","exportNames":["*"],"imports":1}},{"name":"./exports.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":68},"end":{"line":2,"column":48,"index":116}}],"key":"t/+6jF6bamLhGLo72Jouy5+wt/Q=","exportNames":["*"],"imports":1}},{"name":"./semanticAttributes.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":117},"end":{"line":3,"column":109,"index":226}}],"key":"/6BUdYPH9gaEicG1aM+qviDIUZE=","exportNames":["*"],"imports":1}},{"name":"./utils/object.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":227},"end":{"line":4,"column":61,"index":288}}],"key":"Mr3b16VHRX5yCRL431OMVx5iyT8=","exportNames":["*"],"imports":1}},{"name":"./utils/normalize.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":289},"end":{"line":5,"column":49,"index":338}}],"key":"eA0aotdEwNDbk3x/hlVkXJnhQwg=","exportNames":["*"],"imports":1}},{"name":"./tracing/trace.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":6,"column":0,"index":339},"end":{"line":6,"column":53,"index":392}}],"key":"Z0hO6xxcK72YpJO1GcfhCSObzfk=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"trpcMiddleware\", {\n    enumerable: true,\n    get: function () {\n      return trpcMiddleware;\n    }\n  });\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _currentScopesJs = require(_dependencyMap[1], \"./currentScopes.js\");\n  var _exportsJs = require(_dependencyMap[2], \"./exports.js\");\n  var _semanticAttributesJs = require(_dependencyMap[3], \"./semanticAttributes.js\");\n  var _utilsObjectJs = require(_dependencyMap[4], \"./utils/object.js\");\n  var _utilsNormalizeJs = require(_dependencyMap[5], \"./utils/normalize.js\");\n  var _tracingTraceJs = require(_dependencyMap[6], \"./tracing/trace.js\");\n  var trpcCaptureContext = {\n    mechanism: {\n      handled: false,\n      type: 'auto.rpc.trpc.middleware'\n    }\n  };\n  function captureIfError(nextResult) {\n    // TODO: Set span status based on what TRPCError was encountered\n    if (typeof nextResult === 'object' && nextResult !== null && 'ok' in nextResult && !nextResult.ok && 'error' in nextResult) {\n      (0, _exportsJs.captureException)(nextResult.error, trpcCaptureContext);\n    }\n  }\n\n  /**\n   * Sentry tRPC middleware that captures errors and creates spans for tRPC procedures.\n   */\n  function trpcMiddleware() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    return /*#__PURE__*/function () {\n      var _ref = (0, _asyncToGenerator.default)(function* (opts) {\n        var path = opts.path,\n          type = opts.type,\n          next = opts.next,\n          rawInput = opts.rawInput,\n          getRawInput = opts.getRawInput;\n        var client = (0, _currentScopesJs.getClient)();\n        var clientOptions = client?.getOptions();\n        var trpcContext = {\n          procedure_path: path,\n          procedure_type: type\n        };\n        (0, _utilsObjectJs.addNonEnumerableProperty)(trpcContext, '__sentry_override_normalization_depth__', 1 + (\n        // 1 for context.input + the normal normalization depth\n        clientOptions?.normalizeDepth ?? 5) // 5 is a sane depth\n        );\n        if (options.attachRpcInput !== undefined ? options.attachRpcInput : clientOptions?.sendDefaultPii) {\n          if (rawInput !== undefined) {\n            trpcContext.input = (0, _utilsNormalizeJs.normalize)(rawInput);\n          }\n          if (getRawInput !== undefined && typeof getRawInput === 'function') {\n            try {\n              var rawRes = yield getRawInput();\n              trpcContext.input = (0, _utilsNormalizeJs.normalize)(rawRes);\n            } catch {\n              // noop\n            }\n          }\n        }\n        return (0, _currentScopesJs.withIsolationScope)(scope => {\n          scope.setContext('trpc', trpcContext);\n          return (0, _tracingTraceJs.startSpanManual)({\n            name: `trpc/${path}`,\n            op: 'rpc.server',\n            attributes: {\n              [_semanticAttributesJs.SEMANTIC_ATTRIBUTE_SENTRY_SOURCE]: 'route',\n              [_semanticAttributesJs.SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN]: 'auto.rpc.trpc'\n            },\n            forceTransaction: !!options.forceTransaction\n          }, /*#__PURE__*/function () {\n            var _ref2 = (0, _asyncToGenerator.default)(function* (span) {\n              try {\n                var nextResult = yield next();\n                captureIfError(nextResult);\n                span.end();\n                return nextResult;\n              } catch (e) {\n                (0, _exportsJs.captureException)(e, trpcCaptureContext);\n                span.end();\n                throw e;\n              }\n            });\n            return function (_x2) {\n              return _ref2.apply(this, arguments);\n            };\n          }());\n        });\n      });\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n  }\n});","lineCount":110,"map":[[12,2,92,0,"Object"],[12,8,92,0],[12,9,92,0,"defineProperty"],[12,23,92,0],[12,24,92,0,"exports"],[12,31,92,0],[13,4,92,0,"enumerable"],[13,14,92,0],[14,4,92,0,"get"],[14,7,92,0],[14,18,92,0,"get"],[14,19,92,0],[15,6,92,0],[15,13,92,9,"trpcMiddleware"],[15,27,92,23],[16,4,92,23],[17,2,92,23],[18,2,92,26],[18,6,92,26,"_babelRuntimeHelpersAsyncToGenerator"],[18,42,92,26],[18,45,92,26,"require"],[18,52,92,26],[18,53,92,26,"_dependencyMap"],[18,67,92,26],[19,2,92,26],[19,6,92,26,"_asyncToGenerator"],[19,23,92,26],[19,26,92,26,"_interopDefault"],[19,41,92,26],[19,42,92,26,"_babelRuntimeHelpersAsyncToGenerator"],[19,78,92,26],[20,2,1,0],[20,6,1,0,"_currentScopesJs"],[20,22,1,0],[20,25,1,0,"require"],[20,32,1,0],[20,33,1,0,"_dependencyMap"],[20,47,1,0],[21,2,2,0],[21,6,2,0,"_exportsJs"],[21,16,2,0],[21,19,2,0,"require"],[21,26,2,0],[21,27,2,0,"_dependencyMap"],[21,41,2,0],[22,2,3,0],[22,6,3,0,"_semanticAttributesJs"],[22,27,3,0],[22,30,3,0,"require"],[22,37,3,0],[22,38,3,0,"_dependencyMap"],[22,52,3,0],[23,2,4,0],[23,6,4,0,"_utilsObjectJs"],[23,20,4,0],[23,23,4,0,"require"],[23,30,4,0],[23,31,4,0,"_dependencyMap"],[23,45,4,0],[24,2,5,0],[24,6,5,0,"_utilsNormalizeJs"],[24,23,5,0],[24,26,5,0,"require"],[24,33,5,0],[24,34,5,0,"_dependencyMap"],[24,48,5,0],[25,2,6,0],[25,6,6,0,"_tracingTraceJs"],[25,21,6,0],[25,24,6,0,"require"],[25,31,6,0],[25,32,6,0,"_dependencyMap"],[25,46,6,0],[26,2,8,0],[26,6,8,6,"trpcCaptureContext"],[26,24,8,24],[26,27,8,27],[27,4,8,29,"mechanism"],[27,13,8,38],[27,15,8,40],[28,6,8,42,"handled"],[28,13,8,49],[28,15,8,51],[28,20,8,56],[29,6,8,58,"type"],[29,10,8,62],[29,12,8,64],[30,4,8,91],[31,2,8,93],[31,3,8,94],[32,2,10,0],[32,11,10,9,"captureIfError"],[32,25,10,23,"captureIfError"],[32,26,10,24,"nextResult"],[32,36,10,34],[32,38,10,36],[33,4,11,2],[34,4,12,2],[34,8,13,4],[34,15,13,11,"nextResult"],[34,25,13,21],[34,30,13,26],[34,38,13,34],[34,42,14,4,"nextResult"],[34,52,14,14],[34,57,14,19],[34,61,14,23],[34,65,15,4],[34,69,15,8],[34,73,15,12,"nextResult"],[34,83,15,22],[34,87,16,4],[34,88,16,5,"nextResult"],[34,98,16,15],[34,99,16,16,"ok"],[34,101,16,18],[34,105,17,4],[34,112,17,11],[34,116,17,15,"nextResult"],[34,126,17,25],[34,128,18,4],[35,6,19,4],[35,10,19,4,"captureException"],[35,20,19,20],[35,21,19,20,"captureException"],[35,37,19,20],[35,39,19,21,"nextResult"],[35,49,19,31],[35,50,19,32,"error"],[35,55,19,37],[35,57,19,39,"trpcCaptureContext"],[35,75,19,57],[35,76,19,58],[36,4,20,2],[37,2,21,0],[39,2,23,0],[40,0,24,0],[41,0,25,0],[42,2,26,0],[42,11,26,9,"trpcMiddleware"],[42,25,26,23,"trpcMiddleware"],[42,26,26,23],[42,28,26,38],[43,4,26,38],[43,8,26,24,"options"],[43,15,26,31],[43,18,26,31,"arguments"],[43,27,26,31],[43,28,26,31,"length"],[43,34,26,31],[43,42,26,31,"arguments"],[43,51,26,31],[43,59,26,31,"undefined"],[43,68,26,31],[43,71,26,31,"arguments"],[43,80,26,31],[43,86,26,34],[43,87,26,35],[43,88,26,36],[44,4,27,2],[45,4,28,2],[46,4,29,2],[47,6,29,2],[47,10,29,2,"_ref"],[47,14,29,2],[47,21,29,2,"_asyncToGenerator"],[47,38,29,2],[47,39,29,2,"default"],[47,46,29,2],[47,48,29,9],[47,59,29,25,"opts"],[47,63,29,29],[47,65,29,31],[48,8,30,4],[48,12,30,12,"path"],[48,16,30,16],[48,19,30,56,"opts"],[48,23,30,60],[48,24,30,12,"path"],[48,28,30,16],[49,10,30,18,"type"],[49,14,30,22],[49,17,30,56,"opts"],[49,21,30,60],[49,22,30,18,"type"],[49,26,30,22],[50,10,30,24,"next"],[50,14,30,28],[50,17,30,56,"opts"],[50,21,30,60],[50,22,30,24,"next"],[50,26,30,28],[51,10,30,30,"rawInput"],[51,18,30,38],[51,21,30,56,"opts"],[51,25,30,60],[51,26,30,30,"rawInput"],[51,34,30,38],[52,10,30,40,"getRawInput"],[52,21,30,51],[52,24,30,56,"opts"],[52,28,30,60],[52,29,30,40,"getRawInput"],[52,40,30,51],[53,8,32,4],[53,12,32,10,"client"],[53,18,32,16],[53,21,32,19],[53,25,32,19,"getClient"],[53,41,32,28],[53,42,32,28,"getClient"],[53,51,32,28],[53,53,32,29],[53,54,32,30],[54,8,33,4],[54,12,33,10,"clientOptions"],[54,25,33,23],[54,28,33,26,"client"],[54,34,33,32],[54,36,33,34,"getOptions"],[54,46,33,44],[54,47,33,45],[54,48,33,46],[55,8,35,4],[55,12,35,10,"trpcContext"],[55,23,35,21],[55,26,35,24],[56,10,36,6,"procedure_path"],[56,24,36,20],[56,26,36,22,"path"],[56,30,36,26],[57,10,37,6,"procedure_type"],[57,24,37,20],[57,26,37,22,"type"],[58,8,38,4],[58,9,38,5],[59,8,40,4],[59,12,40,4,"addNonEnumerableProperty"],[59,26,40,28],[59,27,40,28,"addNonEnumerableProperty"],[59,51,40,28],[59,53,41,6,"trpcContext"],[59,64,41,17],[59,66,42,6],[59,107,42,47],[59,109,43,6],[59,110,43,7],[60,8,43,10],[61,8,44,9,"clientOptions"],[61,21,44,22],[61,23,44,24,"normalizeDepth"],[61,37,44,38],[61,41,44,42],[61,42,44,43],[61,43,44,44],[61,44,44,46],[62,8,45,4],[62,9,45,5],[63,8,47,4],[63,12,47,8,"options"],[63,19,47,15],[63,20,47,16,"attachRpcInput"],[63,34,47,30],[63,39,47,35,"undefined"],[63,48,47,44],[63,51,47,47,"options"],[63,58,47,54],[63,59,47,55,"attachRpcInput"],[63,73,47,69],[63,76,47,72,"clientOptions"],[63,89,47,85],[63,91,47,87,"sendDefaultPii"],[63,105,47,101],[63,107,47,103],[64,10,48,6],[64,14,48,10,"rawInput"],[64,22,48,18],[64,27,48,23,"undefined"],[64,36,48,32],[64,38,48,34],[65,12,49,8,"trpcContext"],[65,23,49,19],[65,24,49,20,"input"],[65,29,49,25],[65,32,49,28],[65,36,49,28,"normalize"],[65,53,49,37],[65,54,49,37,"normalize"],[65,63,49,37],[65,65,49,38,"rawInput"],[65,73,49,46],[65,74,49,47],[66,10,50,6],[67,10,52,6],[67,14,52,10,"getRawInput"],[67,25,52,21],[67,30,52,26,"undefined"],[67,39,52,35],[67,43,52,39],[67,50,52,46,"getRawInput"],[67,61,52,57],[67,66,52,62],[67,76,52,72],[67,78,52,74],[68,12,53,8],[68,16,53,12],[69,14,54,10],[69,18,54,16,"rawRes"],[69,24,54,22],[69,33,54,31,"getRawInput"],[69,44,54,42],[69,45,54,43],[69,46,54,44],[70,14,56,10,"trpcContext"],[70,25,56,21],[70,26,56,22,"input"],[70,31,56,27],[70,34,56,30],[70,38,56,30,"normalize"],[70,55,56,39],[70,56,56,39,"normalize"],[70,65,56,39],[70,67,56,40,"rawRes"],[70,73,56,46],[70,74,56,47],[71,12,57,8],[71,13,57,9],[71,14,57,10],[71,20,57,16],[72,14,58,10],[73,12,58,10],[74,10,60,6],[75,8,61,4],[76,8,63,4],[76,15,63,11],[76,19,63,11,"withIsolationScope"],[76,35,63,29],[76,36,63,29,"withIsolationScope"],[76,54,63,29],[76,56,63,30,"scope"],[76,61,63,35],[76,65,63,39],[77,10,64,6,"scope"],[77,15,64,11],[77,16,64,12,"setContext"],[77,26,64,22],[77,27,64,23],[77,33,64,29],[77,35,64,31,"trpcContext"],[77,46,64,42],[77,47,64,43],[78,10,65,6],[78,17,65,13],[78,21,65,13,"startSpanManual"],[78,36,65,28],[78,37,65,28,"startSpanManual"],[78,52,65,28],[78,54,66,8],[79,12,67,10,"name"],[79,16,67,14],[79,18,67,16],[79,26,67,24,"path"],[79,30,67,28],[79,32,67,30],[80,12,68,10,"op"],[80,14,68,12],[80,16,68,14],[80,28,68,26],[81,12,69,10,"attributes"],[81,22,69,20],[81,24,69,22],[82,14,70,12],[82,15,70,13,"SEMANTIC_ATTRIBUTE_SENTRY_SOURCE"],[82,36,70,45],[82,37,70,45,"SEMANTIC_ATTRIBUTE_SENTRY_SOURCE"],[82,69,70,45],[82,72,70,48],[82,79,70,55],[83,14,71,12],[83,15,71,13,"SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN"],[83,36,71,45],[83,37,71,45,"SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN"],[83,69,71,45],[83,72,71,48],[84,12,72,10],[84,13,72,11],[85,12,73,10,"forceTransaction"],[85,28,73,26],[85,30,73,28],[85,31,73,29],[85,32,73,30,"options"],[85,39,73,37],[85,40,73,38,"forceTransaction"],[86,10,74,8],[86,11,74,9],[87,12,74,9],[87,16,74,9,"_ref2"],[87,21,74,9],[87,28,74,9,"_asyncToGenerator"],[87,45,74,9],[87,46,74,9,"default"],[87,53,74,9],[87,55,75,8],[87,66,75,14,"span"],[87,70,75,18],[87,72,75,22],[88,14,76,10],[88,18,76,14],[89,16,77,12],[89,20,77,18,"nextResult"],[89,30,77,28],[89,39,77,37,"next"],[89,43,77,41],[89,44,77,42],[89,45,77,43],[90,16,78,12,"captureIfError"],[90,30,78,26],[90,31,78,27,"nextResult"],[90,41,78,37],[90,42,78,38],[91,16,79,12,"span"],[91,20,79,16],[91,21,79,17,"end"],[91,24,79,20],[91,25,79,21],[91,26,79,22],[92,16,80,12],[92,23,80,19,"nextResult"],[92,33,80,29],[93,14,81,10],[93,15,81,11],[93,16,81,12],[93,23,81,19,"e"],[93,24,81,20],[93,26,81,22],[94,16,82,12],[94,20,82,12,"captureException"],[94,30,82,28],[94,31,82,28,"captureException"],[94,47,82,28],[94,49,82,29,"e"],[94,50,82,30],[94,52,82,32,"trpcCaptureContext"],[94,70,82,50],[94,71,82,51],[95,16,83,12,"span"],[95,20,83,16],[95,21,83,17,"end"],[95,24,83,20],[95,25,83,21],[95,26,83,22],[96,16,84,12],[96,22,84,18,"e"],[96,23,84,19],[97,14,85,10],[98,12,86,8],[98,13,86,9],[99,12,86,9],[99,29,86,9,"_x2"],[99,32,86,9],[100,14,86,9],[100,21,86,9,"_ref2"],[100,26,86,9],[100,27,86,9,"apply"],[100,32,86,9],[100,39,86,9,"arguments"],[100,48,86,9],[101,12,86,9],[102,10,86,9],[102,13,87,6],[102,14,87,7],[103,8,88,4],[103,9,88,5],[103,10,88,6],[104,6,89,2],[104,7,89,3],[105,6,89,3],[105,23,89,3,"_x"],[105,25,89,3],[106,8,89,3],[106,15,89,3,"_ref"],[106,19,89,3],[106,20,89,3,"apply"],[106,25,89,3],[106,32,89,3,"arguments"],[106,41,89,3],[107,6,89,3],[108,4,89,3],[109,2,90,0],[110,0,90,1],[110,3]],"functionMap":{"names":["<global>","captureIfError","trpcMiddleware","<anonymous>","withIsolationScope$argument_0","startSpanManual$argument_1"],"mappings":"AAA;ACS;CDW;AEK;SCG;8BCkC;QCY;SDW;KDE;GDC;CFC"},"hasCjsExports":false},"type":"js/module"}]}