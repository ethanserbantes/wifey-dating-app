{"dependencies":[{"name":"../debug-build.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":48,"index":48}}],"key":"rfhktnzi6PvZxT1xtyHWbBktN/w=","exportNames":["*"],"imports":1}},{"name":"../utils/debug-logger.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":49},"end":{"line":2,"column":49,"index":98}}],"key":"bptn1GZFOkS4BOMU8jhPqqHmvAc=","exportNames":["*"],"imports":1}},{"name":"../utils/envelope.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":99},"end":{"line":3,"column":126,"index":225}}],"key":"yiniLg9hHeIHPDkrzeivR1oDz5o=","exportNames":["*"],"imports":1}},{"name":"../utils/promisebuffer.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":226},"end":{"line":4,"column":88,"index":314}}],"key":"g1PLmpXkRqx5eG1RICG6UFDmM1s=","exportNames":["*"],"imports":1}},{"name":"../utils/ratelimit.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":315},"end":{"line":5,"column":72,"index":387}}],"key":"eBQc6ZZkzOf7Vfwryf2nt/LMy9M=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"DEFAULT_TRANSPORT_BUFFER_SIZE\", {\n    enumerable: true,\n    get: function () {\n      return DEFAULT_TRANSPORT_BUFFER_SIZE;\n    }\n  });\n  Object.defineProperty(exports, \"createTransport\", {\n    enumerable: true,\n    get: function () {\n      return createTransport;\n    }\n  });\n  var _debugBuildJs = require(_dependencyMap[0], \"../debug-build.js\");\n  var _utilsDebugLoggerJs = require(_dependencyMap[1], \"../utils/debug-logger.js\");\n  var _utilsEnvelopeJs = require(_dependencyMap[2], \"../utils/envelope.js\");\n  var _utilsPromisebufferJs = require(_dependencyMap[3], \"../utils/promisebuffer.js\");\n  var _utilsRatelimitJs = require(_dependencyMap[4], \"../utils/ratelimit.js\");\n  var DEFAULT_TRANSPORT_BUFFER_SIZE = 64;\n\n  /**\n   * Creates an instance of a Sentry `Transport`\n   *\n   * @param options\n   * @param makeRequest\n   */\n  function createTransport(options, makeRequest) {\n    var buffer = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : (0, _utilsPromisebufferJs.makePromiseBuffer)(options.bufferSize || DEFAULT_TRANSPORT_BUFFER_SIZE);\n    var rateLimits = {};\n    var flush = timeout => buffer.drain(timeout);\n    function send(envelope) {\n      var filteredEnvelopeItems = [];\n\n      // Drop rate limited items from envelope\n      (0, _utilsEnvelopeJs.forEachEnvelopeItem)(envelope, (item, type) => {\n        var dataCategory = (0, _utilsEnvelopeJs.envelopeItemTypeToDataCategory)(type);\n        if ((0, _utilsRatelimitJs.isRateLimited)(rateLimits, dataCategory)) {\n          options.recordDroppedEvent('ratelimit_backoff', dataCategory);\n        } else {\n          filteredEnvelopeItems.push(item);\n        }\n      });\n\n      // Skip sending if envelope is empty after filtering out rate limited events\n      if (filteredEnvelopeItems.length === 0) {\n        return Promise.resolve({});\n      }\n      var filteredEnvelope = (0, _utilsEnvelopeJs.createEnvelope)(envelope[0], filteredEnvelopeItems);\n\n      // Creates client report for each item in an envelope\n      var recordEnvelopeLoss = reason => {\n        (0, _utilsEnvelopeJs.forEachEnvelopeItem)(filteredEnvelope, (item, type) => {\n          options.recordDroppedEvent(reason, (0, _utilsEnvelopeJs.envelopeItemTypeToDataCategory)(type));\n        });\n      };\n      var requestTask = () => makeRequest({\n        body: (0, _utilsEnvelopeJs.serializeEnvelope)(filteredEnvelope)\n      }).then(response => {\n        // We don't want to throw on NOK responses, but we want to at least log them\n        if (response.statusCode !== undefined && (response.statusCode < 200 || response.statusCode >= 300)) {\n          _debugBuildJs.DEBUG_BUILD && _utilsDebugLoggerJs.debug.warn(`Sentry responded with status code ${response.statusCode} to sent event.`);\n        }\n        rateLimits = (0, _utilsRatelimitJs.updateRateLimits)(rateLimits, response);\n        return response;\n      }, error => {\n        recordEnvelopeLoss('network_error');\n        _debugBuildJs.DEBUG_BUILD && _utilsDebugLoggerJs.debug.error('Encountered error running transport request:', error);\n        throw error;\n      });\n      return buffer.add(requestTask).then(result => result, error => {\n        if (error === _utilsPromisebufferJs.SENTRY_BUFFER_FULL_ERROR) {\n          _debugBuildJs.DEBUG_BUILD && _utilsDebugLoggerJs.debug.error('Skipped sending event because buffer is full.');\n          recordEnvelopeLoss('queue_overflow');\n          return Promise.resolve({});\n        } else {\n          throw error;\n        }\n      });\n    }\n    return {\n      send,\n      flush\n    };\n  }\n});","lineCount":90,"map":[[7,2,90,0,"Object"],[7,8,90,0],[7,9,90,0,"defineProperty"],[7,23,90,0],[7,24,90,0,"exports"],[7,31,90,0],[8,4,90,0,"enumerable"],[8,14,90,0],[9,4,90,0,"get"],[9,7,90,0],[9,18,90,0,"get"],[9,19,90,0],[10,6,90,0],[10,13,90,9,"DEFAULT_TRANSPORT_BUFFER_SIZE"],[10,42,90,38],[11,4,90,38],[12,2,90,38],[13,2,90,0,"Object"],[13,8,90,0],[13,9,90,0,"defineProperty"],[13,23,90,0],[13,24,90,0,"exports"],[13,31,90,0],[14,4,90,0,"enumerable"],[14,14,90,0],[15,4,90,0,"get"],[15,7,90,0],[15,18,90,0,"get"],[15,19,90,0],[16,6,90,0],[16,13,90,40,"createTransport"],[16,28,90,55],[17,4,90,55],[18,2,90,55],[19,2,1,0],[19,6,1,0,"_debugBuildJs"],[19,19,1,0],[19,22,1,0,"require"],[19,29,1,0],[19,30,1,0,"_dependencyMap"],[19,44,1,0],[20,2,2,0],[20,6,2,0,"_utilsDebugLoggerJs"],[20,25,2,0],[20,28,2,0,"require"],[20,35,2,0],[20,36,2,0,"_dependencyMap"],[20,50,2,0],[21,2,3,0],[21,6,3,0,"_utilsEnvelopeJs"],[21,22,3,0],[21,25,3,0,"require"],[21,32,3,0],[21,33,3,0,"_dependencyMap"],[21,47,3,0],[22,2,4,0],[22,6,4,0,"_utilsPromisebufferJs"],[22,27,4,0],[22,30,4,0,"require"],[22,37,4,0],[22,38,4,0,"_dependencyMap"],[22,52,4,0],[23,2,5,0],[23,6,5,0,"_utilsRatelimitJs"],[23,23,5,0],[23,26,5,0,"require"],[23,33,5,0],[23,34,5,0,"_dependencyMap"],[23,48,5,0],[24,2,7,0],[24,6,7,6,"DEFAULT_TRANSPORT_BUFFER_SIZE"],[24,35,7,35],[24,38,7,38],[24,40,7,40],[26,2,9,0],[27,0,10,0],[28,0,11,0],[29,0,12,0],[30,0,13,0],[31,0,14,0],[32,2,15,0],[32,11,15,9,"createTransport"],[32,26,15,24,"createTransport"],[32,27,16,2,"options"],[32,34,16,9],[32,36,17,2,"makeRequest"],[32,47,17,13],[32,49,21,2],[33,4,21,2],[33,8,18,2,"buffer"],[33,14,18,8],[33,17,18,8,"arguments"],[33,26,18,8],[33,27,18,8,"length"],[33,33,18,8],[33,41,18,8,"arguments"],[33,50,18,8],[33,58,18,8,"undefined"],[33,67,18,8],[33,70,18,8,"arguments"],[33,79,18,8],[33,85,18,11],[33,89,18,11,"makePromiseBuffer"],[33,110,18,28],[33,111,18,28,"makePromiseBuffer"],[33,128,18,28],[33,130,19,4,"options"],[33,137,19,11],[33,138,19,12,"bufferSize"],[33,148,19,22],[33,152,19,26,"DEFAULT_TRANSPORT_BUFFER_SIZE"],[33,181,20,2],[33,182,20,3],[34,4,22,2],[34,8,22,6,"rateLimits"],[34,18,22,16],[34,21,22,19],[34,22,22,20],[34,23,22,21],[35,4,23,2],[35,8,23,8,"flush"],[35,13,23,13],[35,16,23,17,"timeout"],[35,23,23,24],[35,27,23,29,"buffer"],[35,33,23,35],[35,34,23,36,"drain"],[35,39,23,41],[35,40,23,42,"timeout"],[35,47,23,49],[35,48,23,50],[36,4,25,2],[36,13,25,11,"send"],[36,17,25,15,"send"],[36,18,25,16,"envelope"],[36,26,25,24],[36,28,25,26],[37,6,26,4],[37,10,26,10,"filteredEnvelopeItems"],[37,31,26,31],[37,34,26,34],[37,36,26,36],[39,6,28,4],[40,6,29,4],[40,10,29,4,"forEachEnvelopeItem"],[40,26,29,23],[40,27,29,23,"forEachEnvelopeItem"],[40,46,29,23],[40,48,29,24,"envelope"],[40,56,29,32],[40,58,29,34],[40,59,29,35,"item"],[40,63,29,39],[40,65,29,41,"type"],[40,69,29,45],[40,74,29,50],[41,8,30,6],[41,12,30,12,"dataCategory"],[41,24,30,24],[41,27,30,27],[41,31,30,27,"envelopeItemTypeToDataCategory"],[41,47,30,57],[41,48,30,57,"envelopeItemTypeToDataCategory"],[41,78,30,57],[41,80,30,58,"type"],[41,84,30,62],[41,85,30,63],[42,8,31,6],[42,12,31,10],[42,16,31,10,"isRateLimited"],[42,33,31,23],[42,34,31,23,"isRateLimited"],[42,47,31,23],[42,49,31,24,"rateLimits"],[42,59,31,34],[42,61,31,36,"dataCategory"],[42,73,31,48],[42,74,31,49],[42,76,31,51],[43,10,32,8,"options"],[43,17,32,15],[43,18,32,16,"recordDroppedEvent"],[43,36,32,34],[43,37,32,35],[43,56,32,54],[43,58,32,56,"dataCategory"],[43,70,32,68],[43,71,32,69],[44,8,33,6],[44,9,33,7],[44,15,33,13],[45,10,34,8,"filteredEnvelopeItems"],[45,31,34,29],[45,32,34,30,"push"],[45,36,34,34],[45,37,34,35,"item"],[45,41,34,39],[45,42,34,40],[46,8,35,6],[47,6,36,4],[47,7,36,5],[47,8,36,6],[49,6,38,4],[50,6,39,4],[50,10,39,8,"filteredEnvelopeItems"],[50,31,39,29],[50,32,39,30,"length"],[50,38,39,36],[50,43,39,41],[50,44,39,42],[50,46,39,44],[51,8,40,6],[51,15,40,13,"Promise"],[51,22,40,20],[51,23,40,21,"resolve"],[51,30,40,28],[51,31,40,29],[51,32,40,30],[51,33,40,31],[51,34,40,32],[52,6,41,4],[53,6,43,4],[53,10,43,10,"filteredEnvelope"],[53,26,43,26],[53,29,43,29],[53,33,43,29,"createEnvelope"],[53,49,43,43],[53,50,43,43,"createEnvelope"],[53,64,43,43],[53,66,43,44,"envelope"],[53,74,43,52],[53,75,43,53],[53,76,43,54],[53,77,43,55],[53,79,43,57,"filteredEnvelopeItems"],[53,100,43,79],[53,101,43,80],[55,6,45,4],[56,6,46,4],[56,10,46,10,"recordEnvelopeLoss"],[56,28,46,28],[56,31,46,32,"reason"],[56,37,46,38],[56,41,46,43],[57,8,47,6],[57,12,47,6,"forEachEnvelopeItem"],[57,28,47,25],[57,29,47,25,"forEachEnvelopeItem"],[57,48,47,25],[57,50,47,26,"filteredEnvelope"],[57,66,47,42],[57,68,47,44],[57,69,47,45,"item"],[57,73,47,49],[57,75,47,51,"type"],[57,79,47,55],[57,84,47,60],[58,10,48,8,"options"],[58,17,48,15],[58,18,48,16,"recordDroppedEvent"],[58,36,48,34],[58,37,48,35,"reason"],[58,43,48,41],[58,45,48,43],[58,49,48,43,"envelopeItemTypeToDataCategory"],[58,65,48,73],[58,66,48,73,"envelopeItemTypeToDataCategory"],[58,96,48,73],[58,98,48,74,"type"],[58,102,48,78],[58,103,48,79],[58,104,48,80],[59,8,49,6],[59,9,49,7],[59,10,49,8],[60,6,50,4],[60,7,50,5],[61,6,52,4],[61,10,52,10,"requestTask"],[61,21,52,21],[61,24,52,24,"requestTask"],[61,25,52,24],[61,30,53,6,"makeRequest"],[61,41,53,17],[61,42,53,18],[62,8,53,20,"body"],[62,12,53,24],[62,14,53,26],[62,18,53,26,"serializeEnvelope"],[62,34,53,43],[62,35,53,43,"serializeEnvelope"],[62,52,53,43],[62,54,53,44,"filteredEnvelope"],[62,70,53,60],[63,6,53,62],[63,7,53,63],[63,8,53,64],[63,9,53,65,"then"],[63,13,53,69],[63,14,54,8,"response"],[63,22,54,16],[63,26,54,20],[64,8,55,10],[65,8,56,10],[65,12,56,14,"response"],[65,20,56,22],[65,21,56,23,"statusCode"],[65,31,56,33],[65,36,56,38,"undefined"],[65,45,56,47],[65,50,56,52,"response"],[65,58,56,60],[65,59,56,61,"statusCode"],[65,69,56,71],[65,72,56,74],[65,75,56,77],[65,79,56,81,"response"],[65,87,56,89],[65,88,56,90,"statusCode"],[65,98,56,100],[65,102,56,104],[65,105,56,107],[65,106,56,108],[65,108,56,110],[66,10,57,12,"DEBUG_BUILD"],[66,23,57,23],[66,24,57,23,"DEBUG_BUILD"],[66,35,57,23],[66,39,57,27,"debug"],[66,58,57,32],[66,59,57,32,"debug"],[66,64,57,32],[66,65,57,33,"warn"],[66,69,57,37],[66,70,57,38],[66,107,57,75,"response"],[66,115,57,83],[66,116,57,84,"statusCode"],[66,126,57,94],[66,143,57,111],[66,144,57,112],[67,8,58,10],[68,8,60,10,"rateLimits"],[68,18,60,20],[68,21,60,23],[68,25,60,23,"updateRateLimits"],[68,42,60,39],[68,43,60,39,"updateRateLimits"],[68,59,60,39],[68,61,60,40,"rateLimits"],[68,71,60,50],[68,73,60,52,"response"],[68,81,60,60],[68,82,60,61],[69,8,61,10],[69,15,61,17,"response"],[69,23,61,25],[70,6,62,8],[70,7,62,9],[70,9,63,8,"error"],[70,14,63,13],[70,18,63,17],[71,8,64,10,"recordEnvelopeLoss"],[71,26,64,28],[71,27,64,29],[71,42,64,44],[71,43,64,45],[72,8,65,10,"DEBUG_BUILD"],[72,21,65,21],[72,22,65,21,"DEBUG_BUILD"],[72,33,65,21],[72,37,65,25,"debug"],[72,56,65,30],[72,57,65,30,"debug"],[72,62,65,30],[72,63,65,31,"error"],[72,68,65,36],[72,69,65,37],[72,115,65,83],[72,117,65,85,"error"],[72,122,65,90],[72,123,65,91],[73,8,66,10],[73,14,66,16,"error"],[73,19,66,21],[74,6,67,8],[74,7,68,6],[74,8,68,7],[75,6,70,4],[75,13,70,11,"buffer"],[75,19,70,17],[75,20,70,18,"add"],[75,23,70,21],[75,24,70,22,"requestTask"],[75,35,70,33],[75,36,70,34],[75,37,70,35,"then"],[75,41,70,39],[75,42,71,6,"result"],[75,48,71,12],[75,52,71,16,"result"],[75,58,71,22],[75,60,72,6,"error"],[75,65,72,11],[75,69,72,15],[76,8,73,8],[76,12,73,12,"error"],[76,17,73,17],[76,22,73,22,"SENTRY_BUFFER_FULL_ERROR"],[76,43,73,46],[76,44,73,46,"SENTRY_BUFFER_FULL_ERROR"],[76,68,73,46],[76,70,73,48],[77,10,74,10,"DEBUG_BUILD"],[77,23,74,21],[77,24,74,21,"DEBUG_BUILD"],[77,35,74,21],[77,39,74,25,"debug"],[77,58,74,30],[77,59,74,30,"debug"],[77,64,74,30],[77,65,74,31,"error"],[77,70,74,36],[77,71,74,37],[77,118,74,84],[77,119,74,85],[78,10,75,10,"recordEnvelopeLoss"],[78,28,75,28],[78,29,75,29],[78,45,75,45],[78,46,75,46],[79,10,76,10],[79,17,76,17,"Promise"],[79,24,76,24],[79,25,76,25,"resolve"],[79,32,76,32],[79,33,76,33],[79,34,76,34],[79,35,76,35],[79,36,76,36],[80,8,77,8],[80,9,77,9],[80,15,77,15],[81,10,78,10],[81,16,78,16,"error"],[81,21,78,21],[82,8,79,8],[83,6,80,6],[83,7,81,4],[83,8,81,5],[84,4,82,2],[85,4,84,2],[85,11,84,9],[86,6,85,4,"send"],[86,10,85,8],[87,6,86,4,"flush"],[88,4,87,2],[88,5,87,3],[89,2,88,0],[90,0,88,1],[90,3]],"functionMap":{"names":["<global>","createTransport","flush","send","forEachEnvelopeItem$argument_1","recordEnvelopeLoss","requestTask","makeRequest.then$argument_0","makeRequest.then$argument_1","buffer.add.then$argument_0","buffer.add.then$argument_1"],"mappings":"AAA;ACc;gBCQ,kCD;EEE;kCCI;KDO;+BEU;4CDC;OCE;KFC;wBGE;QCE;SDQ;QEC;SFI;OHC;MMG,gBN;MOC;OPQ;GFE;CDM"},"hasCjsExports":false},"type":"js/module"}]}