{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":57,"index":57}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@/utils/dateCreditsHelpers","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":58},"end":{"line":5,"column":36,"index":156}}],"key":"oRWBdvQUhGiyZ/vbJNT/hHj85Fs=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.useDateCreditsData = useDateCreditsData;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _utilsDateCreditsHelpers = require(_dependencyMap[1], \"@/utils/dateCreditsHelpers\");\n  function useDateCreditsData(jwt) {\n    const [userId, setUserId] = (0, _react.useState)(null);\n    const [loading, setLoading] = (0, _react.useState)(true);\n    const [credits, setCredits] = (0, _react.useState)(0);\n    const [maxCredits, setMaxCredits] = (0, _react.useState)(3);\n    const [balanceCents, setBalanceCents] = (0, _react.useState)(0);\n    const loadUser = (0, _react.useCallback)(async () => {\n      try {\n        const u = await (0, _utilsDateCreditsHelpers.safeReadUserFromStorage)();\n        const id = Number(u?.id);\n        return Number.isFinite(id) ? id : null;\n      } catch (e) {\n        console.error(e);\n        return null;\n      }\n    }, []);\n    const refresh = (0, _react.useCallback)(async uid => {\n      // IMPORTANT:\n      // Prefer an explicit legacy userId when we have one.\n      // This prevents stale credit displays when token parsing fails in some RN runtimes.\n      const idNum = Number(uid);\n      const hasUid = Number.isFinite(idNum);\n      const hasJwt = jwt && typeof jwt === \"string\";\n      if (!hasUid && !hasJwt) return null;\n      const url = hasUid ? `/api/date-credits/status?userId=${idNum}` : `/api/date-credits/status`;\n      const resp = await fetch(url, {\n        headers: hasJwt ? {\n          Authorization: `Bearer ${jwt}`\n        } : undefined\n      });\n      if (!resp.ok) {\n        throw new Error(`When fetching /api/date-credits/status, the response was [${resp.status}] ${resp.statusText}`);\n      }\n      const data = await resp.json();\n\n      // NEW: if backend resolved a different legacy user id, adopt it so\n      // everything (messages, matches, credits) stays consistent.\n      const resolvedUserId = Number(data?.userId);\n      if (Number.isFinite(resolvedUserId) && resolvedUserId !== Number(uid)) {\n        setUserId(resolvedUserId);\n        const existing = (await (0, _utilsDateCreditsHelpers.safeReadUserFromStorage)()) || {};\n        await (0, _utilsDateCreditsHelpers.safeWriteUserToStorage)({\n          ...existing,\n          id: resolvedUserId\n        });\n      }\n      const nextCredits = Number(data?.credits || 0);\n      const nextMaxCredits = Number(data?.maxCredits || 3);\n      const nextBalanceCents = Number(data?.balanceCents || 0);\n      setCredits(nextCredits);\n      setMaxCredits(nextMaxCredits);\n      setBalanceCents(nextBalanceCents);\n\n      // NEW: return values so callers (like purchase polling) can act on fresh numbers\n      return {\n        credits: nextCredits,\n        maxCredits: nextMaxCredits,\n        balanceCents: nextBalanceCents\n      };\n    }, [jwt]);\n    (0, _react.useEffect)(() => {\n      let alive = true;\n      (async () => {\n        try {\n          const uid = await loadUser();\n          if (!alive) return;\n          setUserId(uid);\n          // Even if uid is missing/stale, refresh() can resolve via jwt.\n          await refresh(uid);\n        } catch (e) {\n          console.error(e);\n        } finally {\n          if (alive) setLoading(false);\n        }\n      })();\n      return () => {\n        alive = false;\n      };\n    }, [loadUser, refresh]);\n    return {\n      userId,\n      setUserId,\n      loading,\n      credits,\n      setCredits,\n      maxCredits,\n      setMaxCredits,\n      balanceCents,\n      setBalanceCents,\n      loadUser,\n      refresh\n    };\n  }\n});","lineCount":103,"map":[[7,2,7,0,"exports"],[7,9,7,0],[7,10,7,0,"useDateCreditsData"],[7,28,7,0],[7,31,7,0,"useDateCreditsData"],[7,49,7,0],[8,2,1,0],[8,6,1,0,"_react"],[8,12,1,0],[8,15,1,0,"require"],[8,22,1,0],[8,23,1,0,"_dependencyMap"],[8,37,1,0],[9,2,2,0],[9,6,2,0,"_utilsDateCreditsHelpers"],[9,30,2,0],[9,33,2,0,"require"],[9,40,2,0],[9,41,2,0,"_dependencyMap"],[9,55,2,0],[10,2,7,7],[10,11,7,16,"useDateCreditsData"],[10,29,7,34,"useDateCreditsData"],[10,30,7,35,"jwt"],[10,33,7,38],[10,35,7,40],[11,4,8,2],[11,10,8,8],[11,11,8,9,"userId"],[11,17,8,15],[11,19,8,17,"setUserId"],[11,28,8,26],[11,29,8,27],[11,32,8,30],[11,36,8,30,"useState"],[11,42,8,38],[11,43,8,38,"useState"],[11,51,8,38],[11,53,8,39],[11,57,8,43],[11,58,8,44],[12,4,9,2],[12,10,9,8],[12,11,9,9,"loading"],[12,18,9,16],[12,20,9,18,"setLoading"],[12,30,9,28],[12,31,9,29],[12,34,9,32],[12,38,9,32,"useState"],[12,44,9,40],[12,45,9,40,"useState"],[12,53,9,40],[12,55,9,41],[12,59,9,45],[12,60,9,46],[13,4,10,2],[13,10,10,8],[13,11,10,9,"credits"],[13,18,10,16],[13,20,10,18,"setCredits"],[13,30,10,28],[13,31,10,29],[13,34,10,32],[13,38,10,32,"useState"],[13,44,10,40],[13,45,10,40,"useState"],[13,53,10,40],[13,55,10,41],[13,56,10,42],[13,57,10,43],[14,4,11,2],[14,10,11,8],[14,11,11,9,"maxCredits"],[14,21,11,19],[14,23,11,21,"setMaxCredits"],[14,36,11,34],[14,37,11,35],[14,40,11,38],[14,44,11,38,"useState"],[14,50,11,46],[14,51,11,46,"useState"],[14,59,11,46],[14,61,11,47],[14,62,11,48],[14,63,11,49],[15,4,12,2],[15,10,12,8],[15,11,12,9,"balanceCents"],[15,23,12,21],[15,25,12,23,"setBalanceCents"],[15,40,12,38],[15,41,12,39],[15,44,12,42],[15,48,12,42,"useState"],[15,54,12,50],[15,55,12,50,"useState"],[15,63,12,50],[15,65,12,51],[15,66,12,52],[15,67,12,53],[16,4,14,2],[16,10,14,8,"loadUser"],[16,18,14,16],[16,21,14,19],[16,25,14,19,"useCallback"],[16,31,14,30],[16,32,14,30,"useCallback"],[16,43,14,30],[16,45,14,31],[16,57,14,43],[17,6,15,4],[17,10,15,8],[18,8,16,6],[18,14,16,12,"u"],[18,15,16,13],[18,18,16,16],[18,24,16,22],[18,28,16,22,"safeReadUserFromStorage"],[18,52,16,45],[18,53,16,45,"safeReadUserFromStorage"],[18,76,16,45],[18,78,16,46],[18,79,16,47],[19,8,17,6],[19,14,17,12,"id"],[19,16,17,14],[19,19,17,17,"Number"],[19,25,17,23],[19,26,17,24,"u"],[19,27,17,25],[19,29,17,27,"id"],[19,31,17,29],[19,32,17,30],[20,8,18,6],[20,15,18,13,"Number"],[20,21,18,19],[20,22,18,20,"isFinite"],[20,30,18,28],[20,31,18,29,"id"],[20,33,18,31],[20,34,18,32],[20,37,18,35,"id"],[20,39,18,37],[20,42,18,40],[20,46,18,44],[21,6,19,4],[21,7,19,5],[21,8,19,6],[21,15,19,13,"e"],[21,16,19,14],[21,18,19,16],[22,8,20,6,"console"],[22,15,20,13],[22,16,20,14,"error"],[22,21,20,19],[22,22,20,20,"e"],[22,23,20,21],[22,24,20,22],[23,8,21,6],[23,15,21,13],[23,19,21,17],[24,6,22,4],[25,4,23,2],[25,5,23,3],[25,7,23,5],[25,9,23,7],[25,10,23,8],[26,4,25,2],[26,10,25,8,"refresh"],[26,17,25,15],[26,20,25,18],[26,24,25,18,"useCallback"],[26,30,25,29],[26,31,25,29,"useCallback"],[26,42,25,29],[26,44,26,4],[26,50,26,11,"uid"],[26,53,26,14],[26,57,26,19],[27,6,27,6],[28,6,28,6],[29,6,29,6],[30,6,30,6],[30,12,30,12,"idNum"],[30,17,30,17],[30,20,30,20,"Number"],[30,26,30,26],[30,27,30,27,"uid"],[30,30,30,30],[30,31,30,31],[31,6,31,6],[31,12,31,12,"hasUid"],[31,18,31,18],[31,21,31,21,"Number"],[31,27,31,27],[31,28,31,28,"isFinite"],[31,36,31,36],[31,37,31,37,"idNum"],[31,42,31,42],[31,43,31,43],[32,6,33,6],[32,12,33,12,"hasJwt"],[32,18,33,18],[32,21,33,21,"jwt"],[32,24,33,24],[32,28,33,28],[32,35,33,35,"jwt"],[32,38,33,38],[32,43,33,43],[32,51,33,51],[33,6,34,6],[33,10,34,10],[33,11,34,11,"hasUid"],[33,17,34,17],[33,21,34,21],[33,22,34,22,"hasJwt"],[33,28,34,28],[33,30,34,30],[33,37,34,37],[33,41,34,41],[34,6,36,6],[34,12,36,12,"url"],[34,15,36,15],[34,18,36,18,"hasUid"],[34,24,36,24],[34,27,37,10],[34,62,37,45,"idNum"],[34,67,37,50],[34,69,37,52],[34,72,38,10],[34,98,38,36],[35,6,40,6],[35,12,40,12,"resp"],[35,16,40,16],[35,19,40,19],[35,25,40,25,"fetch"],[35,30,40,30],[35,31,40,31,"url"],[35,34,40,34],[35,36,40,36],[36,8,41,8,"headers"],[36,15,41,15],[36,17,41,17,"hasJwt"],[36,23,41,23],[36,26,41,26],[37,10,41,28,"Authorization"],[37,23,41,41],[37,25,41,43],[37,35,41,53,"jwt"],[37,38,41,56],[38,8,41,59],[38,9,41,60],[38,12,41,63,"undefined"],[39,6,42,6],[39,7,42,7],[39,8,42,8],[40,6,43,6],[40,10,43,10],[40,11,43,11,"resp"],[40,15,43,15],[40,16,43,16,"ok"],[40,18,43,18],[40,20,43,20],[41,8,44,8],[41,14,44,14],[41,18,44,18,"Error"],[41,23,44,23],[41,24,45,10],[41,85,45,71,"resp"],[41,89,45,75],[41,90,45,76,"status"],[41,96,45,82],[41,101,45,87,"resp"],[41,105,45,91],[41,106,45,92,"statusText"],[41,116,45,102],[41,118,46,8],[41,119,46,9],[42,6,47,6],[43,6,48,6],[43,12,48,12,"data"],[43,16,48,16],[43,19,48,19],[43,25,48,25,"resp"],[43,29,48,29],[43,30,48,30,"json"],[43,34,48,34],[43,35,48,35],[43,36,48,36],[45,6,50,6],[46,6,51,6],[47,6,52,6],[47,12,52,12,"resolvedUserId"],[47,26,52,26],[47,29,52,29,"Number"],[47,35,52,35],[47,36,52,36,"data"],[47,40,52,40],[47,42,52,42,"userId"],[47,48,52,48],[47,49,52,49],[48,6,53,6],[48,10,53,10,"Number"],[48,16,53,16],[48,17,53,17,"isFinite"],[48,25,53,25],[48,26,53,26,"resolvedUserId"],[48,40,53,40],[48,41,53,41],[48,45,53,45,"resolvedUserId"],[48,59,53,59],[48,64,53,64,"Number"],[48,70,53,70],[48,71,53,71,"uid"],[48,74,53,74],[48,75,53,75],[48,77,53,77],[49,8,54,8,"setUserId"],[49,17,54,17],[49,18,54,18,"resolvedUserId"],[49,32,54,32],[49,33,54,33],[50,8,55,8],[50,14,55,14,"existing"],[50,22,55,22],[50,25,55,25],[50,26,55,26],[50,32,55,32],[50,36,55,32,"safeReadUserFromStorage"],[50,60,55,55],[50,61,55,55,"safeReadUserFromStorage"],[50,84,55,55],[50,86,55,56],[50,87,55,57],[50,92,55,62],[50,93,55,63],[50,94,55,64],[51,8,56,8],[51,14,56,14],[51,18,56,14,"safeWriteUserToStorage"],[51,42,56,36],[51,43,56,36,"safeWriteUserToStorage"],[51,65,56,36],[51,67,56,37],[52,10,56,39],[52,13,56,42,"existing"],[52,21,56,50],[53,10,56,52,"id"],[53,12,56,54],[53,14,56,56,"resolvedUserId"],[54,8,56,71],[54,9,56,72],[54,10,56,73],[55,6,57,6],[56,6,59,6],[56,12,59,12,"nextCredits"],[56,23,59,23],[56,26,59,26,"Number"],[56,32,59,32],[56,33,59,33,"data"],[56,37,59,37],[56,39,59,39,"credits"],[56,46,59,46],[56,50,59,50],[56,51,59,51],[56,52,59,52],[57,6,60,6],[57,12,60,12,"nextMaxCredits"],[57,26,60,26],[57,29,60,29,"Number"],[57,35,60,35],[57,36,60,36,"data"],[57,40,60,40],[57,42,60,42,"maxCredits"],[57,52,60,52],[57,56,60,56],[57,57,60,57],[57,58,60,58],[58,6,61,6],[58,12,61,12,"nextBalanceCents"],[58,28,61,28],[58,31,61,31,"Number"],[58,37,61,37],[58,38,61,38,"data"],[58,42,61,42],[58,44,61,44,"balanceCents"],[58,56,61,56],[58,60,61,60],[58,61,61,61],[58,62,61,62],[59,6,63,6,"setCredits"],[59,16,63,16],[59,17,63,17,"nextCredits"],[59,28,63,28],[59,29,63,29],[60,6,64,6,"setMaxCredits"],[60,19,64,19],[60,20,64,20,"nextMaxCredits"],[60,34,64,34],[60,35,64,35],[61,6,65,6,"setBalanceCents"],[61,21,65,21],[61,22,65,22,"nextBalanceCents"],[61,38,65,38],[61,39,65,39],[63,6,67,6],[64,6,68,6],[64,13,68,13],[65,8,69,8,"credits"],[65,15,69,15],[65,17,69,17,"nextCredits"],[65,28,69,28],[66,8,70,8,"maxCredits"],[66,18,70,18],[66,20,70,20,"nextMaxCredits"],[66,34,70,34],[67,8,71,8,"balanceCents"],[67,20,71,20],[67,22,71,22,"nextBalanceCents"],[68,6,72,6],[68,7,72,7],[69,4,73,4],[69,5,73,5],[69,7,74,4],[69,8,74,5,"jwt"],[69,11,74,8],[69,12,75,2],[69,13,75,3],[70,4,77,2],[70,8,77,2,"useEffect"],[70,14,77,11],[70,15,77,11,"useEffect"],[70,24,77,11],[70,26,77,12],[70,32,77,18],[71,6,78,4],[71,10,78,8,"alive"],[71,15,78,13],[71,18,78,16],[71,22,78,20],[72,6,80,4],[72,7,80,5],[72,19,80,17],[73,8,81,6],[73,12,81,10],[74,10,82,8],[74,16,82,14,"uid"],[74,19,82,17],[74,22,82,20],[74,28,82,26,"loadUser"],[74,36,82,34],[74,37,82,35],[74,38,82,36],[75,10,83,8],[75,14,83,12],[75,15,83,13,"alive"],[75,20,83,18],[75,22,83,20],[76,10,84,8,"setUserId"],[76,19,84,17],[76,20,84,18,"uid"],[76,23,84,21],[76,24,84,22],[77,10,85,8],[78,10,86,8],[78,16,86,14,"refresh"],[78,23,86,21],[78,24,86,22,"uid"],[78,27,86,25],[78,28,86,26],[79,8,87,6],[79,9,87,7],[79,10,87,8],[79,17,87,15,"e"],[79,18,87,16],[79,20,87,18],[80,10,88,8,"console"],[80,17,88,15],[80,18,88,16,"error"],[80,23,88,21],[80,24,88,22,"e"],[80,25,88,23],[80,26,88,24],[81,8,89,6],[81,9,89,7],[81,18,89,16],[82,10,90,8],[82,14,90,12,"alive"],[82,19,90,17],[82,21,90,19,"setLoading"],[82,31,90,29],[82,32,90,30],[82,37,90,35],[82,38,90,36],[83,8,91,6],[84,6,92,4],[84,7,92,5],[84,9,92,7],[84,10,92,8],[85,6,94,4],[85,13,94,11],[85,19,94,17],[86,8,95,6,"alive"],[86,13,95,11],[86,16,95,14],[86,21,95,19],[87,6,96,4],[87,7,96,5],[88,4,97,2],[88,5,97,3],[88,7,97,5],[88,8,97,6,"loadUser"],[88,16,97,14],[88,18,97,16,"refresh"],[88,25,97,23],[88,26,97,24],[88,27,97,25],[89,4,99,2],[89,11,99,9],[90,6,100,4,"userId"],[90,12,100,10],[91,6,101,4,"setUserId"],[91,15,101,13],[92,6,102,4,"loading"],[92,13,102,11],[93,6,103,4,"credits"],[93,13,103,11],[94,6,104,4,"setCredits"],[94,16,104,14],[95,6,105,4,"maxCredits"],[95,16,105,14],[96,6,106,4,"setMaxCredits"],[96,19,106,17],[97,6,107,4,"balanceCents"],[97,18,107,16],[98,6,108,4,"setBalanceCents"],[98,21,108,19],[99,6,109,4,"loadUser"],[99,14,109,12],[100,6,110,4,"refresh"],[101,4,111,2],[101,5,111,3],[102,2,112,0],[103,0,112,1],[103,3]],"functionMap":{"names":["<global>","useDateCreditsData","loadUser","refresh","useEffect$argument_0","<anonymous>"],"mappings":"AAA;OCM;+BCO;GDS;IEG;KF+C;YGI;KCG;KDY;WCE;KDE;GHC;CDe"},"hasCjsExports":false},"type":"js/module"}]}