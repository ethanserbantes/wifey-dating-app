{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":55,"index":55}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@react-navigation/native","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":56},"end":{"line":2,"column":56,"index":112}}],"key":"yKhyWCfwa1gXEwEbMKnWHykYbZ4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.usePresencePing = usePresencePing;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _reactNavigationNative = require(_dependencyMap[1], \"@react-navigation/native\");\n  function usePresencePing(userId, options) {\n    _s();\n    const isFocused = (0, _reactNavigationNative.useIsFocused)();\n    const intervalMs = Number(options?.intervalMs) || 30_000;\n    const enabled = options?.enabled !== false;\n    const busyRef = (0, _react.useRef)(false);\n    const pingOnce = (0, _react.useCallback)(async () => {\n      if (!enabled) return;\n      const uid = Number(userId);\n      if (!Number.isFinite(uid)) return;\n      if (busyRef.current) return;\n      busyRef.current = true;\n      try {\n        const resp = await fetch(\"/api/presence/ping\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify({\n            userId: uid,\n            platform: \"mobile\"\n          })\n        });\n        if (!resp.ok) {\n          const text = await resp.text().catch(() => \"\");\n          throw new Error(`When posting /api/presence/ping, the response was [${resp.status}] ${resp.statusText}. ${text}`);\n        }\n      } catch (e) {\n        // Presence is best-effort â€” never block UI.\n        console.error(\"[presence] ping failed\", e);\n      } finally {\n        busyRef.current = false;\n      }\n    }, [enabled, userId]);\n    (0, _react.useEffect)(() => {\n      if (!enabled) return;\n      if (!isFocused) return;\n      let alive = true;\n      const start = async () => {\n        if (!alive) return;\n        await pingOnce();\n      };\n      start();\n      const interval = setInterval(() => {\n        pingOnce();\n      }, intervalMs);\n      return () => {\n        alive = false;\n        clearInterval(interval);\n      };\n    }, [enabled, intervalMs, isFocused, pingOnce]);\n  }\n  _s(usePresencePing, \"+VkUsZwT8M9hzMDvScpciVxQ5Z0=\", false, function () {\n    return [_reactNavigationNative.useIsFocused];\n  });\n});","lineCount":66,"map":[[8,2,4,0,"exports"],[8,9,4,0],[8,10,4,0,"usePresencePing"],[8,25,4,0],[8,28,4,0,"usePresencePing"],[8,43,4,0],[9,2,1,0],[9,6,1,0,"_react"],[9,12,1,0],[9,15,1,0,"require"],[9,22,1,0],[9,23,1,0,"_dependencyMap"],[9,37,1,0],[10,2,2,0],[10,6,2,0,"_reactNavigationNative"],[10,28,2,0],[10,31,2,0,"require"],[10,38,2,0],[10,39,2,0,"_dependencyMap"],[10,53,2,0],[11,2,4,7],[11,11,4,16,"usePresencePing"],[11,26,4,31,"usePresencePing"],[11,27,4,32,"userId"],[11,33,4,38],[11,35,4,40,"options"],[11,42,4,47],[11,44,4,49],[12,4,4,49,"_s"],[12,6,4,49],[13,4,5,2],[13,10,5,8,"isFocused"],[13,19,5,17],[13,22,5,20],[13,26,5,20,"useIsFocused"],[13,48,5,32],[13,49,5,32,"useIsFocused"],[13,61,5,32],[13,63,5,33],[13,64,5,34],[14,4,6,2],[14,10,6,8,"intervalMs"],[14,20,6,18],[14,23,6,21,"Number"],[14,29,6,27],[14,30,6,28,"options"],[14,37,6,35],[14,39,6,37,"intervalMs"],[14,49,6,47],[14,50,6,48],[14,54,6,52],[14,60,6,58],[15,4,7,2],[15,10,7,8,"enabled"],[15,17,7,15],[15,20,7,18,"options"],[15,27,7,25],[15,29,7,27,"enabled"],[15,36,7,34],[15,41,7,39],[15,46,7,44],[16,4,9,2],[16,10,9,8,"busyRef"],[16,17,9,15],[16,20,9,18],[16,24,9,18,"useRef"],[16,30,9,24],[16,31,9,24,"useRef"],[16,37,9,24],[16,39,9,25],[16,44,9,30],[16,45,9,31],[17,4,11,2],[17,10,11,8,"pingOnce"],[17,18,11,16],[17,21,11,19],[17,25,11,19,"useCallback"],[17,31,11,30],[17,32,11,30,"useCallback"],[17,43,11,30],[17,45,11,31],[17,57,11,43],[18,6,12,4],[18,10,12,8],[18,11,12,9,"enabled"],[18,18,12,16],[18,20,12,18],[19,6,13,4],[19,12,13,10,"uid"],[19,15,13,13],[19,18,13,16,"Number"],[19,24,13,22],[19,25,13,23,"userId"],[19,31,13,29],[19,32,13,30],[20,6,14,4],[20,10,14,8],[20,11,14,9,"Number"],[20,17,14,15],[20,18,14,16,"isFinite"],[20,26,14,24],[20,27,14,25,"uid"],[20,30,14,28],[20,31,14,29],[20,33,14,31],[21,6,15,4],[21,10,15,8,"busyRef"],[21,17,15,15],[21,18,15,16,"current"],[21,25,15,23],[21,27,15,25],[22,6,17,4,"busyRef"],[22,13,17,11],[22,14,17,12,"current"],[22,21,17,19],[22,24,17,22],[22,28,17,26],[23,6,18,4],[23,10,18,8],[24,8,19,6],[24,14,19,12,"resp"],[24,18,19,16],[24,21,19,19],[24,27,19,25,"fetch"],[24,32,19,30],[24,33,19,31],[24,53,19,51],[24,55,19,53],[25,10,20,8,"method"],[25,16,20,14],[25,18,20,16],[25,24,20,22],[26,10,21,8,"headers"],[26,17,21,15],[26,19,21,17],[27,12,21,19],[27,26,21,33],[27,28,21,35],[28,10,21,54],[28,11,21,55],[29,10,22,8,"body"],[29,14,22,12],[29,16,22,14,"JSON"],[29,20,22,18],[29,21,22,19,"stringify"],[29,30,22,28],[29,31,22,29],[30,12,22,31,"userId"],[30,18,22,37],[30,20,22,39,"uid"],[30,23,22,42],[31,12,22,44,"platform"],[31,20,22,52],[31,22,22,54],[32,10,22,63],[32,11,22,64],[33,8,23,6],[33,9,23,7],[33,10,23,8],[34,8,25,6],[34,12,25,10],[34,13,25,11,"resp"],[34,17,25,15],[34,18,25,16,"ok"],[34,20,25,18],[34,22,25,20],[35,10,26,8],[35,16,26,14,"text"],[35,20,26,18],[35,23,26,21],[35,29,26,27,"resp"],[35,33,26,31],[35,34,26,32,"text"],[35,38,26,36],[35,39,26,37],[35,40,26,38],[35,41,26,39,"catch"],[35,46,26,44],[35,47,26,45],[35,53,26,51],[35,55,26,53],[35,56,26,54],[36,10,27,8],[36,16,27,14],[36,20,27,18,"Error"],[36,25,27,23],[36,26,28,10],[36,80,28,64,"resp"],[36,84,28,68],[36,85,28,69,"status"],[36,91,28,75],[36,96,28,80,"resp"],[36,100,28,84],[36,101,28,85,"statusText"],[36,111,28,95],[36,116,28,100,"text"],[36,120,28,104],[36,122,29,8],[36,123,29,9],[37,8,30,6],[38,6,31,4],[38,7,31,5],[38,8,31,6],[38,15,31,13,"e"],[38,16,31,14],[38,18,31,16],[39,8,32,6],[40,8,33,6,"console"],[40,15,33,13],[40,16,33,14,"error"],[40,21,33,19],[40,22,33,20],[40,46,33,44],[40,48,33,46,"e"],[40,49,33,47],[40,50,33,48],[41,6,34,4],[41,7,34,5],[41,16,34,14],[42,8,35,6,"busyRef"],[42,15,35,13],[42,16,35,14,"current"],[42,23,35,21],[42,26,35,24],[42,31,35,29],[43,6,36,4],[44,4,37,2],[44,5,37,3],[44,7,37,5],[44,8,37,6,"enabled"],[44,15,37,13],[44,17,37,15,"userId"],[44,23,37,21],[44,24,37,22],[44,25,37,23],[45,4,39,2],[45,8,39,2,"useEffect"],[45,14,39,11],[45,15,39,11,"useEffect"],[45,24,39,11],[45,26,39,12],[45,32,39,18],[46,6,40,4],[46,10,40,8],[46,11,40,9,"enabled"],[46,18,40,16],[46,20,40,18],[47,6,41,4],[47,10,41,8],[47,11,41,9,"isFocused"],[47,20,41,18],[47,22,41,20],[48,6,43,4],[48,10,43,8,"alive"],[48,15,43,13],[48,18,43,16],[48,22,43,20],[49,6,45,4],[49,12,45,10,"start"],[49,17,45,15],[49,20,45,18],[49,26,45,18,"start"],[49,27,45,18],[49,32,45,30],[50,8,46,6],[50,12,46,10],[50,13,46,11,"alive"],[50,18,46,16],[50,20,46,18],[51,8,47,6],[51,14,47,12,"pingOnce"],[51,22,47,20],[51,23,47,21],[51,24,47,22],[52,6,48,4],[52,7,48,5],[53,6,50,4,"start"],[53,11,50,9],[53,12,50,10],[53,13,50,11],[54,6,51,4],[54,12,51,10,"interval"],[54,20,51,18],[54,23,51,21,"setInterval"],[54,34,51,32],[54,35,51,33],[54,41,51,39],[55,8,52,6,"pingOnce"],[55,16,52,14],[55,17,52,15],[55,18,52,16],[56,6,53,4],[56,7,53,5],[56,9,53,7,"intervalMs"],[56,19,53,17],[56,20,53,18],[57,6,55,4],[57,13,55,11],[57,19,55,17],[58,8,56,6,"alive"],[58,13,56,11],[58,16,56,14],[58,21,56,19],[59,8,57,6,"clearInterval"],[59,21,57,19],[59,22,57,20,"interval"],[59,30,57,28],[59,31,57,29],[60,6,58,4],[60,7,58,5],[61,4,59,2],[61,5,59,3],[61,7,59,5],[61,8,59,6,"enabled"],[61,15,59,13],[61,17,59,15,"intervalMs"],[61,27,59,25],[61,29,59,27,"isFocused"],[61,38,59,36],[61,40,59,38,"pingOnce"],[61,48,59,46],[61,49,59,47],[61,50,59,48],[62,2,60,0],[63,2,60,1,"_s"],[63,4,60,1],[63,5,4,16,"usePresencePing"],[63,20,4,31],[64,4,4,31],[64,12,5,20,"useIsFocused"],[64,34,5,32],[64,35,5,32,"useIsFocused"],[64,47,5,32],[65,2,5,32],[66,0,5,32],[66,3]],"functionMap":{"names":["<global>","usePresencePing","pingOnce","resp.text._catch$argument_0","useEffect$argument_0","start","setInterval$argument_0","<anonymous>"],"mappings":"AAA;OCG;+BCO;6CCe,QD;GDW;YGE;kBCM;KDG;iCEG;KFE;WGE;KHG;GHC;CDC"},"hasCjsExports":false},"type":"js/module"}]}