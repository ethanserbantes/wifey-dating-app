{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.moderatePhoto = moderatePhoto;\n  exports.isDecisionAllowed = isDecisionAllowed;\n  async function moderatePhoto({\n    userId,\n    imageUrl,\n    purpose\n  }) {\n    const url = typeof imageUrl === \"string\" ? imageUrl.trim() : \"\";\n    if (!url) {\n      return {\n        ok: false,\n        error: \"Missing image url\"\n      };\n    }\n    try {\n      const baseURL = process.env.EXPO_PUBLIC_BASE_URL || \"\";\n      const endpoint = baseURL ? `${baseURL}/api/moderation/photo` : \"/api/moderation/photo\";\n      const resp = await fetch(endpoint, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          userId: Number.isFinite(Number(userId)) ? Number(userId) : null,\n          imageUrl: url,\n          purpose: purpose ? String(purpose) : null\n        })\n      });\n      if (!resp.ok) {\n        let extra = \"\";\n        try {\n          const j = await resp.json();\n          if (j?.error) extra = String(j.error);\n        } catch {\n          // ignore\n        }\n        throw new Error(extra || `When calling /api/moderation/photo, the response was [${resp.status}] ${resp.statusText}`);\n      }\n      const json = await resp.json();\n      return {\n        ok: true,\n        decision: json?.decision || null,\n        safeSearch: json?.safeSearch || null,\n        moderationSkipped: !!json?.moderationSkipped\n      };\n    } catch (e) {\n      console.error(\"[MODERATION] moderatePhoto error\", e);\n      return {\n        ok: false,\n        error: e?.message || \"Moderation failed\"\n      };\n    }\n  }\n  function isDecisionAllowed(decision, moderationSkipped = false, purpose = null) {\n    // If the server had to skip moderation (Vision API disabled / misconfigured),\n    // don't block the user during signup/profile edits.\n    if (moderationSkipped) {\n      return true;\n    }\n    const d = String(decision || \"\").toLowerCase();\n    const p = String(purpose || \"\").toLowerCase();\n\n    // By default we only allow \"approve\".\n    // BUT: SafeSearch false positives happen a lot for normal selfies/swimsuit/fashion.\n    // For our two user-facing flows, we allow \"review\" (it still gets recorded server-side).\n    const allowReview = p === \"profile_photo\" || p === \"verification_photo\";\n    if (d === \"approve\") {\n      return true;\n    }\n    if (allowReview && d === \"review\") {\n      return true;\n    }\n    return false;\n  }\n});","lineCount":81,"map":[[7,2,1,0,"exports"],[7,9,1,0],[7,10,1,0,"moderatePhoto"],[7,23,1,0],[7,26,1,0,"moderatePhoto"],[7,39,1,0],[8,2,49,0,"exports"],[8,9,49,0],[8,10,49,0,"isDecisionAllowed"],[8,27,49,0],[8,30,49,0,"isDecisionAllowed"],[8,47,49,0],[9,2,1,7],[9,17,1,22,"moderatePhoto"],[9,30,1,35,"moderatePhoto"],[9,31,1,36],[10,4,1,38,"userId"],[10,10,1,44],[11,4,1,46,"imageUrl"],[11,12,1,54],[12,4,1,56,"purpose"],[13,2,1,64],[13,3,1,65],[13,5,1,67],[14,4,2,2],[14,10,2,8,"url"],[14,13,2,11],[14,16,2,14],[14,23,2,21,"imageUrl"],[14,31,2,29],[14,36,2,34],[14,44,2,42],[14,47,2,45,"imageUrl"],[14,55,2,53],[14,56,2,54,"trim"],[14,60,2,58],[14,61,2,59],[14,62,2,60],[14,65,2,63],[14,67,2,65],[15,4,3,2],[15,8,3,6],[15,9,3,7,"url"],[15,12,3,10],[15,14,3,12],[16,6,4,4],[16,13,4,11],[17,8,4,13,"ok"],[17,10,4,15],[17,12,4,17],[17,17,4,22],[18,8,4,24,"error"],[18,13,4,29],[18,15,4,31],[19,6,4,51],[19,7,4,52],[20,4,5,2],[21,4,7,2],[21,8,7,6],[22,6,8,4],[22,12,8,10,"baseURL"],[22,19,8,17],[22,22,8,20,"process"],[22,29,8,27],[22,30,8,28,"env"],[22,33,8,31],[22,34,8,32,"EXPO_PUBLIC_BASE_URL"],[22,54,8,52],[22,58,8,56],[22,60,8,58],[23,6,9,4],[23,12,9,10,"endpoint"],[23,20,9,18],[23,23,9,21,"baseURL"],[23,30,9,28],[23,33,9,31],[23,36,9,34,"baseURL"],[23,43,9,41],[23,66,9,64],[23,69,9,67],[23,92,9,90],[24,6,11,4],[24,12,11,10,"resp"],[24,16,11,14],[24,19,11,17],[24,25,11,23,"fetch"],[24,30,11,28],[24,31,11,29,"endpoint"],[24,39,11,37],[24,41,11,39],[25,8,12,6,"method"],[25,14,12,12],[25,16,12,14],[25,22,12,20],[26,8,13,6,"headers"],[26,15,13,13],[26,17,13,15],[27,10,13,17],[27,24,13,31],[27,26,13,33],[28,8,13,52],[28,9,13,53],[29,8,14,6,"body"],[29,12,14,10],[29,14,14,12,"JSON"],[29,18,14,16],[29,19,14,17,"stringify"],[29,28,14,26],[29,29,14,27],[30,10,15,8,"userId"],[30,16,15,14],[30,18,15,16,"Number"],[30,24,15,22],[30,25,15,23,"isFinite"],[30,33,15,31],[30,34,15,32,"Number"],[30,40,15,38],[30,41,15,39,"userId"],[30,47,15,45],[30,48,15,46],[30,49,15,47],[30,52,15,50,"Number"],[30,58,15,56],[30,59,15,57,"userId"],[30,65,15,63],[30,66,15,64],[30,69,15,67],[30,73,15,71],[31,10,16,8,"imageUrl"],[31,18,16,16],[31,20,16,18,"url"],[31,23,16,21],[32,10,17,8,"purpose"],[32,17,17,15],[32,19,17,17,"purpose"],[32,26,17,24],[32,29,17,27,"String"],[32,35,17,33],[32,36,17,34,"purpose"],[32,43,17,41],[32,44,17,42],[32,47,17,45],[33,8,18,6],[33,9,18,7],[34,6,19,4],[34,7,19,5],[34,8,19,6],[35,6,21,4],[35,10,21,8],[35,11,21,9,"resp"],[35,15,21,13],[35,16,21,14,"ok"],[35,18,21,16],[35,20,21,18],[36,8,22,6],[36,12,22,10,"extra"],[36,17,22,15],[36,20,22,18],[36,22,22,20],[37,8,23,6],[37,12,23,10],[38,10,24,8],[38,16,24,14,"j"],[38,17,24,15],[38,20,24,18],[38,26,24,24,"resp"],[38,30,24,28],[38,31,24,29,"json"],[38,35,24,33],[38,36,24,34],[38,37,24,35],[39,10,25,8],[39,14,25,12,"j"],[39,15,25,13],[39,17,25,15,"error"],[39,22,25,20],[39,24,25,22,"extra"],[39,29,25,27],[39,32,25,30,"String"],[39,38,25,36],[39,39,25,37,"j"],[39,40,25,38],[39,41,25,39,"error"],[39,46,25,44],[39,47,25,45],[40,8,26,6],[40,9,26,7],[40,10,26,8],[40,16,26,14],[41,10,27,8],[42,8,27,8],[43,8,30,6],[43,14,30,12],[43,18,30,16,"Error"],[43,23,30,21],[43,24,31,8,"extra"],[43,29,31,13],[43,33,32,10],[43,90,32,67,"resp"],[43,94,32,71],[43,95,32,72,"status"],[43,101,32,78],[43,106,32,83,"resp"],[43,110,32,87],[43,111,32,88,"statusText"],[43,121,32,98],[43,123,33,6],[43,124,33,7],[44,6,34,4],[45,6,36,4],[45,12,36,10,"json"],[45,16,36,14],[45,19,36,17],[45,25,36,23,"resp"],[45,29,36,27],[45,30,36,28,"json"],[45,34,36,32],[45,35,36,33],[45,36,36,34],[46,6,37,4],[46,13,37,11],[47,8,38,6,"ok"],[47,10,38,8],[47,12,38,10],[47,16,38,14],[48,8,39,6,"decision"],[48,16,39,14],[48,18,39,16,"json"],[48,22,39,20],[48,24,39,22,"decision"],[48,32,39,30],[48,36,39,34],[48,40,39,38],[49,8,40,6,"safeSearch"],[49,18,40,16],[49,20,40,18,"json"],[49,24,40,22],[49,26,40,24,"safeSearch"],[49,36,40,34],[49,40,40,38],[49,44,40,42],[50,8,41,6,"moderationSkipped"],[50,25,41,23],[50,27,41,25],[50,28,41,26],[50,29,41,27,"json"],[50,33,41,31],[50,35,41,33,"moderationSkipped"],[51,6,42,4],[51,7,42,5],[52,4,43,2],[52,5,43,3],[52,6,43,4],[52,13,43,11,"e"],[52,14,43,12],[52,16,43,14],[53,6,44,4,"console"],[53,13,44,11],[53,14,44,12,"error"],[53,19,44,17],[53,20,44,18],[53,54,44,52],[53,56,44,54,"e"],[53,57,44,55],[53,58,44,56],[54,6,45,4],[54,13,45,11],[55,8,45,13,"ok"],[55,10,45,15],[55,12,45,17],[55,17,45,22],[56,8,45,24,"error"],[56,13,45,29],[56,15,45,31,"e"],[56,16,45,32],[56,18,45,34,"message"],[56,25,45,41],[56,29,45,45],[57,6,45,65],[57,7,45,66],[58,4,46,2],[59,2,47,0],[60,2,49,7],[60,11,49,16,"isDecisionAllowed"],[60,28,49,33,"isDecisionAllowed"],[60,29,50,2,"decision"],[60,37,50,10],[60,39,51,2,"moderationSkipped"],[60,56,51,19],[60,59,51,22],[60,64,51,27],[60,66,52,2,"purpose"],[60,73,52,9],[60,76,52,12],[60,80,52,16],[60,82,53,2],[61,4,54,2],[62,4,55,2],[63,4,56,2],[63,8,56,6,"moderationSkipped"],[63,25,56,23],[63,27,56,25],[64,6,57,4],[64,13,57,11],[64,17,57,15],[65,4,58,2],[66,4,60,2],[66,10,60,8,"d"],[66,11,60,9],[66,14,60,12,"String"],[66,20,60,18],[66,21,60,19,"decision"],[66,29,60,27],[66,33,60,31],[66,35,60,33],[66,36,60,34],[66,37,60,35,"toLowerCase"],[66,48,60,46],[66,49,60,47],[66,50,60,48],[67,4,61,2],[67,10,61,8,"p"],[67,11,61,9],[67,14,61,12,"String"],[67,20,61,18],[67,21,61,19,"purpose"],[67,28,61,26],[67,32,61,30],[67,34,61,32],[67,35,61,33],[67,36,61,34,"toLowerCase"],[67,47,61,45],[67,48,61,46],[67,49,61,47],[69,4,63,2],[70,4,64,2],[71,4,65,2],[72,4,66,2],[72,10,66,8,"allowReview"],[72,21,66,19],[72,24,66,22,"p"],[72,25,66,23],[72,30,66,28],[72,45,66,43],[72,49,66,47,"p"],[72,50,66,48],[72,55,66,53],[72,75,66,73],[73,4,68,2],[73,8,68,6,"d"],[73,9,68,7],[73,14,68,12],[73,23,68,21],[73,25,68,23],[74,6,69,4],[74,13,69,11],[74,17,69,15],[75,4,70,2],[76,4,72,2],[76,8,72,6,"allowReview"],[76,19,72,17],[76,23,72,21,"d"],[76,24,72,22],[76,29,72,27],[76,37,72,35],[76,39,72,37],[77,6,73,4],[77,13,73,11],[77,17,73,15],[78,4,74,2],[79,4,76,2],[79,11,76,9],[79,16,76,14],[80,2,77,0],[81,0,77,1],[81,3]],"functionMap":{"names":["<global>","moderatePhoto","isDecisionAllowed"],"mappings":"AAA,OC;CD8C;OEE;CF4B"},"hasCjsExports":false},"type":"js/module"}]}