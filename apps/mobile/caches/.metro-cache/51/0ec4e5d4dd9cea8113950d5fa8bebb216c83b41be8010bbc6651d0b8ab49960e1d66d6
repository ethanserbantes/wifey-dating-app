{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":55,"index":55}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@react-navigation/native","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":56},"end":{"line":2,"column":56,"index":112}}],"key":"yKhyWCfwa1gXEwEbMKnWHykYbZ4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.usePresencePing = usePresencePing;\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0]);\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _react = require(_dependencyMap[1]);\n  var _reactNavigationNative = require(_dependencyMap[2]);\n  function usePresencePing(userId, options) {\n    var isFocused = (0, _reactNavigationNative.useIsFocused)();\n    var intervalMs = Number(options?.intervalMs) || 30_000;\n    var enabled = options?.enabled !== false;\n    var busyRef = (0, _react.useRef)(false);\n    var pingOnce = (0, _react.useCallback)(/*#__PURE__*/(0, _asyncToGenerator.default)(function* () {\n      if (!enabled) return;\n      var uid = Number(userId);\n      if (!Number.isFinite(uid)) return;\n      if (busyRef.current) return;\n      busyRef.current = true;\n      try {\n        var resp = yield fetch(\"/api/presence/ping\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify({\n            userId: uid,\n            platform: \"mobile\"\n          })\n        });\n        if (!resp.ok) {\n          var text = yield resp.text().catch(() => \"\");\n          throw new Error(`When posting /api/presence/ping, the response was [${resp.status}] ${resp.statusText}. ${text}`);\n        }\n      } catch (e) {\n        // Presence is best-effort â€” never block UI.\n        console.error(\"[presence] ping failed\", e);\n      } finally {\n        busyRef.current = false;\n      }\n    }), [enabled, userId]);\n    (0, _react.useEffect)(() => {\n      if (!enabled) return;\n      if (!isFocused) return;\n      var alive = true;\n      var start = /*#__PURE__*/function () {\n        var _ref2 = (0, _asyncToGenerator.default)(function* () {\n          if (!alive) return;\n          yield pingOnce();\n        });\n        return function start() {\n          return _ref2.apply(this, arguments);\n        };\n      }();\n      start();\n      var interval = setInterval(() => {\n        pingOnce();\n      }, intervalMs);\n      return () => {\n        alive = false;\n        clearInterval(interval);\n      };\n    }, [enabled, intervalMs, isFocused, pingOnce]);\n  }\n});","lineCount":73,"map":[[12,2,4,0,"exports"],[12,9,4,0],[12,10,4,0,"usePresencePing"],[12,25,4,0],[12,28,4,0,"usePresencePing"],[12,43,4,0],[13,2,60,1],[13,6,60,1,"_babelRuntimeHelpersAsyncToGenerator"],[13,42,60,1],[13,45,60,1,"require"],[13,52,60,1],[13,53,60,1,"_dependencyMap"],[13,67,60,1],[14,2,60,1],[14,6,60,1,"_asyncToGenerator"],[14,23,60,1],[14,26,60,1,"_interopDefault"],[14,41,60,1],[14,42,60,1,"_babelRuntimeHelpersAsyncToGenerator"],[14,78,60,1],[15,2,1,0],[15,6,1,0,"_react"],[15,12,1,0],[15,15,1,0,"require"],[15,22,1,0],[15,23,1,0,"_dependencyMap"],[15,37,1,0],[16,2,2,0],[16,6,2,0,"_reactNavigationNative"],[16,28,2,0],[16,31,2,0,"require"],[16,38,2,0],[16,39,2,0,"_dependencyMap"],[16,53,2,0],[17,2,4,7],[17,11,4,16,"usePresencePing"],[17,26,4,31,"usePresencePing"],[17,27,4,32,"userId"],[17,33,4,38],[17,35,4,40,"options"],[17,42,4,47],[17,44,4,49],[18,4,5,2],[18,8,5,8,"isFocused"],[18,17,5,17],[18,20,5,20],[18,24,5,20,"useIsFocused"],[18,46,5,32],[18,47,5,32,"useIsFocused"],[18,59,5,32],[18,61,5,33],[18,62,5,34],[19,4,6,2],[19,8,6,8,"intervalMs"],[19,18,6,18],[19,21,6,21,"Number"],[19,27,6,27],[19,28,6,28,"options"],[19,35,6,35],[19,37,6,37,"intervalMs"],[19,47,6,47],[19,48,6,48],[19,52,6,52],[19,58,6,58],[20,4,7,2],[20,8,7,8,"enabled"],[20,15,7,15],[20,18,7,18,"options"],[20,25,7,25],[20,27,7,27,"enabled"],[20,34,7,34],[20,39,7,39],[20,44,7,44],[21,4,9,2],[21,8,9,8,"busyRef"],[21,15,9,15],[21,18,9,18],[21,22,9,18,"useRef"],[21,28,9,24],[21,29,9,24,"useRef"],[21,35,9,24],[21,37,9,25],[21,42,9,30],[21,43,9,31],[22,4,11,2],[22,8,11,8,"pingOnce"],[22,16,11,16],[22,19,11,19],[22,23,11,19,"useCallback"],[22,29,11,30],[22,30,11,30,"useCallback"],[22,41,11,30],[22,60,11,30,"_asyncToGenerator"],[22,77,11,30],[22,78,11,30,"default"],[22,85,11,30],[22,87,11,31],[22,100,11,43],[23,6,12,4],[23,10,12,8],[23,11,12,9,"enabled"],[23,18,12,16],[23,20,12,18],[24,6,13,4],[24,10,13,10,"uid"],[24,13,13,13],[24,16,13,16,"Number"],[24,22,13,22],[24,23,13,23,"userId"],[24,29,13,29],[24,30,13,30],[25,6,14,4],[25,10,14,8],[25,11,14,9,"Number"],[25,17,14,15],[25,18,14,16,"isFinite"],[25,26,14,24],[25,27,14,25,"uid"],[25,30,14,28],[25,31,14,29],[25,33,14,31],[26,6,15,4],[26,10,15,8,"busyRef"],[26,17,15,15],[26,18,15,16,"current"],[26,25,15,23],[26,27,15,25],[27,6,17,4,"busyRef"],[27,13,17,11],[27,14,17,12,"current"],[27,21,17,19],[27,24,17,22],[27,28,17,26],[28,6,18,4],[28,10,18,8],[29,8,19,6],[29,12,19,12,"resp"],[29,16,19,16],[29,25,19,25,"fetch"],[29,30,19,30],[29,31,19,31],[29,51,19,51],[29,53,19,53],[30,10,20,8,"method"],[30,16,20,14],[30,18,20,16],[30,24,20,22],[31,10,21,8,"headers"],[31,17,21,15],[31,19,21,17],[32,12,21,19],[32,26,21,33],[32,28,21,35],[33,10,21,54],[33,11,21,55],[34,10,22,8,"body"],[34,14,22,12],[34,16,22,14,"JSON"],[34,20,22,18],[34,21,22,19,"stringify"],[34,30,22,28],[34,31,22,29],[35,12,22,31,"userId"],[35,18,22,37],[35,20,22,39,"uid"],[35,23,22,42],[36,12,22,44,"platform"],[36,20,22,52],[36,22,22,54],[37,10,22,63],[37,11,22,64],[38,8,23,6],[38,9,23,7],[38,10,23,8],[39,8,25,6],[39,12,25,10],[39,13,25,11,"resp"],[39,17,25,15],[39,18,25,16,"ok"],[39,20,25,18],[39,22,25,20],[40,10,26,8],[40,14,26,14,"text"],[40,18,26,18],[40,27,26,27,"resp"],[40,31,26,31],[40,32,26,32,"text"],[40,36,26,36],[40,37,26,37],[40,38,26,38],[40,39,26,39,"catch"],[40,44,26,44],[40,45,26,45],[40,51,26,51],[40,53,26,53],[40,54,26,54],[41,10,27,8],[41,16,27,14],[41,20,27,18,"Error"],[41,25,27,23],[41,26,28,10],[41,80,28,64,"resp"],[41,84,28,68],[41,85,28,69,"status"],[41,91,28,75],[41,96,28,80,"resp"],[41,100,28,84],[41,101,28,85,"statusText"],[41,111,28,95],[41,116,28,100,"text"],[41,120,28,104],[41,122,29,8],[41,123,29,9],[42,8,30,6],[43,6,31,4],[43,7,31,5],[43,8,31,6],[43,15,31,13,"e"],[43,16,31,14],[43,18,31,16],[44,8,32,6],[45,8,33,6,"console"],[45,15,33,13],[45,16,33,14,"error"],[45,21,33,19],[45,22,33,20],[45,46,33,44],[45,48,33,46,"e"],[45,49,33,47],[45,50,33,48],[46,6,34,4],[46,7,34,5],[46,16,34,14],[47,8,35,6,"busyRef"],[47,15,35,13],[47,16,35,14,"current"],[47,23,35,21],[47,26,35,24],[47,31,35,29],[48,6,36,4],[49,4,37,2],[49,5,37,3],[49,8,37,5],[49,9,37,6,"enabled"],[49,16,37,13],[49,18,37,15,"userId"],[49,24,37,21],[49,25,37,22],[49,26,37,23],[50,4,39,2],[50,8,39,2,"useEffect"],[50,14,39,11],[50,15,39,11,"useEffect"],[50,24,39,11],[50,26,39,12],[50,32,39,18],[51,6,40,4],[51,10,40,8],[51,11,40,9,"enabled"],[51,18,40,16],[51,20,40,18],[52,6,41,4],[52,10,41,8],[52,11,41,9,"isFocused"],[52,20,41,18],[52,22,41,20],[53,6,43,4],[53,10,43,8,"alive"],[53,15,43,13],[53,18,43,16],[53,22,43,20],[54,6,45,4],[54,10,45,10,"start"],[54,15,45,15],[55,8,45,15],[55,12,45,15,"_ref2"],[55,17,45,15],[55,24,45,15,"_asyncToGenerator"],[55,41,45,15],[55,42,45,15,"default"],[55,49,45,15],[55,51,45,18],[55,64,45,30],[56,10,46,6],[56,14,46,10],[56,15,46,11,"alive"],[56,20,46,16],[56,22,46,18],[57,10,47,6],[57,16,47,12,"pingOnce"],[57,24,47,20],[57,25,47,21],[57,26,47,22],[58,8,48,4],[58,9,48,5],[59,8,48,5],[59,24,45,10,"start"],[59,29,45,15,"start"],[59,30,45,15],[60,10,45,15],[60,17,45,15,"_ref2"],[60,22,45,15],[60,23,45,15,"apply"],[60,28,45,15],[60,35,45,15,"arguments"],[60,44,45,15],[61,8,45,15],[62,6,45,15],[62,9,48,5],[63,6,50,4,"start"],[63,11,50,9],[63,12,50,10],[63,13,50,11],[64,6,51,4],[64,10,51,10,"interval"],[64,18,51,18],[64,21,51,21,"setInterval"],[64,32,51,32],[64,33,51,33],[64,39,51,39],[65,8,52,6,"pingOnce"],[65,16,52,14],[65,17,52,15],[65,18,52,16],[66,6,53,4],[66,7,53,5],[66,9,53,7,"intervalMs"],[66,19,53,17],[66,20,53,18],[67,6,55,4],[67,13,55,11],[67,19,55,17],[68,8,56,6,"alive"],[68,13,56,11],[68,16,56,14],[68,21,56,19],[69,8,57,6,"clearInterval"],[69,21,57,19],[69,22,57,20,"interval"],[69,30,57,28],[69,31,57,29],[70,6,58,4],[70,7,58,5],[71,4,59,2],[71,5,59,3],[71,7,59,5],[71,8,59,6,"enabled"],[71,15,59,13],[71,17,59,15,"intervalMs"],[71,27,59,25],[71,29,59,27,"isFocused"],[71,38,59,36],[71,40,59,38,"pingOnce"],[71,48,59,46],[71,49,59,47],[71,50,59,48],[72,2,60,0],[73,0,60,1],[73,3]],"functionMap":{"names":["<global>","usePresencePing","pingOnce","resp.text._catch$argument_0","useEffect$argument_0","start","setInterval$argument_0","<anonymous>"],"mappings":"AAA;OCG;+BCO;6CCe,QD;GDW;YGE;kBCM;KDG;iCEG;KFE;WGE;KHG;GHC;CDC"},"hasCjsExports":false},"type":"js/module"}]}