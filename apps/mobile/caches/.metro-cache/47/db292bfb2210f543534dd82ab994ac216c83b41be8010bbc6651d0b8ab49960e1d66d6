{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":55,"index":55}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@react-navigation/native","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":56},"end":{"line":2,"column":56,"index":112}}],"key":"yKhyWCfwa1gXEwEbMKnWHykYbZ4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.usePresencePing = usePresencePing;\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _react = require(_dependencyMap[1], \"react\");\n  var _reactNavigationNative = require(_dependencyMap[2], \"@react-navigation/native\");\n  function usePresencePing(userId, options) {\n    _s();\n    var isFocused = (0, _reactNavigationNative.useIsFocused)();\n    var intervalMs = Number(options?.intervalMs) || 30_000;\n    var enabled = options?.enabled !== false;\n    var busyRef = (0, _react.useRef)(false);\n    var pingOnce = (0, _react.useCallback)(/*#__PURE__*/(0, _asyncToGenerator.default)(function* () {\n      if (!enabled) return;\n      var uid = Number(userId);\n      if (!Number.isFinite(uid)) return;\n      if (busyRef.current) return;\n      busyRef.current = true;\n      try {\n        var resp = yield fetch(\"/api/presence/ping\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify({\n            userId: uid,\n            platform: \"mobile\"\n          })\n        });\n        if (!resp.ok) {\n          var text = yield resp.text().catch(() => \"\");\n          throw new Error(`When posting /api/presence/ping, the response was [${resp.status}] ${resp.statusText}. ${text}`);\n        }\n      } catch (e) {\n        // Presence is best-effort â€” never block UI.\n        console.error(\"[presence] ping failed\", e);\n      } finally {\n        busyRef.current = false;\n      }\n    }), [enabled, userId]);\n    (0, _react.useEffect)(() => {\n      if (!enabled) return;\n      if (!isFocused) return;\n      var alive = true;\n      var start = /*#__PURE__*/function () {\n        var _ref2 = (0, _asyncToGenerator.default)(function* () {\n          if (!alive) return;\n          yield pingOnce();\n        });\n        return function start() {\n          return _ref2.apply(this, arguments);\n        };\n      }();\n      start();\n      var interval = setInterval(() => {\n        pingOnce();\n      }, intervalMs);\n      return () => {\n        alive = false;\n        clearInterval(interval);\n      };\n    }, [enabled, intervalMs, isFocused, pingOnce]);\n  }\n  _s(usePresencePing, \"+VkUsZwT8M9hzMDvScpciVxQ5Z0=\", false, function () {\n    return [_reactNavigationNative.useIsFocused];\n  });\n});","lineCount":78,"map":[[13,2,4,0,"exports"],[13,9,4,0],[13,10,4,0,"usePresencePing"],[13,25,4,0],[13,28,4,0,"usePresencePing"],[13,43,4,0],[14,2,60,1],[14,6,60,1,"_babelRuntimeHelpersAsyncToGenerator"],[14,42,60,1],[14,45,60,1,"require"],[14,52,60,1],[14,53,60,1,"_dependencyMap"],[14,67,60,1],[15,2,60,1],[15,6,60,1,"_asyncToGenerator"],[15,23,60,1],[15,26,60,1,"_interopDefault"],[15,41,60,1],[15,42,60,1,"_babelRuntimeHelpersAsyncToGenerator"],[15,78,60,1],[16,2,1,0],[16,6,1,0,"_react"],[16,12,1,0],[16,15,1,0,"require"],[16,22,1,0],[16,23,1,0,"_dependencyMap"],[16,37,1,0],[17,2,2,0],[17,6,2,0,"_reactNavigationNative"],[17,28,2,0],[17,31,2,0,"require"],[17,38,2,0],[17,39,2,0,"_dependencyMap"],[17,53,2,0],[18,2,4,7],[18,11,4,16,"usePresencePing"],[18,26,4,31,"usePresencePing"],[18,27,4,32,"userId"],[18,33,4,38],[18,35,4,40,"options"],[18,42,4,47],[18,44,4,49],[19,4,4,49,"_s"],[19,6,4,49],[20,4,5,2],[20,8,5,8,"isFocused"],[20,17,5,17],[20,20,5,20],[20,24,5,20,"useIsFocused"],[20,46,5,32],[20,47,5,32,"useIsFocused"],[20,59,5,32],[20,61,5,33],[20,62,5,34],[21,4,6,2],[21,8,6,8,"intervalMs"],[21,18,6,18],[21,21,6,21,"Number"],[21,27,6,27],[21,28,6,28,"options"],[21,35,6,35],[21,37,6,37,"intervalMs"],[21,47,6,47],[21,48,6,48],[21,52,6,52],[21,58,6,58],[22,4,7,2],[22,8,7,8,"enabled"],[22,15,7,15],[22,18,7,18,"options"],[22,25,7,25],[22,27,7,27,"enabled"],[22,34,7,34],[22,39,7,39],[22,44,7,44],[23,4,9,2],[23,8,9,8,"busyRef"],[23,15,9,15],[23,18,9,18],[23,22,9,18,"useRef"],[23,28,9,24],[23,29,9,24,"useRef"],[23,35,9,24],[23,37,9,25],[23,42,9,30],[23,43,9,31],[24,4,11,2],[24,8,11,8,"pingOnce"],[24,16,11,16],[24,19,11,19],[24,23,11,19,"useCallback"],[24,29,11,30],[24,30,11,30,"useCallback"],[24,41,11,30],[24,60,11,30,"_asyncToGenerator"],[24,77,11,30],[24,78,11,30,"default"],[24,85,11,30],[24,87,11,31],[24,100,11,43],[25,6,12,4],[25,10,12,8],[25,11,12,9,"enabled"],[25,18,12,16],[25,20,12,18],[26,6,13,4],[26,10,13,10,"uid"],[26,13,13,13],[26,16,13,16,"Number"],[26,22,13,22],[26,23,13,23,"userId"],[26,29,13,29],[26,30,13,30],[27,6,14,4],[27,10,14,8],[27,11,14,9,"Number"],[27,17,14,15],[27,18,14,16,"isFinite"],[27,26,14,24],[27,27,14,25,"uid"],[27,30,14,28],[27,31,14,29],[27,33,14,31],[28,6,15,4],[28,10,15,8,"busyRef"],[28,17,15,15],[28,18,15,16,"current"],[28,25,15,23],[28,27,15,25],[29,6,17,4,"busyRef"],[29,13,17,11],[29,14,17,12,"current"],[29,21,17,19],[29,24,17,22],[29,28,17,26],[30,6,18,4],[30,10,18,8],[31,8,19,6],[31,12,19,12,"resp"],[31,16,19,16],[31,25,19,25,"fetch"],[31,30,19,30],[31,31,19,31],[31,51,19,51],[31,53,19,53],[32,10,20,8,"method"],[32,16,20,14],[32,18,20,16],[32,24,20,22],[33,10,21,8,"headers"],[33,17,21,15],[33,19,21,17],[34,12,21,19],[34,26,21,33],[34,28,21,35],[35,10,21,54],[35,11,21,55],[36,10,22,8,"body"],[36,14,22,12],[36,16,22,14,"JSON"],[36,20,22,18],[36,21,22,19,"stringify"],[36,30,22,28],[36,31,22,29],[37,12,22,31,"userId"],[37,18,22,37],[37,20,22,39,"uid"],[37,23,22,42],[38,12,22,44,"platform"],[38,20,22,52],[38,22,22,54],[39,10,22,63],[39,11,22,64],[40,8,23,6],[40,9,23,7],[40,10,23,8],[41,8,25,6],[41,12,25,10],[41,13,25,11,"resp"],[41,17,25,15],[41,18,25,16,"ok"],[41,20,25,18],[41,22,25,20],[42,10,26,8],[42,14,26,14,"text"],[42,18,26,18],[42,27,26,27,"resp"],[42,31,26,31],[42,32,26,32,"text"],[42,36,26,36],[42,37,26,37],[42,38,26,38],[42,39,26,39,"catch"],[42,44,26,44],[42,45,26,45],[42,51,26,51],[42,53,26,53],[42,54,26,54],[43,10,27,8],[43,16,27,14],[43,20,27,18,"Error"],[43,25,27,23],[43,26,28,10],[43,80,28,64,"resp"],[43,84,28,68],[43,85,28,69,"status"],[43,91,28,75],[43,96,28,80,"resp"],[43,100,28,84],[43,101,28,85,"statusText"],[43,111,28,95],[43,116,28,100,"text"],[43,120,28,104],[43,122,29,8],[43,123,29,9],[44,8,30,6],[45,6,31,4],[45,7,31,5],[45,8,31,6],[45,15,31,13,"e"],[45,16,31,14],[45,18,31,16],[46,8,32,6],[47,8,33,6,"console"],[47,15,33,13],[47,16,33,14,"error"],[47,21,33,19],[47,22,33,20],[47,46,33,44],[47,48,33,46,"e"],[47,49,33,47],[47,50,33,48],[48,6,34,4],[48,7,34,5],[48,16,34,14],[49,8,35,6,"busyRef"],[49,15,35,13],[49,16,35,14,"current"],[49,23,35,21],[49,26,35,24],[49,31,35,29],[50,6,36,4],[51,4,37,2],[51,5,37,3],[51,8,37,5],[51,9,37,6,"enabled"],[51,16,37,13],[51,18,37,15,"userId"],[51,24,37,21],[51,25,37,22],[51,26,37,23],[52,4,39,2],[52,8,39,2,"useEffect"],[52,14,39,11],[52,15,39,11,"useEffect"],[52,24,39,11],[52,26,39,12],[52,32,39,18],[53,6,40,4],[53,10,40,8],[53,11,40,9,"enabled"],[53,18,40,16],[53,20,40,18],[54,6,41,4],[54,10,41,8],[54,11,41,9,"isFocused"],[54,20,41,18],[54,22,41,20],[55,6,43,4],[55,10,43,8,"alive"],[55,15,43,13],[55,18,43,16],[55,22,43,20],[56,6,45,4],[56,10,45,10,"start"],[56,15,45,15],[57,8,45,15],[57,12,45,15,"_ref2"],[57,17,45,15],[57,24,45,15,"_asyncToGenerator"],[57,41,45,15],[57,42,45,15,"default"],[57,49,45,15],[57,51,45,18],[57,64,45,30],[58,10,46,6],[58,14,46,10],[58,15,46,11,"alive"],[58,20,46,16],[58,22,46,18],[59,10,47,6],[59,16,47,12,"pingOnce"],[59,24,47,20],[59,25,47,21],[59,26,47,22],[60,8,48,4],[60,9,48,5],[61,8,48,5],[61,24,45,10,"start"],[61,29,45,15,"start"],[61,30,45,15],[62,10,45,15],[62,17,45,15,"_ref2"],[62,22,45,15],[62,23,45,15,"apply"],[62,28,45,15],[62,35,45,15,"arguments"],[62,44,45,15],[63,8,45,15],[64,6,45,15],[64,9,48,5],[65,6,50,4,"start"],[65,11,50,9],[65,12,50,10],[65,13,50,11],[66,6,51,4],[66,10,51,10,"interval"],[66,18,51,18],[66,21,51,21,"setInterval"],[66,32,51,32],[66,33,51,33],[66,39,51,39],[67,8,52,6,"pingOnce"],[67,16,52,14],[67,17,52,15],[67,18,52,16],[68,6,53,4],[68,7,53,5],[68,9,53,7,"intervalMs"],[68,19,53,17],[68,20,53,18],[69,6,55,4],[69,13,55,11],[69,19,55,17],[70,8,56,6,"alive"],[70,13,56,11],[70,16,56,14],[70,21,56,19],[71,8,57,6,"clearInterval"],[71,21,57,19],[71,22,57,20,"interval"],[71,30,57,28],[71,31,57,29],[72,6,58,4],[72,7,58,5],[73,4,59,2],[73,5,59,3],[73,7,59,5],[73,8,59,6,"enabled"],[73,15,59,13],[73,17,59,15,"intervalMs"],[73,27,59,25],[73,29,59,27,"isFocused"],[73,38,59,36],[73,40,59,38,"pingOnce"],[73,48,59,46],[73,49,59,47],[73,50,59,48],[74,2,60,0],[75,2,60,1,"_s"],[75,4,60,1],[75,5,4,16,"usePresencePing"],[75,20,4,31],[76,4,4,31],[76,12,5,20,"useIsFocused"],[76,34,5,32],[76,35,5,32,"useIsFocused"],[76,47,5,32],[77,2,5,32],[78,0,5,32],[78,3]],"functionMap":{"names":["<global>","usePresencePing","pingOnce","resp.text._catch$argument_0","useEffect$argument_0","start","setInterval$argument_0","<anonymous>"],"mappings":"AAA;OCG;+BCO;6CCe,QD;GDW;YGE;kBCM;KDG;iCEG;KFE;WGE;KHG;GHC;CDC"},"hasCjsExports":false},"type":"js/module"}]}