{"dependencies":[{"name":"./util","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":36,"index":36}}],"key":"1+hZBLc/k6i18AZJ4yHV73uDZHQ=","exportNames":["*"],"imports":1}},{"name":"./mimes","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":37},"end":{"line":2,"column":38,"index":75}}],"key":"TEIwCaAktDlIPJQVs10BNF88RAg=","exportNames":["*"],"imports":1}},{"name":"./dataurl","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":76},"end":{"line":3,"column":70,"index":146}}],"key":"YDncyeQvfBgB8K+AxXbrKq6ci9c=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.parseURLs = parseURLs;\n  exports.embed = embed;\n  exports.shouldEmbed = shouldEmbed;\n  exports.embedResources = embedResources;\n  var _util = require(_dependencyMap[0], \"./util\");\n  var _mimes = require(_dependencyMap[1], \"./mimes\");\n  var _dataurl = require(_dependencyMap[2], \"./dataurl\");\n  const URL_REGEX = /url\\((['\"]?)([^'\"]+?)\\1\\)/g;\n  const URL_WITH_FORMAT_REGEX = /url\\([^)]+\\)\\s*format\\(([\"']?)([^\"']+)\\1\\)/g;\n  const FONT_SRC_REGEX = /src:\\s*(?:url\\([^)]+\\)\\s*format\\([^)]+\\)[,;]\\s*)+/g;\n  function toRegex(url) {\n    // eslint-disable-next-line no-useless-escape\n    const escaped = url.replace(/([.*+?^${}()|\\[\\]\\/\\\\])/g, '\\\\$1');\n    return new RegExp(`(url\\\\(['\"]?)(${escaped})(['\"]?\\\\))`, 'g');\n  }\n  function parseURLs(cssText) {\n    const urls = [];\n    cssText.replace(URL_REGEX, (raw, quotation, url) => {\n      urls.push(url);\n      return raw;\n    });\n    return urls.filter(url => !(0, _dataurl.isDataUrl)(url));\n  }\n  async function embed(cssText, resourceURL, baseURL, options, getContentFromUrl) {\n    try {\n      const resolvedURL = baseURL ? (0, _util.resolveUrl)(resourceURL, baseURL) : resourceURL;\n      const contentType = (0, _mimes.getMimeType)(resourceURL);\n      let dataURL;\n      if (getContentFromUrl) {\n        const content = await getContentFromUrl(resolvedURL);\n        dataURL = (0, _dataurl.makeDataUrl)(content, contentType);\n      } else {\n        dataURL = await (0, _dataurl.resourceToDataURL)(resolvedURL, contentType, options);\n      }\n      return cssText.replace(toRegex(resourceURL), `$1${dataURL}$3`);\n    } catch (error) {\n      // pass\n    }\n    return cssText;\n  }\n  function filterPreferredFontFormat(str, {\n    preferredFontFormat\n  }) {\n    return !preferredFontFormat ? str : str.replace(FONT_SRC_REGEX, match => {\n      // eslint-disable-next-line no-constant-condition\n      while (true) {\n        const [src,, format] = URL_WITH_FORMAT_REGEX.exec(match) || [];\n        if (!format) {\n          return '';\n        }\n        if (format === preferredFontFormat) {\n          return `src: ${src};`;\n        }\n      }\n    });\n  }\n  function shouldEmbed(url) {\n    return url.search(URL_REGEX) !== -1;\n  }\n  async function embedResources(cssText, baseUrl, options) {\n    if (!shouldEmbed(cssText)) {\n      return cssText;\n    }\n    const filteredCSSText = filterPreferredFontFormat(cssText, options);\n    const urls = parseURLs(filteredCSSText);\n    return urls.reduce((deferred, url) => deferred.then(css => embed(css, url, baseUrl, options)), Promise.resolve(filteredCSSText));\n  }\n});","lineCount":74,"map":[[7,2,12,0,"exports"],[7,9,12,0],[7,10,12,0,"parseURLs"],[7,19,12,0],[7,22,12,0,"parseURLs"],[7,31,12,0],[8,2,20,0,"exports"],[8,9,20,0],[8,10,20,0,"embed"],[8,15,20,0],[8,18,20,0,"embed"],[8,23,20,0],[9,2,55,0,"exports"],[9,9,55,0],[9,10,55,0,"shouldEmbed"],[9,21,55,0],[9,24,55,0,"shouldEmbed"],[9,35,55,0],[10,2,58,0,"exports"],[10,9,58,0],[10,10,58,0,"embedResources"],[10,24,58,0],[10,27,58,0,"embedResources"],[10,41,58,0],[11,2,1,0],[11,6,1,0,"_util"],[11,11,1,0],[11,14,1,0,"require"],[11,21,1,0],[11,22,1,0,"_dependencyMap"],[11,36,1,0],[12,2,2,0],[12,6,2,0,"_mimes"],[12,12,2,0],[12,15,2,0,"require"],[12,22,2,0],[12,23,2,0,"_dependencyMap"],[12,37,2,0],[13,2,3,0],[13,6,3,0,"_dataurl"],[13,14,3,0],[13,17,3,0,"require"],[13,24,3,0],[13,25,3,0,"_dependencyMap"],[13,39,3,0],[14,2,4,0],[14,8,4,6,"URL_REGEX"],[14,17,4,15],[14,20,4,18],[14,48,4,46],[15,2,5,0],[15,8,5,6,"URL_WITH_FORMAT_REGEX"],[15,29,5,27],[15,32,5,30],[15,77,5,75],[16,2,6,0],[16,8,6,6,"FONT_SRC_REGEX"],[16,22,6,20],[16,25,6,23],[16,77,6,75],[17,2,7,0],[17,11,7,9,"toRegex"],[17,18,7,16,"toRegex"],[17,19,7,17,"url"],[17,22,7,20],[17,24,7,22],[18,4,8,4],[19,4,9,4],[19,10,9,10,"escaped"],[19,17,9,17],[19,20,9,20,"url"],[19,23,9,23],[19,24,9,24,"replace"],[19,31,9,31],[19,32,9,32],[19,58,9,58],[19,60,9,60],[19,66,9,66],[19,67,9,67],[20,4,10,4],[20,11,10,11],[20,15,10,15,"RegExp"],[20,21,10,21],[20,22,10,22],[20,39,10,39,"escaped"],[20,46,10,46],[20,59,10,59],[20,61,10,61],[20,64,10,64],[20,65,10,65],[21,2,11,0],[22,2,12,7],[22,11,12,16,"parseURLs"],[22,20,12,25,"parseURLs"],[22,21,12,26,"cssText"],[22,28,12,33],[22,30,12,35],[23,4,13,4],[23,10,13,10,"urls"],[23,14,13,14],[23,17,13,17],[23,19,13,19],[24,4,14,4,"cssText"],[24,11,14,11],[24,12,14,12,"replace"],[24,19,14,19],[24,20,14,20,"URL_REGEX"],[24,29,14,29],[24,31,14,31],[24,32,14,32,"raw"],[24,35,14,35],[24,37,14,37,"quotation"],[24,46,14,46],[24,48,14,48,"url"],[24,51,14,51],[24,56,14,56],[25,6,15,8,"urls"],[25,10,15,12],[25,11,15,13,"push"],[25,15,15,17],[25,16,15,18,"url"],[25,19,15,21],[25,20,15,22],[26,6,16,8],[26,13,16,15,"raw"],[26,16,16,18],[27,4,17,4],[27,5,17,5],[27,6,17,6],[28,4,18,4],[28,11,18,11,"urls"],[28,15,18,15],[28,16,18,16,"filter"],[28,22,18,22],[28,23,18,24,"url"],[28,26,18,27],[28,30,18,32],[28,31,18,33],[28,35,18,33,"isDataUrl"],[28,43,18,42],[28,44,18,42,"isDataUrl"],[28,53,18,42],[28,55,18,43,"url"],[28,58,18,46],[28,59,18,47],[28,60,18,48],[29,2,19,0],[30,2,20,7],[30,17,20,22,"embed"],[30,22,20,27,"embed"],[30,23,20,28,"cssText"],[30,30,20,35],[30,32,20,37,"resourceURL"],[30,43,20,48],[30,45,20,50,"baseURL"],[30,52,20,57],[30,54,20,59,"options"],[30,61,20,66],[30,63,20,68,"getContentFromUrl"],[30,80,20,85],[30,82,20,87],[31,4,21,4],[31,8,21,8],[32,6,22,8],[32,12,22,14,"resolvedURL"],[32,23,22,25],[32,26,22,28,"baseURL"],[32,33,22,35],[32,36,22,38],[32,40,22,38,"resolveUrl"],[32,45,22,48],[32,46,22,48,"resolveUrl"],[32,56,22,48],[32,58,22,49,"resourceURL"],[32,69,22,60],[32,71,22,62,"baseURL"],[32,78,22,69],[32,79,22,70],[32,82,22,73,"resourceURL"],[32,93,22,84],[33,6,23,8],[33,12,23,14,"contentType"],[33,23,23,25],[33,26,23,28],[33,30,23,28,"getMimeType"],[33,36,23,39],[33,37,23,39,"getMimeType"],[33,48,23,39],[33,50,23,40,"resourceURL"],[33,61,23,51],[33,62,23,52],[34,6,24,8],[34,10,24,12,"dataURL"],[34,17,24,19],[35,6,25,8],[35,10,25,12,"getContentFromUrl"],[35,27,25,29],[35,29,25,31],[36,8,26,12],[36,14,26,18,"content"],[36,21,26,25],[36,24,26,28],[36,30,26,34,"getContentFromUrl"],[36,47,26,51],[36,48,26,52,"resolvedURL"],[36,59,26,63],[36,60,26,64],[37,8,27,12,"dataURL"],[37,15,27,19],[37,18,27,22],[37,22,27,22,"makeDataUrl"],[37,30,27,33],[37,31,27,33,"makeDataUrl"],[37,42,27,33],[37,44,27,34,"content"],[37,51,27,41],[37,53,27,43,"contentType"],[37,64,27,54],[37,65,27,55],[38,6,28,8],[38,7,28,9],[38,13,29,13],[39,8,30,12,"dataURL"],[39,15,30,19],[39,18,30,22],[39,24,30,28],[39,28,30,28,"resourceToDataURL"],[39,36,30,45],[39,37,30,45,"resourceToDataURL"],[39,54,30,45],[39,56,30,46,"resolvedURL"],[39,67,30,57],[39,69,30,59,"contentType"],[39,80,30,70],[39,82,30,72,"options"],[39,89,30,79],[39,90,30,80],[40,6,31,8],[41,6,32,8],[41,13,32,15,"cssText"],[41,20,32,22],[41,21,32,23,"replace"],[41,28,32,30],[41,29,32,31,"toRegex"],[41,36,32,38],[41,37,32,39,"resourceURL"],[41,48,32,50],[41,49,32,51],[41,51,32,53],[41,56,32,58,"dataURL"],[41,63,32,65],[41,67,32,69],[41,68,32,70],[42,4,33,4],[42,5,33,5],[42,6,34,4],[42,13,34,11,"error"],[42,18,34,16],[42,20,34,18],[43,6,35,8],[44,4,35,8],[45,4,37,4],[45,11,37,11,"cssText"],[45,18,37,18],[46,2,38,0],[47,2,39,0],[47,11,39,9,"filterPreferredFontFormat"],[47,36,39,34,"filterPreferredFontFormat"],[47,37,39,35,"str"],[47,40,39,38],[47,42,39,40],[48,4,39,42,"preferredFontFormat"],[49,2,39,62],[49,3,39,63],[49,5,39,65],[50,4,40,4],[50,11,40,11],[50,12,40,12,"preferredFontFormat"],[50,31,40,31],[50,34,41,10,"str"],[50,37,41,13],[50,40,42,10,"str"],[50,43,42,13],[50,44,42,14,"replace"],[50,51,42,21],[50,52,42,22,"FONT_SRC_REGEX"],[50,66,42,36],[50,68,42,39,"match"],[50,73,42,44],[50,77,42,49],[51,6,43,12],[52,6,44,12],[52,13,44,19],[52,17,44,23],[52,19,44,25],[53,8,45,16],[53,14,45,22],[53,15,45,23,"src"],[53,18,45,26],[53,21,45,30,"format"],[53,27,45,36],[53,28,45,37],[53,31,45,40,"URL_WITH_FORMAT_REGEX"],[53,52,45,61],[53,53,45,62,"exec"],[53,57,45,66],[53,58,45,67,"match"],[53,63,45,72],[53,64,45,73],[53,68,45,77],[53,70,45,79],[54,8,46,16],[54,12,46,20],[54,13,46,21,"format"],[54,19,46,27],[54,21,46,29],[55,10,47,20],[55,17,47,27],[55,19,47,29],[56,8,48,16],[57,8,49,16],[57,12,49,20,"format"],[57,18,49,26],[57,23,49,31,"preferredFontFormat"],[57,42,49,50],[57,44,49,52],[58,10,50,20],[58,17,50,27],[58,25,50,35,"src"],[58,28,50,38],[58,31,50,41],[59,8,51,16],[60,6,52,12],[61,4,53,8],[61,5,53,9],[61,6,53,10],[62,2,54,0],[63,2,55,7],[63,11,55,16,"shouldEmbed"],[63,22,55,27,"shouldEmbed"],[63,23,55,28,"url"],[63,26,55,31],[63,28,55,33],[64,4,56,4],[64,11,56,11,"url"],[64,14,56,14],[64,15,56,15,"search"],[64,21,56,21],[64,22,56,22,"URL_REGEX"],[64,31,56,31],[64,32,56,32],[64,37,56,37],[64,38,56,38],[64,39,56,39],[65,2,57,0],[66,2,58,7],[66,17,58,22,"embedResources"],[66,31,58,36,"embedResources"],[66,32,58,37,"cssText"],[66,39,58,44],[66,41,58,46,"baseUrl"],[66,48,58,53],[66,50,58,55,"options"],[66,57,58,62],[66,59,58,64],[67,4,59,4],[67,8,59,8],[67,9,59,9,"shouldEmbed"],[67,20,59,20],[67,21,59,21,"cssText"],[67,28,59,28],[67,29,59,29],[67,31,59,31],[68,6,60,8],[68,13,60,15,"cssText"],[68,20,60,22],[69,4,61,4],[70,4,62,4],[70,10,62,10,"filteredCSSText"],[70,25,62,25],[70,28,62,28,"filterPreferredFontFormat"],[70,53,62,53],[70,54,62,54,"cssText"],[70,61,62,61],[70,63,62,63,"options"],[70,70,62,70],[70,71,62,71],[71,4,63,4],[71,10,63,10,"urls"],[71,14,63,14],[71,17,63,17,"parseURLs"],[71,26,63,26],[71,27,63,27,"filteredCSSText"],[71,42,63,42],[71,43,63,43],[72,4,64,4],[72,11,64,11,"urls"],[72,15,64,15],[72,16,64,16,"reduce"],[72,22,64,22],[72,23,64,23],[72,24,64,24,"deferred"],[72,32,64,32],[72,34,64,34,"url"],[72,37,64,37],[72,42,64,42,"deferred"],[72,50,64,50],[72,51,64,51,"then"],[72,55,64,55],[72,56,64,57,"css"],[72,59,64,60],[72,63,64,65,"embed"],[72,68,64,70],[72,69,64,71,"css"],[72,72,64,74],[72,74,64,76,"url"],[72,77,64,79],[72,79,64,81,"baseUrl"],[72,86,64,88],[72,88,64,90,"options"],[72,95,64,97],[72,96,64,98],[72,97,64,99],[72,99,64,101,"Promise"],[72,106,64,108],[72,107,64,109,"resolve"],[72,114,64,116],[72,115,64,117,"filteredCSSText"],[72,130,64,132],[72,131,64,133],[72,132,64,134],[73,2,65,0],[74,0,65,1],[74,3]],"functionMap":{"names":["<global>","toRegex","parseURLs","cssText.replace$argument_1","urls.filter$argument_0","embed","filterPreferredFontFormat","str.replace$argument_1","shouldEmbed","embedResources","urls.reduce$argument_0","deferred.then$argument_0"],"mappings":"AAA;ACM;CDI;OEC;+BCE;KDG;uBEC,wBF;CFC;OKC;CLkB;AMC;sCCG;SDW;CNC;OQC;CRE;OSC;uBCM,iCC,0CD,CD;CTC"},"hasCjsExports":false},"type":"js/module"}]}