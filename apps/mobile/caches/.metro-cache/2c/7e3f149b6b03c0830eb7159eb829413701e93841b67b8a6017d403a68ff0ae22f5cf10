{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":42,"index":42}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.usePreChatDecisionTimers = usePreChatDecisionTimers;\n  var _react = require(_dependencyMap[0], \"react\");\n  function usePreChatDecisionTimers({\n    user,\n    preChatRows,\n    loading,\n    otherChatsHidden,\n    loadMatches\n  }) {\n    const startedDecisionTimersRef = (0, _react.useRef)(new Set());\n    (0, _react.useEffect)(() => {\n      if (otherChatsHidden) return;\n      const userIdNum = Number(user?.id);\n      if (!Number.isFinite(userIdNum)) return;\n      if (loading) return;\n      const candidates = (Array.isArray(preChatRows) ? preChatRows : []).filter(m => String(m?.prechat_role) === \"receiver\").filter(m => !m?.decision_expires_at).filter(m => !m?.terminal_state).slice(0, 6);\n      const toStart = candidates.filter(m => {\n        const idStr = m?.match_id != null ? String(m.match_id) : \"\";\n        if (!idStr) return false;\n        if (startedDecisionTimersRef.current.has(idStr)) return false;\n        return true;\n      });\n      if (toStart.length === 0) return;\n      toStart.forEach(m => {\n        const idStr = String(m.match_id);\n        startedDecisionTimersRef.current.add(idStr);\n      });\n      let cancelled = false;\n      const run = async () => {\n        try {\n          const results = await Promise.all(toStart.map(async m => {\n            const matchIdStr = String(m.match_id);\n            const resp = await fetch(`/api/conversations/prechat-seen/${encodeURIComponent(matchIdStr)}`, {\n              method: \"POST\",\n              headers: {\n                \"Content-Type\": \"application/json\"\n              },\n              body: JSON.stringify({\n                userId: userIdNum\n              })\n            });\n            if (!resp.ok) {\n              const text = await resp.text().catch(() => \"\");\n              throw new Error(`When posting /api/conversations/prechat-seen/${matchIdStr}, the response was [${resp.status}] ${resp.statusText}. ${text}`);\n            }\n            const data = await resp.json().catch(() => ({}));\n            return Boolean(data?.started);\n          }));\n          const startedAny = results.some(Boolean);\n          if (!cancelled && startedAny) {\n            await loadMatches(userIdNum);\n          }\n        } catch (e) {\n          console.error(e);\n        }\n      };\n      run();\n      return () => {\n        cancelled = true;\n      };\n    }, [loading, loadMatches, otherChatsHidden, preChatRows, user?.id]);\n  }\n});","lineCount":69,"map":[[7,2,3,0,"exports"],[7,9,3,0],[7,10,3,0,"usePreChatDecisionTimers"],[7,34,3,0],[7,37,3,0,"usePreChatDecisionTimers"],[7,61,3,0],[8,2,1,0],[8,6,1,0,"_react"],[8,12,1,0],[8,15,1,0,"require"],[8,22,1,0],[8,23,1,0,"_dependencyMap"],[8,37,1,0],[9,2,3,7],[9,11,3,16,"usePreChatDecisionTimers"],[9,35,3,40,"usePreChatDecisionTimers"],[9,36,3,41],[10,4,4,2,"user"],[10,8,4,6],[11,4,5,2,"preChatRows"],[11,15,5,13],[12,4,6,2,"loading"],[12,11,6,9],[13,4,7,2,"otherChatsHidden"],[13,20,7,18],[14,4,8,2,"loadMatches"],[15,2,9,0],[15,3,9,1],[15,5,9,3],[16,4,10,2],[16,10,10,8,"startedDecisionTimersRef"],[16,34,10,32],[16,37,10,35],[16,41,10,35,"useRef"],[16,47,10,41],[16,48,10,41,"useRef"],[16,54,10,41],[16,56,10,42],[16,60,10,46,"Set"],[16,63,10,49],[16,64,10,50],[16,65,10,51],[16,66,10,52],[17,4,12,2],[17,8,12,2,"useEffect"],[17,14,12,11],[17,15,12,11,"useEffect"],[17,24,12,11],[17,26,12,12],[17,32,12,18],[18,6,13,4],[18,10,13,8,"otherChatsHidden"],[18,26,13,24],[18,28,13,26],[19,6,15,4],[19,12,15,10,"userIdNum"],[19,21,15,19],[19,24,15,22,"Number"],[19,30,15,28],[19,31,15,29,"user"],[19,35,15,33],[19,37,15,35,"id"],[19,39,15,37],[19,40,15,38],[20,6,16,4],[20,10,16,8],[20,11,16,9,"Number"],[20,17,16,15],[20,18,16,16,"isFinite"],[20,26,16,24],[20,27,16,25,"userIdNum"],[20,36,16,34],[20,37,16,35],[20,39,16,37],[21,6,17,4],[21,10,17,8,"loading"],[21,17,17,15],[21,19,17,17],[22,6,19,4],[22,12,19,10,"candidates"],[22,22,19,20],[22,25,19,23],[22,26,19,24,"Array"],[22,31,19,29],[22,32,19,30,"isArray"],[22,39,19,37],[22,40,19,38,"preChatRows"],[22,51,19,49],[22,52,19,50],[22,55,19,53,"preChatRows"],[22,66,19,64],[22,69,19,67],[22,71,19,69],[22,73,20,7,"filter"],[22,79,20,13],[22,80,20,15,"m"],[22,81,20,16],[22,85,20,21,"String"],[22,91,20,27],[22,92,20,28,"m"],[22,93,20,29],[22,95,20,31,"prechat_role"],[22,107,20,43],[22,108,20,44],[22,113,20,49],[22,123,20,59],[22,124,20,60],[22,125,21,7,"filter"],[22,131,21,13],[22,132,21,15,"m"],[22,133,21,16],[22,137,21,21],[22,138,21,22,"m"],[22,139,21,23],[22,141,21,25,"decision_expires_at"],[22,160,21,44],[22,161,21,45],[22,162,22,7,"filter"],[22,168,22,13],[22,169,22,15,"m"],[22,170,22,16],[22,174,22,21],[22,175,22,22,"m"],[22,176,22,23],[22,178,22,25,"terminal_state"],[22,192,22,39],[22,193,22,40],[22,194,23,7,"slice"],[22,199,23,12],[22,200,23,13],[22,201,23,14],[22,203,23,16],[22,204,23,17],[22,205,23,18],[23,6,25,4],[23,12,25,10,"toStart"],[23,19,25,17],[23,22,25,20,"candidates"],[23,32,25,30],[23,33,25,31,"filter"],[23,39,25,37],[23,40,25,39,"m"],[23,41,25,40],[23,45,25,45],[24,8,26,6],[24,14,26,12,"idStr"],[24,19,26,17],[24,22,26,20,"m"],[24,23,26,21],[24,25,26,23,"match_id"],[24,33,26,31],[24,37,26,35],[24,41,26,39],[24,44,26,42,"String"],[24,50,26,48],[24,51,26,49,"m"],[24,52,26,50],[24,53,26,51,"match_id"],[24,61,26,59],[24,62,26,60],[24,65,26,63],[24,67,26,65],[25,8,27,6],[25,12,27,10],[25,13,27,11,"idStr"],[25,18,27,16],[25,20,27,18],[25,27,27,25],[25,32,27,30],[26,8,28,6],[26,12,28,10,"startedDecisionTimersRef"],[26,36,28,34],[26,37,28,35,"current"],[26,44,28,42],[26,45,28,43,"has"],[26,48,28,46],[26,49,28,47,"idStr"],[26,54,28,52],[26,55,28,53],[26,57,28,55],[26,64,28,62],[26,69,28,67],[27,8,29,6],[27,15,29,13],[27,19,29,17],[28,6,30,4],[28,7,30,5],[28,8,30,6],[29,6,32,4],[29,10,32,8,"toStart"],[29,17,32,15],[29,18,32,16,"length"],[29,24,32,22],[29,29,32,27],[29,30,32,28],[29,32,32,30],[30,6,34,4,"toStart"],[30,13,34,11],[30,14,34,12,"forEach"],[30,21,34,19],[30,22,34,21,"m"],[30,23,34,22],[30,27,34,27],[31,8,35,6],[31,14,35,12,"idStr"],[31,19,35,17],[31,22,35,20,"String"],[31,28,35,26],[31,29,35,27,"m"],[31,30,35,28],[31,31,35,29,"match_id"],[31,39,35,37],[31,40,35,38],[32,8,36,6,"startedDecisionTimersRef"],[32,32,36,30],[32,33,36,31,"current"],[32,40,36,38],[32,41,36,39,"add"],[32,44,36,42],[32,45,36,43,"idStr"],[32,50,36,48],[32,51,36,49],[33,6,37,4],[33,7,37,5],[33,8,37,6],[34,6,39,4],[34,10,39,8,"cancelled"],[34,19,39,17],[34,22,39,20],[34,27,39,25],[35,6,41,4],[35,12,41,10,"run"],[35,15,41,13],[35,18,41,16],[35,24,41,16,"run"],[35,25,41,16],[35,30,41,28],[36,8,42,6],[36,12,42,10],[37,10,43,8],[37,16,43,14,"results"],[37,23,43,21],[37,26,43,24],[37,32,43,30,"Promise"],[37,39,43,37],[37,40,43,38,"all"],[37,43,43,41],[37,44,44,10,"toStart"],[37,51,44,17],[37,52,44,18,"map"],[37,55,44,21],[37,56,44,22],[37,62,44,29,"m"],[37,63,44,30],[37,67,44,35],[38,12,45,12],[38,18,45,18,"matchIdStr"],[38,28,45,28],[38,31,45,31,"String"],[38,37,45,37],[38,38,45,38,"m"],[38,39,45,39],[38,40,45,40,"match_id"],[38,48,45,48],[38,49,45,49],[39,12,46,12],[39,18,46,18,"resp"],[39,22,46,22],[39,25,46,25],[39,31,46,31,"fetch"],[39,36,46,36],[39,37,47,14],[39,72,47,49,"encodeURIComponent"],[39,90,47,67],[39,91,47,68,"matchIdStr"],[39,101,47,78],[39,102,47,79],[39,104,47,81],[39,106,48,14],[40,14,49,16,"method"],[40,20,49,22],[40,22,49,24],[40,28,49,30],[41,14,50,16,"headers"],[41,21,50,23],[41,23,50,25],[42,16,50,27],[42,30,50,41],[42,32,50,43],[43,14,50,62],[43,15,50,63],[44,14,51,16,"body"],[44,18,51,20],[44,20,51,22,"JSON"],[44,24,51,26],[44,25,51,27,"stringify"],[44,34,51,36],[44,35,51,37],[45,16,51,39,"userId"],[45,22,51,45],[45,24,51,47,"userIdNum"],[46,14,51,57],[46,15,51,58],[47,12,52,14],[47,13,53,12],[47,14,53,13],[48,12,55,12],[48,16,55,16],[48,17,55,17,"resp"],[48,21,55,21],[48,22,55,22,"ok"],[48,24,55,24],[48,26,55,26],[49,14,56,14],[49,20,56,20,"text"],[49,24,56,24],[49,27,56,27],[49,33,56,33,"resp"],[49,37,56,37],[49,38,56,38,"text"],[49,42,56,42],[49,43,56,43],[49,44,56,44],[49,45,56,45,"catch"],[49,50,56,50],[49,51,56,51],[49,57,56,57],[49,59,56,59],[49,60,56,60],[50,14,57,14],[50,20,57,20],[50,24,57,24,"Error"],[50,29,57,29],[50,30,58,16],[50,78,58,64,"matchIdStr"],[50,88,58,74],[50,111,58,97,"resp"],[50,115,58,101],[50,116,58,102,"status"],[50,122,58,108],[50,127,58,113,"resp"],[50,131,58,117],[50,132,58,118,"statusText"],[50,142,58,128],[50,147,58,133,"text"],[50,151,58,137],[50,153,59,14],[50,154,59,15],[51,12,60,12],[52,12,62,12],[52,18,62,18,"data"],[52,22,62,22],[52,25,62,25],[52,31,62,31,"resp"],[52,35,62,35],[52,36,62,36,"json"],[52,40,62,40],[52,41,62,41],[52,42,62,42],[52,43,62,43,"catch"],[52,48,62,48],[52,49,62,49],[52,56,62,56],[52,57,62,57],[52,58,62,58],[52,59,62,59],[52,60,62,60],[53,12,63,12],[53,19,63,19,"Boolean"],[53,26,63,26],[53,27,63,27,"data"],[53,31,63,31],[53,33,63,33,"started"],[53,40,63,40],[53,41,63,41],[54,10,64,10],[54,11,64,11],[54,12,65,8],[54,13,65,9],[55,10,67,8],[55,16,67,14,"startedAny"],[55,26,67,24],[55,29,67,27,"results"],[55,36,67,34],[55,37,67,35,"some"],[55,41,67,39],[55,42,67,40,"Boolean"],[55,49,67,47],[55,50,67,48],[56,10,68,8],[56,14,68,12],[56,15,68,13,"cancelled"],[56,24,68,22],[56,28,68,26,"startedAny"],[56,38,68,36],[56,40,68,38],[57,12,69,10],[57,18,69,16,"loadMatches"],[57,29,69,27],[57,30,69,28,"userIdNum"],[57,39,69,37],[57,40,69,38],[58,10,70,8],[59,8,71,6],[59,9,71,7],[59,10,71,8],[59,17,71,15,"e"],[59,18,71,16],[59,20,71,18],[60,10,72,8,"console"],[60,17,72,15],[60,18,72,16,"error"],[60,23,72,21],[60,24,72,22,"e"],[60,25,72,23],[60,26,72,24],[61,8,73,6],[62,6,74,4],[62,7,74,5],[63,6,76,4,"run"],[63,9,76,7],[63,10,76,8],[63,11,76,9],[64,6,78,4],[64,13,78,11],[64,19,78,17],[65,8,79,6,"cancelled"],[65,17,79,15],[65,20,79,18],[65,24,79,22],[66,6,80,4],[66,7,80,5],[67,4,81,2],[67,5,81,3],[67,7,81,5],[67,8,81,6,"loading"],[67,15,81,13],[67,17,81,15,"loadMatches"],[67,28,81,26],[67,30,81,28,"otherChatsHidden"],[67,46,81,44],[67,48,81,46,"preChatRows"],[67,59,81,57],[67,61,81,59,"user"],[67,65,81,63],[67,67,81,65,"id"],[67,69,81,67],[67,70,81,68],[67,71,81,69],[68,2,82,0],[69,0,82,1],[69,3]],"functionMap":{"names":["<global>","usePreChatDecisionTimers","useEffect$argument_0","filter$argument_0","filter.filter$argument_0","filter.filter.filter$argument_0","candidates.filter$argument_0","toStart.forEach$argument_0","run","toStart.map$argument_0","resp.text._catch$argument_0","resp.json._catch$argument_0","<anonymous>"],"mappings":"AAA;OCE;YCS;cCQ,6CD;cEC,8BF;cGC,yBH;sCIG;KJK;oBKI;KLG;gBMI;sBCG;mDCY,QD;iDEM,UF;WDE;KNU;WUI;KVE;GDC;CDC"},"hasCjsExports":false},"type":"js/module"}]}