{"dependencies":[{"name":"../language/kinds.mjs","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":45,"index":45}}],"key":"DYuiImaor5NJsXEIc7+6lq9coRI=","exportNames":["*"],"imports":1}},{"name":"../language/visitor.mjs","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":46},"end":{"line":2,"column":48,"index":94}}],"key":"SEnlLumLZ6vesKpdr4QUTE3uPwg=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.separateOperations = separateOperations;\n  var _languageKindsMjs = require(_dependencyMap[0]);\n  var _languageVisitorMjs = require(_dependencyMap[1]);\n  /**\n   * separateOperations accepts a single AST document which may contain many\n   * operations and fragments and returns a collection of AST documents each of\n   * which contains a single operation as well the fragment definitions it\n   * refers to.\n   */\n\n  function separateOperations(documentAST) {\n    var operations = [];\n    var depGraph = Object.create(null); // Populate metadata and build a dependency graph.\n\n    for (var definitionNode of documentAST.definitions) {\n      switch (definitionNode.kind) {\n        case _languageKindsMjs.Kind.OPERATION_DEFINITION:\n          operations.push(definitionNode);\n          break;\n        case _languageKindsMjs.Kind.FRAGMENT_DEFINITION:\n          depGraph[definitionNode.name.value] = collectDependencies(definitionNode.selectionSet);\n          break;\n        default: // ignore non-executable definitions\n      }\n    } // For each operation, produce a new synthesized AST which includes only what\n    // is necessary for completing that operation.\n\n    var separatedDocumentASTs = Object.create(null);\n    var _loop = function (operation) {\n      var dependencies = new Set();\n      for (var fragmentName of collectDependencies(operation.selectionSet)) {\n        collectTransitiveDependencies(dependencies, depGraph, fragmentName);\n      } // Provides the empty string for anonymous operations.\n\n      var operationName = operation.name ? operation.name.value : ''; // The list of definition nodes to be included for this operation, sorted\n      // to retain the same order as the original document.\n\n      separatedDocumentASTs[operationName] = {\n        kind: _languageKindsMjs.Kind.DOCUMENT,\n        definitions: documentAST.definitions.filter(node => node === operation || node.kind === _languageKindsMjs.Kind.FRAGMENT_DEFINITION && dependencies.has(node.name.value))\n      };\n    };\n    for (var operation of operations) {\n      _loop(operation);\n    }\n    return separatedDocumentASTs;\n  }\n\n  // From a dependency graph, collects a list of transitive dependencies by\n  // recursing through a dependency graph.\n  function collectTransitiveDependencies(collected, depGraph, fromName) {\n    if (!collected.has(fromName)) {\n      collected.add(fromName);\n      var immediateDeps = depGraph[fromName];\n      if (immediateDeps !== undefined) {\n        for (var toName of immediateDeps) {\n          collectTransitiveDependencies(collected, depGraph, toName);\n        }\n      }\n    }\n  }\n  function collectDependencies(selectionSet) {\n    var dependencies = [];\n    (0, _languageVisitorMjs.visit)(selectionSet, {\n      FragmentSpread(node) {\n        dependencies.push(node.name.value);\n      }\n    });\n    return dependencies;\n  }\n});","lineCount":77,"map":[[7,2,10,0,"exports"],[7,9,10,0],[7,10,10,0,"separateOperations"],[7,28,10,0],[7,31,10,0,"separateOperations"],[7,49,10,0],[8,2,1,0],[8,6,1,0,"_languageKindsMjs"],[8,23,1,0],[8,26,1,0,"require"],[8,33,1,0],[8,34,1,0,"_dependencyMap"],[8,48,1,0],[9,2,2,0],[9,6,2,0,"_languageVisitorMjs"],[9,25,2,0],[9,28,2,0,"require"],[9,35,2,0],[9,36,2,0,"_dependencyMap"],[9,50,2,0],[10,2,3,0],[11,0,4,0],[12,0,5,0],[13,0,6,0],[14,0,7,0],[15,0,8,0],[17,2,10,7],[17,11,10,16,"separateOperations"],[17,29,10,34,"separateOperations"],[17,30,10,35,"documentAST"],[17,41,10,46],[17,43,10,48],[18,4,11,2],[18,8,11,8,"operations"],[18,18,11,18],[18,21,11,21],[18,23,11,23],[19,4,12,2],[19,8,12,8,"depGraph"],[19,16,12,16],[19,19,12,19,"Object"],[19,25,12,25],[19,26,12,26,"create"],[19,32,12,32],[19,33,12,33],[19,37,12,37],[19,38,12,38],[19,39,12,39],[19,40,12,40],[21,4,14,2],[21,9,14,7],[21,13,14,13,"definitionNode"],[21,27,14,27],[21,31,14,31,"documentAST"],[21,42,14,42],[21,43,14,43,"definitions"],[21,54,14,54],[21,56,14,56],[22,6,15,4],[22,14,15,12,"definitionNode"],[22,28,15,26],[22,29,15,27,"kind"],[22,33,15,31],[23,8,16,6],[23,13,16,11,"Kind"],[23,30,16,15],[23,31,16,15,"Kind"],[23,35,16,15],[23,36,16,16,"OPERATION_DEFINITION"],[23,56,16,36],[24,10,17,8,"operations"],[24,20,17,18],[24,21,17,19,"push"],[24,25,17,23],[24,26,17,24,"definitionNode"],[24,40,17,38],[24,41,17,39],[25,10,18,8],[26,8,20,6],[26,13,20,11,"Kind"],[26,30,20,15],[26,31,20,15,"Kind"],[26,35,20,15],[26,36,20,16,"FRAGMENT_DEFINITION"],[26,55,20,35],[27,10,21,8,"depGraph"],[27,18,21,16],[27,19,21,17,"definitionNode"],[27,33,21,31],[27,34,21,32,"name"],[27,38,21,36],[27,39,21,37,"value"],[27,44,21,42],[27,45,21,43],[27,48,21,46,"collectDependencies"],[27,67,21,65],[27,68,22,10,"definitionNode"],[27,82,22,24],[27,83,22,25,"selectionSet"],[27,95,23,8],[27,96,23,9],[28,10,24,8],[29,8,26,6],[29,16,26,14],[29,17,26,15],[30,6,27,4],[31,4,28,2],[31,5,28,3],[31,6,28,4],[32,4,29,2],[34,4,31,2],[34,8,31,8,"separatedDocumentASTs"],[34,29,31,29],[34,32,31,32,"Object"],[34,38,31,38],[34,39,31,39,"create"],[34,45,31,45],[34,46,31,46],[34,50,31,50],[34,51,31,51],[35,4,31,52],[35,8,31,52,"_loop"],[35,13,31,52],[35,25,31,52,"_loop"],[35,26,31,52,"operation"],[35,35,31,52],[35,37,33,38],[36,6,34,4],[36,10,34,10,"dependencies"],[36,22,34,22],[36,25,34,25],[36,29,34,29,"Set"],[36,32,34,32],[36,33,34,33],[36,34,34,34],[37,6,36,4],[37,11,36,9],[37,15,36,15,"fragmentName"],[37,27,36,27],[37,31,36,31,"collectDependencies"],[37,50,36,50],[37,51,36,51,"operation"],[37,60,36,60],[37,61,36,61,"selectionSet"],[37,73,36,73],[37,74,36,74],[37,76,36,76],[38,8,37,6,"collectTransitiveDependencies"],[38,37,37,35],[38,38,37,36,"dependencies"],[38,50,37,48],[38,52,37,50,"depGraph"],[38,60,37,58],[38,62,37,60,"fragmentName"],[38,74,37,72],[38,75,37,73],[39,6,38,4],[39,7,38,5],[39,8,38,6],[41,6,40,4],[41,10,40,10,"operationName"],[41,23,40,23],[41,26,40,26,"operation"],[41,35,40,35],[41,36,40,36,"name"],[41,40,40,40],[41,43,40,43,"operation"],[41,52,40,52],[41,53,40,53,"name"],[41,57,40,57],[41,58,40,58,"value"],[41,63,40,63],[41,66,40,66],[41,68,40,68],[41,69,40,69],[41,70,40,70],[42,6,41,4],[44,6,43,4,"separatedDocumentASTs"],[44,27,43,25],[44,28,43,26,"operationName"],[44,41,43,39],[44,42,43,40],[44,45,43,43],[45,8,44,6,"kind"],[45,12,44,10],[45,14,44,12,"Kind"],[45,31,44,16],[45,32,44,16,"Kind"],[45,36,44,16],[45,37,44,17,"DOCUMENT"],[45,45,44,25],[46,8,45,6,"definitions"],[46,19,45,17],[46,21,45,19,"documentAST"],[46,32,45,30],[46,33,45,31,"definitions"],[46,44,45,42],[46,45,45,43,"filter"],[46,51,45,49],[46,52,46,9,"node"],[46,56,46,13],[46,60,47,10,"node"],[46,64,47,14],[46,69,47,19,"operation"],[46,78,47,28],[46,82,48,11,"node"],[46,86,48,15],[46,87,48,16,"kind"],[46,91,48,20],[46,96,48,25,"Kind"],[46,113,48,29],[46,114,48,29,"Kind"],[46,118,48,29],[46,119,48,30,"FRAGMENT_DEFINITION"],[46,138,48,49],[46,142,49,12,"dependencies"],[46,154,49,24],[46,155,49,25,"has"],[46,158,49,28],[46,159,49,29,"node"],[46,163,49,33],[46,164,49,34,"name"],[46,168,49,38],[46,169,49,39,"value"],[46,174,49,44],[46,175,50,6],[47,6,51,4],[47,7,51,5],[48,4,52,2],[48,5,52,3],[49,4,33,2],[49,9,33,7],[49,13,33,13,"operation"],[49,22,33,22],[49,26,33,26,"operations"],[49,36,33,36],[50,6,33,36,"_loop"],[50,11,33,36],[50,12,33,36,"operation"],[50,21,33,36],[51,4,33,36],[52,4,54,2],[52,11,54,9,"separatedDocumentASTs"],[52,32,54,30],[53,2,55,0],[55,2,57,0],[56,2,58,0],[57,2,59,0],[57,11,59,9,"collectTransitiveDependencies"],[57,40,59,38,"collectTransitiveDependencies"],[57,41,59,39,"collected"],[57,50,59,48],[57,52,59,50,"depGraph"],[57,60,59,58],[57,62,59,60,"fromName"],[57,70,59,68],[57,72,59,70],[58,4,60,2],[58,8,60,6],[58,9,60,7,"collected"],[58,18,60,16],[58,19,60,17,"has"],[58,22,60,20],[58,23,60,21,"fromName"],[58,31,60,29],[58,32,60,30],[58,34,60,32],[59,6,61,4,"collected"],[59,15,61,13],[59,16,61,14,"add"],[59,19,61,17],[59,20,61,18,"fromName"],[59,28,61,26],[59,29,61,27],[60,6,62,4],[60,10,62,10,"immediateDeps"],[60,23,62,23],[60,26,62,26,"depGraph"],[60,34,62,34],[60,35,62,35,"fromName"],[60,43,62,43],[60,44,62,44],[61,6,64,4],[61,10,64,8,"immediateDeps"],[61,23,64,21],[61,28,64,26,"undefined"],[61,37,64,35],[61,39,64,37],[62,8,65,6],[62,13,65,11],[62,17,65,17,"toName"],[62,23,65,23],[62,27,65,27,"immediateDeps"],[62,40,65,40],[62,42,65,42],[63,10,66,8,"collectTransitiveDependencies"],[63,39,66,37],[63,40,66,38,"collected"],[63,49,66,47],[63,51,66,49,"depGraph"],[63,59,66,57],[63,61,66,59,"toName"],[63,67,66,65],[63,68,66,66],[64,8,67,6],[65,6,68,4],[66,4,69,2],[67,2,70,0],[68,2,72,0],[68,11,72,9,"collectDependencies"],[68,30,72,28,"collectDependencies"],[68,31,72,29,"selectionSet"],[68,43,72,41],[68,45,72,43],[69,4,73,2],[69,8,73,8,"dependencies"],[69,20,73,20],[69,23,73,23],[69,25,73,25],[70,4,74,2],[70,8,74,2,"visit"],[70,27,74,7],[70,28,74,7,"visit"],[70,33,74,7],[70,35,74,8,"selectionSet"],[70,47,74,20],[70,49,74,22],[71,6,75,4,"FragmentSpread"],[71,20,75,18,"FragmentSpread"],[71,21,75,19,"node"],[71,25,75,23],[71,27,75,25],[72,8,76,6,"dependencies"],[72,20,76,18],[72,21,76,19,"push"],[72,25,76,23],[72,26,76,24,"node"],[72,30,76,28],[72,31,76,29,"name"],[72,35,76,33],[72,36,76,34,"value"],[72,41,76,39],[72,42,76,40],[73,6,77,4],[74,4,78,2],[74,5,78,3],[74,6,78,4],[75,4,79,2],[75,11,79,9,"dependencies"],[75,23,79,21],[76,2,80,0],[77,0,80,1],[77,3]],"functionMap":{"names":["<global>","separateOperations","documentAST.definitions.filter$argument_0","collectTransitiveDependencies","collectDependencies","visit$argument_1.FragmentSpread"],"mappings":"AAA;OCS;QCoC;8CDG;CDM;AGI;CHW;AIE;ICG;KDE;CJG"},"hasCjsExports":false},"type":"js/module"}]}