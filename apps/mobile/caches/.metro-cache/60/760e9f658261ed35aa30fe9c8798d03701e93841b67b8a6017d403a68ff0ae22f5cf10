{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":42,"index":42}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.usePreChatDecisionTimers = usePreChatDecisionTimers;\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _react = require(_dependencyMap[1], \"react\");\n  function usePreChatDecisionTimers(_ref) {\n    _s();\n    var user = _ref.user,\n      preChatRows = _ref.preChatRows,\n      loading = _ref.loading,\n      otherChatsHidden = _ref.otherChatsHidden,\n      loadMatches = _ref.loadMatches;\n    var startedDecisionTimersRef = (0, _react.useRef)(new Set());\n    (0, _react.useEffect)(() => {\n      if (otherChatsHidden) return;\n      var userIdNum = Number(user?.id);\n      if (!Number.isFinite(userIdNum)) return;\n      if (loading) return;\n      var candidates = (Array.isArray(preChatRows) ? preChatRows : []).filter(m => String(m?.prechat_role) === \"receiver\").filter(m => !m?.decision_expires_at).filter(m => !m?.terminal_state).slice(0, 6);\n      var toStart = candidates.filter(m => {\n        var idStr = m?.match_id != null ? String(m.match_id) : \"\";\n        if (!idStr) return false;\n        if (startedDecisionTimersRef.current.has(idStr)) return false;\n        return true;\n      });\n      if (toStart.length === 0) return;\n      toStart.forEach(m => {\n        var idStr = String(m.match_id);\n        startedDecisionTimersRef.current.add(idStr);\n      });\n      var cancelled = false;\n      var run = /*#__PURE__*/function () {\n        var _ref2 = (0, _asyncToGenerator.default)(function* () {\n          try {\n            var results = yield Promise.all(toStart.map(/*#__PURE__*/function () {\n              var _ref3 = (0, _asyncToGenerator.default)(function* (m) {\n                var matchIdStr = String(m.match_id);\n                var resp = yield fetch(`/api/conversations/prechat-seen/${encodeURIComponent(matchIdStr)}`, {\n                  method: \"POST\",\n                  headers: {\n                    \"Content-Type\": \"application/json\"\n                  },\n                  body: JSON.stringify({\n                    userId: userIdNum\n                  })\n                });\n                if (!resp.ok) {\n                  var text = yield resp.text().catch(() => \"\");\n                  throw new Error(`When posting /api/conversations/prechat-seen/${matchIdStr}, the response was [${resp.status}] ${resp.statusText}. ${text}`);\n                }\n                var data = yield resp.json().catch(() => ({}));\n                return Boolean(data?.started);\n              });\n              return function (_x) {\n                return _ref3.apply(this, arguments);\n              };\n            }()));\n            var startedAny = results.some(Boolean);\n            if (!cancelled && startedAny) {\n              yield loadMatches(userIdNum);\n            }\n          } catch (e) {\n            console.error(e);\n          }\n        });\n        return function run() {\n          return _ref2.apply(this, arguments);\n        };\n      }();\n      run();\n      return () => {\n        cancelled = true;\n      };\n    }, [loading, loadMatches, otherChatsHidden, preChatRows, user?.id]);\n  }\n  _s(usePreChatDecisionTimers, \"9UffgzQKEzd7mmYodndltzVYOJ0=\");\n});","lineCount":88,"map":[[13,2,3,0,"exports"],[13,9,3,0],[13,10,3,0,"usePreChatDecisionTimers"],[13,34,3,0],[13,37,3,0,"usePreChatDecisionTimers"],[13,61,3,0],[14,2,82,1],[14,6,82,1,"_babelRuntimeHelpersAsyncToGenerator"],[14,42,82,1],[14,45,82,1,"require"],[14,52,82,1],[14,53,82,1,"_dependencyMap"],[14,67,82,1],[15,2,82,1],[15,6,82,1,"_asyncToGenerator"],[15,23,82,1],[15,26,82,1,"_interopDefault"],[15,41,82,1],[15,42,82,1,"_babelRuntimeHelpersAsyncToGenerator"],[15,78,82,1],[16,2,1,0],[16,6,1,0,"_react"],[16,12,1,0],[16,15,1,0,"require"],[16,22,1,0],[16,23,1,0,"_dependencyMap"],[16,37,1,0],[17,2,3,7],[17,11,3,16,"usePreChatDecisionTimers"],[17,35,3,40,"usePreChatDecisionTimers"],[17,36,3,40,"_ref"],[17,40,3,40],[17,42,9,3],[18,4,9,3,"_s"],[18,6,9,3],[19,4,9,3],[19,8,4,2,"user"],[19,12,4,6],[19,15,4,6,"_ref"],[19,19,4,6],[19,20,4,2,"user"],[19,24,4,6],[20,6,5,2,"preChatRows"],[20,17,5,13],[20,20,5,13,"_ref"],[20,24,5,13],[20,25,5,2,"preChatRows"],[20,36,5,13],[21,6,6,2,"loading"],[21,13,6,9],[21,16,6,9,"_ref"],[21,20,6,9],[21,21,6,2,"loading"],[21,28,6,9],[22,6,7,2,"otherChatsHidden"],[22,22,7,18],[22,25,7,18,"_ref"],[22,29,7,18],[22,30,7,2,"otherChatsHidden"],[22,46,7,18],[23,6,8,2,"loadMatches"],[23,17,8,13],[23,20,8,13,"_ref"],[23,24,8,13],[23,25,8,2,"loadMatches"],[23,36,8,13],[24,4,10,2],[24,8,10,8,"startedDecisionTimersRef"],[24,32,10,32],[24,35,10,35],[24,39,10,35,"useRef"],[24,45,10,41],[24,46,10,41,"useRef"],[24,52,10,41],[24,54,10,42],[24,58,10,46,"Set"],[24,61,10,49],[24,62,10,50],[24,63,10,51],[24,64,10,52],[25,4,12,2],[25,8,12,2,"useEffect"],[25,14,12,11],[25,15,12,11,"useEffect"],[25,24,12,11],[25,26,12,12],[25,32,12,18],[26,6,13,4],[26,10,13,8,"otherChatsHidden"],[26,26,13,24],[26,28,13,26],[27,6,15,4],[27,10,15,10,"userIdNum"],[27,19,15,19],[27,22,15,22,"Number"],[27,28,15,28],[27,29,15,29,"user"],[27,33,15,33],[27,35,15,35,"id"],[27,37,15,37],[27,38,15,38],[28,6,16,4],[28,10,16,8],[28,11,16,9,"Number"],[28,17,16,15],[28,18,16,16,"isFinite"],[28,26,16,24],[28,27,16,25,"userIdNum"],[28,36,16,34],[28,37,16,35],[28,39,16,37],[29,6,17,4],[29,10,17,8,"loading"],[29,17,17,15],[29,19,17,17],[30,6,19,4],[30,10,19,10,"candidates"],[30,20,19,20],[30,23,19,23],[30,24,19,24,"Array"],[30,29,19,29],[30,30,19,30,"isArray"],[30,37,19,37],[30,38,19,38,"preChatRows"],[30,49,19,49],[30,50,19,50],[30,53,19,53,"preChatRows"],[30,64,19,64],[30,67,19,67],[30,69,19,69],[30,71,20,7,"filter"],[30,77,20,13],[30,78,20,15,"m"],[30,79,20,16],[30,83,20,21,"String"],[30,89,20,27],[30,90,20,28,"m"],[30,91,20,29],[30,93,20,31,"prechat_role"],[30,105,20,43],[30,106,20,44],[30,111,20,49],[30,121,20,59],[30,122,20,60],[30,123,21,7,"filter"],[30,129,21,13],[30,130,21,15,"m"],[30,131,21,16],[30,135,21,21],[30,136,21,22,"m"],[30,137,21,23],[30,139,21,25,"decision_expires_at"],[30,158,21,44],[30,159,21,45],[30,160,22,7,"filter"],[30,166,22,13],[30,167,22,15,"m"],[30,168,22,16],[30,172,22,21],[30,173,22,22,"m"],[30,174,22,23],[30,176,22,25,"terminal_state"],[30,190,22,39],[30,191,22,40],[30,192,23,7,"slice"],[30,197,23,12],[30,198,23,13],[30,199,23,14],[30,201,23,16],[30,202,23,17],[30,203,23,18],[31,6,25,4],[31,10,25,10,"toStart"],[31,17,25,17],[31,20,25,20,"candidates"],[31,30,25,30],[31,31,25,31,"filter"],[31,37,25,37],[31,38,25,39,"m"],[31,39,25,40],[31,43,25,45],[32,8,26,6],[32,12,26,12,"idStr"],[32,17,26,17],[32,20,26,20,"m"],[32,21,26,21],[32,23,26,23,"match_id"],[32,31,26,31],[32,35,26,35],[32,39,26,39],[32,42,26,42,"String"],[32,48,26,48],[32,49,26,49,"m"],[32,50,26,50],[32,51,26,51,"match_id"],[32,59,26,59],[32,60,26,60],[32,63,26,63],[32,65,26,65],[33,8,27,6],[33,12,27,10],[33,13,27,11,"idStr"],[33,18,27,16],[33,20,27,18],[33,27,27,25],[33,32,27,30],[34,8,28,6],[34,12,28,10,"startedDecisionTimersRef"],[34,36,28,34],[34,37,28,35,"current"],[34,44,28,42],[34,45,28,43,"has"],[34,48,28,46],[34,49,28,47,"idStr"],[34,54,28,52],[34,55,28,53],[34,57,28,55],[34,64,28,62],[34,69,28,67],[35,8,29,6],[35,15,29,13],[35,19,29,17],[36,6,30,4],[36,7,30,5],[36,8,30,6],[37,6,32,4],[37,10,32,8,"toStart"],[37,17,32,15],[37,18,32,16,"length"],[37,24,32,22],[37,29,32,27],[37,30,32,28],[37,32,32,30],[38,6,34,4,"toStart"],[38,13,34,11],[38,14,34,12,"forEach"],[38,21,34,19],[38,22,34,21,"m"],[38,23,34,22],[38,27,34,27],[39,8,35,6],[39,12,35,12,"idStr"],[39,17,35,17],[39,20,35,20,"String"],[39,26,35,26],[39,27,35,27,"m"],[39,28,35,28],[39,29,35,29,"match_id"],[39,37,35,37],[39,38,35,38],[40,8,36,6,"startedDecisionTimersRef"],[40,32,36,30],[40,33,36,31,"current"],[40,40,36,38],[40,41,36,39,"add"],[40,44,36,42],[40,45,36,43,"idStr"],[40,50,36,48],[40,51,36,49],[41,6,37,4],[41,7,37,5],[41,8,37,6],[42,6,39,4],[42,10,39,8,"cancelled"],[42,19,39,17],[42,22,39,20],[42,27,39,25],[43,6,41,4],[43,10,41,10,"run"],[43,13,41,13],[44,8,41,13],[44,12,41,13,"_ref2"],[44,17,41,13],[44,24,41,13,"_asyncToGenerator"],[44,41,41,13],[44,42,41,13,"default"],[44,49,41,13],[44,51,41,16],[44,64,41,28],[45,10,42,6],[45,14,42,10],[46,12,43,8],[46,16,43,14,"results"],[46,23,43,21],[46,32,43,30,"Promise"],[46,39,43,37],[46,40,43,38,"all"],[46,43,43,41],[46,44,44,10,"toStart"],[46,51,44,17],[46,52,44,18,"map"],[46,55,44,21],[47,14,44,21],[47,18,44,21,"_ref3"],[47,23,44,21],[47,30,44,21,"_asyncToGenerator"],[47,47,44,21],[47,48,44,21,"default"],[47,55,44,21],[47,57,44,22],[47,68,44,29,"m"],[47,69,44,30],[47,71,44,35],[48,16,45,12],[48,20,45,18,"matchIdStr"],[48,30,45,28],[48,33,45,31,"String"],[48,39,45,37],[48,40,45,38,"m"],[48,41,45,39],[48,42,45,40,"match_id"],[48,50,45,48],[48,51,45,49],[49,16,46,12],[49,20,46,18,"resp"],[49,24,46,22],[49,33,46,31,"fetch"],[49,38,46,36],[49,39,47,14],[49,74,47,49,"encodeURIComponent"],[49,92,47,67],[49,93,47,68,"matchIdStr"],[49,103,47,78],[49,104,47,79],[49,106,47,81],[49,108,48,14],[50,18,49,16,"method"],[50,24,49,22],[50,26,49,24],[50,32,49,30],[51,18,50,16,"headers"],[51,25,50,23],[51,27,50,25],[52,20,50,27],[52,34,50,41],[52,36,50,43],[53,18,50,62],[53,19,50,63],[54,18,51,16,"body"],[54,22,51,20],[54,24,51,22,"JSON"],[54,28,51,26],[54,29,51,27,"stringify"],[54,38,51,36],[54,39,51,37],[55,20,51,39,"userId"],[55,26,51,45],[55,28,51,47,"userIdNum"],[56,18,51,57],[56,19,51,58],[57,16,52,14],[57,17,53,12],[57,18,53,13],[58,16,55,12],[58,20,55,16],[58,21,55,17,"resp"],[58,25,55,21],[58,26,55,22,"ok"],[58,28,55,24],[58,30,55,26],[59,18,56,14],[59,22,56,20,"text"],[59,26,56,24],[59,35,56,33,"resp"],[59,39,56,37],[59,40,56,38,"text"],[59,44,56,42],[59,45,56,43],[59,46,56,44],[59,47,56,45,"catch"],[59,52,56,50],[59,53,56,51],[59,59,56,57],[59,61,56,59],[59,62,56,60],[60,18,57,14],[60,24,57,20],[60,28,57,24,"Error"],[60,33,57,29],[60,34,58,16],[60,82,58,64,"matchIdStr"],[60,92,58,74],[60,115,58,97,"resp"],[60,119,58,101],[60,120,58,102,"status"],[60,126,58,108],[60,131,58,113,"resp"],[60,135,58,117],[60,136,58,118,"statusText"],[60,146,58,128],[60,151,58,133,"text"],[60,155,58,137],[60,157,59,14],[60,158,59,15],[61,16,60,12],[62,16,62,12],[62,20,62,18,"data"],[62,24,62,22],[62,33,62,31,"resp"],[62,37,62,35],[62,38,62,36,"json"],[62,42,62,40],[62,43,62,41],[62,44,62,42],[62,45,62,43,"catch"],[62,50,62,48],[62,51,62,49],[62,58,62,56],[62,59,62,57],[62,60,62,58],[62,61,62,59],[62,62,62,60],[63,16,63,12],[63,23,63,19,"Boolean"],[63,30,63,26],[63,31,63,27,"data"],[63,35,63,31],[63,37,63,33,"started"],[63,44,63,40],[63,45,63,41],[64,14,64,10],[64,15,64,11],[65,14,64,11],[65,31,64,11,"_x"],[65,33,64,11],[66,16,64,11],[66,23,64,11,"_ref3"],[66,28,64,11],[66,29,64,11,"apply"],[66,34,64,11],[66,41,64,11,"arguments"],[66,50,64,11],[67,14,64,11],[68,12,64,11],[68,16,65,8],[68,17,65,9],[69,12,67,8],[69,16,67,14,"startedAny"],[69,26,67,24],[69,29,67,27,"results"],[69,36,67,34],[69,37,67,35,"some"],[69,41,67,39],[69,42,67,40,"Boolean"],[69,49,67,47],[69,50,67,48],[70,12,68,8],[70,16,68,12],[70,17,68,13,"cancelled"],[70,26,68,22],[70,30,68,26,"startedAny"],[70,40,68,36],[70,42,68,38],[71,14,69,10],[71,20,69,16,"loadMatches"],[71,31,69,27],[71,32,69,28,"userIdNum"],[71,41,69,37],[71,42,69,38],[72,12,70,8],[73,10,71,6],[73,11,71,7],[73,12,71,8],[73,19,71,15,"e"],[73,20,71,16],[73,22,71,18],[74,12,72,8,"console"],[74,19,72,15],[74,20,72,16,"error"],[74,25,72,21],[74,26,72,22,"e"],[74,27,72,23],[74,28,72,24],[75,10,73,6],[76,8,74,4],[76,9,74,5],[77,8,74,5],[77,24,41,10,"run"],[77,27,41,13,"run"],[77,28,41,13],[78,10,41,13],[78,17,41,13,"_ref2"],[78,22,41,13],[78,23,41,13,"apply"],[78,28,41,13],[78,35,41,13,"arguments"],[78,44,41,13],[79,8,41,13],[80,6,41,13],[80,9,74,5],[81,6,76,4,"run"],[81,9,76,7],[81,10,76,8],[81,11,76,9],[82,6,78,4],[82,13,78,11],[82,19,78,17],[83,8,79,6,"cancelled"],[83,17,79,15],[83,20,79,18],[83,24,79,22],[84,6,80,4],[84,7,80,5],[85,4,81,2],[85,5,81,3],[85,7,81,5],[85,8,81,6,"loading"],[85,15,81,13],[85,17,81,15,"loadMatches"],[85,28,81,26],[85,30,81,28,"otherChatsHidden"],[85,46,81,44],[85,48,81,46,"preChatRows"],[85,59,81,57],[85,61,81,59,"user"],[85,65,81,63],[85,67,81,65,"id"],[85,69,81,67],[85,70,81,68],[85,71,81,69],[86,2,82,0],[87,2,82,1,"_s"],[87,4,82,1],[87,5,3,16,"usePreChatDecisionTimers"],[87,29,3,40],[88,0,3,40],[88,3]],"functionMap":{"names":["<global>","usePreChatDecisionTimers","useEffect$argument_0","filter$argument_0","filter.filter$argument_0","filter.filter.filter$argument_0","candidates.filter$argument_0","toStart.forEach$argument_0","run","toStart.map$argument_0","resp.text._catch$argument_0","resp.json._catch$argument_0","<anonymous>"],"mappings":"AAA;OCE;YCS;cCQ,6CD;cEC,8BF;cGC,yBH;sCIG;KJK;oBKI;KLG;gBMI;sBCG;mDCY,QD;iDEM,UF;WDE;KNU;WUI;KVE;GDC;CDC"},"hasCjsExports":false},"type":"js/module"}]}