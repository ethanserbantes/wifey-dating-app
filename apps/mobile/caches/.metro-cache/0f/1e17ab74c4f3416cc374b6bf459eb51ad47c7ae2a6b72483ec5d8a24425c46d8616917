{"dependencies":[{"name":"./syncpromise.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":76,"index":76}}],"key":"r9D+KVM39qpXh7dXewX99qgTA/A=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"SENTRY_BUFFER_FULL_ERROR\", {\n    enumerable: true,\n    get: function () {\n      return SENTRY_BUFFER_FULL_ERROR;\n    }\n  });\n  Object.defineProperty(exports, \"makePromiseBuffer\", {\n    enumerable: true,\n    get: function () {\n      return makePromiseBuffer;\n    }\n  });\n  var _syncpromiseJs = require(_dependencyMap[0]);\n  var SENTRY_BUFFER_FULL_ERROR = Symbol.for('SentryBufferFullError');\n\n  /**\n   * Creates an new PromiseBuffer object with the specified limit\n   * @param limit max number of promises that can be stored in the buffer\n   */\n  function makePromiseBuffer() {\n    var limit = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 100;\n    var buffer = new Set();\n    function isReady() {\n      return buffer.size < limit;\n    }\n\n    /**\n     * Remove a promise from the queue.\n     *\n     * @param task Can be any PromiseLike<T>\n     * @returns Removed promise.\n     */\n    function remove(task) {\n      buffer.delete(task);\n    }\n\n    /**\n     * Add a promise (representing an in-flight action) to the queue, and set it to remove itself on fulfillment.\n     *\n     * @param taskProducer A function producing any PromiseLike<T>; In previous versions this used to be `task:\n     *        PromiseLike<T>`, but under that model, Promises were instantly created on the call-site and their executor\n     *        functions therefore ran immediately. Thus, even if the buffer was full, the action still happened. By\n     *        requiring the promise to be wrapped in a function, we can defer promise creation until after the buffer\n     *        limit check.\n     * @returns The original promise.\n     */\n    function add(taskProducer) {\n      if (!isReady()) {\n        return (0, _syncpromiseJs.rejectedSyncPromise)(SENTRY_BUFFER_FULL_ERROR);\n      }\n\n      // start the task and add its promise to the queue\n      var task = taskProducer();\n      buffer.add(task);\n      void task.then(() => remove(task), () => remove(task));\n      return task;\n    }\n\n    /**\n     * Wait for all promises in the queue to resolve or for timeout to expire, whichever comes first.\n     *\n     * @param timeout The time, in ms, after which to resolve to `false` if the queue is still non-empty. Passing `0` (or\n     * not passing anything) will make the promise wait as long as it takes for the queue to drain before resolving to\n     * `true`.\n     * @returns A promise which will resolve to `true` if the queue is already empty or drains before the timeout, and\n     * `false` otherwise\n     */\n    function drain(timeout) {\n      if (!buffer.size) {\n        return (0, _syncpromiseJs.resolvedSyncPromise)(true);\n      }\n\n      // We want to resolve even if one of the promises rejects\n      var drainPromise = Promise.allSettled(Array.from(buffer)).then(() => true);\n      if (!timeout) {\n        return drainPromise;\n      }\n      var promises = [drainPromise, new Promise(resolve => setTimeout(() => resolve(false), timeout))];\n\n      // Promise.race will resolve to the first promise that resolves or rejects\n      // So if the drainPromise resolves, the timeout promise will be ignored\n      return Promise.race(promises);\n    }\n    return {\n      get $() {\n        return Array.from(buffer);\n      },\n      add,\n      drain\n    };\n  }\n});","lineCount":98,"map":[[7,2,88,0,"Object"],[7,8,88,0],[7,9,88,0,"defineProperty"],[7,23,88,0],[7,24,88,0,"exports"],[7,31,88,0],[8,4,88,0,"enumerable"],[8,14,88,0],[9,4,88,0,"get"],[9,7,88,0],[9,18,88,0,"get"],[9,19,88,0],[10,6,88,0],[10,13,88,9,"SENTRY_BUFFER_FULL_ERROR"],[10,37,88,33],[11,4,88,33],[12,2,88,33],[13,2,88,0,"Object"],[13,8,88,0],[13,9,88,0,"defineProperty"],[13,23,88,0],[13,24,88,0,"exports"],[13,31,88,0],[14,4,88,0,"enumerable"],[14,14,88,0],[15,4,88,0,"get"],[15,7,88,0],[15,18,88,0,"get"],[15,19,88,0],[16,6,88,0],[16,13,88,35,"makePromiseBuffer"],[16,30,88,52],[17,4,88,52],[18,2,88,52],[19,2,1,0],[19,6,1,0,"_syncpromiseJs"],[19,20,1,0],[19,23,1,0,"require"],[19,30,1,0],[19,31,1,0,"_dependencyMap"],[19,45,1,0],[20,2,3,0],[20,6,3,6,"SENTRY_BUFFER_FULL_ERROR"],[20,30,3,30],[20,33,3,33,"Symbol"],[20,39,3,39],[20,40,3,40,"for"],[20,43,3,43],[20,44,3,44],[20,67,3,67],[20,68,3,68],[22,2,5,0],[23,0,6,0],[24,0,7,0],[25,0,8,0],[26,2,9,0],[26,11,9,9,"makePromiseBuffer"],[26,28,9,26,"makePromiseBuffer"],[26,29,9,26],[26,31,9,40],[27,4,9,40],[27,8,9,27,"limit"],[27,13,9,32],[27,16,9,32,"arguments"],[27,25,9,32],[27,26,9,32,"length"],[27,32,9,32],[27,40,9,32,"arguments"],[27,49,9,32],[27,57,9,32,"undefined"],[27,66,9,32],[27,69,9,32,"arguments"],[27,78,9,32],[27,84,9,35],[27,87,9,38],[28,4,10,2],[28,8,10,8,"buffer"],[28,14,10,14],[28,17,10,17],[28,21,10,21,"Set"],[28,24,10,24],[28,25,10,25],[28,26,10,26],[29,4,12,2],[29,13,12,11,"isReady"],[29,20,12,18,"isReady"],[29,21,12,18],[29,23,12,21],[30,6,13,4],[30,13,13,11,"buffer"],[30,19,13,17],[30,20,13,18,"size"],[30,24,13,22],[30,27,13,25,"limit"],[30,32,13,30],[31,4,14,2],[33,4,16,2],[34,0,17,0],[35,0,18,0],[36,0,19,0],[37,0,20,0],[38,0,21,0],[39,4,22,2],[39,13,22,11,"remove"],[39,19,22,17,"remove"],[39,20,22,18,"task"],[39,24,22,22],[39,26,22,24],[40,6,23,4,"buffer"],[40,12,23,10],[40,13,23,11,"delete"],[40,19,23,17],[40,20,23,18,"task"],[40,24,23,22],[40,25,23,23],[41,4,24,2],[43,4,26,2],[44,0,27,0],[45,0,28,0],[46,0,29,0],[47,0,30,0],[48,0,31,0],[49,0,32,0],[50,0,33,0],[51,0,34,0],[52,0,35,0],[53,4,36,2],[53,13,36,11,"add"],[53,16,36,14,"add"],[53,17,36,15,"taskProducer"],[53,29,36,27],[53,31,36,29],[54,6,37,4],[54,10,37,8],[54,11,37,9,"isReady"],[54,18,37,16],[54,19,37,17],[54,20,37,18],[54,22,37,20],[55,8,38,6],[55,15,38,13],[55,19,38,13,"rejectedSyncPromise"],[55,33,38,32],[55,34,38,32,"rejectedSyncPromise"],[55,53,38,32],[55,55,38,33,"SENTRY_BUFFER_FULL_ERROR"],[55,79,38,57],[55,80,38,58],[56,6,39,4],[58,6,41,4],[59,6,42,4],[59,10,42,10,"task"],[59,14,42,14],[59,17,42,17,"taskProducer"],[59,29,42,29],[59,30,42,30],[59,31,42,31],[60,6,43,4,"buffer"],[60,12,43,10],[60,13,43,11,"add"],[60,16,43,14],[60,17,43,15,"task"],[60,21,43,19],[60,22,43,20],[61,6,44,4],[61,11,44,9,"task"],[61,15,44,13],[61,16,44,14,"then"],[61,20,44,18],[61,21,45,6],[61,27,45,12,"remove"],[61,33,45,18],[61,34,45,19,"task"],[61,38,45,23],[61,39,45,24],[61,41,46,6],[61,47,46,12,"remove"],[61,53,46,18],[61,54,46,19,"task"],[61,58,46,23],[61,59,47,4],[61,60,47,5],[62,6,48,4],[62,13,48,11,"task"],[62,17,48,15],[63,4,49,2],[65,4,51,2],[66,0,52,0],[67,0,53,0],[68,0,54,0],[69,0,55,0],[70,0,56,0],[71,0,57,0],[72,0,58,0],[73,0,59,0],[74,4,60,2],[74,13,60,11,"drain"],[74,18,60,16,"drain"],[74,19,60,17,"timeout"],[74,26,60,24],[74,28,60,26],[75,6,61,4],[75,10,61,8],[75,11,61,9,"buffer"],[75,17,61,15],[75,18,61,16,"size"],[75,22,61,20],[75,24,61,22],[76,8,62,6],[76,15,62,13],[76,19,62,13,"resolvedSyncPromise"],[76,33,62,32],[76,34,62,32,"resolvedSyncPromise"],[76,53,62,32],[76,55,62,33],[76,59,62,37],[76,60,62,38],[77,6,63,4],[79,6,65,4],[80,6,66,4],[80,10,66,10,"drainPromise"],[80,22,66,22],[80,25,66,25,"Promise"],[80,32,66,32],[80,33,66,33,"allSettled"],[80,43,66,43],[80,44,66,44,"Array"],[80,49,66,49],[80,50,66,50,"from"],[80,54,66,54],[80,55,66,55,"buffer"],[80,61,66,61],[80,62,66,62],[80,63,66,63],[80,64,66,64,"then"],[80,68,66,68],[80,69,66,69],[80,75,66,75],[80,79,66,79],[80,80,66,80],[81,6,68,4],[81,10,68,8],[81,11,68,9,"timeout"],[81,18,68,16],[81,20,68,18],[82,8,69,6],[82,15,69,13,"drainPromise"],[82,27,69,25],[83,6,70,4],[84,6,72,4],[84,10,72,10,"promises"],[84,18,72,18],[84,21,72,21],[84,22,72,22,"drainPromise"],[84,34,72,34],[84,36,72,36],[84,40,72,40,"Promise"],[84,47,72,47],[84,48,72,48,"resolve"],[84,55,72,55],[84,59,72,59,"setTimeout"],[84,69,72,69],[84,70,72,70],[84,76,72,76,"resolve"],[84,83,72,83],[84,84,72,84],[84,89,72,89],[84,90,72,90],[84,92,72,92,"timeout"],[84,99,72,99],[84,100,72,100],[84,101,72,101],[84,102,72,102],[86,6,74,4],[87,6,75,4],[88,6,76,4],[88,13,76,11,"Promise"],[88,20,76,18],[88,21,76,19,"race"],[88,25,76,23],[88,26,76,24,"promises"],[88,34,76,32],[88,35,76,33],[89,4,77,2],[90,4,79,2],[90,11,79,9],[91,6,80,4],[91,10,80,8,"$"],[91,11,80,9,"$"],[91,12,80,9],[91,14,80,12],[92,8,81,6],[92,15,81,13,"Array"],[92,20,81,18],[92,21,81,19,"from"],[92,25,81,23],[92,26,81,24,"buffer"],[92,32,81,30],[92,33,81,31],[93,6,82,4],[93,7,82,5],[94,6,83,4,"add"],[94,9,83,7],[95,6,84,4,"drain"],[96,4,85,2],[96,5,85,3],[97,2,86,0],[98,0,86,1],[98,3]],"functionMap":{"names":["<global>","makePromiseBuffer","isReady","remove","add","task.then$argument_0","task.then$argument_1","drain","Promise.allSettled.then$argument_0","Promise$argument_0","setTimeout$argument_0","get__$"],"mappings":"AAA;ACQ;ECG;GDE;EEQ;GFE;EGY;MCS,kBD;MEC,kBF;GHG;EMW;qECM,UD;gDEM,sBC,oBD,UF;GNK;IUG;KVE;CDI"},"hasCjsExports":false},"type":"js/module"}]}