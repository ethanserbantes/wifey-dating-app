{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":52,"index":52}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":53},"end":{"line":2,"column":69,"index":122}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":123},"end":{"line":3,"column":49,"index":172}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return useLikesBadge;\n    }\n  });\n  var _react = require(_dependencyMap[0], \"react\");\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[1], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _tanstackReactQuery = require(_dependencyMap[2], \"@tanstack/react-query\");\n  function buildLikesQueryString({\n    userId,\n    userEmail\n  }) {\n    const params = [];\n    const uid = Number(userId);\n    if (Number.isFinite(uid)) {\n      params.push(`userId=${encodeURIComponent(String(uid))}`);\n    }\n    const email = String(userEmail || \"\").trim();\n    if (email) {\n      params.push(`email=${encodeURIComponent(email)}`);\n    }\n    return params.length ? `?${params.join(\"&\")}` : \"\";\n  }\n  function useLikesBadge() {\n    const [userId, setUserId] = (0, _react.useState)(null);\n    const [userEmail, setUserEmail] = (0, _react.useState)(null);\n    const pollRef = (0, _react.useRef)(null);\n    (0, _react.useEffect)(() => {\n      let cancelled = false;\n      const load = async () => {\n        try {\n          const raw = await AsyncStorage.default.getItem(\"user\");\n          if (!raw) {\n            if (!cancelled) {\n              setUserId(null);\n              setUserEmail(null);\n            }\n            return false;\n          }\n          const user = JSON.parse(raw);\n          const parsedId = Number(user?.id);\n          const nextId = Number.isFinite(parsedId) ? parsedId : null;\n          const nextEmail = String(user?.email || \"\").trim() || null;\n          if (!cancelled) {\n            setUserId(nextId);\n            setUserEmail(nextEmail);\n          }\n          return Boolean(nextId || nextEmail);\n        } catch (e) {\n          console.error(e);\n          if (!cancelled) {\n            setUserId(null);\n            setUserEmail(null);\n          }\n          return false;\n        }\n      };\n\n      // Root layouts can mount before login finishes.\n      // Keep checking until a user appears so the badge works right after sign-in.\n      load().then(found => {\n        if (cancelled) return;\n        if (found) return;\n        if (pollRef.current) {\n          clearInterval(pollRef.current);\n        }\n        pollRef.current = setInterval(() => {\n          if (cancelled) return;\n          load().then(nowFound => {\n            if (cancelled) return;\n            if (nowFound && pollRef.current) {\n              clearInterval(pollRef.current);\n              pollRef.current = null;\n            }\n          });\n        }, 1500);\n      });\n      return () => {\n        cancelled = true;\n        if (pollRef.current) {\n          clearInterval(pollRef.current);\n          pollRef.current = null;\n        }\n      };\n    }, []);\n    const badgeQuery = (0, _tanstackReactQuery.useQuery)({\n      queryKey: [\"likesBadge\", userId || null, userEmail || null],\n      enabled: Boolean(userId || userEmail),\n      queryFn: async () => {\n        const queryString = buildLikesQueryString({\n          userId,\n          userEmail\n        });\n        const response = await fetch(`/api/likes/badge${queryString}`);\n        if (!response.ok) {\n          throw new Error(`When fetching /api/likes/badge, the response was [${response.status}] ${response.statusText}`);\n        }\n        return response.json();\n      },\n      // Keep this lightweight; it only drives a small dot.\n      refetchInterval: 4000,\n      refetchIntervalInBackground: true,\n      staleTime: 0,\n      retry: 1\n    });\n    const badgeCountRaw = badgeQuery.data?.badgeCount;\n    const badgeCountNum = Number(badgeCountRaw);\n    const badgeCount = Number.isFinite(badgeCountNum) ? badgeCountNum : 0;\n    return {\n      userId,\n      userEmail,\n      badgeCount,\n      isLoading: badgeQuery.isLoading,\n      refetch: badgeQuery.refetch\n    };\n  }\n});","lineCount":130,"map":[[12,2,21,15,"Object"],[12,8,21,15],[12,9,21,15,"defineProperty"],[12,23,21,15],[12,24,21,15,"exports"],[12,31,21,15],[13,4,21,15,"enumerable"],[13,14,21,15],[14,4,21,15,"get"],[14,7,21,15],[14,18,21,15,"get"],[14,19,21,15],[15,6,21,15],[15,13,21,15,"useLikesBadge"],[15,26,21,15],[16,4,21,15],[17,2,21,15],[18,2,1,0],[18,6,1,0,"_react"],[18,12,1,0],[18,15,1,0,"require"],[18,22,1,0],[18,23,1,0,"_dependencyMap"],[18,37,1,0],[19,2,2,0],[19,6,2,0,"_reactNativeAsyncStorageAsyncStorage"],[19,42,2,0],[19,45,2,0,"require"],[19,52,2,0],[19,53,2,0,"_dependencyMap"],[19,67,2,0],[20,2,2,0],[20,6,2,0,"AsyncStorage"],[20,18,2,0],[20,21,2,0,"_interopDefault"],[20,36,2,0],[20,37,2,0,"_reactNativeAsyncStorageAsyncStorage"],[20,73,2,0],[21,2,3,0],[21,6,3,0,"_tanstackReactQuery"],[21,25,3,0],[21,28,3,0,"require"],[21,35,3,0],[21,36,3,0,"_dependencyMap"],[21,50,3,0],[22,2,5,0],[22,11,5,9,"buildLikesQueryString"],[22,32,5,30,"buildLikesQueryString"],[22,33,5,31],[23,4,5,33,"userId"],[23,10,5,39],[24,4,5,41,"userEmail"],[25,2,5,51],[25,3,5,52],[25,5,5,54],[26,4,6,2],[26,10,6,8,"params"],[26,16,6,14],[26,19,6,17],[26,21,6,19],[27,4,7,2],[27,10,7,8,"uid"],[27,13,7,11],[27,16,7,14,"Number"],[27,22,7,20],[27,23,7,21,"userId"],[27,29,7,27],[27,30,7,28],[28,4,9,2],[28,8,9,6,"Number"],[28,14,9,12],[28,15,9,13,"isFinite"],[28,23,9,21],[28,24,9,22,"uid"],[28,27,9,25],[28,28,9,26],[28,30,9,28],[29,6,10,4,"params"],[29,12,10,10],[29,13,10,11,"push"],[29,17,10,15],[29,18,10,16],[29,28,10,26,"encodeURIComponent"],[29,46,10,44],[29,47,10,45,"String"],[29,53,10,51],[29,54,10,52,"uid"],[29,57,10,55],[29,58,10,56],[29,59,10,57],[29,61,10,59],[29,62,10,60],[30,4,11,2],[31,4,13,2],[31,10,13,8,"email"],[31,15,13,13],[31,18,13,16,"String"],[31,24,13,22],[31,25,13,23,"userEmail"],[31,34,13,32],[31,38,13,36],[31,40,13,38],[31,41,13,39],[31,42,13,40,"trim"],[31,46,13,44],[31,47,13,45],[31,48,13,46],[32,4,14,2],[32,8,14,6,"email"],[32,13,14,11],[32,15,14,13],[33,6,15,4,"params"],[33,12,15,10],[33,13,15,11,"push"],[33,17,15,15],[33,18,15,16],[33,27,15,25,"encodeURIComponent"],[33,45,15,43],[33,46,15,44,"email"],[33,51,15,49],[33,52,15,50],[33,54,15,52],[33,55,15,53],[34,4,16,2],[35,4,18,2],[35,11,18,9,"params"],[35,17,18,15],[35,18,18,16,"length"],[35,24,18,22],[35,27,18,25],[35,31,18,29,"params"],[35,37,18,35],[35,38,18,36,"join"],[35,42,18,40],[35,43,18,41],[35,46,18,44],[35,47,18,45],[35,49,18,47],[35,52,18,50],[35,54,18,52],[36,2,19,0],[37,2,21,15],[37,11,21,24,"useLikesBadge"],[37,24,21,37,"useLikesBadge"],[37,25,21,37],[37,27,21,40],[38,4,22,2],[38,10,22,8],[38,11,22,9,"userId"],[38,17,22,15],[38,19,22,17,"setUserId"],[38,28,22,26],[38,29,22,27],[38,32,22,30],[38,36,22,30,"useState"],[38,42,22,38],[38,43,22,38,"useState"],[38,51,22,38],[38,53,22,39],[38,57,22,43],[38,58,22,44],[39,4,23,2],[39,10,23,8],[39,11,23,9,"userEmail"],[39,20,23,18],[39,22,23,20,"setUserEmail"],[39,34,23,32],[39,35,23,33],[39,38,23,36],[39,42,23,36,"useState"],[39,48,23,44],[39,49,23,44,"useState"],[39,57,23,44],[39,59,23,45],[39,63,23,49],[39,64,23,50],[40,4,24,2],[40,10,24,8,"pollRef"],[40,17,24,15],[40,20,24,18],[40,24,24,18,"useRef"],[40,30,24,24],[40,31,24,24,"useRef"],[40,37,24,24],[40,39,24,25],[40,43,24,29],[40,44,24,30],[41,4,26,2],[41,8,26,2,"useEffect"],[41,14,26,11],[41,15,26,11,"useEffect"],[41,24,26,11],[41,26,26,12],[41,32,26,18],[42,6,27,4],[42,10,27,8,"cancelled"],[42,19,27,17],[42,22,27,20],[42,27,27,25],[43,6,29,4],[43,12,29,10,"load"],[43,16,29,14],[43,19,29,17],[43,25,29,17,"load"],[43,26,29,17],[43,31,29,29],[44,8,30,6],[44,12,30,10],[45,10,31,8],[45,16,31,14,"raw"],[45,19,31,17],[45,22,31,20],[45,28,31,26,"AsyncStorage"],[45,40,31,38],[45,41,31,38,"default"],[45,48,31,38],[45,49,31,39,"getItem"],[45,56,31,46],[45,57,31,47],[45,63,31,53],[45,64,31,54],[46,10,32,8],[46,14,32,12],[46,15,32,13,"raw"],[46,18,32,16],[46,20,32,18],[47,12,33,10],[47,16,33,14],[47,17,33,15,"cancelled"],[47,26,33,24],[47,28,33,26],[48,14,34,12,"setUserId"],[48,23,34,21],[48,24,34,22],[48,28,34,26],[48,29,34,27],[49,14,35,12,"setUserEmail"],[49,26,35,24],[49,27,35,25],[49,31,35,29],[49,32,35,30],[50,12,36,10],[51,12,37,10],[51,19,37,17],[51,24,37,22],[52,10,38,8],[53,10,40,8],[53,16,40,14,"user"],[53,20,40,18],[53,23,40,21,"JSON"],[53,27,40,25],[53,28,40,26,"parse"],[53,33,40,31],[53,34,40,32,"raw"],[53,37,40,35],[53,38,40,36],[54,10,41,8],[54,16,41,14,"parsedId"],[54,24,41,22],[54,27,41,25,"Number"],[54,33,41,31],[54,34,41,32,"user"],[54,38,41,36],[54,40,41,38,"id"],[54,42,41,40],[54,43,41,41],[55,10,42,8],[55,16,42,14,"nextId"],[55,22,42,20],[55,25,42,23,"Number"],[55,31,42,29],[55,32,42,30,"isFinite"],[55,40,42,38],[55,41,42,39,"parsedId"],[55,49,42,47],[55,50,42,48],[55,53,42,51,"parsedId"],[55,61,42,59],[55,64,42,62],[55,68,42,66],[56,10,43,8],[56,16,43,14,"nextEmail"],[56,25,43,23],[56,28,43,26,"String"],[56,34,43,32],[56,35,43,33,"user"],[56,39,43,37],[56,41,43,39,"email"],[56,46,43,44],[56,50,43,48],[56,52,43,50],[56,53,43,51],[56,54,43,52,"trim"],[56,58,43,56],[56,59,43,57],[56,60,43,58],[56,64,43,62],[56,68,43,66],[57,10,45,8],[57,14,45,12],[57,15,45,13,"cancelled"],[57,24,45,22],[57,26,45,24],[58,12,46,10,"setUserId"],[58,21,46,19],[58,22,46,20,"nextId"],[58,28,46,26],[58,29,46,27],[59,12,47,10,"setUserEmail"],[59,24,47,22],[59,25,47,23,"nextEmail"],[59,34,47,32],[59,35,47,33],[60,10,48,8],[61,10,50,8],[61,17,50,15,"Boolean"],[61,24,50,22],[61,25,50,23,"nextId"],[61,31,50,29],[61,35,50,33,"nextEmail"],[61,44,50,42],[61,45,50,43],[62,8,51,6],[62,9,51,7],[62,10,51,8],[62,17,51,15,"e"],[62,18,51,16],[62,20,51,18],[63,10,52,8,"console"],[63,17,52,15],[63,18,52,16,"error"],[63,23,52,21],[63,24,52,22,"e"],[63,25,52,23],[63,26,52,24],[64,10,53,8],[64,14,53,12],[64,15,53,13,"cancelled"],[64,24,53,22],[64,26,53,24],[65,12,54,10,"setUserId"],[65,21,54,19],[65,22,54,20],[65,26,54,24],[65,27,54,25],[66,12,55,10,"setUserEmail"],[66,24,55,22],[66,25,55,23],[66,29,55,27],[66,30,55,28],[67,10,56,8],[68,10,57,8],[68,17,57,15],[68,22,57,20],[69,8,58,6],[70,6,59,4],[70,7,59,5],[72,6,61,4],[73,6,62,4],[74,6,63,4,"load"],[74,10,63,8],[74,11,63,9],[74,12,63,10],[74,13,63,11,"then"],[74,17,63,15],[74,18,63,17,"found"],[74,23,63,22],[74,27,63,27],[75,8,64,6],[75,12,64,10,"cancelled"],[75,21,64,19],[75,23,64,21],[76,8,65,6],[76,12,65,10,"found"],[76,17,65,15],[76,19,65,17],[77,8,67,6],[77,12,67,10,"pollRef"],[77,19,67,17],[77,20,67,18,"current"],[77,27,67,25],[77,29,67,27],[78,10,68,8,"clearInterval"],[78,23,68,21],[78,24,68,22,"pollRef"],[78,31,68,29],[78,32,68,30,"current"],[78,39,68,37],[78,40,68,38],[79,8,69,6],[80,8,71,6,"pollRef"],[80,15,71,13],[80,16,71,14,"current"],[80,23,71,21],[80,26,71,24,"setInterval"],[80,37,71,35],[80,38,71,36],[80,44,71,42],[81,10,72,8],[81,14,72,12,"cancelled"],[81,23,72,21],[81,25,72,23],[82,10,73,8,"load"],[82,14,73,12],[82,15,73,13],[82,16,73,14],[82,17,73,15,"then"],[82,21,73,19],[82,22,73,21,"nowFound"],[82,30,73,29],[82,34,73,34],[83,12,74,10],[83,16,74,14,"cancelled"],[83,25,74,23],[83,27,74,25],[84,12,75,10],[84,16,75,14,"nowFound"],[84,24,75,22],[84,28,75,26,"pollRef"],[84,35,75,33],[84,36,75,34,"current"],[84,43,75,41],[84,45,75,43],[85,14,76,12,"clearInterval"],[85,27,76,25],[85,28,76,26,"pollRef"],[85,35,76,33],[85,36,76,34,"current"],[85,43,76,41],[85,44,76,42],[86,14,77,12,"pollRef"],[86,21,77,19],[86,22,77,20,"current"],[86,29,77,27],[86,32,77,30],[86,36,77,34],[87,12,78,10],[88,10,79,8],[88,11,79,9],[88,12,79,10],[89,8,80,6],[89,9,80,7],[89,11,80,9],[89,15,80,13],[89,16,80,14],[90,6,81,4],[90,7,81,5],[90,8,81,6],[91,6,83,4],[91,13,83,11],[91,19,83,17],[92,8,84,6,"cancelled"],[92,17,84,15],[92,20,84,18],[92,24,84,22],[93,8,85,6],[93,12,85,10,"pollRef"],[93,19,85,17],[93,20,85,18,"current"],[93,27,85,25],[93,29,85,27],[94,10,86,8,"clearInterval"],[94,23,86,21],[94,24,86,22,"pollRef"],[94,31,86,29],[94,32,86,30,"current"],[94,39,86,37],[94,40,86,38],[95,10,87,8,"pollRef"],[95,17,87,15],[95,18,87,16,"current"],[95,25,87,23],[95,28,87,26],[95,32,87,30],[96,8,88,6],[97,6,89,4],[97,7,89,5],[98,4,90,2],[98,5,90,3],[98,7,90,5],[98,9,90,7],[98,10,90,8],[99,4,92,2],[99,10,92,8,"badgeQuery"],[99,20,92,18],[99,23,92,21],[99,27,92,21,"useQuery"],[99,46,92,29],[99,47,92,29,"useQuery"],[99,55,92,29],[99,57,92,30],[100,6,93,4,"queryKey"],[100,14,93,12],[100,16,93,14],[100,17,93,15],[100,29,93,27],[100,31,93,29,"userId"],[100,37,93,35],[100,41,93,39],[100,45,93,43],[100,47,93,45,"userEmail"],[100,56,93,54],[100,60,93,58],[100,64,93,62],[100,65,93,63],[101,6,94,4,"enabled"],[101,13,94,11],[101,15,94,13,"Boolean"],[101,22,94,20],[101,23,94,21,"userId"],[101,29,94,27],[101,33,94,31,"userEmail"],[101,42,94,40],[101,43,94,41],[102,6,95,4,"queryFn"],[102,13,95,11],[102,15,95,13],[102,21,95,13,"queryFn"],[102,22,95,13],[102,27,95,25],[103,8,96,6],[103,14,96,12,"queryString"],[103,25,96,23],[103,28,96,26,"buildLikesQueryString"],[103,49,96,47],[103,50,96,48],[104,10,96,50,"userId"],[104,16,96,56],[105,10,96,58,"userEmail"],[106,8,96,68],[106,9,96,69],[106,10,96,70],[107,8,97,6],[107,14,97,12,"response"],[107,22,97,20],[107,25,97,23],[107,31,97,29,"fetch"],[107,36,97,34],[107,37,97,35],[107,56,97,54,"queryString"],[107,67,97,65],[107,69,97,67],[107,70,97,68],[108,8,98,6],[108,12,98,10],[108,13,98,11,"response"],[108,21,98,19],[108,22,98,20,"ok"],[108,24,98,22],[108,26,98,24],[109,10,99,8],[109,16,99,14],[109,20,99,18,"Error"],[109,25,99,23],[109,26,100,10],[109,79,100,63,"response"],[109,87,100,71],[109,88,100,72,"status"],[109,94,100,78],[109,99,100,83,"response"],[109,107,100,91],[109,108,100,92,"statusText"],[109,118,100,102],[109,120,101,8],[109,121,101,9],[110,8,102,6],[111,8,103,6],[111,15,103,13,"response"],[111,23,103,21],[111,24,103,22,"json"],[111,28,103,26],[111,29,103,27],[111,30,103,28],[112,6,104,4],[112,7,104,5],[113,6,105,4],[114,6,106,4,"refetchInterval"],[114,21,106,19],[114,23,106,21],[114,27,106,25],[115,6,107,4,"refetchIntervalInBackground"],[115,33,107,31],[115,35,107,33],[115,39,107,37],[116,6,108,4,"staleTime"],[116,15,108,13],[116,17,108,15],[116,18,108,16],[117,6,109,4,"retry"],[117,11,109,9],[117,13,109,11],[118,4,110,2],[118,5,110,3],[118,6,110,4],[119,4,112,2],[119,10,112,8,"badgeCountRaw"],[119,23,112,21],[119,26,112,24,"badgeQuery"],[119,36,112,34],[119,37,112,35,"data"],[119,41,112,39],[119,43,112,41,"badgeCount"],[119,53,112,51],[120,4,113,2],[120,10,113,8,"badgeCountNum"],[120,23,113,21],[120,26,113,24,"Number"],[120,32,113,30],[120,33,113,31,"badgeCountRaw"],[120,46,113,44],[120,47,113,45],[121,4,114,2],[121,10,114,8,"badgeCount"],[121,20,114,18],[121,23,114,21,"Number"],[121,29,114,27],[121,30,114,28,"isFinite"],[121,38,114,36],[121,39,114,37,"badgeCountNum"],[121,52,114,50],[121,53,114,51],[121,56,114,54,"badgeCountNum"],[121,69,114,67],[121,72,114,70],[121,73,114,71],[122,4,116,2],[122,11,116,9],[123,6,117,4,"userId"],[123,12,117,10],[124,6,118,4,"userEmail"],[124,15,118,13],[125,6,119,4,"badgeCount"],[125,16,119,14],[126,6,120,4,"isLoading"],[126,15,120,13],[126,17,120,15,"badgeQuery"],[126,27,120,25],[126,28,120,26,"isLoading"],[126,37,120,35],[127,6,121,4,"refetch"],[127,13,121,11],[127,15,121,13,"badgeQuery"],[127,25,121,23],[127,26,121,24,"refetch"],[128,4,122,2],[128,5,122,3],[129,2,123,0],[130,0,123,1],[130,3]],"functionMap":{"names":["<global>","buildLikesQueryString","useLikesBadge","useEffect$argument_0","load","load.then$argument_0","setInterval$argument_0","<anonymous>","useQuery$argument_0.queryFn"],"mappings":"AAA;ACI;CDc;eEE;YCK;iBCG;KD8B;gBEI;oCCQ;oBDE;SCM;ODC;KFC;WIE;KJM;GDC;aMK;KNS;CFmB"},"hasCjsExports":false},"type":"js/module"}]}