{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":57,"index":57}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@/utils/dateCreditsHelpers","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":58},"end":{"line":5,"column":36,"index":156}}],"key":"oRWBdvQUhGiyZ/vbJNT/hHj85Fs=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.useDateCreditsData = useDateCreditsData;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _utilsDateCreditsHelpers = require(_dependencyMap[1], \"@/utils/dateCreditsHelpers\");\n  function useDateCreditsData(jwt) {\n    _s();\n    const [userId, setUserId] = (0, _react.useState)(null);\n    const [loading, setLoading] = (0, _react.useState)(true);\n    const [credits, setCredits] = (0, _react.useState)(0);\n    const [maxCredits, setMaxCredits] = (0, _react.useState)(3);\n    const [balanceCents, setBalanceCents] = (0, _react.useState)(0);\n    const loadUser = (0, _react.useCallback)(async () => {\n      try {\n        const u = await (0, _utilsDateCreditsHelpers.safeReadUserFromStorage)();\n        const id = Number(u?.id);\n        return Number.isFinite(id) ? id : null;\n      } catch (e) {\n        console.error(e);\n        return null;\n      }\n    }, []);\n    const refresh = (0, _react.useCallback)(async uid => {\n      // IMPORTANT:\n      // Prefer an explicit legacy userId when we have one.\n      // This prevents stale credit displays when token parsing fails in some RN runtimes.\n      const idNum = Number(uid);\n      const hasUid = Number.isFinite(idNum);\n      const hasJwt = jwt && typeof jwt === \"string\";\n      if (!hasUid && !hasJwt) return null;\n      const url = hasUid ? `/api/date-credits/status?userId=${idNum}` : `/api/date-credits/status`;\n      const resp = await fetch(url, {\n        headers: hasJwt ? {\n          Authorization: `Bearer ${jwt}`\n        } : undefined\n      });\n      if (!resp.ok) {\n        throw new Error(`When fetching /api/date-credits/status, the response was [${resp.status}] ${resp.statusText}`);\n      }\n      const data = await resp.json();\n\n      // NEW: if backend resolved a different legacy user id, adopt it so\n      // everything (messages, matches, credits) stays consistent.\n      const resolvedUserId = Number(data?.userId);\n      if (Number.isFinite(resolvedUserId) && resolvedUserId !== Number(uid)) {\n        setUserId(resolvedUserId);\n        const existing = (await (0, _utilsDateCreditsHelpers.safeReadUserFromStorage)()) || {};\n        await (0, _utilsDateCreditsHelpers.safeWriteUserToStorage)({\n          ...existing,\n          id: resolvedUserId\n        });\n      }\n      const nextCredits = Number(data?.credits || 0);\n      const nextMaxCredits = Number(data?.maxCredits || 3);\n      const nextBalanceCents = Number(data?.balanceCents || 0);\n      setCredits(nextCredits);\n      setMaxCredits(nextMaxCredits);\n      setBalanceCents(nextBalanceCents);\n\n      // NEW: return values so callers (like purchase polling) can act on fresh numbers\n      return {\n        credits: nextCredits,\n        maxCredits: nextMaxCredits,\n        balanceCents: nextBalanceCents\n      };\n    }, [jwt]);\n    (0, _react.useEffect)(() => {\n      let alive = true;\n      (async () => {\n        try {\n          const uid = await loadUser();\n          if (!alive) return;\n          setUserId(uid);\n          // Even if uid is missing/stale, refresh() can resolve via jwt.\n          await refresh(uid);\n        } catch (e) {\n          console.error(e);\n        } finally {\n          if (alive) setLoading(false);\n        }\n      })();\n      return () => {\n        alive = false;\n      };\n    }, [loadUser, refresh]);\n    return {\n      userId,\n      setUserId,\n      loading,\n      credits,\n      setCredits,\n      maxCredits,\n      setMaxCredits,\n      balanceCents,\n      setBalanceCents,\n      loadUser,\n      refresh\n    };\n  }\n  _s(useDateCreditsData, \"vGWxU8m1ufErMTF2Vha0sVVXIXY=\");\n});","lineCount":106,"map":[[8,2,7,0,"exports"],[8,9,7,0],[8,10,7,0,"useDateCreditsData"],[8,28,7,0],[8,31,7,0,"useDateCreditsData"],[8,49,7,0],[9,2,1,0],[9,6,1,0,"_react"],[9,12,1,0],[9,15,1,0,"require"],[9,22,1,0],[9,23,1,0,"_dependencyMap"],[9,37,1,0],[10,2,2,0],[10,6,2,0,"_utilsDateCreditsHelpers"],[10,30,2,0],[10,33,2,0,"require"],[10,40,2,0],[10,41,2,0,"_dependencyMap"],[10,55,2,0],[11,2,7,7],[11,11,7,16,"useDateCreditsData"],[11,29,7,34,"useDateCreditsData"],[11,30,7,35,"jwt"],[11,33,7,38],[11,35,7,40],[12,4,7,40,"_s"],[12,6,7,40],[13,4,8,2],[13,10,8,8],[13,11,8,9,"userId"],[13,17,8,15],[13,19,8,17,"setUserId"],[13,28,8,26],[13,29,8,27],[13,32,8,30],[13,36,8,30,"useState"],[13,42,8,38],[13,43,8,38,"useState"],[13,51,8,38],[13,53,8,39],[13,57,8,43],[13,58,8,44],[14,4,9,2],[14,10,9,8],[14,11,9,9,"loading"],[14,18,9,16],[14,20,9,18,"setLoading"],[14,30,9,28],[14,31,9,29],[14,34,9,32],[14,38,9,32,"useState"],[14,44,9,40],[14,45,9,40,"useState"],[14,53,9,40],[14,55,9,41],[14,59,9,45],[14,60,9,46],[15,4,10,2],[15,10,10,8],[15,11,10,9,"credits"],[15,18,10,16],[15,20,10,18,"setCredits"],[15,30,10,28],[15,31,10,29],[15,34,10,32],[15,38,10,32,"useState"],[15,44,10,40],[15,45,10,40,"useState"],[15,53,10,40],[15,55,10,41],[15,56,10,42],[15,57,10,43],[16,4,11,2],[16,10,11,8],[16,11,11,9,"maxCredits"],[16,21,11,19],[16,23,11,21,"setMaxCredits"],[16,36,11,34],[16,37,11,35],[16,40,11,38],[16,44,11,38,"useState"],[16,50,11,46],[16,51,11,46,"useState"],[16,59,11,46],[16,61,11,47],[16,62,11,48],[16,63,11,49],[17,4,12,2],[17,10,12,8],[17,11,12,9,"balanceCents"],[17,23,12,21],[17,25,12,23,"setBalanceCents"],[17,40,12,38],[17,41,12,39],[17,44,12,42],[17,48,12,42,"useState"],[17,54,12,50],[17,55,12,50,"useState"],[17,63,12,50],[17,65,12,51],[17,66,12,52],[17,67,12,53],[18,4,14,2],[18,10,14,8,"loadUser"],[18,18,14,16],[18,21,14,19],[18,25,14,19,"useCallback"],[18,31,14,30],[18,32,14,30,"useCallback"],[18,43,14,30],[18,45,14,31],[18,57,14,43],[19,6,15,4],[19,10,15,8],[20,8,16,6],[20,14,16,12,"u"],[20,15,16,13],[20,18,16,16],[20,24,16,22],[20,28,16,22,"safeReadUserFromStorage"],[20,52,16,45],[20,53,16,45,"safeReadUserFromStorage"],[20,76,16,45],[20,78,16,46],[20,79,16,47],[21,8,17,6],[21,14,17,12,"id"],[21,16,17,14],[21,19,17,17,"Number"],[21,25,17,23],[21,26,17,24,"u"],[21,27,17,25],[21,29,17,27,"id"],[21,31,17,29],[21,32,17,30],[22,8,18,6],[22,15,18,13,"Number"],[22,21,18,19],[22,22,18,20,"isFinite"],[22,30,18,28],[22,31,18,29,"id"],[22,33,18,31],[22,34,18,32],[22,37,18,35,"id"],[22,39,18,37],[22,42,18,40],[22,46,18,44],[23,6,19,4],[23,7,19,5],[23,8,19,6],[23,15,19,13,"e"],[23,16,19,14],[23,18,19,16],[24,8,20,6,"console"],[24,15,20,13],[24,16,20,14,"error"],[24,21,20,19],[24,22,20,20,"e"],[24,23,20,21],[24,24,20,22],[25,8,21,6],[25,15,21,13],[25,19,21,17],[26,6,22,4],[27,4,23,2],[27,5,23,3],[27,7,23,5],[27,9,23,7],[27,10,23,8],[28,4,25,2],[28,10,25,8,"refresh"],[28,17,25,15],[28,20,25,18],[28,24,25,18,"useCallback"],[28,30,25,29],[28,31,25,29,"useCallback"],[28,42,25,29],[28,44,26,4],[28,50,26,11,"uid"],[28,53,26,14],[28,57,26,19],[29,6,27,6],[30,6,28,6],[31,6,29,6],[32,6,30,6],[32,12,30,12,"idNum"],[32,17,30,17],[32,20,30,20,"Number"],[32,26,30,26],[32,27,30,27,"uid"],[32,30,30,30],[32,31,30,31],[33,6,31,6],[33,12,31,12,"hasUid"],[33,18,31,18],[33,21,31,21,"Number"],[33,27,31,27],[33,28,31,28,"isFinite"],[33,36,31,36],[33,37,31,37,"idNum"],[33,42,31,42],[33,43,31,43],[34,6,33,6],[34,12,33,12,"hasJwt"],[34,18,33,18],[34,21,33,21,"jwt"],[34,24,33,24],[34,28,33,28],[34,35,33,35,"jwt"],[34,38,33,38],[34,43,33,43],[34,51,33,51],[35,6,34,6],[35,10,34,10],[35,11,34,11,"hasUid"],[35,17,34,17],[35,21,34,21],[35,22,34,22,"hasJwt"],[35,28,34,28],[35,30,34,30],[35,37,34,37],[35,41,34,41],[36,6,36,6],[36,12,36,12,"url"],[36,15,36,15],[36,18,36,18,"hasUid"],[36,24,36,24],[36,27,37,10],[36,62,37,45,"idNum"],[36,67,37,50],[36,69,37,52],[36,72,38,10],[36,98,38,36],[37,6,40,6],[37,12,40,12,"resp"],[37,16,40,16],[37,19,40,19],[37,25,40,25,"fetch"],[37,30,40,30],[37,31,40,31,"url"],[37,34,40,34],[37,36,40,36],[38,8,41,8,"headers"],[38,15,41,15],[38,17,41,17,"hasJwt"],[38,23,41,23],[38,26,41,26],[39,10,41,28,"Authorization"],[39,23,41,41],[39,25,41,43],[39,35,41,53,"jwt"],[39,38,41,56],[40,8,41,59],[40,9,41,60],[40,12,41,63,"undefined"],[41,6,42,6],[41,7,42,7],[41,8,42,8],[42,6,43,6],[42,10,43,10],[42,11,43,11,"resp"],[42,15,43,15],[42,16,43,16,"ok"],[42,18,43,18],[42,20,43,20],[43,8,44,8],[43,14,44,14],[43,18,44,18,"Error"],[43,23,44,23],[43,24,45,10],[43,85,45,71,"resp"],[43,89,45,75],[43,90,45,76,"status"],[43,96,45,82],[43,101,45,87,"resp"],[43,105,45,91],[43,106,45,92,"statusText"],[43,116,45,102],[43,118,46,8],[43,119,46,9],[44,6,47,6],[45,6,48,6],[45,12,48,12,"data"],[45,16,48,16],[45,19,48,19],[45,25,48,25,"resp"],[45,29,48,29],[45,30,48,30,"json"],[45,34,48,34],[45,35,48,35],[45,36,48,36],[47,6,50,6],[48,6,51,6],[49,6,52,6],[49,12,52,12,"resolvedUserId"],[49,26,52,26],[49,29,52,29,"Number"],[49,35,52,35],[49,36,52,36,"data"],[49,40,52,40],[49,42,52,42,"userId"],[49,48,52,48],[49,49,52,49],[50,6,53,6],[50,10,53,10,"Number"],[50,16,53,16],[50,17,53,17,"isFinite"],[50,25,53,25],[50,26,53,26,"resolvedUserId"],[50,40,53,40],[50,41,53,41],[50,45,53,45,"resolvedUserId"],[50,59,53,59],[50,64,53,64,"Number"],[50,70,53,70],[50,71,53,71,"uid"],[50,74,53,74],[50,75,53,75],[50,77,53,77],[51,8,54,8,"setUserId"],[51,17,54,17],[51,18,54,18,"resolvedUserId"],[51,32,54,32],[51,33,54,33],[52,8,55,8],[52,14,55,14,"existing"],[52,22,55,22],[52,25,55,25],[52,26,55,26],[52,32,55,32],[52,36,55,32,"safeReadUserFromStorage"],[52,60,55,55],[52,61,55,55,"safeReadUserFromStorage"],[52,84,55,55],[52,86,55,56],[52,87,55,57],[52,92,55,62],[52,93,55,63],[52,94,55,64],[53,8,56,8],[53,14,56,14],[53,18,56,14,"safeWriteUserToStorage"],[53,42,56,36],[53,43,56,36,"safeWriteUserToStorage"],[53,65,56,36],[53,67,56,37],[54,10,56,39],[54,13,56,42,"existing"],[54,21,56,50],[55,10,56,52,"id"],[55,12,56,54],[55,14,56,56,"resolvedUserId"],[56,8,56,71],[56,9,56,72],[56,10,56,73],[57,6,57,6],[58,6,59,6],[58,12,59,12,"nextCredits"],[58,23,59,23],[58,26,59,26,"Number"],[58,32,59,32],[58,33,59,33,"data"],[58,37,59,37],[58,39,59,39,"credits"],[58,46,59,46],[58,50,59,50],[58,51,59,51],[58,52,59,52],[59,6,60,6],[59,12,60,12,"nextMaxCredits"],[59,26,60,26],[59,29,60,29,"Number"],[59,35,60,35],[59,36,60,36,"data"],[59,40,60,40],[59,42,60,42,"maxCredits"],[59,52,60,52],[59,56,60,56],[59,57,60,57],[59,58,60,58],[60,6,61,6],[60,12,61,12,"nextBalanceCents"],[60,28,61,28],[60,31,61,31,"Number"],[60,37,61,37],[60,38,61,38,"data"],[60,42,61,42],[60,44,61,44,"balanceCents"],[60,56,61,56],[60,60,61,60],[60,61,61,61],[60,62,61,62],[61,6,63,6,"setCredits"],[61,16,63,16],[61,17,63,17,"nextCredits"],[61,28,63,28],[61,29,63,29],[62,6,64,6,"setMaxCredits"],[62,19,64,19],[62,20,64,20,"nextMaxCredits"],[62,34,64,34],[62,35,64,35],[63,6,65,6,"setBalanceCents"],[63,21,65,21],[63,22,65,22,"nextBalanceCents"],[63,38,65,38],[63,39,65,39],[65,6,67,6],[66,6,68,6],[66,13,68,13],[67,8,69,8,"credits"],[67,15,69,15],[67,17,69,17,"nextCredits"],[67,28,69,28],[68,8,70,8,"maxCredits"],[68,18,70,18],[68,20,70,20,"nextMaxCredits"],[68,34,70,34],[69,8,71,8,"balanceCents"],[69,20,71,20],[69,22,71,22,"nextBalanceCents"],[70,6,72,6],[70,7,72,7],[71,4,73,4],[71,5,73,5],[71,7,74,4],[71,8,74,5,"jwt"],[71,11,74,8],[71,12,75,2],[71,13,75,3],[72,4,77,2],[72,8,77,2,"useEffect"],[72,14,77,11],[72,15,77,11,"useEffect"],[72,24,77,11],[72,26,77,12],[72,32,77,18],[73,6,78,4],[73,10,78,8,"alive"],[73,15,78,13],[73,18,78,16],[73,22,78,20],[74,6,80,4],[74,7,80,5],[74,19,80,17],[75,8,81,6],[75,12,81,10],[76,10,82,8],[76,16,82,14,"uid"],[76,19,82,17],[76,22,82,20],[76,28,82,26,"loadUser"],[76,36,82,34],[76,37,82,35],[76,38,82,36],[77,10,83,8],[77,14,83,12],[77,15,83,13,"alive"],[77,20,83,18],[77,22,83,20],[78,10,84,8,"setUserId"],[78,19,84,17],[78,20,84,18,"uid"],[78,23,84,21],[78,24,84,22],[79,10,85,8],[80,10,86,8],[80,16,86,14,"refresh"],[80,23,86,21],[80,24,86,22,"uid"],[80,27,86,25],[80,28,86,26],[81,8,87,6],[81,9,87,7],[81,10,87,8],[81,17,87,15,"e"],[81,18,87,16],[81,20,87,18],[82,10,88,8,"console"],[82,17,88,15],[82,18,88,16,"error"],[82,23,88,21],[82,24,88,22,"e"],[82,25,88,23],[82,26,88,24],[83,8,89,6],[83,9,89,7],[83,18,89,16],[84,10,90,8],[84,14,90,12,"alive"],[84,19,90,17],[84,21,90,19,"setLoading"],[84,31,90,29],[84,32,90,30],[84,37,90,35],[84,38,90,36],[85,8,91,6],[86,6,92,4],[86,7,92,5],[86,9,92,7],[86,10,92,8],[87,6,94,4],[87,13,94,11],[87,19,94,17],[88,8,95,6,"alive"],[88,13,95,11],[88,16,95,14],[88,21,95,19],[89,6,96,4],[89,7,96,5],[90,4,97,2],[90,5,97,3],[90,7,97,5],[90,8,97,6,"loadUser"],[90,16,97,14],[90,18,97,16,"refresh"],[90,25,97,23],[90,26,97,24],[90,27,97,25],[91,4,99,2],[91,11,99,9],[92,6,100,4,"userId"],[92,12,100,10],[93,6,101,4,"setUserId"],[93,15,101,13],[94,6,102,4,"loading"],[94,13,102,11],[95,6,103,4,"credits"],[95,13,103,11],[96,6,104,4,"setCredits"],[96,16,104,14],[97,6,105,4,"maxCredits"],[97,16,105,14],[98,6,106,4,"setMaxCredits"],[98,19,106,17],[99,6,107,4,"balanceCents"],[99,18,107,16],[100,6,108,4,"setBalanceCents"],[100,21,108,19],[101,6,109,4,"loadUser"],[101,14,109,12],[102,6,110,4,"refresh"],[103,4,111,2],[103,5,111,3],[104,2,112,0],[105,2,112,1,"_s"],[105,4,112,1],[105,5,7,16,"useDateCreditsData"],[105,23,7,34],[106,0,7,34],[106,3]],"functionMap":{"names":["<global>","useDateCreditsData","loadUser","refresh","useEffect$argument_0","<anonymous>"],"mappings":"AAA;OCM;+BCO;GDS;IEG;KF+C;YGI;KCG;KDY;WCE;KDE;GHC;CDe"},"hasCjsExports":false},"type":"js/module"}]}