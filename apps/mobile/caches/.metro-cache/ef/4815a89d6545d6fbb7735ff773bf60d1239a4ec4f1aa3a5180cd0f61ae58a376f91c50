{"dependencies":[{"name":"@babel/runtime/helpers/slicedToArray","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"5y7e5+zC7teYEEC6niD9f5zII1M=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"DEFAULT_RETRY_AFTER\", {\n    enumerable: true,\n    get: function () {\n      return DEFAULT_RETRY_AFTER;\n    }\n  });\n  Object.defineProperty(exports, \"disabledUntil\", {\n    enumerable: true,\n    get: function () {\n      return disabledUntil;\n    }\n  });\n  Object.defineProperty(exports, \"isRateLimited\", {\n    enumerable: true,\n    get: function () {\n      return isRateLimited;\n    }\n  });\n  Object.defineProperty(exports, \"parseRetryAfterHeader\", {\n    enumerable: true,\n    get: function () {\n      return parseRetryAfterHeader;\n    }\n  });\n  Object.defineProperty(exports, \"updateRateLimits\", {\n    enumerable: true,\n    get: function () {\n      return updateRateLimits;\n    }\n  });\n  var _babelRuntimeHelpersSlicedToArray = require(_dependencyMap[0], \"@babel/runtime/helpers/slicedToArray\");\n  var _slicedToArray = _interopDefault(_babelRuntimeHelpersSlicedToArray);\n  // Intentionally keeping the key broad, as we don't know for sure what rate limit headers get returned from backend\n\n  var DEFAULT_RETRY_AFTER = 60 * 1000; // 60 seconds\n\n  /**\n   * Extracts Retry-After value from the request header or returns default value\n   * @param header string representation of 'Retry-After' header\n   * @param now current unix timestamp\n   *\n   */\n  function parseRetryAfterHeader(header) {\n    var now = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Date.now();\n    var headerDelay = parseInt(`${header}`, 10);\n    if (!isNaN(headerDelay)) {\n      return headerDelay * 1000;\n    }\n    var headerDate = Date.parse(`${header}`);\n    if (!isNaN(headerDate)) {\n      return headerDate - now;\n    }\n    return DEFAULT_RETRY_AFTER;\n  }\n\n  /**\n   * Gets the time that the given category is disabled until for rate limiting.\n   * In case no category-specific limit is set but a general rate limit across all categories is active,\n   * that time is returned.\n   *\n   * @return the time in ms that the category is disabled until or 0 if there's no active rate limit.\n   */\n  function disabledUntil(limits, dataCategory) {\n    return limits[dataCategory] || limits.all || 0;\n  }\n\n  /**\n   * Checks if a category is rate limited\n   */\n  function isRateLimited(limits, dataCategory) {\n    var now = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : Date.now();\n    return disabledUntil(limits, dataCategory) > now;\n  }\n\n  /**\n   * Update ratelimits from incoming headers.\n   *\n   * @return the updated RateLimits object.\n   */\n  function updateRateLimits(limits, _ref) {\n    var statusCode = _ref.statusCode,\n      headers = _ref.headers;\n    var now = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : Date.now();\n    var updatedRateLimits = {\n      ...limits\n    };\n\n    // \"The name is case-insensitive.\"\n    // https://developer.mozilla.org/en-US/docs/Web/API/Headers/get\n    var rateLimitHeader = headers?.['x-sentry-rate-limits'];\n    var retryAfterHeader = headers?.['retry-after'];\n    if (rateLimitHeader) {\n      /**\n       * rate limit headers are of the form\n       *     <header>,<header>,..\n       * where each <header> is of the form\n       *     <retry_after>: <categories>: <scope>: <reason_code>: <namespaces>\n       * where\n       *     <retry_after> is a delay in seconds\n       *     <categories> is the event type(s) (error, transaction, etc) being rate limited and is of the form\n       *         <category>;<category>;...\n       *     <scope> is what's being limited (org, project, or key) - ignored by SDK\n       *     <reason_code> is an arbitrary string like \"org_quota\" - ignored by SDK\n       *     <namespaces> Semicolon-separated list of metric namespace identifiers. Defines which namespace(s) will be affected.\n       *         Only present if rate limit applies to the metric_bucket data category.\n       */\n      for (var limit of rateLimitHeader.trim().split(',')) {\n        var _limit$split = limit.split(':', 5),\n          _limit$split2 = (0, _slicedToArray.default)(_limit$split, 5),\n          retryAfter = _limit$split2[0],\n          categories = _limit$split2[1],\n          namespaces = _limit$split2[4];\n        var headerDelay = parseInt(retryAfter, 10);\n        var delay = (!isNaN(headerDelay) ? headerDelay : 60) * 1000; // 60sec default\n        if (!categories) {\n          updatedRateLimits.all = now + delay;\n        } else {\n          for (var category of categories.split(';')) {\n            if (category === 'metric_bucket') {\n              // namespaces will be present when category === 'metric_bucket'\n              if (!namespaces || namespaces.split(';').includes('custom')) {\n                updatedRateLimits[category] = now + delay;\n              }\n            } else {\n              updatedRateLimits[category] = now + delay;\n            }\n          }\n        }\n      }\n    } else if (retryAfterHeader) {\n      updatedRateLimits.all = now + parseRetryAfterHeader(retryAfterHeader, now);\n    } else if (statusCode === 429) {\n      updatedRateLimits.all = now + 60 * 1000;\n    }\n    return updatedRateLimits;\n  }\n});","lineCount":148,"map":[[12,2,105,0,"Object"],[12,8,105,0],[12,9,105,0,"defineProperty"],[12,23,105,0],[12,24,105,0,"exports"],[12,31,105,0],[13,4,105,0,"enumerable"],[13,14,105,0],[14,4,105,0,"get"],[14,7,105,0],[14,18,105,0,"get"],[14,19,105,0],[15,6,105,0],[15,13,105,9,"DEFAULT_RETRY_AFTER"],[15,32,105,28],[16,4,105,28],[17,2,105,28],[18,2,105,0,"Object"],[18,8,105,0],[18,9,105,0,"defineProperty"],[18,23,105,0],[18,24,105,0,"exports"],[18,31,105,0],[19,4,105,0,"enumerable"],[19,14,105,0],[20,4,105,0,"get"],[20,7,105,0],[20,18,105,0,"get"],[20,19,105,0],[21,6,105,0],[21,13,105,30,"disabledUntil"],[21,26,105,43],[22,4,105,43],[23,2,105,43],[24,2,105,0,"Object"],[24,8,105,0],[24,9,105,0,"defineProperty"],[24,23,105,0],[24,24,105,0,"exports"],[24,31,105,0],[25,4,105,0,"enumerable"],[25,14,105,0],[26,4,105,0,"get"],[26,7,105,0],[26,18,105,0,"get"],[26,19,105,0],[27,6,105,0],[27,13,105,45,"isRateLimited"],[27,26,105,58],[28,4,105,58],[29,2,105,58],[30,2,105,0,"Object"],[30,8,105,0],[30,9,105,0,"defineProperty"],[30,23,105,0],[30,24,105,0,"exports"],[30,31,105,0],[31,4,105,0,"enumerable"],[31,14,105,0],[32,4,105,0,"get"],[32,7,105,0],[32,18,105,0,"get"],[32,19,105,0],[33,6,105,0],[33,13,105,60,"parseRetryAfterHeader"],[33,34,105,81],[34,4,105,81],[35,2,105,81],[36,2,105,0,"Object"],[36,8,105,0],[36,9,105,0,"defineProperty"],[36,23,105,0],[36,24,105,0,"exports"],[36,31,105,0],[37,4,105,0,"enumerable"],[37,14,105,0],[38,4,105,0,"get"],[38,7,105,0],[38,18,105,0,"get"],[38,19,105,0],[39,6,105,0],[39,13,105,83,"updateRateLimits"],[39,29,105,99],[40,4,105,99],[41,2,105,99],[42,2,105,102],[42,6,105,102,"_babelRuntimeHelpersSlicedToArray"],[42,39,105,102],[42,42,105,102,"require"],[42,49,105,102],[42,50,105,102,"_dependencyMap"],[42,64,105,102],[43,2,105,102],[43,6,105,102,"_slicedToArray"],[43,20,105,102],[43,23,105,102,"_interopDefault"],[43,38,105,102],[43,39,105,102,"_babelRuntimeHelpersSlicedToArray"],[43,72,105,102],[44,2,1,0],[46,2,3,0],[46,6,3,6,"DEFAULT_RETRY_AFTER"],[46,25,3,25],[46,28,3,28],[46,30,3,30],[46,33,3,33],[46,37,3,37],[46,38,3,38],[46,39,3,39],[48,2,5,0],[49,0,6,0],[50,0,7,0],[51,0,8,0],[52,0,9,0],[53,0,10,0],[54,2,11,0],[54,11,11,9,"parseRetryAfterHeader"],[54,32,11,30,"parseRetryAfterHeader"],[54,33,11,31,"header"],[54,39,11,37],[54,41,11,57],[55,4,11,57],[55,8,11,39,"now"],[55,11,11,42],[55,14,11,42,"arguments"],[55,23,11,42],[55,24,11,42,"length"],[55,30,11,42],[55,38,11,42,"arguments"],[55,47,11,42],[55,55,11,42,"undefined"],[55,64,11,42],[55,67,11,42,"arguments"],[55,76,11,42],[55,82,11,45,"Date"],[55,86,11,49],[55,87,11,50,"now"],[55,90,11,53],[55,91,11,54],[55,92,11,55],[56,4,12,2],[56,8,12,8,"headerDelay"],[56,19,12,19],[56,22,12,22,"parseInt"],[56,30,12,30],[56,31,12,31],[56,34,12,34,"header"],[56,40,12,40],[56,42,12,42],[56,44,12,44],[56,46,12,46],[56,47,12,47],[57,4,13,2],[57,8,13,6],[57,9,13,7,"isNaN"],[57,14,13,12],[57,15,13,13,"headerDelay"],[57,26,13,24],[57,27,13,25],[57,29,13,27],[58,6,14,4],[58,13,14,11,"headerDelay"],[58,24,14,22],[58,27,14,25],[58,31,14,29],[59,4,15,2],[60,4,17,2],[60,8,17,8,"headerDate"],[60,18,17,18],[60,21,17,21,"Date"],[60,25,17,25],[60,26,17,26,"parse"],[60,31,17,31],[60,32,17,32],[60,35,17,35,"header"],[60,41,17,41],[60,43,17,43],[60,44,17,44],[61,4,18,2],[61,8,18,6],[61,9,18,7,"isNaN"],[61,14,18,12],[61,15,18,13,"headerDate"],[61,25,18,23],[61,26,18,24],[61,28,18,26],[62,6,19,4],[62,13,19,11,"headerDate"],[62,23,19,21],[62,26,19,24,"now"],[62,29,19,27],[63,4,20,2],[64,4,22,2],[64,11,22,9,"DEFAULT_RETRY_AFTER"],[64,30,22,28],[65,2,23,0],[67,2,25,0],[68,0,26,0],[69,0,27,0],[70,0,28,0],[71,0,29,0],[72,0,30,0],[73,0,31,0],[74,2,32,0],[74,11,32,9,"disabledUntil"],[74,24,32,22,"disabledUntil"],[74,25,32,23,"limits"],[74,31,32,29],[74,33,32,31,"dataCategory"],[74,45,32,43],[74,47,32,45],[75,4,33,2],[75,11,33,9,"limits"],[75,17,33,15],[75,18,33,16,"dataCategory"],[75,30,33,28],[75,31,33,29],[75,35,33,33,"limits"],[75,41,33,39],[75,42,33,40,"all"],[75,45,33,43],[75,49,33,47],[75,50,33,48],[76,2,34,0],[78,2,36,0],[79,0,37,0],[80,0,38,0],[81,2,39,0],[81,11,39,9,"isRateLimited"],[81,24,39,22,"isRateLimited"],[81,25,39,23,"limits"],[81,31,39,29],[81,33,39,31,"dataCategory"],[81,45,39,43],[81,47,39,63],[82,4,39,63],[82,8,39,45,"now"],[82,11,39,48],[82,14,39,48,"arguments"],[82,23,39,48],[82,24,39,48,"length"],[82,30,39,48],[82,38,39,48,"arguments"],[82,47,39,48],[82,55,39,48,"undefined"],[82,64,39,48],[82,67,39,48,"arguments"],[82,76,39,48],[82,82,39,51,"Date"],[82,86,39,55],[82,87,39,56,"now"],[82,90,39,59],[82,91,39,60],[82,92,39,61],[83,4,40,2],[83,11,40,9,"disabledUntil"],[83,24,40,22],[83,25,40,23,"limits"],[83,31,40,29],[83,33,40,31,"dataCategory"],[83,45,40,43],[83,46,40,44],[83,49,40,47,"now"],[83,52,40,50],[84,2,41,0],[86,2,43,0],[87,0,44,0],[88,0,45,0],[89,0,46,0],[90,0,47,0],[91,2,48,0],[91,11,48,9,"updateRateLimits"],[91,27,48,25,"updateRateLimits"],[91,28,49,2,"limits"],[91,34,49,8],[91,36,49,8,"_ref"],[91,40,49,8],[91,42,52,2],[92,4,52,2],[92,8,50,4,"statusCode"],[92,18,50,14],[92,21,50,14,"_ref"],[92,25,50,14],[92,26,50,4,"statusCode"],[92,36,50,14],[93,6,50,16,"headers"],[93,13,50,23],[93,16,50,23,"_ref"],[93,20,50,23],[93,21,50,16,"headers"],[93,28,50,23],[94,4,50,23],[94,8,51,2,"now"],[94,11,51,5],[94,14,51,5,"arguments"],[94,23,51,5],[94,24,51,5,"length"],[94,30,51,5],[94,38,51,5,"arguments"],[94,47,51,5],[94,55,51,5,"undefined"],[94,64,51,5],[94,67,51,5,"arguments"],[94,76,51,5],[94,82,51,8,"Date"],[94,86,51,12],[94,87,51,13,"now"],[94,90,51,16],[94,91,51,17],[94,92,51,18],[95,4,53,2],[95,8,53,8,"updatedRateLimits"],[95,25,53,25],[95,28,53,28],[96,6,54,4],[96,9,54,7,"limits"],[97,4,55,2],[97,5,55,3],[99,4,57,2],[100,4,58,2],[101,4,59,2],[101,8,59,8,"rateLimitHeader"],[101,23,59,23],[101,26,59,26,"headers"],[101,33,59,33],[101,36,59,36],[101,58,59,58],[101,59,59,59],[102,4,60,2],[102,8,60,8,"retryAfterHeader"],[102,24,60,24],[102,27,60,27,"headers"],[102,34,60,34],[102,37,60,37],[102,50,60,50],[102,51,60,51],[103,4,62,2],[103,8,62,6,"rateLimitHeader"],[103,23,62,21],[103,25,62,23],[104,6,63,4],[105,0,64,0],[106,0,65,0],[107,0,66,0],[108,0,67,0],[109,0,68,0],[110,0,69,0],[111,0,70,0],[112,0,71,0],[113,0,72,0],[114,0,73,0],[115,0,74,0],[116,0,75,0],[117,0,76,0],[118,6,77,4],[118,11,77,9],[118,15,77,15,"limit"],[118,20,77,20],[118,24,77,24,"rateLimitHeader"],[118,39,77,39],[118,40,77,40,"trim"],[118,44,77,44],[118,45,77,45],[118,46,77,46],[118,47,77,47,"split"],[118,52,77,52],[118,53,77,53],[118,56,77,56],[118,57,77,57],[118,59,77,59],[119,8,78,6],[119,12,78,6,"_limit$split"],[119,24,78,6],[119,27,78,55,"limit"],[119,32,78,60],[119,33,78,61,"split"],[119,38,78,66],[119,39,78,67],[119,42,78,70],[119,44,78,72],[119,45,78,73],[119,46,78,74],[120,10,78,74,"_limit$split2"],[120,23,78,74],[120,30,78,74,"_slicedToArray"],[120,44,78,74],[120,45,78,74,"default"],[120,52,78,74],[120,54,78,74,"_limit$split"],[120,66,78,74],[121,10,78,13,"retryAfter"],[121,20,78,23],[121,23,78,23,"_limit$split2"],[121,36,78,23],[122,10,78,25,"categories"],[122,20,78,35],[122,23,78,35,"_limit$split2"],[122,36,78,35],[123,10,78,41,"namespaces"],[123,20,78,51],[123,23,78,51,"_limit$split2"],[123,36,78,51],[124,8,79,6],[124,12,79,12,"headerDelay"],[124,23,79,23],[124,26,79,26,"parseInt"],[124,34,79,34],[124,35,79,35,"retryAfter"],[124,45,79,45],[124,47,79,47],[124,49,79,49],[124,50,79,50],[125,8,80,6],[125,12,80,12,"delay"],[125,17,80,17],[125,20,80,20],[125,21,80,21],[125,22,80,22,"isNaN"],[125,27,80,27],[125,28,80,28,"headerDelay"],[125,39,80,39],[125,40,80,40],[125,43,80,43,"headerDelay"],[125,54,80,54],[125,57,80,57],[125,59,80,59],[125,63,80,63],[125,67,80,67],[125,68,80,68],[125,69,80,69],[126,8,81,6],[126,12,81,10],[126,13,81,11,"categories"],[126,23,81,21],[126,25,81,23],[127,10,82,8,"updatedRateLimits"],[127,27,82,25],[127,28,82,26,"all"],[127,31,82,29],[127,34,82,32,"now"],[127,37,82,35],[127,40,82,38,"delay"],[127,45,82,43],[128,8,83,6],[128,9,83,7],[128,15,83,13],[129,10,84,8],[129,15,84,13],[129,19,84,19,"category"],[129,27,84,27],[129,31,84,31,"categories"],[129,41,84,41],[129,42,84,42,"split"],[129,47,84,47],[129,48,84,48],[129,51,84,51],[129,52,84,52],[129,54,84,54],[130,12,85,10],[130,16,85,14,"category"],[130,24,85,22],[130,29,85,27],[130,44,85,42],[130,46,85,44],[131,14,86,12],[132,14,87,12],[132,18,87,16],[132,19,87,17,"namespaces"],[132,29,87,27],[132,33,87,31,"namespaces"],[132,43,87,41],[132,44,87,42,"split"],[132,49,87,47],[132,50,87,48],[132,53,87,51],[132,54,87,52],[132,55,87,53,"includes"],[132,63,87,61],[132,64,87,62],[132,72,87,70],[132,73,87,71],[132,75,87,73],[133,16,88,14,"updatedRateLimits"],[133,33,88,31],[133,34,88,32,"category"],[133,42,88,40],[133,43,88,41],[133,46,88,44,"now"],[133,49,88,47],[133,52,88,50,"delay"],[133,57,88,55],[134,14,89,12],[135,12,90,10],[135,13,90,11],[135,19,90,17],[136,14,91,12,"updatedRateLimits"],[136,31,91,29],[136,32,91,30,"category"],[136,40,91,38],[136,41,91,39],[136,44,91,42,"now"],[136,47,91,45],[136,50,91,48,"delay"],[136,55,91,53],[137,12,92,10],[138,10,93,8],[139,8,94,6],[140,6,95,4],[141,4,96,2],[141,5,96,3],[141,11,96,9],[141,15,96,13,"retryAfterHeader"],[141,31,96,29],[141,33,96,31],[142,6,97,4,"updatedRateLimits"],[142,23,97,21],[142,24,97,22,"all"],[142,27,97,25],[142,30,97,28,"now"],[142,33,97,31],[142,36,97,34,"parseRetryAfterHeader"],[142,57,97,55],[142,58,97,56,"retryAfterHeader"],[142,74,97,72],[142,76,97,74,"now"],[142,79,97,77],[142,80,97,78],[143,4,98,2],[143,5,98,3],[143,11,98,9],[143,15,98,13,"statusCode"],[143,25,98,23],[143,30,98,28],[143,33,98,31],[143,35,98,33],[144,6,99,4,"updatedRateLimits"],[144,23,99,21],[144,24,99,22,"all"],[144,27,99,25],[144,30,99,28,"now"],[144,33,99,31],[144,36,99,34],[144,38,99,36],[144,41,99,39],[144,45,99,43],[145,4,100,2],[146,4,102,2],[146,11,102,9,"updatedRateLimits"],[146,28,102,26],[147,2,103,0],[148,0,103,1],[148,3]],"functionMap":{"names":["<global>","parseRetryAfterHeader","disabledUntil","isRateLimited","updateRateLimits"],"mappings":"AAA;ACU;CDY;AES;CFE;AGK;CHE;AIO;CJuD"},"hasCjsExports":false},"type":"js/module"}]}