{"dependencies":[{"name":"./gen-ai-attributes.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":152,"index":152}}],"key":"EmAYAYXJGPnzpSXN+q9ZtGOEkn0=","exportNames":["*"],"imports":1}},{"name":"./messageTruncation.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":153},"end":{"line":2,"column":89,"index":242}}],"key":"WqwXXFdOM+M2Ih4VIkxFRH75SGE=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"buildMethodPath\", {\n    enumerable: true,\n    get: function () {\n      return buildMethodPath;\n    }\n  });\n  Object.defineProperty(exports, \"getFinalOperationName\", {\n    enumerable: true,\n    get: function () {\n      return getFinalOperationName;\n    }\n  });\n  Object.defineProperty(exports, \"getSpanOperation\", {\n    enumerable: true,\n    get: function () {\n      return getSpanOperation;\n    }\n  });\n  Object.defineProperty(exports, \"getTruncatedJsonString\", {\n    enumerable: true,\n    get: function () {\n      return getTruncatedJsonString;\n    }\n  });\n  Object.defineProperty(exports, \"setTokenUsageAttributes\", {\n    enumerable: true,\n    get: function () {\n      return setTokenUsageAttributes;\n    }\n  });\n  var _genAiAttributesJs = require(_dependencyMap[0]);\n  var _messageTruncationJs = require(_dependencyMap[1]);\n  /**\n   * Maps AI method paths to Sentry operation name\n   */\n  function getFinalOperationName(methodPath) {\n    if (methodPath.includes('messages')) {\n      return 'messages';\n    }\n    if (methodPath.includes('completions')) {\n      return 'completions';\n    }\n    if (methodPath.includes('models')) {\n      return 'models';\n    }\n    if (methodPath.includes('chat')) {\n      return 'chat';\n    }\n    return methodPath.split('.').pop() || 'unknown';\n  }\n\n  /**\n   * Get the span operation for AI methods\n   * Following Sentry's convention: \"gen_ai.{operation_name}\"\n   */\n  function getSpanOperation(methodPath) {\n    return `gen_ai.${getFinalOperationName(methodPath)}`;\n  }\n\n  /**\n   * Build method path from current traversal\n   */\n  function buildMethodPath(currentPath, prop) {\n    return currentPath ? `${currentPath}.${prop}` : prop;\n  }\n\n  /**\n   * Set token usage attributes\n   * @param span - The span to add attributes to\n   * @param promptTokens - The number of prompt tokens\n   * @param completionTokens - The number of completion tokens\n   * @param cachedInputTokens - The number of cached input tokens\n   * @param cachedOutputTokens - The number of cached output tokens\n   */\n  function setTokenUsageAttributes(span, promptTokens, completionTokens, cachedInputTokens, cachedOutputTokens) {\n    if (promptTokens !== undefined) {\n      span.setAttributes({\n        [_genAiAttributesJs.GEN_AI_USAGE_INPUT_TOKENS_ATTRIBUTE]: promptTokens\n      });\n    }\n    if (completionTokens !== undefined) {\n      span.setAttributes({\n        [_genAiAttributesJs.GEN_AI_USAGE_OUTPUT_TOKENS_ATTRIBUTE]: completionTokens\n      });\n    }\n    if (promptTokens !== undefined || completionTokens !== undefined || cachedInputTokens !== undefined || cachedOutputTokens !== undefined) {\n      /**\n       * Total input tokens in a request is the summation of `input_tokens`,\n       * `cache_creation_input_tokens`, and `cache_read_input_tokens`.\n       */\n      var totalTokens = (promptTokens ?? 0) + (completionTokens ?? 0) + (cachedInputTokens ?? 0) + (cachedOutputTokens ?? 0);\n      span.setAttributes({\n        [_genAiAttributesJs.GEN_AI_USAGE_TOTAL_TOKENS_ATTRIBUTE]: totalTokens\n      });\n    }\n  }\n\n  /**\n   * Get the truncated JSON string for a string or array of strings.\n   *\n   * @param value - The string or array of strings to truncate\n   * @returns The truncated JSON string\n   */\n  function getTruncatedJsonString(value) {\n    if (typeof value === 'string') {\n      // Some values are already JSON strings, so we don't need to duplicate the JSON parsing\n      return (0, _messageTruncationJs.truncateGenAiStringInput)(value);\n    }\n    if (Array.isArray(value)) {\n      // truncateGenAiMessages returns an array of strings, so we need to stringify it\n      var truncatedMessages = (0, _messageTruncationJs.truncateGenAiMessages)(value);\n      return JSON.stringify(truncatedMessages);\n    }\n    // value is an object, so we need to stringify it\n    return JSON.stringify(value);\n  }\n});","lineCount":123,"map":[[7,2,102,0,"Object"],[7,8,102,0],[7,9,102,0,"defineProperty"],[7,23,102,0],[7,24,102,0,"exports"],[7,31,102,0],[8,4,102,0,"enumerable"],[8,14,102,0],[9,4,102,0,"get"],[9,7,102,0],[9,18,102,0,"get"],[9,19,102,0],[10,6,102,0],[10,13,102,9,"buildMethodPath"],[10,28,102,24],[11,4,102,24],[12,2,102,24],[13,2,102,0,"Object"],[13,8,102,0],[13,9,102,0,"defineProperty"],[13,23,102,0],[13,24,102,0,"exports"],[13,31,102,0],[14,4,102,0,"enumerable"],[14,14,102,0],[15,4,102,0,"get"],[15,7,102,0],[15,18,102,0,"get"],[15,19,102,0],[16,6,102,0],[16,13,102,26,"getFinalOperationName"],[16,34,102,47],[17,4,102,47],[18,2,102,47],[19,2,102,0,"Object"],[19,8,102,0],[19,9,102,0,"defineProperty"],[19,23,102,0],[19,24,102,0,"exports"],[19,31,102,0],[20,4,102,0,"enumerable"],[20,14,102,0],[21,4,102,0,"get"],[21,7,102,0],[21,18,102,0,"get"],[21,19,102,0],[22,6,102,0],[22,13,102,49,"getSpanOperation"],[22,29,102,65],[23,4,102,65],[24,2,102,65],[25,2,102,0,"Object"],[25,8,102,0],[25,9,102,0,"defineProperty"],[25,23,102,0],[25,24,102,0,"exports"],[25,31,102,0],[26,4,102,0,"enumerable"],[26,14,102,0],[27,4,102,0,"get"],[27,7,102,0],[27,18,102,0,"get"],[27,19,102,0],[28,6,102,0],[28,13,102,67,"getTruncatedJsonString"],[28,35,102,89],[29,4,102,89],[30,2,102,89],[31,2,102,0,"Object"],[31,8,102,0],[31,9,102,0,"defineProperty"],[31,23,102,0],[31,24,102,0,"exports"],[31,31,102,0],[32,4,102,0,"enumerable"],[32,14,102,0],[33,4,102,0,"get"],[33,7,102,0],[33,18,102,0,"get"],[33,19,102,0],[34,6,102,0],[34,13,102,91,"setTokenUsageAttributes"],[34,36,102,114],[35,4,102,114],[36,2,102,114],[37,2,1,0],[37,6,1,0,"_genAiAttributesJs"],[37,24,1,0],[37,27,1,0,"require"],[37,34,1,0],[37,35,1,0,"_dependencyMap"],[37,49,1,0],[38,2,2,0],[38,6,2,0,"_messageTruncationJs"],[38,26,2,0],[38,29,2,0,"require"],[38,36,2,0],[38,37,2,0,"_dependencyMap"],[38,51,2,0],[39,2,4,0],[40,0,5,0],[41,0,6,0],[42,2,7,0],[42,11,7,9,"getFinalOperationName"],[42,32,7,30,"getFinalOperationName"],[42,33,7,31,"methodPath"],[42,43,7,41],[42,45,7,43],[43,4,8,2],[43,8,8,6,"methodPath"],[43,18,8,16],[43,19,8,17,"includes"],[43,27,8,25],[43,28,8,26],[43,38,8,36],[43,39,8,37],[43,41,8,39],[44,6,9,4],[44,13,9,11],[44,23,9,21],[45,4,10,2],[46,4,11,2],[46,8,11,6,"methodPath"],[46,18,11,16],[46,19,11,17,"includes"],[46,27,11,25],[46,28,11,26],[46,41,11,39],[46,42,11,40],[46,44,11,42],[47,6,12,4],[47,13,12,11],[47,26,12,24],[48,4,13,2],[49,4,14,2],[49,8,14,6,"methodPath"],[49,18,14,16],[49,19,14,17,"includes"],[49,27,14,25],[49,28,14,26],[49,36,14,34],[49,37,14,35],[49,39,14,37],[50,6,15,4],[50,13,15,11],[50,21,15,19],[51,4,16,2],[52,4,17,2],[52,8,17,6,"methodPath"],[52,18,17,16],[52,19,17,17,"includes"],[52,27,17,25],[52,28,17,26],[52,34,17,32],[52,35,17,33],[52,37,17,35],[53,6,18,4],[53,13,18,11],[53,19,18,17],[54,4,19,2],[55,4,20,2],[55,11,20,9,"methodPath"],[55,21,20,19],[55,22,20,20,"split"],[55,27,20,25],[55,28,20,26],[55,31,20,29],[55,32,20,30],[55,33,20,31,"pop"],[55,36,20,34],[55,37,20,35],[55,38,20,36],[55,42,20,40],[55,51,20,49],[56,2,21,0],[58,2,23,0],[59,0,24,0],[60,0,25,0],[61,0,26,0],[62,2,27,0],[62,11,27,9,"getSpanOperation"],[62,27,27,25,"getSpanOperation"],[62,28,27,26,"methodPath"],[62,38,27,36],[62,40,27,38],[63,4,28,2],[63,11,28,9],[63,21,28,19,"getFinalOperationName"],[63,42,28,40],[63,43,28,41,"methodPath"],[63,53,28,51],[63,54,28,52],[63,56,28,54],[64,2,29,0],[66,2,31,0],[67,0,32,0],[68,0,33,0],[69,2,34,0],[69,11,34,9,"buildMethodPath"],[69,26,34,24,"buildMethodPath"],[69,27,34,25,"currentPath"],[69,38,34,36],[69,40,34,38,"prop"],[69,44,34,42],[69,46,34,44],[70,4,35,2],[70,11,35,9,"currentPath"],[70,22,35,20],[70,25,35,23],[70,28,35,26,"currentPath"],[70,39,35,37],[70,43,35,41,"prop"],[70,47,35,45],[70,49,35,47],[70,52,35,50,"prop"],[70,56,35,54],[71,2,36,0],[73,2,38,0],[74,0,39,0],[75,0,40,0],[76,0,41,0],[77,0,42,0],[78,0,43,0],[79,0,44,0],[80,0,45,0],[81,2,46,0],[81,11,46,9,"setTokenUsageAttributes"],[81,34,46,32,"setTokenUsageAttributes"],[81,35,47,2,"span"],[81,39,47,6],[81,41,48,2,"promptTokens"],[81,53,48,14],[81,55,49,2,"completionTokens"],[81,71,49,18],[81,73,50,2,"cachedInputTokens"],[81,90,50,19],[81,92,51,2,"cachedOutputTokens"],[81,110,51,20],[81,112,52,2],[82,4,53,2],[82,8,53,6,"promptTokens"],[82,20,53,18],[82,25,53,23,"undefined"],[82,34,53,32],[82,36,53,34],[83,6,54,4,"span"],[83,10,54,8],[83,11,54,9,"setAttributes"],[83,24,54,22],[83,25,54,23],[84,8,55,6],[84,9,55,7,"GEN_AI_USAGE_INPUT_TOKENS_ATTRIBUTE"],[84,27,55,42],[84,28,55,42,"GEN_AI_USAGE_INPUT_TOKENS_ATTRIBUTE"],[84,63,55,42],[84,66,55,45,"promptTokens"],[85,6,56,4],[85,7,56,5],[85,8,56,6],[86,4,57,2],[87,4,58,2],[87,8,58,6,"completionTokens"],[87,24,58,22],[87,29,58,27,"undefined"],[87,38,58,36],[87,40,58,38],[88,6,59,4,"span"],[88,10,59,8],[88,11,59,9,"setAttributes"],[88,24,59,22],[88,25,59,23],[89,8,60,6],[89,9,60,7,"GEN_AI_USAGE_OUTPUT_TOKENS_ATTRIBUTE"],[89,27,60,43],[89,28,60,43,"GEN_AI_USAGE_OUTPUT_TOKENS_ATTRIBUTE"],[89,64,60,43],[89,67,60,46,"completionTokens"],[90,6,61,4],[90,7,61,5],[90,8,61,6],[91,4,62,2],[92,4,63,2],[92,8,64,4,"promptTokens"],[92,20,64,16],[92,25,64,21,"undefined"],[92,34,64,30],[92,38,65,4,"completionTokens"],[92,54,65,20],[92,59,65,25,"undefined"],[92,68,65,34],[92,72,66,4,"cachedInputTokens"],[92,89,66,21],[92,94,66,26,"undefined"],[92,103,66,35],[92,107,67,4,"cachedOutputTokens"],[92,125,67,22],[92,130,67,27,"undefined"],[92,139,67,36],[92,141,68,4],[93,6,69,4],[94,0,70,0],[95,0,71,0],[96,0,72,0],[97,6,73,4],[97,10,73,10,"totalTokens"],[97,21,73,21],[97,24,74,6],[97,25,74,7,"promptTokens"],[97,37,74,19],[97,41,74,23],[97,42,74,24],[97,47,74,29,"completionTokens"],[97,63,74,45],[97,67,74,49],[97,68,74,50],[97,69,74,51],[97,73,74,55,"cachedInputTokens"],[97,90,74,72],[97,94,74,76],[97,95,74,77],[97,96,74,78],[97,100,74,82,"cachedOutputTokens"],[97,118,74,100],[97,122,74,104],[97,123,74,105],[97,124,74,106],[98,6,76,4,"span"],[98,10,76,8],[98,11,76,9,"setAttributes"],[98,24,76,22],[98,25,76,23],[99,8,77,6],[99,9,77,7,"GEN_AI_USAGE_TOTAL_TOKENS_ATTRIBUTE"],[99,27,77,42],[99,28,77,42,"GEN_AI_USAGE_TOTAL_TOKENS_ATTRIBUTE"],[99,63,77,42],[99,66,77,45,"totalTokens"],[100,6,78,4],[100,7,78,5],[100,8,78,6],[101,4,79,2],[102,2,80,0],[104,2,82,0],[105,0,83,0],[106,0,84,0],[107,0,85,0],[108,0,86,0],[109,0,87,0],[110,2,88,0],[110,11,88,9,"getTruncatedJsonString"],[110,33,88,31,"getTruncatedJsonString"],[110,34,88,32,"value"],[110,39,88,37],[110,41,88,39],[111,4,89,2],[111,8,89,6],[111,15,89,13,"value"],[111,20,89,18],[111,25,89,23],[111,33,89,31],[111,35,89,33],[112,6,90,4],[113,6,91,4],[113,13,91,11],[113,17,91,11,"truncateGenAiStringInput"],[113,37,91,35],[113,38,91,35,"truncateGenAiStringInput"],[113,62,91,35],[113,64,91,36,"value"],[113,69,91,41],[113,70,91,42],[114,4,92,2],[115,4,93,2],[115,8,93,6,"Array"],[115,13,93,11],[115,14,93,12,"isArray"],[115,21,93,19],[115,22,93,20,"value"],[115,27,93,25],[115,28,93,26],[115,30,93,28],[116,6,94,4],[117,6,95,4],[117,10,95,10,"truncatedMessages"],[117,27,95,27],[117,30,95,30],[117,34,95,30,"truncateGenAiMessages"],[117,54,95,51],[117,55,95,51,"truncateGenAiMessages"],[117,76,95,51],[117,78,95,52,"value"],[117,83,95,57],[117,84,95,58],[118,6,96,4],[118,13,96,11,"JSON"],[118,17,96,15],[118,18,96,16,"stringify"],[118,27,96,25],[118,28,96,26,"truncatedMessages"],[118,45,96,43],[118,46,96,44],[119,4,97,2],[120,4,98,2],[121,4,99,2],[121,11,99,9,"JSON"],[121,15,99,13],[121,16,99,14,"stringify"],[121,25,99,23],[121,26,99,24,"value"],[121,31,99,29],[121,32,99,30],[122,2,100,0],[123,0,100,1],[123,3]],"functionMap":{"names":["<global>","getFinalOperationName","getSpanOperation","buildMethodPath","setTokenUsageAttributes","getTruncatedJsonString"],"mappings":"AAA;ACM;CDc;AEM;CFE;AGK;CHE;AIU;CJkC;AKQ;CLY"},"hasCjsExports":false},"type":"js/module"}]}