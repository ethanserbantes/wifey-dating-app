{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":42,"index":42}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.usePreChatDecisionTimers = usePreChatDecisionTimers;\n  var _react = require(_dependencyMap[0], \"react\");\n  function usePreChatDecisionTimers({\n    user,\n    preChatRows,\n    loading,\n    otherChatsHidden,\n    loadMatches\n  }) {\n    _s();\n    const startedDecisionTimersRef = (0, _react.useRef)(new Set());\n    (0, _react.useEffect)(() => {\n      if (otherChatsHidden) return;\n      const userIdNum = Number(user?.id);\n      if (!Number.isFinite(userIdNum)) return;\n      if (loading) return;\n      const candidates = (Array.isArray(preChatRows) ? preChatRows : []).filter(m => String(m?.prechat_role) === \"receiver\").filter(m => !m?.decision_expires_at).filter(m => !m?.terminal_state).slice(0, 6);\n      const toStart = candidates.filter(m => {\n        const idStr = m?.match_id != null ? String(m.match_id) : \"\";\n        if (!idStr) return false;\n        if (startedDecisionTimersRef.current.has(idStr)) return false;\n        return true;\n      });\n      if (toStart.length === 0) return;\n      toStart.forEach(m => {\n        const idStr = String(m.match_id);\n        startedDecisionTimersRef.current.add(idStr);\n      });\n      let cancelled = false;\n      const run = async () => {\n        try {\n          const results = await Promise.all(toStart.map(async m => {\n            const matchIdStr = String(m.match_id);\n            const resp = await fetch(`/api/conversations/prechat-seen/${encodeURIComponent(matchIdStr)}`, {\n              method: \"POST\",\n              headers: {\n                \"Content-Type\": \"application/json\"\n              },\n              body: JSON.stringify({\n                userId: userIdNum\n              })\n            });\n            if (!resp.ok) {\n              const text = await resp.text().catch(() => \"\");\n              throw new Error(`When posting /api/conversations/prechat-seen/${matchIdStr}, the response was [${resp.status}] ${resp.statusText}. ${text}`);\n            }\n            const data = await resp.json().catch(() => ({}));\n            return Boolean(data?.started);\n          }));\n          const startedAny = results.some(Boolean);\n          if (!cancelled && startedAny) {\n            await loadMatches(userIdNum);\n          }\n        } catch (e) {\n          console.error(e);\n        }\n      };\n      run();\n      return () => {\n        cancelled = true;\n      };\n    }, [loading, loadMatches, otherChatsHidden, preChatRows, user?.id]);\n  }\n  _s(usePreChatDecisionTimers, \"9UffgzQKEzd7mmYodndltzVYOJ0=\");\n});","lineCount":72,"map":[[8,2,3,0,"exports"],[8,9,3,0],[8,10,3,0,"usePreChatDecisionTimers"],[8,34,3,0],[8,37,3,0,"usePreChatDecisionTimers"],[8,61,3,0],[9,2,1,0],[9,6,1,0,"_react"],[9,12,1,0],[9,15,1,0,"require"],[9,22,1,0],[9,23,1,0,"_dependencyMap"],[9,37,1,0],[10,2,3,7],[10,11,3,16,"usePreChatDecisionTimers"],[10,35,3,40,"usePreChatDecisionTimers"],[10,36,3,41],[11,4,4,2,"user"],[11,8,4,6],[12,4,5,2,"preChatRows"],[12,15,5,13],[13,4,6,2,"loading"],[13,11,6,9],[14,4,7,2,"otherChatsHidden"],[14,20,7,18],[15,4,8,2,"loadMatches"],[16,2,9,0],[16,3,9,1],[16,5,9,3],[17,4,9,3,"_s"],[17,6,9,3],[18,4,10,2],[18,10,10,8,"startedDecisionTimersRef"],[18,34,10,32],[18,37,10,35],[18,41,10,35,"useRef"],[18,47,10,41],[18,48,10,41,"useRef"],[18,54,10,41],[18,56,10,42],[18,60,10,46,"Set"],[18,63,10,49],[18,64,10,50],[18,65,10,51],[18,66,10,52],[19,4,12,2],[19,8,12,2,"useEffect"],[19,14,12,11],[19,15,12,11,"useEffect"],[19,24,12,11],[19,26,12,12],[19,32,12,18],[20,6,13,4],[20,10,13,8,"otherChatsHidden"],[20,26,13,24],[20,28,13,26],[21,6,15,4],[21,12,15,10,"userIdNum"],[21,21,15,19],[21,24,15,22,"Number"],[21,30,15,28],[21,31,15,29,"user"],[21,35,15,33],[21,37,15,35,"id"],[21,39,15,37],[21,40,15,38],[22,6,16,4],[22,10,16,8],[22,11,16,9,"Number"],[22,17,16,15],[22,18,16,16,"isFinite"],[22,26,16,24],[22,27,16,25,"userIdNum"],[22,36,16,34],[22,37,16,35],[22,39,16,37],[23,6,17,4],[23,10,17,8,"loading"],[23,17,17,15],[23,19,17,17],[24,6,19,4],[24,12,19,10,"candidates"],[24,22,19,20],[24,25,19,23],[24,26,19,24,"Array"],[24,31,19,29],[24,32,19,30,"isArray"],[24,39,19,37],[24,40,19,38,"preChatRows"],[24,51,19,49],[24,52,19,50],[24,55,19,53,"preChatRows"],[24,66,19,64],[24,69,19,67],[24,71,19,69],[24,73,20,7,"filter"],[24,79,20,13],[24,80,20,15,"m"],[24,81,20,16],[24,85,20,21,"String"],[24,91,20,27],[24,92,20,28,"m"],[24,93,20,29],[24,95,20,31,"prechat_role"],[24,107,20,43],[24,108,20,44],[24,113,20,49],[24,123,20,59],[24,124,20,60],[24,125,21,7,"filter"],[24,131,21,13],[24,132,21,15,"m"],[24,133,21,16],[24,137,21,21],[24,138,21,22,"m"],[24,139,21,23],[24,141,21,25,"decision_expires_at"],[24,160,21,44],[24,161,21,45],[24,162,22,7,"filter"],[24,168,22,13],[24,169,22,15,"m"],[24,170,22,16],[24,174,22,21],[24,175,22,22,"m"],[24,176,22,23],[24,178,22,25,"terminal_state"],[24,192,22,39],[24,193,22,40],[24,194,23,7,"slice"],[24,199,23,12],[24,200,23,13],[24,201,23,14],[24,203,23,16],[24,204,23,17],[24,205,23,18],[25,6,25,4],[25,12,25,10,"toStart"],[25,19,25,17],[25,22,25,20,"candidates"],[25,32,25,30],[25,33,25,31,"filter"],[25,39,25,37],[25,40,25,39,"m"],[25,41,25,40],[25,45,25,45],[26,8,26,6],[26,14,26,12,"idStr"],[26,19,26,17],[26,22,26,20,"m"],[26,23,26,21],[26,25,26,23,"match_id"],[26,33,26,31],[26,37,26,35],[26,41,26,39],[26,44,26,42,"String"],[26,50,26,48],[26,51,26,49,"m"],[26,52,26,50],[26,53,26,51,"match_id"],[26,61,26,59],[26,62,26,60],[26,65,26,63],[26,67,26,65],[27,8,27,6],[27,12,27,10],[27,13,27,11,"idStr"],[27,18,27,16],[27,20,27,18],[27,27,27,25],[27,32,27,30],[28,8,28,6],[28,12,28,10,"startedDecisionTimersRef"],[28,36,28,34],[28,37,28,35,"current"],[28,44,28,42],[28,45,28,43,"has"],[28,48,28,46],[28,49,28,47,"idStr"],[28,54,28,52],[28,55,28,53],[28,57,28,55],[28,64,28,62],[28,69,28,67],[29,8,29,6],[29,15,29,13],[29,19,29,17],[30,6,30,4],[30,7,30,5],[30,8,30,6],[31,6,32,4],[31,10,32,8,"toStart"],[31,17,32,15],[31,18,32,16,"length"],[31,24,32,22],[31,29,32,27],[31,30,32,28],[31,32,32,30],[32,6,34,4,"toStart"],[32,13,34,11],[32,14,34,12,"forEach"],[32,21,34,19],[32,22,34,21,"m"],[32,23,34,22],[32,27,34,27],[33,8,35,6],[33,14,35,12,"idStr"],[33,19,35,17],[33,22,35,20,"String"],[33,28,35,26],[33,29,35,27,"m"],[33,30,35,28],[33,31,35,29,"match_id"],[33,39,35,37],[33,40,35,38],[34,8,36,6,"startedDecisionTimersRef"],[34,32,36,30],[34,33,36,31,"current"],[34,40,36,38],[34,41,36,39,"add"],[34,44,36,42],[34,45,36,43,"idStr"],[34,50,36,48],[34,51,36,49],[35,6,37,4],[35,7,37,5],[35,8,37,6],[36,6,39,4],[36,10,39,8,"cancelled"],[36,19,39,17],[36,22,39,20],[36,27,39,25],[37,6,41,4],[37,12,41,10,"run"],[37,15,41,13],[37,18,41,16],[37,24,41,16,"run"],[37,25,41,16],[37,30,41,28],[38,8,42,6],[38,12,42,10],[39,10,43,8],[39,16,43,14,"results"],[39,23,43,21],[39,26,43,24],[39,32,43,30,"Promise"],[39,39,43,37],[39,40,43,38,"all"],[39,43,43,41],[39,44,44,10,"toStart"],[39,51,44,17],[39,52,44,18,"map"],[39,55,44,21],[39,56,44,22],[39,62,44,29,"m"],[39,63,44,30],[39,67,44,35],[40,12,45,12],[40,18,45,18,"matchIdStr"],[40,28,45,28],[40,31,45,31,"String"],[40,37,45,37],[40,38,45,38,"m"],[40,39,45,39],[40,40,45,40,"match_id"],[40,48,45,48],[40,49,45,49],[41,12,46,12],[41,18,46,18,"resp"],[41,22,46,22],[41,25,46,25],[41,31,46,31,"fetch"],[41,36,46,36],[41,37,47,14],[41,72,47,49,"encodeURIComponent"],[41,90,47,67],[41,91,47,68,"matchIdStr"],[41,101,47,78],[41,102,47,79],[41,104,47,81],[41,106,48,14],[42,14,49,16,"method"],[42,20,49,22],[42,22,49,24],[42,28,49,30],[43,14,50,16,"headers"],[43,21,50,23],[43,23,50,25],[44,16,50,27],[44,30,50,41],[44,32,50,43],[45,14,50,62],[45,15,50,63],[46,14,51,16,"body"],[46,18,51,20],[46,20,51,22,"JSON"],[46,24,51,26],[46,25,51,27,"stringify"],[46,34,51,36],[46,35,51,37],[47,16,51,39,"userId"],[47,22,51,45],[47,24,51,47,"userIdNum"],[48,14,51,57],[48,15,51,58],[49,12,52,14],[49,13,53,12],[49,14,53,13],[50,12,55,12],[50,16,55,16],[50,17,55,17,"resp"],[50,21,55,21],[50,22,55,22,"ok"],[50,24,55,24],[50,26,55,26],[51,14,56,14],[51,20,56,20,"text"],[51,24,56,24],[51,27,56,27],[51,33,56,33,"resp"],[51,37,56,37],[51,38,56,38,"text"],[51,42,56,42],[51,43,56,43],[51,44,56,44],[51,45,56,45,"catch"],[51,50,56,50],[51,51,56,51],[51,57,56,57],[51,59,56,59],[51,60,56,60],[52,14,57,14],[52,20,57,20],[52,24,57,24,"Error"],[52,29,57,29],[52,30,58,16],[52,78,58,64,"matchIdStr"],[52,88,58,74],[52,111,58,97,"resp"],[52,115,58,101],[52,116,58,102,"status"],[52,122,58,108],[52,127,58,113,"resp"],[52,131,58,117],[52,132,58,118,"statusText"],[52,142,58,128],[52,147,58,133,"text"],[52,151,58,137],[52,153,59,14],[52,154,59,15],[53,12,60,12],[54,12,62,12],[54,18,62,18,"data"],[54,22,62,22],[54,25,62,25],[54,31,62,31,"resp"],[54,35,62,35],[54,36,62,36,"json"],[54,40,62,40],[54,41,62,41],[54,42,62,42],[54,43,62,43,"catch"],[54,48,62,48],[54,49,62,49],[54,56,62,56],[54,57,62,57],[54,58,62,58],[54,59,62,59],[54,60,62,60],[55,12,63,12],[55,19,63,19,"Boolean"],[55,26,63,26],[55,27,63,27,"data"],[55,31,63,31],[55,33,63,33,"started"],[55,40,63,40],[55,41,63,41],[56,10,64,10],[56,11,64,11],[56,12,65,8],[56,13,65,9],[57,10,67,8],[57,16,67,14,"startedAny"],[57,26,67,24],[57,29,67,27,"results"],[57,36,67,34],[57,37,67,35,"some"],[57,41,67,39],[57,42,67,40,"Boolean"],[57,49,67,47],[57,50,67,48],[58,10,68,8],[58,14,68,12],[58,15,68,13,"cancelled"],[58,24,68,22],[58,28,68,26,"startedAny"],[58,38,68,36],[58,40,68,38],[59,12,69,10],[59,18,69,16,"loadMatches"],[59,29,69,27],[59,30,69,28,"userIdNum"],[59,39,69,37],[59,40,69,38],[60,10,70,8],[61,8,71,6],[61,9,71,7],[61,10,71,8],[61,17,71,15,"e"],[61,18,71,16],[61,20,71,18],[62,10,72,8,"console"],[62,17,72,15],[62,18,72,16,"error"],[62,23,72,21],[62,24,72,22,"e"],[62,25,72,23],[62,26,72,24],[63,8,73,6],[64,6,74,4],[64,7,74,5],[65,6,76,4,"run"],[65,9,76,7],[65,10,76,8],[65,11,76,9],[66,6,78,4],[66,13,78,11],[66,19,78,17],[67,8,79,6,"cancelled"],[67,17,79,15],[67,20,79,18],[67,24,79,22],[68,6,80,4],[68,7,80,5],[69,4,81,2],[69,5,81,3],[69,7,81,5],[69,8,81,6,"loading"],[69,15,81,13],[69,17,81,15,"loadMatches"],[69,28,81,26],[69,30,81,28,"otherChatsHidden"],[69,46,81,44],[69,48,81,46,"preChatRows"],[69,59,81,57],[69,61,81,59,"user"],[69,65,81,63],[69,67,81,65,"id"],[69,69,81,67],[69,70,81,68],[69,71,81,69],[70,2,82,0],[71,2,82,1,"_s"],[71,4,82,1],[71,5,3,16,"usePreChatDecisionTimers"],[71,29,3,40],[72,0,3,40],[72,3]],"functionMap":{"names":["<global>","usePreChatDecisionTimers","useEffect$argument_0","filter$argument_0","filter.filter$argument_0","filter.filter.filter$argument_0","candidates.filter$argument_0","toStart.forEach$argument_0","run","toStart.map$argument_0","resp.text._catch$argument_0","resp.json._catch$argument_0","<anonymous>"],"mappings":"AAA;OCE;YCS;cCQ,6CD;cEC,8BF;cGC,yBH;sCIG;KJK;oBKI;KLG;gBMI;sBCG;mDCY,QD;iDEM,UF;WDE;KNU;WUI;KVE;GDC;CDC"},"hasCjsExports":false},"type":"js/module"}]}