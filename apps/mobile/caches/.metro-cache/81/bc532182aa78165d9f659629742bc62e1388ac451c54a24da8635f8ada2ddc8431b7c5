{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":52,"index":52}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":53},"end":{"line":2,"column":69,"index":122}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":123},"end":{"line":3,"column":49,"index":172}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return useLikesBadge;\n    }\n  });\n  var _react = require(_dependencyMap[0], \"react\");\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[1], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _tanstackReactQuery = require(_dependencyMap[2], \"@tanstack/react-query\");\n  function buildLikesQueryString({\n    userId,\n    userEmail\n  }) {\n    const params = [];\n    const uid = Number(userId);\n    if (Number.isFinite(uid)) {\n      params.push(`userId=${encodeURIComponent(String(uid))}`);\n    }\n    const email = String(userEmail || \"\").trim();\n    if (email) {\n      params.push(`email=${encodeURIComponent(email)}`);\n    }\n    return params.length ? `?${params.join(\"&\")}` : \"\";\n  }\n  function useLikesBadge() {\n    _s();\n    const [userId, setUserId] = (0, _react.useState)(null);\n    const [userEmail, setUserEmail] = (0, _react.useState)(null);\n    const pollRef = (0, _react.useRef)(null);\n    (0, _react.useEffect)(() => {\n      let cancelled = false;\n      const load = async () => {\n        try {\n          const raw = await AsyncStorage.default.getItem(\"user\");\n          if (!raw) {\n            if (!cancelled) {\n              setUserId(null);\n              setUserEmail(null);\n            }\n            return false;\n          }\n          const user = JSON.parse(raw);\n          const parsedId = Number(user?.id);\n          const nextId = Number.isFinite(parsedId) ? parsedId : null;\n          const nextEmail = String(user?.email || \"\").trim() || null;\n          if (!cancelled) {\n            setUserId(nextId);\n            setUserEmail(nextEmail);\n          }\n          return Boolean(nextId || nextEmail);\n        } catch (e) {\n          console.error(e);\n          if (!cancelled) {\n            setUserId(null);\n            setUserEmail(null);\n          }\n          return false;\n        }\n      };\n\n      // Root layouts can mount before login finishes.\n      // Keep checking until a user appears so the badge works right after sign-in.\n      load().then(found => {\n        if (cancelled) return;\n        if (found) return;\n        if (pollRef.current) {\n          clearInterval(pollRef.current);\n        }\n        pollRef.current = setInterval(() => {\n          if (cancelled) return;\n          load().then(nowFound => {\n            if (cancelled) return;\n            if (nowFound && pollRef.current) {\n              clearInterval(pollRef.current);\n              pollRef.current = null;\n            }\n          });\n        }, 1500);\n      });\n      return () => {\n        cancelled = true;\n        if (pollRef.current) {\n          clearInterval(pollRef.current);\n          pollRef.current = null;\n        }\n      };\n    }, []);\n    const badgeQuery = (0, _tanstackReactQuery.useQuery)({\n      queryKey: [\"likesBadge\", userId || null, userEmail || null],\n      enabled: Boolean(userId || userEmail),\n      queryFn: async () => {\n        const queryString = buildLikesQueryString({\n          userId,\n          userEmail\n        });\n        const response = await fetch(`/api/likes/badge${queryString}`);\n        if (!response.ok) {\n          throw new Error(`When fetching /api/likes/badge, the response was [${response.status}] ${response.statusText}`);\n        }\n        return response.json();\n      },\n      // Keep this lightweight; it only drives a small dot.\n      refetchInterval: 4000,\n      refetchIntervalInBackground: true,\n      staleTime: 0,\n      retry: 1\n    });\n    const badgeCountRaw = badgeQuery.data?.badgeCount;\n    const badgeCountNum = Number(badgeCountRaw);\n    const badgeCount = Number.isFinite(badgeCountNum) ? badgeCountNum : 0;\n    return {\n      userId,\n      userEmail,\n      badgeCount,\n      isLoading: badgeQuery.isLoading,\n      refetch: badgeQuery.refetch\n    };\n  }\n  _s(useLikesBadge, \"HQr1L8YD98e5YTJid4Y11bFbW08=\", false, function () {\n    return [_tanstackReactQuery.useQuery];\n  });\n});","lineCount":135,"map":[[13,2,21,15,"Object"],[13,8,21,15],[13,9,21,15,"defineProperty"],[13,23,21,15],[13,24,21,15,"exports"],[13,31,21,15],[14,4,21,15,"enumerable"],[14,14,21,15],[15,4,21,15,"get"],[15,7,21,15],[15,18,21,15,"get"],[15,19,21,15],[16,6,21,15],[16,13,21,15,"useLikesBadge"],[16,26,21,15],[17,4,21,15],[18,2,21,15],[19,2,1,0],[19,6,1,0,"_react"],[19,12,1,0],[19,15,1,0,"require"],[19,22,1,0],[19,23,1,0,"_dependencyMap"],[19,37,1,0],[20,2,2,0],[20,6,2,0,"_reactNativeAsyncStorageAsyncStorage"],[20,42,2,0],[20,45,2,0,"require"],[20,52,2,0],[20,53,2,0,"_dependencyMap"],[20,67,2,0],[21,2,2,0],[21,6,2,0,"AsyncStorage"],[21,18,2,0],[21,21,2,0,"_interopDefault"],[21,36,2,0],[21,37,2,0,"_reactNativeAsyncStorageAsyncStorage"],[21,73,2,0],[22,2,3,0],[22,6,3,0,"_tanstackReactQuery"],[22,25,3,0],[22,28,3,0,"require"],[22,35,3,0],[22,36,3,0,"_dependencyMap"],[22,50,3,0],[23,2,5,0],[23,11,5,9,"buildLikesQueryString"],[23,32,5,30,"buildLikesQueryString"],[23,33,5,31],[24,4,5,33,"userId"],[24,10,5,39],[25,4,5,41,"userEmail"],[26,2,5,51],[26,3,5,52],[26,5,5,54],[27,4,6,2],[27,10,6,8,"params"],[27,16,6,14],[27,19,6,17],[27,21,6,19],[28,4,7,2],[28,10,7,8,"uid"],[28,13,7,11],[28,16,7,14,"Number"],[28,22,7,20],[28,23,7,21,"userId"],[28,29,7,27],[28,30,7,28],[29,4,9,2],[29,8,9,6,"Number"],[29,14,9,12],[29,15,9,13,"isFinite"],[29,23,9,21],[29,24,9,22,"uid"],[29,27,9,25],[29,28,9,26],[29,30,9,28],[30,6,10,4,"params"],[30,12,10,10],[30,13,10,11,"push"],[30,17,10,15],[30,18,10,16],[30,28,10,26,"encodeURIComponent"],[30,46,10,44],[30,47,10,45,"String"],[30,53,10,51],[30,54,10,52,"uid"],[30,57,10,55],[30,58,10,56],[30,59,10,57],[30,61,10,59],[30,62,10,60],[31,4,11,2],[32,4,13,2],[32,10,13,8,"email"],[32,15,13,13],[32,18,13,16,"String"],[32,24,13,22],[32,25,13,23,"userEmail"],[32,34,13,32],[32,38,13,36],[32,40,13,38],[32,41,13,39],[32,42,13,40,"trim"],[32,46,13,44],[32,47,13,45],[32,48,13,46],[33,4,14,2],[33,8,14,6,"email"],[33,13,14,11],[33,15,14,13],[34,6,15,4,"params"],[34,12,15,10],[34,13,15,11,"push"],[34,17,15,15],[34,18,15,16],[34,27,15,25,"encodeURIComponent"],[34,45,15,43],[34,46,15,44,"email"],[34,51,15,49],[34,52,15,50],[34,54,15,52],[34,55,15,53],[35,4,16,2],[36,4,18,2],[36,11,18,9,"params"],[36,17,18,15],[36,18,18,16,"length"],[36,24,18,22],[36,27,18,25],[36,31,18,29,"params"],[36,37,18,35],[36,38,18,36,"join"],[36,42,18,40],[36,43,18,41],[36,46,18,44],[36,47,18,45],[36,49,18,47],[36,52,18,50],[36,54,18,52],[37,2,19,0],[38,2,21,15],[38,11,21,24,"useLikesBadge"],[38,24,21,37,"useLikesBadge"],[38,25,21,37],[38,27,21,40],[39,4,21,40,"_s"],[39,6,21,40],[40,4,22,2],[40,10,22,8],[40,11,22,9,"userId"],[40,17,22,15],[40,19,22,17,"setUserId"],[40,28,22,26],[40,29,22,27],[40,32,22,30],[40,36,22,30,"useState"],[40,42,22,38],[40,43,22,38,"useState"],[40,51,22,38],[40,53,22,39],[40,57,22,43],[40,58,22,44],[41,4,23,2],[41,10,23,8],[41,11,23,9,"userEmail"],[41,20,23,18],[41,22,23,20,"setUserEmail"],[41,34,23,32],[41,35,23,33],[41,38,23,36],[41,42,23,36,"useState"],[41,48,23,44],[41,49,23,44,"useState"],[41,57,23,44],[41,59,23,45],[41,63,23,49],[41,64,23,50],[42,4,24,2],[42,10,24,8,"pollRef"],[42,17,24,15],[42,20,24,18],[42,24,24,18,"useRef"],[42,30,24,24],[42,31,24,24,"useRef"],[42,37,24,24],[42,39,24,25],[42,43,24,29],[42,44,24,30],[43,4,26,2],[43,8,26,2,"useEffect"],[43,14,26,11],[43,15,26,11,"useEffect"],[43,24,26,11],[43,26,26,12],[43,32,26,18],[44,6,27,4],[44,10,27,8,"cancelled"],[44,19,27,17],[44,22,27,20],[44,27,27,25],[45,6,29,4],[45,12,29,10,"load"],[45,16,29,14],[45,19,29,17],[45,25,29,17,"load"],[45,26,29,17],[45,31,29,29],[46,8,30,6],[46,12,30,10],[47,10,31,8],[47,16,31,14,"raw"],[47,19,31,17],[47,22,31,20],[47,28,31,26,"AsyncStorage"],[47,40,31,38],[47,41,31,38,"default"],[47,48,31,38],[47,49,31,39,"getItem"],[47,56,31,46],[47,57,31,47],[47,63,31,53],[47,64,31,54],[48,10,32,8],[48,14,32,12],[48,15,32,13,"raw"],[48,18,32,16],[48,20,32,18],[49,12,33,10],[49,16,33,14],[49,17,33,15,"cancelled"],[49,26,33,24],[49,28,33,26],[50,14,34,12,"setUserId"],[50,23,34,21],[50,24,34,22],[50,28,34,26],[50,29,34,27],[51,14,35,12,"setUserEmail"],[51,26,35,24],[51,27,35,25],[51,31,35,29],[51,32,35,30],[52,12,36,10],[53,12,37,10],[53,19,37,17],[53,24,37,22],[54,10,38,8],[55,10,40,8],[55,16,40,14,"user"],[55,20,40,18],[55,23,40,21,"JSON"],[55,27,40,25],[55,28,40,26,"parse"],[55,33,40,31],[55,34,40,32,"raw"],[55,37,40,35],[55,38,40,36],[56,10,41,8],[56,16,41,14,"parsedId"],[56,24,41,22],[56,27,41,25,"Number"],[56,33,41,31],[56,34,41,32,"user"],[56,38,41,36],[56,40,41,38,"id"],[56,42,41,40],[56,43,41,41],[57,10,42,8],[57,16,42,14,"nextId"],[57,22,42,20],[57,25,42,23,"Number"],[57,31,42,29],[57,32,42,30,"isFinite"],[57,40,42,38],[57,41,42,39,"parsedId"],[57,49,42,47],[57,50,42,48],[57,53,42,51,"parsedId"],[57,61,42,59],[57,64,42,62],[57,68,42,66],[58,10,43,8],[58,16,43,14,"nextEmail"],[58,25,43,23],[58,28,43,26,"String"],[58,34,43,32],[58,35,43,33,"user"],[58,39,43,37],[58,41,43,39,"email"],[58,46,43,44],[58,50,43,48],[58,52,43,50],[58,53,43,51],[58,54,43,52,"trim"],[58,58,43,56],[58,59,43,57],[58,60,43,58],[58,64,43,62],[58,68,43,66],[59,10,45,8],[59,14,45,12],[59,15,45,13,"cancelled"],[59,24,45,22],[59,26,45,24],[60,12,46,10,"setUserId"],[60,21,46,19],[60,22,46,20,"nextId"],[60,28,46,26],[60,29,46,27],[61,12,47,10,"setUserEmail"],[61,24,47,22],[61,25,47,23,"nextEmail"],[61,34,47,32],[61,35,47,33],[62,10,48,8],[63,10,50,8],[63,17,50,15,"Boolean"],[63,24,50,22],[63,25,50,23,"nextId"],[63,31,50,29],[63,35,50,33,"nextEmail"],[63,44,50,42],[63,45,50,43],[64,8,51,6],[64,9,51,7],[64,10,51,8],[64,17,51,15,"e"],[64,18,51,16],[64,20,51,18],[65,10,52,8,"console"],[65,17,52,15],[65,18,52,16,"error"],[65,23,52,21],[65,24,52,22,"e"],[65,25,52,23],[65,26,52,24],[66,10,53,8],[66,14,53,12],[66,15,53,13,"cancelled"],[66,24,53,22],[66,26,53,24],[67,12,54,10,"setUserId"],[67,21,54,19],[67,22,54,20],[67,26,54,24],[67,27,54,25],[68,12,55,10,"setUserEmail"],[68,24,55,22],[68,25,55,23],[68,29,55,27],[68,30,55,28],[69,10,56,8],[70,10,57,8],[70,17,57,15],[70,22,57,20],[71,8,58,6],[72,6,59,4],[72,7,59,5],[74,6,61,4],[75,6,62,4],[76,6,63,4,"load"],[76,10,63,8],[76,11,63,9],[76,12,63,10],[76,13,63,11,"then"],[76,17,63,15],[76,18,63,17,"found"],[76,23,63,22],[76,27,63,27],[77,8,64,6],[77,12,64,10,"cancelled"],[77,21,64,19],[77,23,64,21],[78,8,65,6],[78,12,65,10,"found"],[78,17,65,15],[78,19,65,17],[79,8,67,6],[79,12,67,10,"pollRef"],[79,19,67,17],[79,20,67,18,"current"],[79,27,67,25],[79,29,67,27],[80,10,68,8,"clearInterval"],[80,23,68,21],[80,24,68,22,"pollRef"],[80,31,68,29],[80,32,68,30,"current"],[80,39,68,37],[80,40,68,38],[81,8,69,6],[82,8,71,6,"pollRef"],[82,15,71,13],[82,16,71,14,"current"],[82,23,71,21],[82,26,71,24,"setInterval"],[82,37,71,35],[82,38,71,36],[82,44,71,42],[83,10,72,8],[83,14,72,12,"cancelled"],[83,23,72,21],[83,25,72,23],[84,10,73,8,"load"],[84,14,73,12],[84,15,73,13],[84,16,73,14],[84,17,73,15,"then"],[84,21,73,19],[84,22,73,21,"nowFound"],[84,30,73,29],[84,34,73,34],[85,12,74,10],[85,16,74,14,"cancelled"],[85,25,74,23],[85,27,74,25],[86,12,75,10],[86,16,75,14,"nowFound"],[86,24,75,22],[86,28,75,26,"pollRef"],[86,35,75,33],[86,36,75,34,"current"],[86,43,75,41],[86,45,75,43],[87,14,76,12,"clearInterval"],[87,27,76,25],[87,28,76,26,"pollRef"],[87,35,76,33],[87,36,76,34,"current"],[87,43,76,41],[87,44,76,42],[88,14,77,12,"pollRef"],[88,21,77,19],[88,22,77,20,"current"],[88,29,77,27],[88,32,77,30],[88,36,77,34],[89,12,78,10],[90,10,79,8],[90,11,79,9],[90,12,79,10],[91,8,80,6],[91,9,80,7],[91,11,80,9],[91,15,80,13],[91,16,80,14],[92,6,81,4],[92,7,81,5],[92,8,81,6],[93,6,83,4],[93,13,83,11],[93,19,83,17],[94,8,84,6,"cancelled"],[94,17,84,15],[94,20,84,18],[94,24,84,22],[95,8,85,6],[95,12,85,10,"pollRef"],[95,19,85,17],[95,20,85,18,"current"],[95,27,85,25],[95,29,85,27],[96,10,86,8,"clearInterval"],[96,23,86,21],[96,24,86,22,"pollRef"],[96,31,86,29],[96,32,86,30,"current"],[96,39,86,37],[96,40,86,38],[97,10,87,8,"pollRef"],[97,17,87,15],[97,18,87,16,"current"],[97,25,87,23],[97,28,87,26],[97,32,87,30],[98,8,88,6],[99,6,89,4],[99,7,89,5],[100,4,90,2],[100,5,90,3],[100,7,90,5],[100,9,90,7],[100,10,90,8],[101,4,92,2],[101,10,92,8,"badgeQuery"],[101,20,92,18],[101,23,92,21],[101,27,92,21,"useQuery"],[101,46,92,29],[101,47,92,29,"useQuery"],[101,55,92,29],[101,57,92,30],[102,6,93,4,"queryKey"],[102,14,93,12],[102,16,93,14],[102,17,93,15],[102,29,93,27],[102,31,93,29,"userId"],[102,37,93,35],[102,41,93,39],[102,45,93,43],[102,47,93,45,"userEmail"],[102,56,93,54],[102,60,93,58],[102,64,93,62],[102,65,93,63],[103,6,94,4,"enabled"],[103,13,94,11],[103,15,94,13,"Boolean"],[103,22,94,20],[103,23,94,21,"userId"],[103,29,94,27],[103,33,94,31,"userEmail"],[103,42,94,40],[103,43,94,41],[104,6,95,4,"queryFn"],[104,13,95,11],[104,15,95,13],[104,21,95,13,"queryFn"],[104,22,95,13],[104,27,95,25],[105,8,96,6],[105,14,96,12,"queryString"],[105,25,96,23],[105,28,96,26,"buildLikesQueryString"],[105,49,96,47],[105,50,96,48],[106,10,96,50,"userId"],[106,16,96,56],[107,10,96,58,"userEmail"],[108,8,96,68],[108,9,96,69],[108,10,96,70],[109,8,97,6],[109,14,97,12,"response"],[109,22,97,20],[109,25,97,23],[109,31,97,29,"fetch"],[109,36,97,34],[109,37,97,35],[109,56,97,54,"queryString"],[109,67,97,65],[109,69,97,67],[109,70,97,68],[110,8,98,6],[110,12,98,10],[110,13,98,11,"response"],[110,21,98,19],[110,22,98,20,"ok"],[110,24,98,22],[110,26,98,24],[111,10,99,8],[111,16,99,14],[111,20,99,18,"Error"],[111,25,99,23],[111,26,100,10],[111,79,100,63,"response"],[111,87,100,71],[111,88,100,72,"status"],[111,94,100,78],[111,99,100,83,"response"],[111,107,100,91],[111,108,100,92,"statusText"],[111,118,100,102],[111,120,101,8],[111,121,101,9],[112,8,102,6],[113,8,103,6],[113,15,103,13,"response"],[113,23,103,21],[113,24,103,22,"json"],[113,28,103,26],[113,29,103,27],[113,30,103,28],[114,6,104,4],[114,7,104,5],[115,6,105,4],[116,6,106,4,"refetchInterval"],[116,21,106,19],[116,23,106,21],[116,27,106,25],[117,6,107,4,"refetchIntervalInBackground"],[117,33,107,31],[117,35,107,33],[117,39,107,37],[118,6,108,4,"staleTime"],[118,15,108,13],[118,17,108,15],[118,18,108,16],[119,6,109,4,"retry"],[119,11,109,9],[119,13,109,11],[120,4,110,2],[120,5,110,3],[120,6,110,4],[121,4,112,2],[121,10,112,8,"badgeCountRaw"],[121,23,112,21],[121,26,112,24,"badgeQuery"],[121,36,112,34],[121,37,112,35,"data"],[121,41,112,39],[121,43,112,41,"badgeCount"],[121,53,112,51],[122,4,113,2],[122,10,113,8,"badgeCountNum"],[122,23,113,21],[122,26,113,24,"Number"],[122,32,113,30],[122,33,113,31,"badgeCountRaw"],[122,46,113,44],[122,47,113,45],[123,4,114,2],[123,10,114,8,"badgeCount"],[123,20,114,18],[123,23,114,21,"Number"],[123,29,114,27],[123,30,114,28,"isFinite"],[123,38,114,36],[123,39,114,37,"badgeCountNum"],[123,52,114,50],[123,53,114,51],[123,56,114,54,"badgeCountNum"],[123,69,114,67],[123,72,114,70],[123,73,114,71],[124,4,116,2],[124,11,116,9],[125,6,117,4,"userId"],[125,12,117,10],[126,6,118,4,"userEmail"],[126,15,118,13],[127,6,119,4,"badgeCount"],[127,16,119,14],[128,6,120,4,"isLoading"],[128,15,120,13],[128,17,120,15,"badgeQuery"],[128,27,120,25],[128,28,120,26,"isLoading"],[128,37,120,35],[129,6,121,4,"refetch"],[129,13,121,11],[129,15,121,13,"badgeQuery"],[129,25,121,23],[129,26,121,24,"refetch"],[130,4,122,2],[130,5,122,3],[131,2,123,0],[132,2,123,1,"_s"],[132,4,123,1],[132,5,21,24,"useLikesBadge"],[132,18,21,37],[133,4,21,37],[133,12,92,21,"useQuery"],[133,31,92,29],[133,32,92,29,"useQuery"],[133,40,92,29],[134,2,92,29],[135,0,92,29],[135,3]],"functionMap":{"names":["<global>","buildLikesQueryString","useLikesBadge","useEffect$argument_0","load","load.then$argument_0","setInterval$argument_0","<anonymous>","useQuery$argument_0.queryFn"],"mappings":"AAA;ACI;CDc;eEE;YCK;iBCG;KD8B;gBEI;oCCQ;oBDE;SCM;ODC;KFC;WIE;KJM;GDC;aMK;KNS;CFmB"},"hasCjsExports":false},"type":"js/module"}]}