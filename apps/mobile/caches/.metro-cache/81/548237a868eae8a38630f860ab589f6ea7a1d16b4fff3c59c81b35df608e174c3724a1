{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/slicedToArray","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"5y7e5+zC7teYEEC6niD9f5zII1M=","exportNames":["*"],"imports":1}},{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":65,"index":65}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":66},"end":{"line":2,"column":69,"index":135}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":136},"end":{"line":3,"column":55,"index":191}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.useConversation = useConversation;\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0]);\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _babelRuntimeHelpersSlicedToArray = require(_dependencyMap[1]);\n  var _slicedToArray = _interopDefault(_babelRuntimeHelpersSlicedToArray);\n  var _react = require(_dependencyMap[2]);\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[3]);\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _tanstackReactQuery = require(_dependencyMap[4]);\n  function useConversation(matchId) {\n    var queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    var _useState = (0, _react.useState)(true),\n      _useState2 = (0, _slicedToArray.default)(_useState, 2),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n    var _useState3 = (0, _react.useState)([]),\n      _useState4 = (0, _slicedToArray.default)(_useState3, 2),\n      messages = _useState4[0],\n      setMessages = _useState4[1];\n    var _useState5 = (0, _react.useState)(null),\n      _useState6 = (0, _slicedToArray.default)(_useState5, 2),\n      user = _useState6[0],\n      setUser = _useState6[1];\n    var _useState7 = (0, _react.useState)(null),\n      _useState8 = (0, _slicedToArray.default)(_useState7, 2),\n      matchInfo = _useState8[0],\n      setMatchInfo = _useState8[1];\n    var _useState9 = (0, _react.useState)(null),\n      _useState0 = (0, _slicedToArray.default)(_useState9, 2),\n      error = _useState0[0],\n      setError = _useState0[1];\n\n    // Prevent \"Too Many Requests\" bursts when multiple parts of the chat\n    // screen trigger a refresh at the same time (tab switches, mutations, etc).\n    var messagesAbortRef = (0, _react.useRef)(null);\n    var messagesInFlightRef = (0, _react.useRef)(false);\n    var lastMessagesFetchAtRef = (0, _react.useRef)(0);\n    var rateLimitedUntilRef = (0, _react.useRef)(0);\n    var markMatchesSeen = (0, _react.useCallback)(/*#__PURE__*/function () {\n      var _ref = (0, _asyncToGenerator.default)(function* (userId) {\n        try {\n          var resp = yield fetch(\"/api/matches/mark-seen\", {\n            method: \"POST\",\n            headers: {\n              \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n              userId\n            })\n          });\n          if (resp.ok) {\n            queryClient.invalidateQueries({\n              queryKey: [\"matchesSummary\", userId]\n            });\n            // NEW: keep the Messages tab dot in sync immediately (donâ€™t wait for polling)\n            queryClient.invalidateQueries({\n              queryKey: [\"matchesForBadge\", userId]\n            });\n          }\n        } catch (e) {\n          console.error(\"Could not mark matches seen\", e);\n        }\n      });\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }(), [queryClient]);\n    var loadMatchInfo = /*#__PURE__*/function () {\n      var _ref2 = (0, _asyncToGenerator.default)(function* (userId) {\n        if (!matchId) return;\n        try {\n          var response = yield fetch(`/api/matches/${matchId}?userId=${userId}`);\n          if (!response.ok) {\n            if (response.status === 404) {\n              setMatchInfo(null);\n              setError(prev => prev || \"This match is no longer available.\");\n              return;\n            }\n\n            // When the backend is sleeping / proxy can't reach it, avoid scary gateway text.\n            if (response.status === 502 || response.status === 503 || response.status === 504) {\n              setMatchInfo(null);\n              setError(prev => prev || \"Server is starting up. Please try again in a moment.\");\n              return;\n            }\n            var text = yield response.text().catch(() => \"\");\n            throw new Error(`When fetching /api/matches/${matchId}, the response was [${response.status}] ${response.statusText} ${text}`);\n          }\n          var data = yield response.json();\n          setMatchInfo(data?.match || null);\n        } catch (err) {\n          console.error(\"Error loading match info:\", err);\n          setMatchInfo(null);\n\n          // Only set the UI error if one isn't already set (messages might set it first).\n          setError(prev => prev || (err?.message ? String(err.message) : \"Could not load match info.\"));\n        }\n      });\n      return function loadMatchInfo(_x2) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    var loadMessages = (0, _react.useCallback)(/*#__PURE__*/function () {\n      var _ref3 = (0, _asyncToGenerator.default)(function* (userId) {\n        if (!matchId) return;\n        var now = Date.now();\n        if (now < rateLimitedUntilRef.current) {\n          return;\n        }\n\n        // throttle: avoid accidental double-fetch on mount / tab switch\n        if (now - lastMessagesFetchAtRef.current < 750) {\n          return;\n        }\n\n        // Abort any in-flight request; we only care about the latest.\n        try {\n          if (messagesAbortRef.current) {\n            messagesAbortRef.current.abort();\n          }\n        } catch {\n          // ignore\n        }\n        var controller = new AbortController();\n        messagesAbortRef.current = controller;\n        lastMessagesFetchAtRef.current = now;\n\n        // prevent re-entrancy\n        if (messagesInFlightRef.current) {\n          return;\n        }\n        messagesInFlightRef.current = true;\n        try {\n          var response = yield fetch(`/api/messages/${matchId}?userId=${userId}`, {\n            signal: controller.signal\n          });\n          if (!response.ok) {\n            if (response.status === 429) {\n              // Soft-fail: keep the last good messages on screen and back off.\n              rateLimitedUntilRef.current = Date.now() + 1500;\n              return;\n            }\n            if (response.status === 404) {\n              setMessages([]);\n              setError(\"This chat is no longer available.\");\n              return;\n            }\n            if (response.status === 410) {\n              setMessages([]);\n              setError(\"This match is no longer available.\");\n              return;\n            }\n\n            // When the backend is sleeping / proxy can't reach it, avoid scary gateway text.\n            if (response.status === 502 || response.status === 503 || response.status === 504) {\n              setMessages([]);\n              setError(\"Server is starting up. Please try again in a moment.\");\n              return;\n            }\n            var text = yield response.text().catch(() => \"\");\n            throw new Error(`When fetching /api/messages/${matchId}, the response was [${response.status}] ${response.statusText} ${text}`);\n          }\n          var data = yield response.json();\n          var nextMessages = Array.isArray(data?.messages) ? data.messages : [];\n          setMessages(nextMessages);\n\n          // Existing: keep any cached match summaries fresh\n          queryClient.invalidateQueries({\n            queryKey: [\"matchesSummary\", userId]\n          });\n\n          // /api/messages marks the one-time \"SYSTEM_HINT\" as read.\n          queryClient.invalidateQueries({\n            queryKey: [\"matchesForBadge\", userId]\n          });\n        } catch (err) {\n          if (err?.name === \"AbortError\") {\n            return;\n          }\n          console.error(\"Error loading messages:\", err);\n          setError(err?.message ? String(err.message) : \"Could not load messages for this match.\");\n        } finally {\n          messagesInFlightRef.current = false;\n        }\n      });\n      return function (_x3) {\n        return _ref3.apply(this, arguments);\n      };\n    }(), [matchId, queryClient]);\n    var loadUserAndMessages = /*#__PURE__*/function () {\n      var _ref4 = (0, _asyncToGenerator.default)(function* () {\n        if (!matchId) {\n          setLoading(true);\n          return;\n        }\n        try {\n          setError(null);\n          var userData = yield AsyncStorage.default.getItem(\"user\");\n          if (!userData) {\n            setUser(null);\n            setError(\"You need to log in again.\");\n            return;\n          }\n          var parsedUser = JSON.parse(userData);\n          setUser(parsedUser);\n          yield markMatchesSeen(parsedUser.id);\n          yield Promise.all([loadMatchInfo(parsedUser.id), loadMessages(parsedUser.id)]);\n        } catch (err) {\n          console.error(\"Error loading conversation:\", err);\n          setError(err?.message ? String(err.message) : \"Could not load this chat.\");\n        } finally {\n          setLoading(false);\n        }\n      });\n      return function loadUserAndMessages() {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n    (0, _react.useEffect)(() => {\n      // IMPORTANT: matchId can arrive slightly after first render in expo-router.\n      // If we only run once, the thread will never load.\n      loadUserAndMessages();\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [matchId]);\n    var reloadMessages = (0, _react.useCallback)(/*#__PURE__*/(0, _asyncToGenerator.default)(function* () {\n      var uid = user?.id;\n      if (!uid) return;\n      if (!matchId) return;\n      yield loadMessages(uid);\n    }), [loadMessages, matchId, user?.id]);\n    return {\n      loading,\n      error,\n      messages,\n      setMessages,\n      user,\n      matchInfo,\n      reloadMessages\n    };\n  }\n});","lineCount":252,"map":[[12,2,5,0,"exports"],[12,9,5,0],[12,10,5,0,"useConversation"],[12,25,5,0],[12,28,5,0,"useConversation"],[12,43,5,0],[13,2,251,1],[13,6,251,1,"_babelRuntimeHelpersAsyncToGenerator"],[13,42,251,1],[13,45,251,1,"require"],[13,52,251,1],[13,53,251,1,"_dependencyMap"],[13,67,251,1],[14,2,251,1],[14,6,251,1,"_asyncToGenerator"],[14,23,251,1],[14,26,251,1,"_interopDefault"],[14,41,251,1],[14,42,251,1,"_babelRuntimeHelpersAsyncToGenerator"],[14,78,251,1],[15,2,251,1],[15,6,251,1,"_babelRuntimeHelpersSlicedToArray"],[15,39,251,1],[15,42,251,1,"require"],[15,49,251,1],[15,50,251,1,"_dependencyMap"],[15,64,251,1],[16,2,251,1],[16,6,251,1,"_slicedToArray"],[16,20,251,1],[16,23,251,1,"_interopDefault"],[16,38,251,1],[16,39,251,1,"_babelRuntimeHelpersSlicedToArray"],[16,72,251,1],[17,2,1,0],[17,6,1,0,"_react"],[17,12,1,0],[17,15,1,0,"require"],[17,22,1,0],[17,23,1,0,"_dependencyMap"],[17,37,1,0],[18,2,2,0],[18,6,2,0,"_reactNativeAsyncStorageAsyncStorage"],[18,42,2,0],[18,45,2,0,"require"],[18,52,2,0],[18,53,2,0,"_dependencyMap"],[18,67,2,0],[19,2,2,0],[19,6,2,0,"AsyncStorage"],[19,18,2,0],[19,21,2,0,"_interopDefault"],[19,36,2,0],[19,37,2,0,"_reactNativeAsyncStorageAsyncStorage"],[19,73,2,0],[20,2,3,0],[20,6,3,0,"_tanstackReactQuery"],[20,25,3,0],[20,28,3,0,"require"],[20,35,3,0],[20,36,3,0,"_dependencyMap"],[20,50,3,0],[21,2,5,7],[21,11,5,16,"useConversation"],[21,26,5,31,"useConversation"],[21,27,5,32,"matchId"],[21,34,5,39],[21,36,5,41],[22,4,6,2],[22,8,6,8,"queryClient"],[22,19,6,19],[22,22,6,22],[22,26,6,22,"useQueryClient"],[22,45,6,36],[22,46,6,36,"useQueryClient"],[22,60,6,36],[22,62,6,37],[22,63,6,38],[23,4,7,2],[23,8,7,2,"_useState"],[23,17,7,2],[23,20,7,32],[23,24,7,32,"useState"],[23,30,7,40],[23,31,7,40,"useState"],[23,39,7,40],[23,41,7,41],[23,45,7,45],[23,46,7,46],[24,6,7,46,"_useState2"],[24,16,7,46],[24,23,7,46,"_slicedToArray"],[24,37,7,46],[24,38,7,46,"default"],[24,45,7,46],[24,47,7,46,"_useState"],[24,56,7,46],[25,6,7,9,"loading"],[25,13,7,16],[25,16,7,16,"_useState2"],[25,26,7,16],[26,6,7,18,"setLoading"],[26,16,7,28],[26,19,7,28,"_useState2"],[26,29,7,28],[27,4,8,2],[27,8,8,2,"_useState3"],[27,18,8,2],[27,21,8,34],[27,25,8,34,"useState"],[27,31,8,42],[27,32,8,42,"useState"],[27,40,8,42],[27,42,8,43],[27,44,8,45],[27,45,8,46],[28,6,8,46,"_useState4"],[28,16,8,46],[28,23,8,46,"_slicedToArray"],[28,37,8,46],[28,38,8,46,"default"],[28,45,8,46],[28,47,8,46,"_useState3"],[28,57,8,46],[29,6,8,9,"messages"],[29,14,8,17],[29,17,8,17,"_useState4"],[29,27,8,17],[30,6,8,19,"setMessages"],[30,17,8,30],[30,20,8,30,"_useState4"],[30,30,8,30],[31,4,9,2],[31,8,9,2,"_useState5"],[31,18,9,2],[31,21,9,26],[31,25,9,26,"useState"],[31,31,9,34],[31,32,9,34,"useState"],[31,40,9,34],[31,42,9,35],[31,46,9,39],[31,47,9,40],[32,6,9,40,"_useState6"],[32,16,9,40],[32,23,9,40,"_slicedToArray"],[32,37,9,40],[32,38,9,40,"default"],[32,45,9,40],[32,47,9,40,"_useState5"],[32,57,9,40],[33,6,9,9,"user"],[33,10,9,13],[33,13,9,13,"_useState6"],[33,23,9,13],[34,6,9,15,"setUser"],[34,13,9,22],[34,16,9,22,"_useState6"],[34,26,9,22],[35,4,10,2],[35,8,10,2,"_useState7"],[35,18,10,2],[35,21,10,36],[35,25,10,36,"useState"],[35,31,10,44],[35,32,10,44,"useState"],[35,40,10,44],[35,42,10,45],[35,46,10,49],[35,47,10,50],[36,6,10,50,"_useState8"],[36,16,10,50],[36,23,10,50,"_slicedToArray"],[36,37,10,50],[36,38,10,50,"default"],[36,45,10,50],[36,47,10,50,"_useState7"],[36,57,10,50],[37,6,10,9,"matchInfo"],[37,15,10,18],[37,18,10,18,"_useState8"],[37,28,10,18],[38,6,10,20,"setMatchInfo"],[38,18,10,32],[38,21,10,32,"_useState8"],[38,31,10,32],[39,4,11,2],[39,8,11,2,"_useState9"],[39,18,11,2],[39,21,11,28],[39,25,11,28,"useState"],[39,31,11,36],[39,32,11,36,"useState"],[39,40,11,36],[39,42,11,37],[39,46,11,41],[39,47,11,42],[40,6,11,42,"_useState0"],[40,16,11,42],[40,23,11,42,"_slicedToArray"],[40,37,11,42],[40,38,11,42,"default"],[40,45,11,42],[40,47,11,42,"_useState9"],[40,57,11,42],[41,6,11,9,"error"],[41,11,11,14],[41,14,11,14,"_useState0"],[41,24,11,14],[42,6,11,16,"setError"],[42,14,11,24],[42,17,11,24,"_useState0"],[42,27,11,24],[44,4,13,2],[45,4,14,2],[46,4,15,2],[46,8,15,8,"messagesAbortRef"],[46,24,15,24],[46,27,15,27],[46,31,15,27,"useRef"],[46,37,15,33],[46,38,15,33,"useRef"],[46,44,15,33],[46,46,15,34],[46,50,15,38],[46,51,15,39],[47,4,16,2],[47,8,16,8,"messagesInFlightRef"],[47,27,16,27],[47,30,16,30],[47,34,16,30,"useRef"],[47,40,16,36],[47,41,16,36,"useRef"],[47,47,16,36],[47,49,16,37],[47,54,16,42],[47,55,16,43],[48,4,17,2],[48,8,17,8,"lastMessagesFetchAtRef"],[48,30,17,30],[48,33,17,33],[48,37,17,33,"useRef"],[48,43,17,39],[48,44,17,39,"useRef"],[48,50,17,39],[48,52,17,40],[48,53,17,41],[48,54,17,42],[49,4,18,2],[49,8,18,8,"rateLimitedUntilRef"],[49,27,18,27],[49,30,18,30],[49,34,18,30,"useRef"],[49,40,18,36],[49,41,18,36,"useRef"],[49,47,18,36],[49,49,18,37],[49,50,18,38],[49,51,18,39],[50,4,20,2],[50,8,20,8,"markMatchesSeen"],[50,23,20,23],[50,26,20,26],[50,30,20,26,"useCallback"],[50,36,20,37],[50,37,20,37,"useCallback"],[50,48,20,37],[51,6,20,37],[51,10,20,37,"_ref"],[51,14,20,37],[51,21,20,37,"_asyncToGenerator"],[51,38,20,37],[51,39,20,37,"default"],[51,46,20,37],[51,48,21,4],[51,59,21,11,"userId"],[51,65,21,17],[51,67,21,22],[52,8,22,6],[52,12,22,10],[53,10,23,8],[53,14,23,14,"resp"],[53,18,23,18],[53,27,23,27,"fetch"],[53,32,23,32],[53,33,23,33],[53,57,23,57],[53,59,23,59],[54,12,24,10,"method"],[54,18,24,16],[54,20,24,18],[54,26,24,24],[55,12,25,10,"headers"],[55,19,25,17],[55,21,25,19],[56,14,25,21],[56,28,25,35],[56,30,25,37],[57,12,25,56],[57,13,25,57],[58,12,26,10,"body"],[58,16,26,14],[58,18,26,16,"JSON"],[58,22,26,20],[58,23,26,21,"stringify"],[58,32,26,30],[58,33,26,31],[59,14,26,33,"userId"],[60,12,26,40],[60,13,26,41],[61,10,27,8],[61,11,27,9],[61,12,27,10],[62,10,28,8],[62,14,28,12,"resp"],[62,18,28,16],[62,19,28,17,"ok"],[62,21,28,19],[62,23,28,21],[63,12,29,10,"queryClient"],[63,23,29,21],[63,24,29,22,"invalidateQueries"],[63,41,29,39],[63,42,29,40],[64,14,30,12,"queryKey"],[64,22,30,20],[64,24,30,22],[64,25,30,23],[64,41,30,39],[64,43,30,41,"userId"],[64,49,30,47],[65,12,31,10],[65,13,31,11],[65,14,31,12],[66,12,32,10],[67,12,33,10,"queryClient"],[67,23,33,21],[67,24,33,22,"invalidateQueries"],[67,41,33,39],[67,42,33,40],[68,14,34,12,"queryKey"],[68,22,34,20],[68,24,34,22],[68,25,34,23],[68,42,34,40],[68,44,34,42,"userId"],[68,50,34,48],[69,12,35,10],[69,13,35,11],[69,14,35,12],[70,10,36,8],[71,8,37,6],[71,9,37,7],[71,10,37,8],[71,17,37,15,"e"],[71,18,37,16],[71,20,37,18],[72,10,38,8,"console"],[72,17,38,15],[72,18,38,16,"error"],[72,23,38,21],[72,24,38,22],[72,53,38,51],[72,55,38,53,"e"],[72,56,38,54],[72,57,38,55],[73,8,39,6],[74,6,40,4],[74,7,40,5],[75,6,40,5],[75,23,40,5,"_x"],[75,25,40,5],[76,8,40,5],[76,15,40,5,"_ref"],[76,19,40,5],[76,20,40,5,"apply"],[76,25,40,5],[76,32,40,5,"arguments"],[76,41,40,5],[77,6,40,5],[78,4,40,5],[78,9,41,4],[78,10,41,5,"queryClient"],[78,21,41,16],[78,22,42,2],[78,23,42,3],[79,4,44,2],[79,8,44,8,"loadMatchInfo"],[79,21,44,21],[80,6,44,21],[80,10,44,21,"_ref2"],[80,15,44,21],[80,22,44,21,"_asyncToGenerator"],[80,39,44,21],[80,40,44,21,"default"],[80,47,44,21],[80,49,44,24],[80,60,44,31,"userId"],[80,66,44,37],[80,68,44,42],[81,8,45,4],[81,12,45,8],[81,13,45,9,"matchId"],[81,20,45,16],[81,22,45,18],[82,8,46,4],[82,12,46,8],[83,10,47,6],[83,14,47,12,"response"],[83,22,47,20],[83,31,47,29,"fetch"],[83,36,47,34],[83,37,47,35],[83,53,47,51,"matchId"],[83,60,47,58],[83,71,47,69,"userId"],[83,77,47,75],[83,79,47,77],[83,80,47,78],[84,10,48,6],[84,14,48,10],[84,15,48,11,"response"],[84,23,48,19],[84,24,48,20,"ok"],[84,26,48,22],[84,28,48,24],[85,12,49,8],[85,16,49,12,"response"],[85,24,49,20],[85,25,49,21,"status"],[85,31,49,27],[85,36,49,32],[85,39,49,35],[85,41,49,37],[86,14,50,10,"setMatchInfo"],[86,26,50,22],[86,27,50,23],[86,31,50,27],[86,32,50,28],[87,14,51,10,"setError"],[87,22,51,18],[87,23,51,20,"prev"],[87,27,51,24],[87,31,51,29,"prev"],[87,35,51,33],[87,39,51,37],[87,75,51,73],[87,76,51,74],[88,14,52,10],[89,12,53,8],[91,12,55,8],[92,12,56,8],[92,16,57,10,"response"],[92,24,57,18],[92,25,57,19,"status"],[92,31,57,25],[92,36,57,30],[92,39,57,33],[92,43,58,10,"response"],[92,51,58,18],[92,52,58,19,"status"],[92,58,58,25],[92,63,58,30],[92,66,58,33],[92,70,59,10,"response"],[92,78,59,18],[92,79,59,19,"status"],[92,85,59,25],[92,90,59,30],[92,93,59,33],[92,95,60,10],[93,14,61,10,"setMatchInfo"],[93,26,61,22],[93,27,61,23],[93,31,61,27],[93,32,61,28],[94,14,62,10,"setError"],[94,22,62,18],[94,23,63,13,"prev"],[94,27,63,17],[94,31,64,14,"prev"],[94,35,64,18],[94,39,64,22],[94,93,65,10],[94,94,65,11],[95,14,66,10],[96,12,67,8],[97,12,69,8],[97,16,69,14,"text"],[97,20,69,18],[97,29,69,27,"response"],[97,37,69,35],[97,38,69,36,"text"],[97,42,69,40],[97,43,69,41],[97,44,69,42],[97,45,69,43,"catch"],[97,50,69,48],[97,51,69,49],[97,57,69,55],[97,59,69,57],[97,60,69,58],[98,12,70,8],[98,18,70,14],[98,22,70,18,"Error"],[98,27,70,23],[98,28,71,10],[98,58,71,40,"matchId"],[98,65,71,47],[98,88,71,70,"response"],[98,96,71,78],[98,97,71,79,"status"],[98,103,71,85],[98,108,71,90,"response"],[98,116,71,98],[98,117,71,99,"statusText"],[98,127,71,109],[98,131,71,113,"text"],[98,135,71,117],[98,137,72,8],[98,138,72,9],[99,10,73,6],[100,10,74,6],[100,14,74,12,"data"],[100,18,74,16],[100,27,74,25,"response"],[100,35,74,33],[100,36,74,34,"json"],[100,40,74,38],[100,41,74,39],[100,42,74,40],[101,10,75,6,"setMatchInfo"],[101,22,75,18],[101,23,75,19,"data"],[101,27,75,23],[101,29,75,25,"match"],[101,34,75,30],[101,38,75,34],[101,42,75,38],[101,43,75,39],[102,8,76,4],[102,9,76,5],[102,10,76,6],[102,17,76,13,"err"],[102,20,76,16],[102,22,76,18],[103,10,77,6,"console"],[103,17,77,13],[103,18,77,14,"error"],[103,23,77,19],[103,24,77,20],[103,51,77,47],[103,53,77,49,"err"],[103,56,77,52],[103,57,77,53],[104,10,78,6,"setMatchInfo"],[104,22,78,18],[104,23,78,19],[104,27,78,23],[104,28,78,24],[106,10,80,6],[107,10,81,6,"setError"],[107,18,81,14],[107,19,82,9,"prev"],[107,23,82,13],[107,27,83,10,"prev"],[107,31,83,14],[107,36,84,11,"err"],[107,39,84,14],[107,41,84,16,"message"],[107,48,84,23],[107,51,84,26,"String"],[107,57,84,32],[107,58,84,33,"err"],[107,61,84,36],[107,62,84,37,"message"],[107,69,84,44],[107,70,84,45],[107,73,84,48],[107,101,84,76],[107,102,85,6],[107,103,85,7],[108,8,86,4],[109,6,87,2],[109,7,87,3],[110,6,87,3],[110,22,44,8,"loadMatchInfo"],[110,35,44,21,"loadMatchInfo"],[110,36,44,21,"_x2"],[110,39,44,21],[111,8,44,21],[111,15,44,21,"_ref2"],[111,20,44,21],[111,21,44,21,"apply"],[111,26,44,21],[111,33,44,21,"arguments"],[111,42,44,21],[112,6,44,21],[113,4,44,21],[113,7,87,3],[114,4,89,2],[114,8,89,8,"loadMessages"],[114,20,89,20],[114,23,89,23],[114,27,89,23,"useCallback"],[114,33,89,34],[114,34,89,34,"useCallback"],[114,45,89,34],[115,6,89,34],[115,10,89,34,"_ref3"],[115,15,89,34],[115,22,89,34,"_asyncToGenerator"],[115,39,89,34],[115,40,89,34,"default"],[115,47,89,34],[115,49,90,4],[115,60,90,11,"userId"],[115,66,90,17],[115,68,90,22],[116,8,91,6],[116,12,91,10],[116,13,91,11,"matchId"],[116,20,91,18],[116,22,91,20],[117,8,93,6],[117,12,93,12,"now"],[117,15,93,15],[117,18,93,18,"Date"],[117,22,93,22],[117,23,93,23,"now"],[117,26,93,26],[117,27,93,27],[117,28,93,28],[118,8,94,6],[118,12,94,10,"now"],[118,15,94,13],[118,18,94,16,"rateLimitedUntilRef"],[118,37,94,35],[118,38,94,36,"current"],[118,45,94,43],[118,47,94,45],[119,10,95,8],[120,8,96,6],[122,8,98,6],[123,8,99,6],[123,12,99,10,"now"],[123,15,99,13],[123,18,99,16,"lastMessagesFetchAtRef"],[123,40,99,38],[123,41,99,39,"current"],[123,48,99,46],[123,51,99,49],[123,54,99,52],[123,56,99,54],[124,10,100,8],[125,8,101,6],[127,8,103,6],[128,8,104,6],[128,12,104,10],[129,10,105,8],[129,14,105,12,"messagesAbortRef"],[129,30,105,28],[129,31,105,29,"current"],[129,38,105,36],[129,40,105,38],[130,12,106,10,"messagesAbortRef"],[130,28,106,26],[130,29,106,27,"current"],[130,36,106,34],[130,37,106,35,"abort"],[130,42,106,40],[130,43,106,41],[130,44,106,42],[131,10,107,8],[132,8,108,6],[132,9,108,7],[132,10,108,8],[132,16,108,14],[133,10,109,8],[134,8,109,8],[135,8,112,6],[135,12,112,12,"controller"],[135,22,112,22],[135,25,112,25],[135,29,112,29,"AbortController"],[135,44,112,44],[135,45,112,45],[135,46,112,46],[136,8,113,6,"messagesAbortRef"],[136,24,113,22],[136,25,113,23,"current"],[136,32,113,30],[136,35,113,33,"controller"],[136,45,113,43],[137,8,114,6,"lastMessagesFetchAtRef"],[137,30,114,28],[137,31,114,29,"current"],[137,38,114,36],[137,41,114,39,"now"],[137,44,114,42],[139,8,116,6],[140,8,117,6],[140,12,117,10,"messagesInFlightRef"],[140,31,117,29],[140,32,117,30,"current"],[140,39,117,37],[140,41,117,39],[141,10,118,8],[142,8,119,6],[143,8,121,6,"messagesInFlightRef"],[143,27,121,25],[143,28,121,26,"current"],[143,35,121,33],[143,38,121,36],[143,42,121,40],[144,8,123,6],[144,12,123,10],[145,10,124,8],[145,14,124,14,"response"],[145,22,124,22],[145,31,124,31,"fetch"],[145,36,124,36],[145,37,125,10],[145,54,125,27,"matchId"],[145,61,125,34],[145,72,125,45,"userId"],[145,78,125,51],[145,80,125,53],[145,82,126,10],[146,12,127,12,"signal"],[146,18,127,18],[146,20,127,20,"controller"],[146,30,127,30],[146,31,127,31,"signal"],[147,10,128,10],[147,11,129,8],[147,12,129,9],[148,10,131,8],[148,14,131,12],[148,15,131,13,"response"],[148,23,131,21],[148,24,131,22,"ok"],[148,26,131,24],[148,28,131,26],[149,12,132,10],[149,16,132,14,"response"],[149,24,132,22],[149,25,132,23,"status"],[149,31,132,29],[149,36,132,34],[149,39,132,37],[149,41,132,39],[150,14,133,12],[151,14,134,12,"rateLimitedUntilRef"],[151,33,134,31],[151,34,134,32,"current"],[151,41,134,39],[151,44,134,42,"Date"],[151,48,134,46],[151,49,134,47,"now"],[151,52,134,50],[151,53,134,51],[151,54,134,52],[151,57,134,55],[151,61,134,59],[152,14,135,12],[153,12,136,10],[154,12,138,10],[154,16,138,14,"response"],[154,24,138,22],[154,25,138,23,"status"],[154,31,138,29],[154,36,138,34],[154,39,138,37],[154,41,138,39],[155,14,139,12,"setMessages"],[155,25,139,23],[155,26,139,24],[155,28,139,26],[155,29,139,27],[156,14,140,12,"setError"],[156,22,140,20],[156,23,140,21],[156,58,140,56],[156,59,140,57],[157,14,141,12],[158,12,142,10],[159,12,144,10],[159,16,144,14,"response"],[159,24,144,22],[159,25,144,23,"status"],[159,31,144,29],[159,36,144,34],[159,39,144,37],[159,41,144,39],[160,14,145,12,"setMessages"],[160,25,145,23],[160,26,145,24],[160,28,145,26],[160,29,145,27],[161,14,146,12,"setError"],[161,22,146,20],[161,23,146,21],[161,59,146,57],[161,60,146,58],[162,14,147,12],[163,12,148,10],[165,12,150,10],[166,12,151,10],[166,16,152,12,"response"],[166,24,152,20],[166,25,152,21,"status"],[166,31,152,27],[166,36,152,32],[166,39,152,35],[166,43,153,12,"response"],[166,51,153,20],[166,52,153,21,"status"],[166,58,153,27],[166,63,153,32],[166,66,153,35],[166,70,154,12,"response"],[166,78,154,20],[166,79,154,21,"status"],[166,85,154,27],[166,90,154,32],[166,93,154,35],[166,95,155,12],[167,14,156,12,"setMessages"],[167,25,156,23],[167,26,156,24],[167,28,156,26],[167,29,156,27],[168,14,157,12,"setError"],[168,22,157,20],[168,23,157,21],[168,77,157,75],[168,78,157,76],[169,14,158,12],[170,12,159,10],[171,12,161,10],[171,16,161,16,"text"],[171,20,161,20],[171,29,161,29,"response"],[171,37,161,37],[171,38,161,38,"text"],[171,42,161,42],[171,43,161,43],[171,44,161,44],[171,45,161,45,"catch"],[171,50,161,50],[171,51,161,51],[171,57,161,57],[171,59,161,59],[171,60,161,60],[172,12,162,10],[172,18,162,16],[172,22,162,20,"Error"],[172,27,162,25],[172,28,163,12],[172,59,163,43,"matchId"],[172,66,163,50],[172,89,163,73,"response"],[172,97,163,81],[172,98,163,82,"status"],[172,104,163,88],[172,109,163,93,"response"],[172,117,163,101],[172,118,163,102,"statusText"],[172,128,163,112],[172,132,163,116,"text"],[172,136,163,120],[172,138,164,10],[172,139,164,11],[173,10,165,8],[174,10,167,8],[174,14,167,14,"data"],[174,18,167,18],[174,27,167,27,"response"],[174,35,167,35],[174,36,167,36,"json"],[174,40,167,40],[174,41,167,41],[174,42,167,42],[175,10,168,8],[175,14,168,14,"nextMessages"],[175,26,168,26],[175,29,168,29,"Array"],[175,34,168,34],[175,35,168,35,"isArray"],[175,42,168,42],[175,43,168,43,"data"],[175,47,168,47],[175,49,168,49,"messages"],[175,57,168,57],[175,58,168,58],[175,61,168,61,"data"],[175,65,168,65],[175,66,168,66,"messages"],[175,74,168,74],[175,77,168,77],[175,79,168,79],[176,10,169,8,"setMessages"],[176,21,169,19],[176,22,169,20,"nextMessages"],[176,34,169,32],[176,35,169,33],[178,10,171,8],[179,10,172,8,"queryClient"],[179,21,172,19],[179,22,172,20,"invalidateQueries"],[179,39,172,37],[179,40,172,38],[180,12,172,40,"queryKey"],[180,20,172,48],[180,22,172,50],[180,23,172,51],[180,39,172,67],[180,41,172,69,"userId"],[180,47,172,75],[181,10,172,77],[181,11,172,78],[181,12,172,79],[183,10,174,8],[184,10,175,8,"queryClient"],[184,21,175,19],[184,22,175,20,"invalidateQueries"],[184,39,175,37],[184,40,175,38],[185,12,176,10,"queryKey"],[185,20,176,18],[185,22,176,20],[185,23,176,21],[185,40,176,38],[185,42,176,40,"userId"],[185,48,176,46],[186,10,177,8],[186,11,177,9],[186,12,177,10],[187,8,178,6],[187,9,178,7],[187,10,178,8],[187,17,178,15,"err"],[187,20,178,18],[187,22,178,20],[188,10,179,8],[188,14,179,12,"err"],[188,17,179,15],[188,19,179,17,"name"],[188,23,179,21],[188,28,179,26],[188,40,179,38],[188,42,179,40],[189,12,180,10],[190,10,181,8],[191,10,183,8,"console"],[191,17,183,15],[191,18,183,16,"error"],[191,23,183,21],[191,24,183,22],[191,49,183,47],[191,51,183,49,"err"],[191,54,183,52],[191,55,183,53],[192,10,184,8,"setError"],[192,18,184,16],[192,19,185,10,"err"],[192,22,185,13],[192,24,185,15,"message"],[192,31,185,22],[192,34,186,14,"String"],[192,40,186,20],[192,41,186,21,"err"],[192,44,186,24],[192,45,186,25,"message"],[192,52,186,32],[192,53,186,33],[192,56,187,14],[192,97,188,8],[192,98,188,9],[193,8,189,6],[193,9,189,7],[193,18,189,16],[194,10,190,8,"messagesInFlightRef"],[194,29,190,27],[194,30,190,28,"current"],[194,37,190,35],[194,40,190,38],[194,45,190,43],[195,8,191,6],[196,6,192,4],[196,7,192,5],[197,6,192,5],[197,23,192,5,"_x3"],[197,26,192,5],[198,8,192,5],[198,15,192,5,"_ref3"],[198,20,192,5],[198,21,192,5,"apply"],[198,26,192,5],[198,33,192,5,"arguments"],[198,42,192,5],[199,6,192,5],[200,4,192,5],[200,9,193,4],[200,10,193,5,"matchId"],[200,17,193,12],[200,19,193,14,"queryClient"],[200,30,193,25],[200,31,194,2],[200,32,194,3],[201,4,196,2],[201,8,196,8,"loadUserAndMessages"],[201,27,196,27],[202,6,196,27],[202,10,196,27,"_ref4"],[202,15,196,27],[202,22,196,27,"_asyncToGenerator"],[202,39,196,27],[202,40,196,27,"default"],[202,47,196,27],[202,49,196,30],[202,62,196,42],[203,8,197,4],[203,12,197,8],[203,13,197,9,"matchId"],[203,20,197,16],[203,22,197,18],[204,10,198,6,"setLoading"],[204,20,198,16],[204,21,198,17],[204,25,198,21],[204,26,198,22],[205,10,199,6],[206,8,200,4],[207,8,202,4],[207,12,202,8],[208,10,203,6,"setError"],[208,18,203,14],[208,19,203,15],[208,23,203,19],[208,24,203,20],[209,10,204,6],[209,14,204,12,"userData"],[209,22,204,20],[209,31,204,29,"AsyncStorage"],[209,43,204,41],[209,44,204,41,"default"],[209,51,204,41],[209,52,204,42,"getItem"],[209,59,204,49],[209,60,204,50],[209,66,204,56],[209,67,204,57],[210,10,205,6],[210,14,205,10],[210,15,205,11,"userData"],[210,23,205,19],[210,25,205,21],[211,12,206,8,"setUser"],[211,19,206,15],[211,20,206,16],[211,24,206,20],[211,25,206,21],[212,12,207,8,"setError"],[212,20,207,16],[212,21,207,17],[212,48,207,44],[212,49,207,45],[213,12,208,8],[214,10,209,6],[215,10,211,6],[215,14,211,12,"parsedUser"],[215,24,211,22],[215,27,211,25,"JSON"],[215,31,211,29],[215,32,211,30,"parse"],[215,37,211,35],[215,38,211,36,"userData"],[215,46,211,44],[215,47,211,45],[216,10,212,6,"setUser"],[216,17,212,13],[216,18,212,14,"parsedUser"],[216,28,212,24],[216,29,212,25],[217,10,213,6],[217,16,213,12,"markMatchesSeen"],[217,31,213,27],[217,32,213,28,"parsedUser"],[217,42,213,38],[217,43,213,39,"id"],[217,45,213,41],[217,46,213,42],[218,10,214,6],[218,16,214,12,"Promise"],[218,23,214,19],[218,24,214,20,"all"],[218,27,214,23],[218,28,214,24],[218,29,215,8,"loadMatchInfo"],[218,42,215,21],[218,43,215,22,"parsedUser"],[218,53,215,32],[218,54,215,33,"id"],[218,56,215,35],[218,57,215,36],[218,59,216,8,"loadMessages"],[218,71,216,20],[218,72,216,21,"parsedUser"],[218,82,216,31],[218,83,216,32,"id"],[218,85,216,34],[218,86,216,35],[218,87,217,7],[218,88,217,8],[219,8,218,4],[219,9,218,5],[219,10,218,6],[219,17,218,13,"err"],[219,20,218,16],[219,22,218,18],[220,10,219,6,"console"],[220,17,219,13],[220,18,219,14,"error"],[220,23,219,19],[220,24,219,20],[220,53,219,49],[220,55,219,51,"err"],[220,58,219,54],[220,59,219,55],[221,10,220,6,"setError"],[221,18,220,14],[221,19,221,8,"err"],[221,22,221,11],[221,24,221,13,"message"],[221,31,221,20],[221,34,221,23,"String"],[221,40,221,29],[221,41,221,30,"err"],[221,44,221,33],[221,45,221,34,"message"],[221,52,221,41],[221,53,221,42],[221,56,221,45],[221,83,222,6],[221,84,222,7],[222,8,223,4],[222,9,223,5],[222,18,223,14],[223,10,224,6,"setLoading"],[223,20,224,16],[223,21,224,17],[223,26,224,22],[223,27,224,23],[224,8,225,4],[225,6,226,2],[225,7,226,3],[226,6,226,3],[226,22,196,8,"loadUserAndMessages"],[226,41,196,27,"loadUserAndMessages"],[226,42,196,27],[227,8,196,27],[227,15,196,27,"_ref4"],[227,20,196,27],[227,21,196,27,"apply"],[227,26,196,27],[227,33,196,27,"arguments"],[227,42,196,27],[228,6,196,27],[229,4,196,27],[229,7,226,3],[230,4,228,2],[230,8,228,2,"useEffect"],[230,14,228,11],[230,15,228,11,"useEffect"],[230,24,228,11],[230,26,228,12],[230,32,228,18],[231,6,229,4],[232,6,230,4],[233,6,231,4,"loadUserAndMessages"],[233,25,231,23],[233,26,231,24],[233,27,231,25],[234,6,232,4],[235,4,233,2],[235,5,233,3],[235,7,233,5],[235,8,233,6,"matchId"],[235,15,233,13],[235,16,233,14],[235,17,233,15],[236,4,235,2],[236,8,235,8,"reloadMessages"],[236,22,235,22],[236,25,235,25],[236,29,235,25,"useCallback"],[236,35,235,36],[236,36,235,36,"useCallback"],[236,47,235,36],[236,66,235,36,"_asyncToGenerator"],[236,83,235,36],[236,84,235,36,"default"],[236,91,235,36],[236,93,235,37],[236,106,235,49],[237,6,236,4],[237,10,236,10,"uid"],[237,13,236,13],[237,16,236,16,"user"],[237,20,236,20],[237,22,236,22,"id"],[237,24,236,24],[238,6,237,4],[238,10,237,8],[238,11,237,9,"uid"],[238,14,237,12],[238,16,237,14],[239,6,238,4],[239,10,238,8],[239,11,238,9,"matchId"],[239,18,238,16],[239,20,238,18],[240,6,239,4],[240,12,239,10,"loadMessages"],[240,24,239,22],[240,25,239,23,"uid"],[240,28,239,26],[240,29,239,27],[241,4,240,2],[241,5,240,3],[241,8,240,5],[241,9,240,6,"loadMessages"],[241,21,240,18],[241,23,240,20,"matchId"],[241,30,240,27],[241,32,240,29,"user"],[241,36,240,33],[241,38,240,35,"id"],[241,40,240,37],[241,41,240,38],[241,42,240,39],[242,4,242,2],[242,11,242,9],[243,6,243,4,"loading"],[243,13,243,11],[244,6,244,4,"error"],[244,11,244,9],[245,6,245,4,"messages"],[245,14,245,12],[246,6,246,4,"setMessages"],[246,17,246,15],[247,6,247,4,"user"],[247,10,247,8],[248,6,248,4,"matchInfo"],[248,15,248,13],[249,6,249,4,"reloadMessages"],[250,4,250,2],[250,5,250,3],[251,2,251,0],[252,0,251,1],[252,3]],"functionMap":{"names":["<global>","useConversation","markMatchesSeen","loadMatchInfo","setError$argument_0","response.text._catch$argument_0","loadMessages","loadUserAndMessages","useEffect$argument_0","reloadMessages"],"mappings":"AAA;OCI;ICgB;KDmB;wBEI;mBCO,sDD;YCY;4EDC;iDEK,QF;QCa;6EDE;GFG;IKG;mDDuE,QC;KL+B;8BMI;GN8B;YOE;GPK;qCQE;GRK;CDW"},"hasCjsExports":false},"type":"js/module"}]}