{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":55,"index":55}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@react-navigation/native","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":56},"end":{"line":2,"column":56,"index":112}}],"key":"yKhyWCfwa1gXEwEbMKnWHykYbZ4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.usePresencePing = usePresencePing;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _reactNavigationNative = require(_dependencyMap[1], \"@react-navigation/native\");\n  function usePresencePing(userId, options) {\n    const isFocused = (0, _reactNavigationNative.useIsFocused)();\n    const intervalMs = Number(options?.intervalMs) || 30_000;\n    const enabled = options?.enabled !== false;\n    const busyRef = (0, _react.useRef)(false);\n    const pingOnce = (0, _react.useCallback)(async () => {\n      if (!enabled) return;\n      const uid = Number(userId);\n      if (!Number.isFinite(uid)) return;\n      if (busyRef.current) return;\n      busyRef.current = true;\n      try {\n        const resp = await fetch(\"/api/presence/ping\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify({\n            userId: uid,\n            platform: \"mobile\"\n          })\n        });\n        if (!resp.ok) {\n          const text = await resp.text().catch(() => \"\");\n          throw new Error(`When posting /api/presence/ping, the response was [${resp.status}] ${resp.statusText}. ${text}`);\n        }\n      } catch (e) {\n        // Presence is best-effort â€” never block UI.\n        console.error(\"[presence] ping failed\", e);\n      } finally {\n        busyRef.current = false;\n      }\n    }, [enabled, userId]);\n    (0, _react.useEffect)(() => {\n      if (!enabled) return;\n      if (!isFocused) return;\n      let alive = true;\n      const start = async () => {\n        if (!alive) return;\n        await pingOnce();\n      };\n      start();\n      const interval = setInterval(() => {\n        pingOnce();\n      }, intervalMs);\n      return () => {\n        alive = false;\n        clearInterval(interval);\n      };\n    }, [enabled, intervalMs, isFocused, pingOnce]);\n  }\n});","lineCount":61,"map":[[7,2,4,0,"exports"],[7,9,4,0],[7,10,4,0,"usePresencePing"],[7,25,4,0],[7,28,4,0,"usePresencePing"],[7,43,4,0],[8,2,1,0],[8,6,1,0,"_react"],[8,12,1,0],[8,15,1,0,"require"],[8,22,1,0],[8,23,1,0,"_dependencyMap"],[8,37,1,0],[9,2,2,0],[9,6,2,0,"_reactNavigationNative"],[9,28,2,0],[9,31,2,0,"require"],[9,38,2,0],[9,39,2,0,"_dependencyMap"],[9,53,2,0],[10,2,4,7],[10,11,4,16,"usePresencePing"],[10,26,4,31,"usePresencePing"],[10,27,4,32,"userId"],[10,33,4,38],[10,35,4,40,"options"],[10,42,4,47],[10,44,4,49],[11,4,5,2],[11,10,5,8,"isFocused"],[11,19,5,17],[11,22,5,20],[11,26,5,20,"useIsFocused"],[11,48,5,32],[11,49,5,32,"useIsFocused"],[11,61,5,32],[11,63,5,33],[11,64,5,34],[12,4,6,2],[12,10,6,8,"intervalMs"],[12,20,6,18],[12,23,6,21,"Number"],[12,29,6,27],[12,30,6,28,"options"],[12,37,6,35],[12,39,6,37,"intervalMs"],[12,49,6,47],[12,50,6,48],[12,54,6,52],[12,60,6,58],[13,4,7,2],[13,10,7,8,"enabled"],[13,17,7,15],[13,20,7,18,"options"],[13,27,7,25],[13,29,7,27,"enabled"],[13,36,7,34],[13,41,7,39],[13,46,7,44],[14,4,9,2],[14,10,9,8,"busyRef"],[14,17,9,15],[14,20,9,18],[14,24,9,18,"useRef"],[14,30,9,24],[14,31,9,24,"useRef"],[14,37,9,24],[14,39,9,25],[14,44,9,30],[14,45,9,31],[15,4,11,2],[15,10,11,8,"pingOnce"],[15,18,11,16],[15,21,11,19],[15,25,11,19,"useCallback"],[15,31,11,30],[15,32,11,30,"useCallback"],[15,43,11,30],[15,45,11,31],[15,57,11,43],[16,6,12,4],[16,10,12,8],[16,11,12,9,"enabled"],[16,18,12,16],[16,20,12,18],[17,6,13,4],[17,12,13,10,"uid"],[17,15,13,13],[17,18,13,16,"Number"],[17,24,13,22],[17,25,13,23,"userId"],[17,31,13,29],[17,32,13,30],[18,6,14,4],[18,10,14,8],[18,11,14,9,"Number"],[18,17,14,15],[18,18,14,16,"isFinite"],[18,26,14,24],[18,27,14,25,"uid"],[18,30,14,28],[18,31,14,29],[18,33,14,31],[19,6,15,4],[19,10,15,8,"busyRef"],[19,17,15,15],[19,18,15,16,"current"],[19,25,15,23],[19,27,15,25],[20,6,17,4,"busyRef"],[20,13,17,11],[20,14,17,12,"current"],[20,21,17,19],[20,24,17,22],[20,28,17,26],[21,6,18,4],[21,10,18,8],[22,8,19,6],[22,14,19,12,"resp"],[22,18,19,16],[22,21,19,19],[22,27,19,25,"fetch"],[22,32,19,30],[22,33,19,31],[22,53,19,51],[22,55,19,53],[23,10,20,8,"method"],[23,16,20,14],[23,18,20,16],[23,24,20,22],[24,10,21,8,"headers"],[24,17,21,15],[24,19,21,17],[25,12,21,19],[25,26,21,33],[25,28,21,35],[26,10,21,54],[26,11,21,55],[27,10,22,8,"body"],[27,14,22,12],[27,16,22,14,"JSON"],[27,20,22,18],[27,21,22,19,"stringify"],[27,30,22,28],[27,31,22,29],[28,12,22,31,"userId"],[28,18,22,37],[28,20,22,39,"uid"],[28,23,22,42],[29,12,22,44,"platform"],[29,20,22,52],[29,22,22,54],[30,10,22,63],[30,11,22,64],[31,8,23,6],[31,9,23,7],[31,10,23,8],[32,8,25,6],[32,12,25,10],[32,13,25,11,"resp"],[32,17,25,15],[32,18,25,16,"ok"],[32,20,25,18],[32,22,25,20],[33,10,26,8],[33,16,26,14,"text"],[33,20,26,18],[33,23,26,21],[33,29,26,27,"resp"],[33,33,26,31],[33,34,26,32,"text"],[33,38,26,36],[33,39,26,37],[33,40,26,38],[33,41,26,39,"catch"],[33,46,26,44],[33,47,26,45],[33,53,26,51],[33,55,26,53],[33,56,26,54],[34,10,27,8],[34,16,27,14],[34,20,27,18,"Error"],[34,25,27,23],[34,26,28,10],[34,80,28,64,"resp"],[34,84,28,68],[34,85,28,69,"status"],[34,91,28,75],[34,96,28,80,"resp"],[34,100,28,84],[34,101,28,85,"statusText"],[34,111,28,95],[34,116,28,100,"text"],[34,120,28,104],[34,122,29,8],[34,123,29,9],[35,8,30,6],[36,6,31,4],[36,7,31,5],[36,8,31,6],[36,15,31,13,"e"],[36,16,31,14],[36,18,31,16],[37,8,32,6],[38,8,33,6,"console"],[38,15,33,13],[38,16,33,14,"error"],[38,21,33,19],[38,22,33,20],[38,46,33,44],[38,48,33,46,"e"],[38,49,33,47],[38,50,33,48],[39,6,34,4],[39,7,34,5],[39,16,34,14],[40,8,35,6,"busyRef"],[40,15,35,13],[40,16,35,14,"current"],[40,23,35,21],[40,26,35,24],[40,31,35,29],[41,6,36,4],[42,4,37,2],[42,5,37,3],[42,7,37,5],[42,8,37,6,"enabled"],[42,15,37,13],[42,17,37,15,"userId"],[42,23,37,21],[42,24,37,22],[42,25,37,23],[43,4,39,2],[43,8,39,2,"useEffect"],[43,14,39,11],[43,15,39,11,"useEffect"],[43,24,39,11],[43,26,39,12],[43,32,39,18],[44,6,40,4],[44,10,40,8],[44,11,40,9,"enabled"],[44,18,40,16],[44,20,40,18],[45,6,41,4],[45,10,41,8],[45,11,41,9,"isFocused"],[45,20,41,18],[45,22,41,20],[46,6,43,4],[46,10,43,8,"alive"],[46,15,43,13],[46,18,43,16],[46,22,43,20],[47,6,45,4],[47,12,45,10,"start"],[47,17,45,15],[47,20,45,18],[47,26,45,18,"start"],[47,27,45,18],[47,32,45,30],[48,8,46,6],[48,12,46,10],[48,13,46,11,"alive"],[48,18,46,16],[48,20,46,18],[49,8,47,6],[49,14,47,12,"pingOnce"],[49,22,47,20],[49,23,47,21],[49,24,47,22],[50,6,48,4],[50,7,48,5],[51,6,50,4,"start"],[51,11,50,9],[51,12,50,10],[51,13,50,11],[52,6,51,4],[52,12,51,10,"interval"],[52,20,51,18],[52,23,51,21,"setInterval"],[52,34,51,32],[52,35,51,33],[52,41,51,39],[53,8,52,6,"pingOnce"],[53,16,52,14],[53,17,52,15],[53,18,52,16],[54,6,53,4],[54,7,53,5],[54,9,53,7,"intervalMs"],[54,19,53,17],[54,20,53,18],[55,6,55,4],[55,13,55,11],[55,19,55,17],[56,8,56,6,"alive"],[56,13,56,11],[56,16,56,14],[56,21,56,19],[57,8,57,6,"clearInterval"],[57,21,57,19],[57,22,57,20,"interval"],[57,30,57,28],[57,31,57,29],[58,6,58,4],[58,7,58,5],[59,4,59,2],[59,5,59,3],[59,7,59,5],[59,8,59,6,"enabled"],[59,15,59,13],[59,17,59,15,"intervalMs"],[59,27,59,25],[59,29,59,27,"isFocused"],[59,38,59,36],[59,40,59,38,"pingOnce"],[59,48,59,46],[59,49,59,47],[59,50,59,48],[60,2,60,0],[61,0,60,1],[61,3]],"functionMap":{"names":["<global>","usePresencePing","pingOnce","resp.text._catch$argument_0","useEffect$argument_0","start","setInterval$argument_0","<anonymous>"],"mappings":"AAA;OCG;+BCO;6CCe,QD;GDW;YGE;kBCM;KDG;iCEG;KFE;WGE;KHG;GHC;CDC"},"hasCjsExports":false},"type":"js/module"}]}