{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":45,"index":45}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":46},"end":{"line":2,"column":78,"index":124}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.useDrinkPerk = useDrinkPerk;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _tanstackReactQuery = require(_dependencyMap[1], \"@tanstack/react-query\");\n  async function fetchJson(url, options) {\n    const resp = await fetch(url, options);\n    if (!resp.ok) {\n      const text = await resp.text().catch(() => \"\");\n      throw new Error(`When fetching ${url}, the response was [${resp.status}] ${resp.statusText}. ${text}`);\n    }\n    return resp.json();\n  }\n  function useDrinkPerk(matchId, userId) {\n    const queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    const canQuery = Boolean(matchId) && Number.isFinite(Number(userId));\n    const perkQuery = (0, _tanstackReactQuery.useQuery)({\n      queryKey: [\"drinkPerk\", String(matchId), Number(userId)],\n      enabled: canQuery,\n      queryFn: async () => {\n        return fetchJson(`/api/drink-perk/${matchId}?userId=${Number(userId)}`);\n      },\n      staleTime: 0,\n      refetchInterval: 10_000\n    });\n    const pingLocationMutation = (0, _tanstackReactQuery.useMutation)({\n      mutationFn: async ({\n        lat,\n        lng,\n        accuracyM\n      }) => {\n        return fetchJson(`/api/drink-perk/${matchId}/ping`, {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify({\n            userId: Number(userId),\n            lat,\n            lng,\n            accuracyM\n          })\n        });\n      },\n      onSuccess: async () => {\n        await queryClient.invalidateQueries({\n          queryKey: [\"drinkPerk\", String(matchId), Number(userId)]\n        });\n      }\n    });\n    const startHandshakeMutation = (0, _tanstackReactQuery.useMutation)({\n      mutationFn: async () => {\n        return fetchJson(`/api/drink-perk/${matchId}/handshake/start`, {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify({\n            userId: Number(userId)\n          })\n        });\n      }\n    });\n    const confirmHandshakeMutation = (0, _tanstackReactQuery.useMutation)({\n      mutationFn: async ({\n        code\n      }) => {\n        return fetchJson(`/api/drink-perk/${matchId}/handshake/confirm`, {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify({\n            userId: Number(userId),\n            code\n          })\n        });\n      },\n      onSuccess: async () => {\n        await queryClient.invalidateQueries({\n          queryKey: [\"drinkPerk\", String(matchId), Number(userId)]\n        });\n      }\n    });\n    const statusQuery = (0, _tanstackReactQuery.useQuery)({\n      queryKey: [\"drinkHandshake\", String(matchId), Number(userId)],\n      enabled: false,\n      queryFn: async () => {\n        return fetchJson(`/api/drink-perk/${matchId}/handshake/status?userId=${Number(userId)}`);\n      },\n      staleTime: 0\n    });\n    const perkState = (0, _react.useMemo)(() => {\n      const state = String(perkQuery.data?.perk?.state || \"LOCKED\");\n      return state;\n    }, [perkQuery.data?.perk?.state]);\n    const hasDatePlan = Boolean(perkQuery.data?.date?.hasDatePlan);\n    const refetchAll = (0, _react.useCallback)(async () => {\n      await perkQuery.refetch();\n    }, [perkQuery]);\n    return {\n      canQuery,\n      perkQuery,\n      perkState,\n      hasDatePlan,\n      pingLocationMutation,\n      startHandshakeMutation,\n      confirmHandshakeMutation,\n      statusQuery,\n      refetchAll\n    };\n  }\n});","lineCount":117,"map":[[7,2,15,0,"exports"],[7,9,15,0],[7,10,15,0,"useDrinkPerk"],[7,22,15,0],[7,25,15,0,"useDrinkPerk"],[7,37,15,0],[8,2,1,0],[8,6,1,0,"_react"],[8,12,1,0],[8,15,1,0,"require"],[8,22,1,0],[8,23,1,0,"_dependencyMap"],[8,37,1,0],[9,2,2,0],[9,6,2,0,"_tanstackReactQuery"],[9,25,2,0],[9,28,2,0,"require"],[9,35,2,0],[9,36,2,0,"_dependencyMap"],[9,50,2,0],[10,2,4,0],[10,17,4,15,"fetchJson"],[10,26,4,24,"fetchJson"],[10,27,4,25,"url"],[10,30,4,28],[10,32,4,30,"options"],[10,39,4,37],[10,41,4,39],[11,4,5,2],[11,10,5,8,"resp"],[11,14,5,12],[11,17,5,15],[11,23,5,21,"fetch"],[11,28,5,26],[11,29,5,27,"url"],[11,32,5,30],[11,34,5,32,"options"],[11,41,5,39],[11,42,5,40],[12,4,6,2],[12,8,6,6],[12,9,6,7,"resp"],[12,13,6,11],[12,14,6,12,"ok"],[12,16,6,14],[12,18,6,16],[13,6,7,4],[13,12,7,10,"text"],[13,16,7,14],[13,19,7,17],[13,25,7,23,"resp"],[13,29,7,27],[13,30,7,28,"text"],[13,34,7,32],[13,35,7,33],[13,36,7,34],[13,37,7,35,"catch"],[13,42,7,40],[13,43,7,41],[13,49,7,47],[13,51,7,49],[13,52,7,50],[14,6,8,4],[14,12,8,10],[14,16,8,14,"Error"],[14,21,8,19],[14,22,9,6],[14,39,9,23,"url"],[14,42,9,26],[14,65,9,49,"resp"],[14,69,9,53],[14,70,9,54,"status"],[14,76,9,60],[14,81,9,65,"resp"],[14,85,9,69],[14,86,9,70,"statusText"],[14,96,9,80],[14,101,9,85,"text"],[14,105,9,89],[14,107,10,4],[14,108,10,5],[15,4,11,2],[16,4,12,2],[16,11,12,9,"resp"],[16,15,12,13],[16,16,12,14,"json"],[16,20,12,18],[16,21,12,19],[16,22,12,20],[17,2,13,0],[18,2,15,7],[18,11,15,16,"useDrinkPerk"],[18,23,15,28,"useDrinkPerk"],[18,24,15,29,"matchId"],[18,31,15,36],[18,33,15,38,"userId"],[18,39,15,44],[18,41,15,46],[19,4,16,2],[19,10,16,8,"queryClient"],[19,21,16,19],[19,24,16,22],[19,28,16,22,"useQueryClient"],[19,47,16,36],[19,48,16,36,"useQueryClient"],[19,62,16,36],[19,64,16,37],[19,65,16,38],[20,4,18,2],[20,10,18,8,"canQuery"],[20,18,18,16],[20,21,18,19,"Boolean"],[20,28,18,26],[20,29,18,27,"matchId"],[20,36,18,34],[20,37,18,35],[20,41,18,39,"Number"],[20,47,18,45],[20,48,18,46,"isFinite"],[20,56,18,54],[20,57,18,55,"Number"],[20,63,18,61],[20,64,18,62,"userId"],[20,70,18,68],[20,71,18,69],[20,72,18,70],[21,4,20,2],[21,10,20,8,"perkQuery"],[21,19,20,17],[21,22,20,20],[21,26,20,20,"useQuery"],[21,45,20,28],[21,46,20,28,"useQuery"],[21,54,20,28],[21,56,20,29],[22,6,21,4,"queryKey"],[22,14,21,12],[22,16,21,14],[22,17,21,15],[22,28,21,26],[22,30,21,28,"String"],[22,36,21,34],[22,37,21,35,"matchId"],[22,44,21,42],[22,45,21,43],[22,47,21,45,"Number"],[22,53,21,51],[22,54,21,52,"userId"],[22,60,21,58],[22,61,21,59],[22,62,21,60],[23,6,22,4,"enabled"],[23,13,22,11],[23,15,22,13,"canQuery"],[23,23,22,21],[24,6,23,4,"queryFn"],[24,13,23,11],[24,15,23,13],[24,21,23,13,"queryFn"],[24,22,23,13],[24,27,23,25],[25,8,24,6],[25,15,24,13,"fetchJson"],[25,24,24,22],[25,25,24,23],[25,44,24,42,"matchId"],[25,51,24,49],[25,62,24,60,"Number"],[25,68,24,66],[25,69,24,67,"userId"],[25,75,24,73],[25,76,24,74],[25,78,24,76],[25,79,24,77],[26,6,25,4],[26,7,25,5],[27,6,26,4,"staleTime"],[27,15,26,13],[27,17,26,15],[27,18,26,16],[28,6,27,4,"refetchInterval"],[28,21,27,19],[28,23,27,21],[29,4,28,2],[29,5,28,3],[29,6,28,4],[30,4,30,2],[30,10,30,8,"pingLocationMutation"],[30,30,30,28],[30,33,30,31],[30,37,30,31,"useMutation"],[30,56,30,42],[30,57,30,42,"useMutation"],[30,68,30,42],[30,70,30,43],[31,6,31,4,"mutationFn"],[31,16,31,14],[31,18,31,16],[31,24,31,16,"mutationFn"],[31,25,31,23],[32,8,31,25,"lat"],[32,11,31,28],[33,8,31,30,"lng"],[33,11,31,33],[34,8,31,35,"accuracyM"],[35,6,31,45],[35,7,31,46],[35,12,31,51],[36,8,32,6],[36,15,32,13,"fetchJson"],[36,24,32,22],[36,25,32,23],[36,44,32,42,"matchId"],[36,51,32,49],[36,58,32,56],[36,60,32,58],[37,10,33,8,"method"],[37,16,33,14],[37,18,33,16],[37,24,33,22],[38,10,34,8,"headers"],[38,17,34,15],[38,19,34,17],[39,12,34,19],[39,26,34,33],[39,28,34,35],[40,10,34,54],[40,11,34,55],[41,10,35,8,"body"],[41,14,35,12],[41,16,35,14,"JSON"],[41,20,35,18],[41,21,35,19,"stringify"],[41,30,35,28],[41,31,35,29],[42,12,36,10,"userId"],[42,18,36,16],[42,20,36,18,"Number"],[42,26,36,24],[42,27,36,25,"userId"],[42,33,36,31],[42,34,36,32],[43,12,37,10,"lat"],[43,15,37,13],[44,12,38,10,"lng"],[44,15,38,13],[45,12,39,10,"accuracyM"],[46,10,40,8],[46,11,40,9],[47,8,41,6],[47,9,41,7],[47,10,41,8],[48,6,42,4],[48,7,42,5],[49,6,43,4,"onSuccess"],[49,15,43,13],[49,17,43,15],[49,23,43,15,"onSuccess"],[49,24,43,15],[49,29,43,27],[50,8,44,6],[50,14,44,12,"queryClient"],[50,25,44,23],[50,26,44,24,"invalidateQueries"],[50,43,44,41],[50,44,44,42],[51,10,45,8,"queryKey"],[51,18,45,16],[51,20,45,18],[51,21,45,19],[51,32,45,30],[51,34,45,32,"String"],[51,40,45,38],[51,41,45,39,"matchId"],[51,48,45,46],[51,49,45,47],[51,51,45,49,"Number"],[51,57,45,55],[51,58,45,56,"userId"],[51,64,45,62],[51,65,45,63],[52,8,46,6],[52,9,46,7],[52,10,46,8],[53,6,47,4],[54,4,48,2],[54,5,48,3],[54,6,48,4],[55,4,50,2],[55,10,50,8,"startHandshakeMutation"],[55,32,50,30],[55,35,50,33],[55,39,50,33,"useMutation"],[55,58,50,44],[55,59,50,44,"useMutation"],[55,70,50,44],[55,72,50,45],[56,6,51,4,"mutationFn"],[56,16,51,14],[56,18,51,16],[56,24,51,16,"mutationFn"],[56,25,51,16],[56,30,51,28],[57,8,52,6],[57,15,52,13,"fetchJson"],[57,24,52,22],[57,25,52,23],[57,44,52,42,"matchId"],[57,51,52,49],[57,69,52,67],[57,71,52,69],[58,10,53,8,"method"],[58,16,53,14],[58,18,53,16],[58,24,53,22],[59,10,54,8,"headers"],[59,17,54,15],[59,19,54,17],[60,12,54,19],[60,26,54,33],[60,28,54,35],[61,10,54,54],[61,11,54,55],[62,10,55,8,"body"],[62,14,55,12],[62,16,55,14,"JSON"],[62,20,55,18],[62,21,55,19,"stringify"],[62,30,55,28],[62,31,55,29],[63,12,55,31,"userId"],[63,18,55,37],[63,20,55,39,"Number"],[63,26,55,45],[63,27,55,46,"userId"],[63,33,55,52],[64,10,55,54],[64,11,55,55],[65,8,56,6],[65,9,56,7],[65,10,56,8],[66,6,57,4],[67,4,58,2],[67,5,58,3],[67,6,58,4],[68,4,60,2],[68,10,60,8,"confirmHandshakeMutation"],[68,34,60,32],[68,37,60,35],[68,41,60,35,"useMutation"],[68,60,60,46],[68,61,60,46,"useMutation"],[68,72,60,46],[68,74,60,47],[69,6,61,4,"mutationFn"],[69,16,61,14],[69,18,61,16],[69,24,61,16,"mutationFn"],[69,25,61,23],[70,8,61,25,"code"],[71,6,61,30],[71,7,61,31],[71,12,61,36],[72,8,62,6],[72,15,62,13,"fetchJson"],[72,24,62,22],[72,25,62,23],[72,44,62,42,"matchId"],[72,51,62,49],[72,71,62,69],[72,73,62,71],[73,10,63,8,"method"],[73,16,63,14],[73,18,63,16],[73,24,63,22],[74,10,64,8,"headers"],[74,17,64,15],[74,19,64,17],[75,12,64,19],[75,26,64,33],[75,28,64,35],[76,10,64,54],[76,11,64,55],[77,10,65,8,"body"],[77,14,65,12],[77,16,65,14,"JSON"],[77,20,65,18],[77,21,65,19,"stringify"],[77,30,65,28],[77,31,65,29],[78,12,65,31,"userId"],[78,18,65,37],[78,20,65,39,"Number"],[78,26,65,45],[78,27,65,46,"userId"],[78,33,65,52],[78,34,65,53],[79,12,65,55,"code"],[80,10,65,60],[80,11,65,61],[81,8,66,6],[81,9,66,7],[81,10,66,8],[82,6,67,4],[82,7,67,5],[83,6,68,4,"onSuccess"],[83,15,68,13],[83,17,68,15],[83,23,68,15,"onSuccess"],[83,24,68,15],[83,29,68,27],[84,8,69,6],[84,14,69,12,"queryClient"],[84,25,69,23],[84,26,69,24,"invalidateQueries"],[84,43,69,41],[84,44,69,42],[85,10,70,8,"queryKey"],[85,18,70,16],[85,20,70,18],[85,21,70,19],[85,32,70,30],[85,34,70,32,"String"],[85,40,70,38],[85,41,70,39,"matchId"],[85,48,70,46],[85,49,70,47],[85,51,70,49,"Number"],[85,57,70,55],[85,58,70,56,"userId"],[85,64,70,62],[85,65,70,63],[86,8,71,6],[86,9,71,7],[86,10,71,8],[87,6,72,4],[88,4,73,2],[88,5,73,3],[88,6,73,4],[89,4,75,2],[89,10,75,8,"statusQuery"],[89,21,75,19],[89,24,75,22],[89,28,75,22,"useQuery"],[89,47,75,30],[89,48,75,30,"useQuery"],[89,56,75,30],[89,58,75,31],[90,6,76,4,"queryKey"],[90,14,76,12],[90,16,76,14],[90,17,76,15],[90,33,76,31],[90,35,76,33,"String"],[90,41,76,39],[90,42,76,40,"matchId"],[90,49,76,47],[90,50,76,48],[90,52,76,50,"Number"],[90,58,76,56],[90,59,76,57,"userId"],[90,65,76,63],[90,66,76,64],[90,67,76,65],[91,6,77,4,"enabled"],[91,13,77,11],[91,15,77,13],[91,20,77,18],[92,6,78,4,"queryFn"],[92,13,78,11],[92,15,78,13],[92,21,78,13,"queryFn"],[92,22,78,13],[92,27,78,25],[93,8,79,6],[93,15,79,13,"fetchJson"],[93,24,79,22],[93,25,80,8],[93,44,80,27,"matchId"],[93,51,80,34],[93,79,80,62,"Number"],[93,85,80,68],[93,86,80,69,"userId"],[93,92,80,75],[93,93,80,76],[93,95,81,6],[93,96,81,7],[94,6,82,4],[94,7,82,5],[95,6,83,4,"staleTime"],[95,15,83,13],[95,17,83,15],[96,4,84,2],[96,5,84,3],[96,6,84,4],[97,4,86,2],[97,10,86,8,"perkState"],[97,19,86,17],[97,22,86,20],[97,26,86,20,"useMemo"],[97,32,86,27],[97,33,86,27,"useMemo"],[97,40,86,27],[97,42,86,28],[97,48,86,34],[98,6,87,4],[98,12,87,10,"state"],[98,17,87,15],[98,20,87,18,"String"],[98,26,87,24],[98,27,87,25,"perkQuery"],[98,36,87,34],[98,37,87,35,"data"],[98,41,87,39],[98,43,87,41,"perk"],[98,47,87,45],[98,49,87,47,"state"],[98,54,87,52],[98,58,87,56],[98,66,87,64],[98,67,87,65],[99,6,88,4],[99,13,88,11,"state"],[99,18,88,16],[100,4,89,2],[100,5,89,3],[100,7,89,5],[100,8,89,6,"perkQuery"],[100,17,89,15],[100,18,89,16,"data"],[100,22,89,20],[100,24,89,22,"perk"],[100,28,89,26],[100,30,89,28,"state"],[100,35,89,33],[100,36,89,34],[100,37,89,35],[101,4,91,2],[101,10,91,8,"hasDatePlan"],[101,21,91,19],[101,24,91,22,"Boolean"],[101,31,91,29],[101,32,91,30,"perkQuery"],[101,41,91,39],[101,42,91,40,"data"],[101,46,91,44],[101,48,91,46,"date"],[101,52,91,50],[101,54,91,52,"hasDatePlan"],[101,65,91,63],[101,66,91,64],[102,4,93,2],[102,10,93,8,"refetchAll"],[102,20,93,18],[102,23,93,21],[102,27,93,21,"useCallback"],[102,33,93,32],[102,34,93,32,"useCallback"],[102,45,93,32],[102,47,93,33],[102,59,93,45],[103,6,94,4],[103,12,94,10,"perkQuery"],[103,21,94,19],[103,22,94,20,"refetch"],[103,29,94,27],[103,30,94,28],[103,31,94,29],[104,4,95,2],[104,5,95,3],[104,7,95,5],[104,8,95,6,"perkQuery"],[104,17,95,15],[104,18,95,16],[104,19,95,17],[105,4,97,2],[105,11,97,9],[106,6,98,4,"canQuery"],[106,14,98,12],[107,6,99,4,"perkQuery"],[107,15,99,13],[108,6,100,4,"perkState"],[108,15,100,13],[109,6,101,4,"hasDatePlan"],[109,17,101,15],[110,6,102,4,"pingLocationMutation"],[110,26,102,24],[111,6,103,4,"startHandshakeMutation"],[111,28,103,26],[112,6,104,4,"confirmHandshakeMutation"],[112,30,104,28],[113,6,105,4,"statusQuery"],[113,17,105,15],[114,6,106,4,"refetchAll"],[115,4,107,2],[115,5,107,3],[116,2,108,0],[117,0,108,1],[117,3]],"functionMap":{"names":["<global>","fetchJson","resp.text._catch$argument_0","useDrinkPerk","useQuery$argument_0.queryFn","useMutation$argument_0.mutationFn","useMutation$argument_0.onSuccess","useMemo$argument_0","refetchAll"],"mappings":"AAA;ACG;yCCG,QD;CDM;OGE;aCQ;KDE;gBEM;KFW;eGC;KHI;gBEI;KFM;gBEI;KFM;eGC;KHI;aCM;KDI;4BII;GJG;iCKI;GLE;CHa"},"hasCjsExports":false},"type":"js/module"}]}